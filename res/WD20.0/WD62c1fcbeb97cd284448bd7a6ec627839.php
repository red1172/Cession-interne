<?php
//20.0.56.0 FMK/Environnement.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 define('FMK_Environnement',true); class FMK_Environnement { var $m_tabassoInformations = array(); var $m_stNavigateurInfo = null; var $m_bNavigateurDetection = false; var $m_cszNavigateurVersionComplete = ''; } $_FMK_Environnement = null; class stNAVIGATEURINFO extends stSTRUCTURE { var $m_ePlateforme =0; var $m_eType =8; var $m_bRecent =false; var $m_nVersionMajeure =0; var $m_pszVersionComplete ='0'; } class stNAVIGATEUR extends stSTRUCTURE { var $m_eType; var $m_pszIdentifiant; var $m_nIdentifiantTaille; var $m_nMinVersionRecente; var $m_bRechercheVersionSurVersion; var $m_pfTraitement; } function& FMK_Environnement() { global $_FMK_Environnement; if (!isset($_FMK_Environnement)) { $_FMK_Environnement= new FMK_Environnement(); } return $_FMK_Environnement; } function Fc727f54d($sNom, $Valeur=null) { if (is_array($sNom)) { foreach ($sNom as $czNom => $nValeur){ Fc727f54d($czNom,$nValeur); } return; } $_FMK_Environnement =& FMK_Environnement(); $_FMK_Environnement->m_tabassoInformations[$sNom] = $Valeur; } function F5ff9334d($sNom) { if (is_array($sNom)) { $tabRetour = array(); foreach ($sNom as $czNom){ $tabRetour[] = F5ff9334d($czNom); } return $tabRetour; } $_FMK_Environnement =& FMK_Environnement(); if (!isset($_FMK_Environnement->m_tabassoInformations[$sNom])) return null; return $_FMK_Environnement->m_tabassoInformations[$sNom]; } function Fb4408787($Option = null) { $HTTP_ENV_VARS = array_merge(array_merge($_REQUEST,$_SERVER),$_ENV); $nTaille = utf8_strlen($Option); if (isset($Option)) $Option = utf8_strtolower($Option); return F150749fc($HTTP_ENV_VARS,$nTaille,$Option); } function F150749fc($tab,$nTaille,$Option) { $SysEnv = ''; reset($tab); while (key($tab) !== null) { $Env = ''; if (($Option === null) || ((utf8_substr(utf8_strtolower(key($tab)),0,$nTaille) == $Option))) { if (is_array( current($tab) )) { $Env = F150749fc( current($tab) ,$nTaille,$Option); } else { $Env = key($tab) . SepSysVar . current($tab); } $SysEnv .= (($SysEnv == '') ? '' : RC) . $Env; if ($Option !== null) break; } next($tab); } return $SysEnv; } function Faee3f2e8($VariableEnv) { $sResultat = Fb4408787($VariableEnv); return substr($sResultat,strpos($sResultat,SepSysVar)+strlen(SepSysVar)); } function F9fa5c586($tabOption,&$sEnvValeur) { foreach ($tabOption as $i => $sOption) { $sEnvValeur = Faee3f2e8($sOption); if ($sEnvValeur !== '') return $i; } return -1; } function Fda268110() { $sFamilleOS = php_uname('s'); switch ($sFamilleOS) { case 'Windows NT': { $sRelease = php_uname('r'); $sBuild = preg_replace('/[^0-9]/','',php_uname('v')); switch ($sRelease) { case '3.1': { return '32s'; } case '3.5': { return 'NT 3.5'; } case '3.51': { return 'NT 3.51'; } case '4.0': { return 'NT 4'; } case '5.0': { return 'NT 5'; } case '5.1': { return 'XP'; } case '5.2': { return '2003S'; } case '6.0': { switch($sBuild) { case '6000': return 'VISTA'; case '6001': return '2008S'; default: return 'VISTA'; } } case '6.1': { switch($sBuild) { case '7600': case '7601': return '7'; default: return '7'; } } default: if ((utf8_strpos(utf8_strtoupper($sFamilleOS),'WINDOWS '))===0) return utf8_substr($sFamilleOS,8); return ''; } } case 'Linux': case 'Unix': { return utf8_strtoupper($sFamilleOS); } break; default: return $sFamilleOS; } } function F78b7df27() { return isset($_SERVER['REMOTE_ADDR']) ? $_SERVER['REMOTE_ADDR'] : '127.0.0.1'; } function F595627bb() { return getenv("SERVER_NAME"); } function F5a48be2d($sFichier=null) { $szChemin = getenv("PATH_INFO");if ($szChemin!==false)$szChemin=dirname($szChemin); if ($szChemin===false) { $szChemin = getenv("ORIG_PATH_INFO"); if ($szChemin!==false) $szChemin=dirname($szChemin); } if ($szChemin===false) $szChemin = isset($_SERVER["PHP_SELF"]) ? dirname($_SERVER["PHP_SELF"]) : false; if ($szChemin===false) $szChemin = isset($_SERVER["REQUEST_URI"]) ? dirname($_SERVER["REQUEST_URI"]) : false; if ($szChemin===false) $szChemin = isset($_SERVER["SCRIPT_NAME"]) ? dirname($_SERVER['SCRIPT_NAME']) : false; if (!isset($sFichier)) return $szChemin; return utf8_str_replace('/./','/', F5b2f2e5c( '/',utf8_str_replace('\\','/',$szChemin) , utf8_str_replace('\\','/', $sFichier) ) ); } function& Fa136cbc9() { $_FMK_Environnement =& FMK_Environnement(); if (false === $_FMK_Environnement->m_bNavigateurDetection) F64fa908a(); return $_FMK_Environnement->m_stNavigateurInfo; } function F64fa908a() { $_FMK_Environnement =& FMK_Environnement(); $_FMK_Environnement->m_bNavigateurDetection=true; $m_stNavigateurInfo =& $_FMK_Environnement->m_stNavigateurInfo; $m_stNavigateurInfo = new stNAVIGATEURINFO(); $pszUserAgent = $_SERVER['HTTP_USER_AGENT']; $tabNavigateurs = array( new stNAVIGATEUR( 4, 'Opera/', 6, 9, true, '__NavigateurDetecte_Opera' ), new stNAVIGATEUR( 4, 'Opera ', 6, 9, true, '__NavigateurDetecte_Opera' ), new stNAVIGATEUR( 0, 'MSIE ', 5, 5, false, '__NavigateurDetecte_IE' ), new stNAVIGATEUR( 0, 'Trident/', 8, 0, 2, '__NavigateurDetecte_Generique'), new stNAVIGATEUR( 1, 'Firefox/', 8, 0, false, '__NavigateurDetecte_Generique' ), new stNAVIGATEUR( 6, 'Gecko/', 6, 0, false, '__NavigateurDetecte_Generique' ), new stNAVIGATEUR( 2, 'Chrome/', 7, 0, false, '__NavigateurDetecte_Generique' ), new stNAVIGATEUR( 3, 'Safari/', 7, 0, true, '__NavigateurDetecte_Generique' ), new stNAVIGATEUR( 5, 'WebKit/', 7, 0, false, '__NavigateurDetecte_Generique' ), new stNAVIGATEUR( 7, 'bot/', 4, 0, false, '__NavigateurDetecte_Robot' ), new stNAVIGATEUR( 7, 'Bot/', 4, 0, false, '__NavigateurDetecte_Robot' ), ); $nNbNavigateurs = count($tabNavigateurs,COUNT_NORMAL); for ($nNavigateur = 0; $nNavigateur < $nNbNavigateurs; ++$nNavigateur) { $rstNavigateur =& $tabNavigateurs[$nNavigateur]; if (false !== ($pszPos = utf8_strstr($pszUserAgent, $rstNavigateur->m_pszIdentifiant))) { call_user_func_array($rstNavigateur->m_pfTraitement,array($pszUserAgent, $pszPos, &$rstNavigateur)); return; } } if ((0 === utf8_strcasecmp($pszUserAgent, 'WWTest')) || (0 === utf8_strncasecmp($pszUserAgent, 'ROBOT_', 6))) { $m_stNavigateurInfo->m_ePlateforme = 7; $m_stNavigateurInfo->m_eType = 7; $m_stNavigateurInfo->m_nVersionMajeure = 0; $m_stNavigateurInfo->m_pszVersionComplete = null; $m_stNavigateurInfo->m_bRecent = true; } else { if (false === F088eac72($pszUserAgent)) { $m_stNavigateurInfo->m_ePlateforme = 0; } $m_stNavigateurInfo->m_eType = 8; $m_stNavigateurInfo->m_nVersionMajeure = 0; $m_stNavigateurInfo->m_pszVersionComplete = null; $m_stNavigateurInfo->m_bRecent = false; } } function F38c80677($pszPos,$nLongeurIdentifiant, $nMinPourRecent) { $pszPos = utf8_substr($pszPos,$nLongeurIdentifiant); $_FMK_Environnement =& FMK_Environnement(); $m_stNavigateurInfo =& $_FMK_Environnement->m_stNavigateurInfo; $m_stNavigateurInfo->m_nVersionMajeure = intval($pszPos); $pszFin1 = utf8_strstr($pszPos, ' '); $pszFin2 = utf8_strstr($pszPos, ';'); $pszFin = null; if (false !== $pszFin1) { if (false !== $pszFin2) { $pszFin = utf8_substr($pszPos,min(utf8_strlen($pszPos)-utf8_strlen($pszFin1), utf8_strlen($pszPos)-utf8_strlen($pszFin2))); } else { $pszFin = $pszFin1; } } else if (false !== $pszFin2) { $pszFin = $pszFin2; } if (false === $pszFin1) { $_FMK_Environnement->m_cszNavigateurVersionComplete = $pszPos; } else { $_FMK_Environnement->m_cszNavigateurVersionComplete = utf8_substr($pszPos,0,utf8_strlen($pszPos) - utf8_strlen($pszFin)); } $m_stNavigateurInfo->m_pszVersionComplete = $_FMK_Environnement->m_cszNavigateurVersionComplete; $m_stNavigateurInfo->m_bRecent = ($nMinPourRecent <= $m_stNavigateurInfo->m_nVersionMajeure); } function F088eac72($pszUserAgent) { $_FMK_Environnement =& FMK_Environnement(); $m_stNavigateurInfo =& $_FMK_Environnement->m_stNavigateurInfo; if (false !== utf8_strstr($pszUserAgent, 'iPhone')) { $m_stNavigateurInfo->m_ePlateforme = 1; return true; } else if ( (false !== utf8_strstr($pszUserAgent, 'iPad')) || (false !== utf8_strstr($pszUserAgent, 'IPAD')) ) { $m_stNavigateurInfo->m_ePlateforme = 2; return true; } else if (false !== utf8_strstr($pszUserAgent, 'BlackBerry')) { $m_stNavigateurInfo->m_ePlateforme = 3; return true; } else if ((false !== utf8_strstr($pszUserAgent, 'Windows CE')) || (false !== utf8_strstr($pszUserAgent, 'IEMobile'))) { if (false !== utf8_strstr($pszUserAgent, 'Windows Phone')) { $m_stNavigateurInfo->m_ePlateforme = 8; } else { $m_stNavigateurInfo->m_ePlateforme = 4; } return true; } else if ((false !== utf8_strstr($pszUserAgent, 'Android')) || (false !== utf8_strstr($pszUserAgent, 'android'))) { $m_stNavigateurInfo->m_ePlateforme = 5; return true; } else if ((false !== utf8_strstr($pszUserAgent, 'Nokia')) || (false !== utf8_strstr($pszUserAgent, 'nokia'))) { $m_stNavigateurInfo->m_ePlateforme = 6; return true; } else { return false; } } function F9861c3a5($pszUserAgent) { $_FMK_Environnement =& FMK_Environnement(); $m_stNavigateurInfo =& $_FMK_Environnement->m_stNavigateurInfo; if (false === F088eac72($pszUserAgent)) $m_stNavigateurInfo->m_ePlateforme = 6; } function __NavigateurDetecte_Generique ($pszUserAgent, $pszPos, $rstNavigateur) { $_FMK_Environnement =& FMK_Environnement(); $m_stNavigateurInfo =& $_FMK_Environnement->m_stNavigateurInfo; $m_stNavigateurInfo->m_eType = $rstNavigateur->m_eType; if (false == F088eac72($pszUserAgent)) { $m_stNavigateurInfo->m_ePlateforme = 0; } $pszPosVersion = $pszPos; $nVersionTaille = $rstNavigateur->m_nIdentifiantTaille; switch ($rstNavigateur->m_bRechercheVersionSurVersion) { case 1 : $pszPosVersionTest = utf8_strstr($pszUserAgent, 'Version/'); if (false !== $pszPosVersionTest) { $pszPosVersion = $pszPosVersionTest; $nVersionTaille = 8; } break; case 2: $pszPosVersionTest = utf8_strstr($pszUserAgent, 'rv:'); if (false !== $pszPosVersionTest) { $pszPosVersion = $pszPosVersionTest; $nVersionTaille = 3; } break; } F38c80677($pszPosVersion, $nVersionTaille, $rstNavigateur->m_nMinVersionRecente); } function __NavigateurDetecte_Opera ($pszUserAgent, $pszPos, $rstNavigateur) { __NavigateurDetecte_Generique($pszUserAgent, $pszPos, $rstNavigateur); if ( (false !== utf8_strstr($pszUserAgent, 'Opera Mini')) || (false !== utf8_strstr($pszUserAgent, 'Opera Mobi'))) { F9861c3a5($pszUserAgent); } } function __NavigateurDetecte_IE ($pszUserAgent, $pszPos, $rstNavigateur) { $_FMK_Environnement =& FMK_Environnement(); $m_stNavigateurInfo =& $_FMK_Environnement->m_stNavigateurInfo; __NavigateurDetecte_Generique($pszUserAgent, $pszPos, $rstNavigateur); if (false !== utf8_strstr($pszPos, 'Mac')) $m_stNavigateurInfo->m_bRecent = false; } function __NavigateurDetecte_Robot ($pszUserAgent, $pszPos, $rstNavigateur) { $_FMK_Environnement =& FMK_Environnement(); $m_stNavigateurInfo =& $_FMK_Environnement->m_stNavigateurInfo; __NavigateurDetecte_Generique($pszUserAgent, $pszPos, $rstNavigateur); $m_stNavigateurInfo->m_ePlateforme = 7; } function F0ff78ef2() { $stNavigateurInfo =& Fa136cbc9(); if (8 !== $stNavigateurInfo->m_eType) { return $stNavigateurInfo->m_bRecent; } return isset($_SERVER['HTTP_USER_AGENT']) && (($_SERVER['HTTP_USER_AGENT']) !== '') ; } function F13caba43($NomFichier=null,$nOptions=0) { $szHost = F595627bb(); $szChemin = F5a48be2d(); if (($szHost != '') && ($szHost[strlen($szHost) - 1] != '/') && ($szChemin != '') && ($szChemin[0] != '/')) { $szHost .= '/'; } switch ($nOptions) { default: case 0: return $NomFichier; case 1: return 'http://' . $szHost . F5b2f2e5c( '/'.$NomFichier , $szChemin ); case 2: return 'https://' . $szHost . F5b2f2e5c( '/'.$NomFichier , $szChemin ); default: return ''; } } ?>