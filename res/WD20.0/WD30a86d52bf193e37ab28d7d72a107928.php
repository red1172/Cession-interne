<?php
//20.0.56.0 WL/HF/Requete.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 if (!defined('__INC__FMK/Sql/Requete.php')) { define('__INC__FMK/Sql/Requete.php',true); include_once(WB_INCLUDE_PATH.'WD685f6c76702963c6b5794e529cb697ea.php'); } if (!defined('__INC__WL/HF/FichierHF.php')) { define('__INC__WL/HF/FichierHF.php',true); include_once(WB_INCLUDE_PATH.'WDabbd184f40b7c43204dbc386acb83648.php'); } class CRequete extends CFichierAnalyse { var $sCodeSQLInitial = ""; var $sCodeSQL = "" ; var $sCodeSQLSansQuote = "" ; var $bInit = false; var $nTypeRequete = REQUETE_SELECT; var $TabFichierRequete = array(); var $bOrderBy = false; var $RubriqueOrderBy = null; var $bAscOrderBy = true; var $bIgnoreClauseOrderBy = false; var $sOrderByInitial = ''; var $TabRubriqueOrderBy = array(); var $RubSequence = null; var $TabParamRequete = null; var $TabNomParamRequete = array(); var $m_clWDRInfo=null; var $bEstUneRequete = true; var $m_pclDernierInitRequete = null; function CRequete($Param = "") { $this->m_nIsXXX = $this->m_nIsXXX &~ 2 | 4; $sNom = ''; $sCodeSQL = null; if (is_array($Param)) { $sNom = $Param[0]; $sCodeSQL = $Param[1]; $this->m_clWDRInfo = $Param[2]; } else { $sNom = $Param; $this->m_clWDRInfo = new FMK_WDR_CHARGEUR($sNom,$sCodeSQL); } $this->sNom = $sNom; $this->sNomLogique = $sNom; $this->bInit = false; $this->sCodeSQLInitial = $this->m_clWDRInfo->F5b17b436(); $nMax = $this->m_clWDRInfo->Fe24f74db(); for($i=0; $i<$nMax; $i++) { $this->TabNomParamRequete[] = $this->m_clWDRInfo->F97b838ac($i); $this->TabParamRequete[utf8_strtolower(F03771b65($this->TabNomParamRequete[$i]))] = null; } } function& getProp($prop) { $err = false; $Retour =& Fff9feb7c($this->sNom, $prop,array('ERR'=>&$err)); if ($err) { return parent::getProp($prop); } return $Retour; } function F9656d042($prop,$valeur) { Ffe125dca($this->sNom, $prop, $valeur); } function F41e5bf49($RubriqueParcours = null, $nSensParcours = PARCOURS_PREMIER_SUIVANT) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F41e5bf49($this,$RubriqueParcours,$nSensParcours); } function F6526986d($sCodeSQL, $bSuppr, $nSensParcours=PARCOURS_PREMIER_SUIVANT) { $nPosition = utf8_strpos($sCodeSQL, $this->sOrderByInitial); if($nPosition === false) { return $sCodeSQL; } $pclAN =& $this->Fb56717be(); if (isset($pclAN)) { $clArbreRequete =& $this->m_clWDRInfo->F7361f67d(); if (isset($clArbreRequete)) { $sOrderBy = utf8_trim($pclAN->Fdf02384a($clArbreRequete,false,($nSensParcours!=PARCOURS_PREMIER_SUIVANT) )); } if($bSuppr) { $sCodeSQL = utf8_substr($sCodeSQL,0,$nPosition).utf8_substr($sCodeSQL,$nPosition + utf8_strlen($this->sOrderByInitial)); return $sCodeSQL; } else if(count($this->TabRubriqueOrderBy) > 0) { foreach($this->TabRubriqueOrderBy as $Rubrique) { $sOrderBy .= ",".$Rubrique->F0c01be43($this,$nSensParcours); } } $sCodeSQL = utf8_substr($sCodeSQL,0,$nPosition).$sOrderBy.utf8_substr($sCodeSQL,$nPosition + utf8_strlen($this->sOrderByInitial)); return $sCodeSQL; } else { if($bSuppr) { $sCodeSQL = utf8_substr($sCodeSQL,0,$nPosition).utf8_substr($sCodeSQL,$nPosition + utf8_strlen($this->sOrderByInitial)); return $sCodeSQL; } else if(count($this->TabRubriqueOrderBy) > 0) { $sOrderBy = $this->sOrderByInitial; foreach($this->TabRubriqueOrderBy as $Rubrique) { $sOrderBy .= ",".$Rubrique->F0c01be43($this,$nSensParcours); } $sCodeSQL = utf8_substr($sCodeSQL,0,$nPosition).$sOrderBy.utf8_substr($sCodeSQL,$nPosition + utf8_strlen($this->sOrderByInitial)); return $sCodeSQL; } return $sCodeSQL; } } function Fe8d9985a() { if(count($this->TabFichierRequete) == 0 || count($this->TabFichierRequete) > 1) { global $sLastFunction; Erreur('ErreurHF',"ErreurOperationNonSupportee", $sLastFunction); } $Fichier = current($this->TabFichierRequete); return $Fichier->Fe8d9985a(); } function F7653b31e() { if(count($this->TabFichierRequete) == 0 || count($this->TabFichierRequete) > 1) { global $sLastFunction; Erreur('ErreurHF',"ErreurOperationNonSupportee", $sLastFunction); } $Fichier = current($this->TabFichierRequete); return $Fichier->F7653b31e(); } function Fd5be2853($TabRub, $nTypeParcours) { if($this->bOrderBy) { if($this->bIgnoreClauseOrderBy) { $this->bIgnoreClauseOrderBy = false; return parent::Fd5be2853($TabRub, $nTypeParcours); } return null; } else { return parent::Fd5be2853($TabRub, $nTypeParcours); } } function Fa15cf330(&$RubriqueParcours) { if($this->bOrderBy && !$this->bIgnoreClauseOrderBy) { return $this->RubSequence; } else { return parent::Fa15cf330($RubriqueParcours); } } function F0e38ea93(&$Rubrique) { return parent::Fa15cf330($Rubrique); } function Fa84e48aa(&$RubriqueParcours, $bPremier = true, $nFlags = 0) { $this->F4b2e2367(); return parent::Fa84e48aa($RubriqueParcours, $bPremier, $nFlags); } function Fec3a1557(&$RubriqueParcours, $bSuivant = true, $nPas = 1) { $this->F4b2e2367(); return parent::Fec3a1557($RubriqueParcours, $bSuivant, $nPas); } function F218e30b2(&$RubriqueParcours, $sValeur, $bPremier = true, $nFlags = 0) { $this->F4b2e2367(); return parent::F218e30b2($RubriqueParcours, $sValeur, $bPremier, $nFlags); } function F7f79f122($nFlags, $sValeurRecherche= "", $RubriqueParcours = null, $bFiltre = false) { $this->F4b2e2367(); return parent::F7f79f122($nFlags, $sValeurRecherche, $RubriqueParcours, $bFiltre); } function F08a30ecf($nFlags) { $this->F4b2e2367(); return parent::F08a30ecf($nFlags); } function F3f143f5b($nFlags) { $this->F4b2e2367(); return parent::F3f143f5b($nFlags); } function F8ca9a29d($nFlags) { $this->F4b2e2367(); return parent::F8ca9a29d($nFlags); } function F5095ecf4() { $this->F4b2e2367(); return parent::F5095ecf4(); } function Fd90f4b71(&$RubriqueParcours) { $this->F4b2e2367(); return parent::Fd90f4b71($RubriqueParcours); } function F52830b80($sNomConnexion) { $this->F4b2e2367(); return parent::F52830b80($sNomConnexion); } function Fc7d0d5f9(&$CleComposee, $TabVal) { $this->F4b2e2367(); return parent::Fc7d0d5f9($CleComposee, $TabVal); } function F018e8e04() { $this->F4b2e2367(); return parent::F018e8e04(); } function Ff83132b7(&$RubriqueParcours, $BorneMin = NULL, $BorneMax = null, $sConditionSelection= "") { $this->F4b2e2367(); return parent::Ff83132b7($RubriqueParcours, $BorneMin, $BorneMax, $sConditionSelection); } function Fcae1f5c6(&$RubriqueParcours, $TabVal) { $this->F4b2e2367(); return parent::Fcae1f5c6($RubriqueParcours, $TabVal); } function Fd7f91600(&$RubriqueParcours, $TabVal) { $this->F4b2e2367(); return parent::Fd7f91600($RubriqueParcours, $TabVal); } function Fa7eacd58(&$Rubrique, $bAll = false) { $this->F4b2e2367(); return parent::Fa7eacd58($Rubrique, $bAll); } function Fd172163b(&$Rubrique) { $this->F4b2e2367(); return parent::Fd172163b($Rubrique); } function F4b2e2367() { if(!$this->bInit) { global $sLastFunction; Erreur('ErreurHF_1_Param',"ErreurRequeteNonInitialisee",$this->sNom, $sLastFunction); } } function Fad8a73f6() { $this->F4b2e2367(); if(isset($this->BestRub)) { return; } if ($this->nMode == H_REQUETE_SANS_CORRECTION) { $this->BestRub = new CRubriqueAnalyse(""); $this->BestRub->Fichier =& $this; return; } if(empty($this->TabRubriques)) { Erreur('ErreurGenerique',Fc34ec142("ERR_WLL"),Fc34ec142("ERR_FATAL"), "Erreur interne HF. Le fichier ".$this->sNom." n'a pas de rubriques." ); } else { $Rubrique =& $this->RubriqueOrderBy; if(!isset($Rubrique)) { $tab = array_keys($this->TabRubriques); $Rubrique =& $this->TabRubriques[$tab[0]]; foreach ($tab as $sNomRubrique) { $BestRub =& $this->TabRubriques[$sNomRubrique]; if ($BestRub->F805b1e57() > $Rubrique->F805b1e57()) { $Rubrique =& $BestRub; } } } $this->BestRub = &$Rubrique; } } function F36b4d334($sCodeSQL) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F36b4d334($this,$sCodeSQL); } function F8cd1fa6d($sSelect) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F8cd1fa6d($sSelect); } function Ff783b6ff($sExpression) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->Ff783b6ff($sExpression); } function F0dd17814($sCodeSQL) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F0dd17814($this,$sCodeSQL); } function Fa18b40ba($sCodeSQL) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->Fa18b40ba($this,$sCodeSQL); } function F08193936($sNomConnexion, $TabParam) { $pclAN =& $this->Fb56717be($sNomConnexion); if (isset($pclAN)) return $pclAN->F08193936($this,$sNomConnexion, $TabParam); } function F3bd60944($sCodeSQL) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F3bd60944($this,$sCodeSQL); } function F9d60968a($sCodeSQL) { return F9d60968a($sCodeSQL); } function& Fb56717be($sNomConnexion = null, $bSansErreur=false) { $ret = null; $pclContexteHF =& FMK_ContextHF(); if (empty($sNomConnexion)) { $sNomConnexion = $this->sNomConnexion; if (empty($sNomConnexion)) { $sNomFichier = $this->m_clWDRInfo->Fafa7a454(0); $pclFichier = F80229053($sNomFichier,false,false); if (isset($pclFichier)) { if (F929705c7($pclFichier)) $sNomConnexion = $pclFichier->sNomConnexion; elseif (Feee3b2d5($pclFichier)) { $pclAN =& $pclFichier->Fb56717be(); if (isset($pclAN)) { $pclConnexion =& $pclFichier->getConnexion(); $this->sNomConnexion = $pclConnexion->sNom; return $pclAN; } } } elseif(!isset($pclFichier)) { $sNomFichier = $this->m_clWDRInfo->F4b91a9e9(0); $pclFichier = F80229053($sNomFichier,false,false); if (isset($pclFichier)&&F929705c7($pclFichier)) $sNomConnexion = $pclFichier->sNomConnexion; } if (empty($sNomConnexion)) { $sNomConnexion = $this->m_clWDRInfo->F1e28af81(); if ((!isset($sNomConnexion)) || ($sNomConnexion===false)) { if ($bSansErreur) return $ret; else Fe81a7f9e('ERR_CONNEXION_REQUETE_NON_DETERMINEE',$this->sNom); } } } } $pclConnexion =& $pclContexteHF->getConnexion( $sNomConnexion ); if (isset($pclConnexion)) { $this->sNomConnexion = $sNomConnexion; if (!$pclConnexion->Fbe3f53b3()) $pclConnexion->Fb640a0ce(); return $pclConnexion->m_clAN; } return $ret; } } ?>