<?php
//20.0.56.0 IHM/Champ/Liste/Liste.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 if (!defined('__INC__IHM/Champ/Champ.php')) { define('__INC__IHM/Champ/Champ.php',true); include_once(WB_INCLUDE_PATH.'WD7c939e6867492a5e5416bd4b4327fac0.php'); } FMK_Charge('FMK/Tableau.php' ); define('TD_SUIVANT' , 'tdSuivant' ); define('TD_PRECEDENT' , 'tdPrecedent' ); define('TD_PAGESUIVANT' , 'tdPageSuivante' ); define('TD_PAGEPRECEDENT' , 'tdPagePrecedente' ); define('TD_PREMIER' , 'tdPremier' ); define('TD_DERNIER' , 'tdDernier' ); define('LIGNE_SELECTIONEE' , -1 ); define('ZR_RUPTURE_HAUT' ,0); define('ZR_RUPTURE_BAS' ,1); define('ZR_RUPTURE_ATTRIBUT' ,2); class CRuptureZR extends CChamp { var $m_bHaut; var $m_nIndice; var $ZR; function CRuptureZR(&$pclZR,$bHaut,$nIndice) { parent::CChamp(); $this->m_bHaut = $bHaut; $this->m_nIndice = $nIndice; $this->ZR = $pclZR->m_sNomPHP; } function& GetType() { return getRef(ID_PARTIERUPTUREZR); } function SetEnroule($bEnroule) { if (false != $this->m_bHaut) { $this->F7306bdb6($bEnroule); } else { Fe81a7f9e('ERR_BAS_RUPTURE_ENROULE',Fc34ec142('PROP_NOM_ENROULE'),Fc34ec142('FCT_ZONEREPETEEINDICERUPTURE')); } if(Feef890d7()) { $pclZR =& $GLOBALS[$this->ZR]; F2afdeace($pclZR->m_sNomPHP); $pclZR->F8723e249($pclZR->GetFirstIndex() + 1 ); } } function& GetEnroule() { $retour = null; if (false != $this->m_bHaut) { $retour = $this->Fc676633a(); } else { Fe81a7f9e('ERR_BAS_RUPTURE_ENROULE',Fc34ec142('PROP_NOM_ENROULE'),Fc34ec142('FCT_ZONEREPETEEINDICERUPTURE')); } return $retour; } function Fc676633a() { $pclZR =& $GLOBALS[$this->ZR]; if ($pclZR === null) return false; $nNumLigne = $pclZR->F63ff45c7(); if (NUMLIGNE_INVALIDE != $nNumLigne) { $nIndiceRupture = $pclZR->F342a28c1($this); if (-1 != $nIndiceRupture) { return $pclZR->F9ade75fe($nNumLigne-1, $nIndiceRupture); } } return false; } function F7306bdb6($bEnroule) { $pclZR =& $GLOBALS[$this->ZR]; $nNumLigne = $pclZR->F63ff45c7(); if (NUMLIGNE_INVALIDE != $nNumLigne) { $nIndiceRupture = $pclZR->F342a28c1($this); if (-1 != $nIndiceRupture) { $pclZR->Feae52488($nNumLigne-1, $nIndiceRupture, $bEnroule); } } } } class CLigneListe extends CObjetBase { var $Liste; var $ValeurAff; var $m_bContientGARecuperer = false; var $m_bContientGLien = false; var $Indice; var $__ValeurOrigine; function CLigneListe($L, $Valeur) { $this->Liste = $L->m_sNomPHP; $this->SetValeur( $Valeur ); } function& F1e21db15() { $s = 'TYPEWL_NOM_LIGNELISTE'; return $s; } function F70cea20e() { return false; } function& Feeaf870e() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_CURSEUR"),F3b9ec4ca($this)); return RetourErreur_Entier; } function F18fc7cff($nCurseur) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_CURSEUR"),F3b9ec4ca($this)); } function& GetPoliceTaille() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICETAILLE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceTaille($nPoliceTaille) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICETAILLE"),F3b9ec4ca($this)); } function& GetPoliceSoulignee() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICESOULIGNEE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceSoulignee($bPoliceSoulignee) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICESOULIGNEE"),F3b9ec4ca($this)); } function& GetPoliceNom() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICENOM"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceNom($sPoliceNom) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICENOM"),F3b9ec4ca($this)); } function& GetPoliceItalique() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEITALIQUE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceItalique($bPoliceItalique) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEITALIQUE"),F3b9ec4ca($this)); } function& GetPoliceGras() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEGRAS"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceGras($bPoliceGras) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEGRAS"),F3b9ec4ca($this)); } function& GetCadrageVertical() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_CADRAGEVERTICAL"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetCadrageVertical($nCadrageVertical) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_CADRAGEVERTICAL"),F3b9ec4ca($this)); } function& GetHTMLAvant() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_HTMLAVANT"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetHTMLAvant($sHTMLAvant) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_HTMLAVANT"),F3b9ec4ca($this)); } function& GetHTMLApres() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_HTMLAPRES"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetHTMLApres($sHTMLApres) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_HTMLAPRES"),F3b9ec4ca($this)); } function& GetBulle() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_BULLE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetBulle($sBulle) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_BULLE"),F3b9ec4ca($this)); } function& GetLargeur() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_LARGEUR"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetLargeur($nLargeur) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_LARGEUR"),F3b9ec4ca($this)); } function SetCouleur($dwCoul) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_COULEUR"),F3b9ec4ca($this)); } function& GetCouleur() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_COULEUR"),F3b9ec4ca($this)); } function SetCouleurFond($dwCoul) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_COULEURFOND"),F3b9ec4ca($this)); } function& GetCouleurFond() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_COULEURFOND"),F3b9ec4ca($this)); } function SetValeur($Valeur) { XVERIFY( F159221ea($Valeur, $this->m_bContientGLien, $this->m_bContientGARecuperer, $this->Valeur, $this->ValeurAff) ); if ($this->m_bContientGLien) { $ChampListe = &$GLOBALS[$this->Liste]; $ChampListe->m_bAuMoinsUnGLien = true; } $this->__ValeurOrigine = $Valeur; if(Feef890d7()) { $ChampListe = &$GLOBALS[$this->Liste]; if (isset($ChampListe)) F2afdeace($ChampListe->m_sNomPHP); } } function& GetValeur() { $pclChampListe =& $GLOBALS[$this->Liste]; if ($pclChampListe->m_bGlienActif) { return $this->Valeur; } elseif ($this->m_bContientGARecuperer) { return $this->Valeur; } return $this->ValeurAff; } function& GetValeurMemorisee() { $pclChampListe =& $GLOBALS[$this->Liste]; if ($pclChampListe->F48dce54a() && (!empty($pclChampListe->sRubriqueMemorisee) && isset($pclChampListe->TabValeurMemorisee) && array_key_exists($pclChampListe->Valeur,$pclChampListe->TabValeurMemorisee)) ) { return $pclChampListe->TabValeurMemorisee[$pclChampListe->Valeur]; } return $this->GetValeur(); } function GetValeurHTML( $TypeConvertion = 0 ) { if ($TypeConvertion==2) return $this->GetValeurAffichee(); $Res = utf8_htmlentities( $this->GetValeurAffichee() , ENT_NOQUOTES ); $Res = utf8_str_replace("\r\n", '<BR>', $Res ); $Res = utf8_str_replace("\n", '<BR>', $Res ); $Res = utf8_str_replace("\r", '<BR>', $Res ); return $Res; } function& GetValeurAffichee() { if ($this->m_bContientGARecuperer) $retour = utf8_str_replace(utf8_chr(27).'V','',$this->__ValeurOrigine); else { $retour = $this->ValeurAff; } return $retour; } function IsSelected() { return $GLOBALS[$this->Liste]->selected($this->Indice); } function F2a3fd3f7($Ind) { $this->Indice = $Ind; } } class CListe extends CChamp { var $TabLigne; var $nNbMaxLigne = 100; var $TabValeurMemorisee = null; var $bInitRemplissage = false; var $bInitLiaison = false; var $m_nTriOptions = triDéfaut; var $m_bTriSens = true; var $m_bEstTrie = false; var $m_nIndiceAffichage=null; var $Occurrence; var $m_tabInfo1ereLignePerso = null; var $bPcodeAffichageEnCours = false; var $m_pclIterateur; var $m_bGlienActif = true; var $m_bAuMoinsUnGLien = false; var $sRubriqueParcoursAffichee= ""; function CListe() { parent::CChamp(); $this->TabLigne = array(); $this->Occurrence = 0; $this->Valeur = -1; } function& Fd135d1c5($Valeur) { $pclLigne = new CLigneListe($this,$Valeur); return $pclLigne; } function F9888ce5c() { if (Fa966307f($this) && !$this->F48dce54a()) { $this->ValeurInitiale = _clone($this->Valeur); $this->ContenuInitial = _clone($this->TabLigne); } } function Fc6eb41aa() { if (Fa966307f($this) && !$this->F48dce54a()) { $this->Valeur = _clone($this->ValeurInitiale); $this->TabLigne = _clone($this->ContenuInitial); } } function Fd4c80e66( $nIndiceC, $bAvecErreur=false ) { $nMax = count($this->TabLigne,COUNT_NORMAL); if (($nIndiceC<0) || ($nIndiceC >= $nMax) ) { if ($bAvecErreur) { F67cfd262(); Fdd46bacf(FMK_ChaineConstruit(Fc34ec142('ERR_OUTOFBOUND'),$nIndiceC+1,$this->Fd464306b(),1,$nMax)); } return false; } return true; } function Fdc05d49f( $ValeurHTTP ) { if (!is_numeric($ValeurHTTP)) $ValeurHTTP = -1; $this->F37bb1c9f($ValeurHTTP); if(Feef890d7()) { F694db118($this->m_sNomPHP); } } function WB_Set1ereLignePerso($sValeurAffichee,$sValeurMemorisee) { $this->m_tabInfo1ereLignePerso = array( 0=>$sValeurAffichee, 1=>$sValeurMemorisee, ); } function& GetNbLignesParPage() { return $this->nMaxLignePage; } function SetNbLignesParPage($n) { $this->nMaxLignePage=(int)$n; $this->ListeAffiche(); if(Feef890d7()) { F2afdeace($this->m_sNomPHP); $this->F8723e249($this->GetFirstIndex() + 1); } } function SetOptionTri($nOptions = triDéfaut) { $this->m_nTriOptions = $nOptions; $this->ListeTrie(true,$nOptions); } function& GetOptionTri() { $RetourParDefaut = null; if ($this->F48dce54a()) return $RetourParDefaut; return $this->m_nTriOptions; } function Fc0939050(&$tabLigne,$nIndexSource,$nIndexDestination) { $ElementDestination = $tabLigne[$nIndexDestination]; $tabLigne[$nIndexDestination] = $tabLigne[$nIndexSource]; $tabLigne[$nIndexSource] = $ElementDestination; } function F11d9860e(&$tabLigne,$nIndexSource,$nIndexDestination) { $ElementSource = $tabLigne[$nIndexSource]; $tabDeplacement = array(0); $tabDeplacement = array_merge($tabDeplacement,$tabLigne); array_splice($tabDeplacement,$nIndexSource,1); if ($nIndexSource<$nIndexDestination) { array_splice($tabDeplacement,$nIndexDestination-1,1,array($tabDeplacement[$nIndexDestination-1],$ElementSource)); } else { array_splice($tabDeplacement,$nIndexDestination,1,array($ElementSource,$tabDeplacement[$nIndexDestination])); } unset($tabDeplacement[0]); $tabLigne = $tabDeplacement; } function ListeDeplaceLigne($nIndexSource, $DestinationOuInc, $nType = null, $sFonctionOrigine = 'FCT_LISTEDEPLACELIGNE') { if ((!isset($nType))) { $nType = TD_DEPLACE; } if ( $nIndexSource == LIGNE_SELECTIONEE) { $nIndexSource = $this->Valeur; } $nLigneListe = count($this->TabLigne,COUNT_NORMAL); if ( ($nIndexSource < 1) || ($nIndexSource > $nLigneListe) ) { Fe81a7f9e('ERR_PARAMETRE_VALEUR_INCORRECT',$sFonctionOrigine); } $nIndexDestination = 0; if (is_numeric($DestinationOuInc)) { $nIndexDestination = intval($DestinationOuInc); } else { switch ($DestinationOuInc) { case TD_PREMIER: $nIndexDestination = 1; break; case TD_DERNIER: $nIndexDestination = $nLigneListe; break; case TD_PRECEDENT: $nIndexDestination = $nIndexSource - 1; break; case TD_SUIVANT: $nIndexDestination = $nIndexSource + 1; break; case TD_PAGESUIVANT: case TD_PAGEPRECEDENT: default: Fe81a7f9e('ERR_DEPLACELIGNE_VALEUR_DEPLACEMENT_INVALIDE',$sFonctionOrigine,$DestinationOuInc); } } if ($nIndexDestination < 1) $nIndexDestination = 1; elseif ($nIndexDestination > $nLigneListe) $nIndexDestination = $nLigneListe; if ($nIndexSource == $nIndexDestination) { return $nIndexSource; } if ($nType & TD_ECHANGE) { $this->Fc0939050($this->TabLigne,$nIndexSource,$nIndexDestination); if ($nIndexDestination == $this->Valeur) { $this->Valeur = $nIndexSource; } elseif ($nIndexSource == $this->Valeur) { $this->Valeur = $nIndexDestination; } if ($this->F48dce54a()) { $this->Fc0939050($this->TabPosition,$nIndexSource,$nIndexDestination); if(!empty($this->sRubriqueMemorisee)) { $this->Fc0939050($this->TabValeurMemorisee,$nIndexSource,$nIndexDestination); } } } else { $this->F11d9860e($this->TabLigne,$nIndexSource,$nIndexDestination); if ($nIndexSource == $this->Valeur) { $this->Valeur = $nIndexDestination; } elseif ( ($nIndexDestination <= $this->Valeur) && ($this->Valeur < $nIndexSource) ) { $this->Valeur = max(1,$this->Valeur-1); } elseif ( ($nIndexDestination >= $this->Valeur) && ($this->Valeur > $nIndexSource) ) { $this->Valeur = min(count($this->TabLigne,COUNT_NORMAL),$this->Valeur+1); } else { } if ($this->F48dce54a()) { $this->F11d9860e($this->TabPosition,$nIndexSource,$nIndexDestination); if(!empty($this->sRubriqueMemorisee)) { $this->F11d9860e($this->TabValeurMemorisee,$nIndexSource,$nIndexDestination); } } } if ($nType & TD_AFFICHE_DESTINATION) { if ( $sFonctionOrigine == 'FCT_LISTEDEPLACELIGNE' ) { Fe81a7f9e('ERR_PARAMETRE_VALEUR_INCORRECT',$sFonctionOrigine); } $this->m_nIndiceAffichage=$nIndexDestination; if(isset($this->Reglette)) { $Reglette = &$this->Reglette; $Reglette->FirstItem(); while($Reglette->F1ce8f6aa()*$this->F56a8269c()<$nIndexDestination){$Reglette->F27083b0f();} } else { $this->SetFirstIndex($nIndexDestination); } } if(Feef890d7()) { F2afdeace($this->m_sNomPHP); } return $nIndexDestination; } function SetFirstIndex($nIndex) { $this->nFirstIndex = $nIndex; } function ZoneRepeteeDeplaceLigne($nIndexSource, $DestinationOuInc, $sType = null) { return $this->ListeDeplaceLigne($nIndexSource, $DestinationOuInc, $sType, 'FCT_ZONEREPETEEDEPLACELIGNE'); } function TableDeplaceLigne($nIndexSource, $DestinationOuInc, $sType = null) { return $this->ListeDeplaceLigne($nIndexSource, $DestinationOuInc, $sType, 'FCT_TABLEDEPLACELIGNE'); } function TableEchangeLigne($nIndiceSource,$nIndiceDestination) { return $this->TableDeplaceLigne($nIndiceSource,$nIndiceDestination,TD_ECHANGE); } function ListeAjoute( $szElements = '' ) { if ( utf8_strpos( $szElements, "\n") != -1) { $szElementsRC = utf8_str_replace("\r\n", "\n", $szElements ); $TabStrLigne = utf8_explode( "\n", $szElementsRC ); $nType = $this->GetType(); $bIlFautTrier = ( ($this->m_bEstTrie) && ( ($nType==TYPE_CHAMP_LISTE) || ($nType==TYPE_CHAMP_COMBO) ) ); if ($bIlFautTrier ) foreach ( $TabStrLigne as $Indice => $szLigne ) $this->ListeInsere($szLigne); else foreach ( $TabStrLigne as $Indice => $szLigne ) $this->F5eadf367($szLigne); } else { if ($bIlFautTrier) { $this->ListeInsere($szElements); } else { $this->F5eadf367( $szElements ); } } if(Feef890d7()) { F2afdeace($this->m_sNomPHP); } } function F5eadf367( $Ligne = '' ) { if (!is_object($Ligne)) $Ligne = $this->Fd135d1c5($Ligne); if ( count($this->TabLigne,COUNT_NORMAL) == 0) { $this->TabLigne[1] = &$Ligne; $this->F37bb1c9f(1); } else { $this->TabLigne[$this->Occurrence + 1] = &$Ligne; } ++$this->Occurrence; return true; } function F8f604d1e($pclLigne) { $nOccurrence = $this->GetOccurrence(); for($nIndiceLigneCourante=1; $nIndiceLigneCourante<=$nOccurrence; ++$nIndiceLigneCourante) { $nResultat = $this->_procCompareLigneListe($pclLigne,$this->TabLigne[$nIndiceLigneCourante]); if ( ($nResultat == -1) || ($nResultat == 0) ) { return $nIndiceLigneCourante; } } return count($this->TabLigne,COUNT_NORMAL)+1; } function ListeTrie($bSensCroissant = true, $nOptions = null) { if (!isset($nOptions)) $nOptions = $this->m_nTriOptions; if ($this->F48dce54a()) return; if ( ($this->GetType()!=TYPE_CHAMP_LISTE) && ($this->GetType()!=TYPE_CHAMP_COMBO) ) return; $bTmpSensCroissant = $this->m_bTriSens; $nTmpOptions = $this->m_nTriOptions; $bTmpEstTrie = $this->m_bEstTrie; $this->m_bTriSens = $bSensCroissant; $this->m_nTriOptions = $nOptions; $temp = array_values($this->TabLigne); if(utf8_usort($temp, array(&$this,'_procCompareLigneListe'))) { $this->TabLigne = array_values($temp); array_unshift($this->TabLigne,0); unset($this->TabLigne[0]); } $this->m_bTriSens = $bTmpSensCroissant; $this->m_nTriOptions = $nTmpOptions; $this->m_bEstTrie = $bTmpEstTrie; } function _procCompareLigneListe($pclValeur1, $pclValeur2) { $nResultat = 0; if(!isset($pclValeur1)) { $nResultat = 1; } else if(!isset($pclValeur2)) { $nResultat = 1; } else { $nOptions = $this->m_nTriOptions; if (F5f7235e7($nOptions,nTRI_SANSFONCTIONGRAPH)) { if ($pclValeur1->m_bContientGLien && !$pclValeur2->m_bContientGLien) return -1; else if (!$pclValeur1->m_bContientGLien && $pclValeur2->m_bContientGLien) return 1; } $nResultat = Fd01c6d85($pclValeur1->Valeur,$pclValeur2->Valeur,F166fddb3($nOptions,nTRI_SANSFONCTIONGRAPH),true); } if(!$this->m_bTriSens) { return -$nResultat; } return $nResultat; } function F07f90bd2($Ligne) { $resultat = $this->F5eadf367($Ligne); if(Feef890d7()) { F2afdeace($this->m_sNomPHP); } return $resultat; } function Feea2b21b($nIndice, &$Element) { $this->TabLigne[$nIndice]->SetValeur($Element); $this->TabLigne[$nIndice]->Indice = $nIndice; } function ListeModifie( $ELEMENT, $Indice=-1 ) { if ($Indice == -1) $Indice = $this->Valeur; if (!isset($this->TabLigne[$Indice])) return -1; $nTypeChamp = $this->GetType(); if ($this->m_bEstTrie) { if ( ($nTypeChamp==TYPE_CHAMP_LISTE) || ($nTypeChamp==TYPE_CHAMP_COMBO)) { $this->ListeSupprime($Indice); $this->ListeAjoute($ELEMENT); } } else { $this->Feea2b21b($Indice,$ELEMENT); } if(Feef890d7() && $nTypeChamp != TYPE_CHAMP_TABLE && $nTypeChamp != TYPE_CHAMP_ZR && $nTypeChamp !=TYPE_CHAMP_ZRLINEAIRE) { F2afdeace($this->m_sNomPHP); } return $Indice; } function Fcfb6d1e2($ELEMENT, $Indice=-1) { if (!is_object($ELEMENT)) $ELEMENT = $this->Fd135d1c5($ELEMENT); if ($Indice > count($this->TabLigne,COUNT_NORMAL)) { $this->F5eadf367($ELEMENT); return -1; } array_unshift($this->TabLigne,0); array_splice($this->TabLigne,$Indice,1,array($ELEMENT,$this->TabLigne[$Indice])); unset($this->TabLigne[0]); ++$this->Occurrence; if (($this->Valeur > 0) && ($this->Valeur >= $Indice)) { ++$this->Valeur; } } function ListeInsere( $ELEMENT, $Indice=-1 ) { if ($Indice == -1) $Indice = $this->Valeur; if ($Indice <= 0) $Indice = 1; $Ligne =& $this->Fd135d1c5($ELEMENT); if ( ($this->GetType()==TYPE_CHAMP_LISTE) || ($this->GetType()==TYPE_CHAMP_COMBO)) { if ( ($this->m_bEstTrie) && ( ($nNouvellePosition = $this->F8f604d1e($Ligne)) != $Indice) ) { $Indice = $nNouvellePosition; } } $this->Fcfb6d1e2($Ligne,$Indice); if(Feef890d7()) { F2afdeace($this->m_sNomPHP); } return $Indice; } function ListeSupprime( $Indice=-1 ) { if($this->F48dce54a()) { return -1; } if ($Indice == -1) $Indice = $this->Valeur; if ($Indice < 1) return -1; if ($Indice > count($this->TabLigne,COUNT_NORMAL)) return -1; unset($this->TabLigne[$Indice]); array_unshift($this->TabLigne,0); $this->TabLigne = array_values($this->TabLigne); unset($this->TabLigne[0]); --$this->Occurrence; if ($this->Valeur >= $this->Occurrence) { $this->Valeur = -1; } $nTypeChamp = $this->GetType(); if(Feef890d7() && $nTypeChamp != TYPE_CHAMP_TABLE && $nTypeChamp != TYPE_CHAMP_ZR && $nTypeChamp !=TYPE_CHAMP_ZRLINEAIRE) { F2afdeace($this->m_sNomPHP); } return $Indice; } function ListeSupprimeTout() { $this->TabLigne = array(); $this->Occurrence = 0; $this->Valeur = -1; if(Feef890d7()) { F2afdeace($this->m_sNomPHP); } } function ListeOccurrence() { $nOccurrence = count($this->TabLigne,COUNT_NORMAL); return $nOccurrence; } function& GetOccurrence() { $nOccurrence = count($this->TabLigne,COUNT_NORMAL); return $nOccurrence; } function& GetVide() { $bProprieteVide = ($this->GetOccurrence() == 0); return $bProprieteVide; } function ListeCherche( $ValeurRech ) { $Indice=0; while(isset($this->TabLigne[++$Indice])) { $Valeur = GetValeur($this->GetValI($Indice)); if ($ValeurRech == $Valeur) return $Indice; } return -1; } function ListeSelectPlus() { $selection = func_get_args(); if(isset($selection) && !empty($selection)) { $this->Valeur= $selection[0]; } else { $this->Valeur = -1; } if(Feef890d7()) { F694db118($this->m_sNomPHP); } } function ListeSelectMoins() { $deselection = func_get_args(); if (!isset($deselection) || empty($deselection) || $deselection[0] == -1 || $deselection[0] == $this->Valeur) { $this->Valeur = -1; if(Feef890d7()) { F694db118($this->m_sNomPHP); } } } function Fd13d5087() { $this->ListeSelectPlus(1); } function selected( $Indice ) { if ($this->Valeur == -1) { return false; } return $this->Valeur == $Indice; } function Fc8e0ba0f() { return $this->Valeur; } function ListeSelect( $nIndiceSel=1 ) { if ($nIndiceSel != 1) return -1; return $this->Valeur; } function ListeSelectOccurrence() { if($this->Valeur == -1) { return 0; } return 1; } function& GetValI( $Indice ) { $sRetourParDefaut = ""; if ($Indice < 1) return $sRetourParDefaut; if ($Indice > count($this->TabLigne,COUNT_NORMAL)) return $sRetourParDefaut; $this->TabLigne[ $Indice ]->Indice = $Indice; $this->TabLigne[ $Indice ]->Liste = $this->m_sNomPHP; return $this->TabLigne[ $Indice ]; } function SetValI( $Indice, $Val ) { if ($Indice < 1) return; if ($Indice > count($this->TabLigne,COUNT_NORMAL)) return; $this->Feea2b21b($Indice,$Val); if(Feef890d7()) { F2afdeace($this->m_sNomPHP); } } function F37bb1c9f($Valeur) { $this->Valeur = (int)($Valeur); } function& GetValeurAffichee() { $retour = ''; if ($this->Valeur == -1 || !array_key_exists($this->Valeur,$this->TabLigne)) { return $retour; } $retour = $this->TabLigne[$this->Valeur]->GetValeurAffichee(); return $retour; } function Ff11ff472($xValeurAffichee) { return $this->TabLigne[$xValeurAffichee]->m_bContientGLien ? $this->TabLigne[$xValeurAffichee]->GetValeur() : $xValeurAffichee; } function& GetValeurMemorisee() { $retour = ''; if ($this->Valeur == -1) { return $retour; } $retour = $this->TabLigne[$this->Valeur]->GetValeurMemorisee(); return $retour; } function SetValeur($NewVal) { if ((isset($this->TabValeurMemorisee) && is_array($this->TabValeurMemorisee)) || $this->m_bAuMoinsUnGLien) { if ($this->F48dce54a()) { $nPos = array_search($NewVal,$this->TabValeurMemorisee); if ( ($nPos === null) || ($nPos === false) ) { $nPos = $NewVal; } } else { $nPos = $this->ListeCherche($NewVal); } } else { $nPos = $NewVal; } $this->F37bb1c9f($nPos); if(Feef890d7()) { F694db118($this->m_sNomPHP); } } function& GetValeur() { if ($this->F48dce54a()) { if (isset($this->TabValeurMemorisee) && array_key_exists($this->Valeur,$this->TabValeurMemorisee)) { return $this->TabValeurMemorisee[$this->Valeur]; } } if(empty($this->Valeur)) { $nRetour = -1; return $nRetour; } return parent::GetValeur(); } function& GetType() { return getRef(TYPE_CHAMP_LISTE); } function F4a917fa4() { return 7; } function SetRubriqueParcourue($sNomRubrique) { $bSensAsc = true; if(utf8_strlen($sNomRubrique) > 0 && utf8_substr($sNomRubrique,0 , 1) == '-') { $bSensAsc = false; $sNomRubrique = utf8_substr($sNomRubrique, 1,utf8_strlen($sNomRubrique)); } if(array_key_exists(utf8_strtolower(F03771b65($sNomRubrique)), $this->FichierParcours->TabNomRubriqueSansAccent)) { $this->RubriqueParcours = &$this->FichierParcours->F133178d5($sNomRubrique); $this->bParcoursAsc = $bSensAsc; if($this->bInitRemplissage) { $this->ListeAffiche(TA_DEBUT); } } } function& GetRubriqueParcourue() { $RetourParDefaut = ""; if(isset($this->RubriqueParcours)) { return $this->RubriqueParcours->sNom; } return $RetourParDefaut; } function SetSourceRemplissage($sFichierParcours, $sRubriqueParcours, $sRubriqueAffichee, $sRubriqueMemorisee, $bParcoursAsc, $sValeurRecherche, $nNbMaxLigne) { $this->FichierParcours = &Fbad7a601($sFichierParcours); if(!empty($sRubriqueParcours)) { $this->RubriqueParcours = $sRubriqueParcours; } $this->sRubriqueAffichee = $sRubriqueAffichee; $this->sRubriqueParcoursAffichee = $sRubriqueAffichee; $this->sRubriqueMemorisee = $sRubriqueMemorisee; $this->bParcoursAsc = $bParcoursAsc; $this->sValeurRecherche = $sValeurRecherche; $this->nNbMaxLigne = $nNbMaxLigne; } function F7f821e68() { if (!$this->F48dce54a()) { return false; } if(is_object($this->FichierParcours) && Feee3b2d5($this->FichierParcours)) { if(!$this->FichierParcours->bInit) { global $sLastFunction; $sLastFunction = ""; $this->FichierParcours->F08193936("",array()); if($this->bInitLiaison) { return true; } } } if($this->bInitLiaison) { return false; } if(!isset($this->RubriqueParcours)) { if(!isset($this->FichierParcours->BestRub)) { $this->FichierParcours->Fad8a73f6(); } $this->RubriqueParcours = &$this->FichierParcours->BestRub; } else if(is_string($this->RubriqueParcours)) { $this->RubriqueParcours = &$this->FichierParcours->F133178d5($this->RubriqueParcours); } $this->bInitLiaison = true; return true; } function InitRemplissage() { if (false === $this->F7f821e68()) return; $this->ListeAffiche(); $this->bInitRemplissage = true; } function FichierVersListeMemoire($sNomFichier = null, $sNomRubAffiche = null, $sNomRubTri = null) { if ($this->F48dce54a()) return; if ($sNomFichier == null) { $sNomFichier = $this->FichierParcours; } if (is_string($sNomFichier)) $hfFichier = &Fbad7a601($sNomFichier); else $hfFichier = $sNomFichier; if ($sNomRubAffiche == null) { $sNomRubAffiche = $this->sRubriqueParcoursAffichee; if ( empty($sNomRubAffiche) ) { $hfFichier->Fad8a73f6(); $rubAffiche = $hfFichier->BestRub; $sNomRubAffiche = $rubAffiche->sNom; } } else { if (is_string($sNomRubAffiche)) { $rubAffiche = $hfFichier->getRubrique($sNomRubAffiche); } else { $rubAffiche = $sNomRubAffiche; $sNomRubAffiche = $rubAffiche->sNom; } } $rubTri = null; if ($sNomRubTri == null) { $sNomRubTri = $rubAffiche->sNom; $rubTri = $rubAffiche; } else { if (!is_string($sNomRubTri)) { $rubTri = $sNomRubTri; $sNomRubTri = $sNomRubTri->sNom; } else { $rubTri = $hfFichier->getRubrique($sNomRubTri); } } $nTailleAvant = count($this->TabLigne,COUNT_NORMAL); $hfFichier->Fa84e48aa($rubTri); while(!$hfFichier->bHEnDehors) { $tabAvecIndiceChaine = $hfFichier->EnregCourant; $pclRub =& $hfFichier->getRubrique($sNomRubAffiche); $this->F5eadf367($pclRub->GetValeur()); $hfFichier->Fec3a1557($rubTri); } if ($this->m_bEstTrie) $this->ListeTrie($this->m_bTriSens,$this->m_nTriOptions); $this->Valeur = $nTailleAvant + 1; if(Feef890d7()) { F2afdeace($this->m_sNomPHP); } } function ListeAffiche($nPosition = TA_DEBUT) { if(!$this->F48dce54a() || ($nPosition != TA_DEBUT && $nPosition != TA_INIT&&$nPosition != TA_COURANTPREMIER && $nPosition != TA_REEXECUTEREQUETE)) { return; } if($nPosition == TA_INIT) { $this->Fc1a6d5f6(trtInit); } if ($nPosition == TA_REEXECUTEREQUETE) { $this->bInitLiaison = false; if(Feee3b2d5($this->FichierParcours)) { $this->FichierParcours->bInit = false; } } $this->F7f821e68(); $nIndicePremierElement = 1; $EnregPremierElement = $this->FichierParcours->EnregCourant; $this->ListeSupprimeTout(); $nPosition = $this->FichierParcours->Fd172163b($this->RubriqueParcours); if(!empty($this->sValeurRecherche)) { $this->FichierParcours->Fd7f91600($this->RubriqueParcours, array($this->sValeurRecherche)); } $this->FichierParcours->Fa84e48aa($this->RubriqueParcours, $this->bParcoursAsc, H_RESPECTE_FILTRE); if(!empty($this->sRubriqueMemorisee)) { $this->TabValeurMemorisee = array(); } $nLigneEnCours = 0; $nNbLignesMax = 0; if ( isset($this->nLimiteChargementMemoire) && ($this->nLimiteChargementMemoire>0) ) { $nNbLignesMax = $this->nLimiteChargementMemoire; } $bAvecPCodeAffLigne = (ExecuteTraitement($this->m_sNomPHP,trtAffichageLigne,false,true)===true); while($this->FichierParcours->bHTrouve && ( ($nNbLignesMax==0)||($nNbLignesMax>$nLigneEnCours)) ) { $nResFiltre = $this->Fb40d01a9($nLigneEnCours+1); if ($nResFiltre == nFILTRE_FIN) { break; } else if ($nResFiltre == nFILTRE_OK) { $this->F5eadf367($this->FichierParcours->EnregCourant[$this->sRubriqueParcoursAffichee]); if(!empty($this->sRubriqueMemorisee)) { $this->TabValeurMemorisee[$this->Occurrence] = $this->FichierParcours->EnregCourant[$this->sRubriqueMemorisee]; } if ($bAvecPCodeAffLigne) $this->Fbe50ddf6($this->GetOccurrence()); $this->FichierParcours->Fec3a1557($this->RubriqueParcours, $this->bParcoursAsc); } ++$nLigneEnCours; } Fe4e65a90($nPosition); if($this->nNbMaxLigne != 0 && $this->Occurrence > $this->nNbMaxLigne) { $this->ListeSupprimeTout(); $this->ListeAjoute(Fc34ec142("ERR_TROP_D_ELEMENT")); if(Feef890d7()) { F2afdeace($this->m_sNomPHP); } return; } if (isset($this->m_tabInfo1ereLignePerso)) { $this->Fcfb6d1e2($this->Fd135d1c5($this->m_tabInfo1ereLignePerso[0]),1); if(!empty($this->sRubriqueMemorisee)) { $this->TabValeurMemorisee = array_values($this->TabValeurMemorisee); array_unshift($this->TabValeurMemorisee,0,$this->m_tabInfo1ereLignePerso[1]); unset($this->TabValeurMemorisee[0]); } } if($nPosition == TA_COURANTPREMIER) { $nIndicePremierElement = $this->Fd7e1f103($EnregPremierElement); } $this->F37bb1c9f($nIndicePremierElement); if(Feef890d7()) { F2afdeace($this->m_sNomPHP); } } function Feb0bfada($nPosition = TA_DEBUT) { if($nPosition == TA_INIT) { $this->Fc1a6d5f6(trtInit); } if (($nPosition != TA_INIT && $nPosition != TA_DEBUT&& $nPosition != TA_COURANTPREMIER && $nPosition != TA_COURANTBANDEAU && $nPosition != TA_REEXECUTEREQUETE) || !$this->F48dce54a()) { return false; } if ($nPosition == TA_REEXECUTEREQUETE) { $this->bInitLiaison = false; if(Feee3b2d5($this->FichierParcours)) { $this->FichierParcours->bInit = false; } } $this->F7f821e68(); $nIndicePremierElement = 1; $this->TabLigne = array(); foreach($this->TabPosition as $_nPosition) { if(isset($_nPosition)) { Fbd3b8aac($_nPosition); } } $this->TabPosition = array(); $this->nLastPosition = -1; $EnregPremierElement = $this->FichierParcours->EnregCourant; if(isset($this->Reglette)) { $Reglette =& $this->Reglette; if ($nPosition == TA_COURANTBANDEAU) { if ($this->GetValeur() == -1) { $nIndicePremierElement=$this->nFirstIndex; $nSelectedItem = $Reglette->nSelectedItem; } else { $nSelectedItem = $Reglette->F4adc3716( ($nIndicePremierElement=$this->GetValeur()) ); } } $Reglette->FirstItem(); if ($nPosition == TA_COURANTBANDEAU) { $Reglette->F47301c2e($nSelectedItem); } else { if($nPosition == TA_COURANTPREMIER) { $nIndicePremierElement = -1; while($nIndicePremierElement<0) { $nIndicePremierElement = $this->Fd7e1f103($EnregPremierElement); if ($nIndicePremierElement<0) { if ($Reglette->Fb19c91cc()) { $Reglette->F27083b0f(); } else { $nIndicePremierElement = 1; } } } $this->FichierParcours->F96c9cbe1($EnregPremierElement); } } } else { if ($nPosition == TA_COURANTBANDEAU) { $nIndicePremierElement = $this->GetValeur(); $this->SetFirstIndex(0); } elseif($nPosition == TA_COURANTPREMIER) { $this->SetFirstIndex(0); $nIndicePremierElement = $this->Fd7e1f103($EnregPremierElement); $this->FichierParcours->F96c9cbe1($EnregPremierElement); } else { $this->SetFirstIndex(0); } } $this->F37bb1c9f($nIndicePremierElement); return true; } function Fe4f426a6($EnregReference,$iComp) { $EnregComparaison = $this->TabLigne[$iComp]->GetValeur(); $pclRubrique =& $this->RubriqueParcours; if (!isset($pclRubrique)) continue; $sNomRubrique = $this->RubriqueParcours->sNom; if ($pclRubrique->F48bb09ec($EnregComparaison) !== $EnregReference[$sNomRubrique]) return false; return true; } function Fdf40f5f3(&$EnregReference) { foreach (array_keys($this->FichierParcours->TabRubriques) as $sNomRubrique) { $pclRubrique =& $this->FichierParcours->TabRubriques[$sNomRubrique]; if (!isset($pclRubrique)) continue; $sNomRubriqueBase = $this->FichierParcours->TabNomRubriqueSansAccent[utf8_strtolower(F03771b65($sNomRubrique))]; $EnregReference[$sNomRubriqueBase] = $pclRubrique->F48bb09ec($EnregReference[$sNomRubriqueBase]); } } function Fd7e1f103(&$EnregPremierElement) { $nOccurrence = $this->GetOccurrence(); $this->Fdf40f5f3($EnregPremierElement); $nIndicePremierElement = -1; for($i=0; $i<$nOccurrence; $i++) { if ($this->Fe4f426a6($EnregPremierElement,$i+1)) { $nIndicePremierElement = $i+1; break; } } return $nIndicePremierElement; } function F236bb7fa($bAvecSelection = true) { $sResultat = "<JS>.options.length=0</JS>"; if($this-> GetOccurrence() > 0) { $sResultat .= '<OPTIONS>' . $this->Fec2dc3df(true) . '</OPTIONS>'; } if($bAvecSelection) { $sResultat .= $this->F7b5c0e7a(); } return $sResultat; } function Fec2dc3df($bSansDebordement,$bPourSaisieAssistee=false) { $sResultat= ''; foreach ($this->TabLigne as $Ligne) { $sResultat .= '<OPTION>'.F5e65e3cf($Ligne->GetValeurAffichee()).'</OPTION>'; } if ($bPourSaisieAssistee && empty($sResultat)) $sResultat = '<SANSOPTION/>'; return $sResultat; } function F7b5c0e7a() { $sResultat = ""; if($this->Valeur != -1) { if($this->Valeur > 0 && $this->Valeur <= $this->GetOccurrence()) { $sResultat = "<JS>.options[".($this->Valeur -1)."].selected=true</JS>"; } } else { return $this->F236bb7fa(false); } return $sResultat; } function SetContenuInitial($ContenuInitial) { $this->ListeSupprimeTout(); if (!empty($ContenuInitial)) $this->ListeAjoute(is_array($ContenuInitial) ? implode(RC,$ContenuInitial) : $ContenuInitial); } } class CCombo extends CListe { function& GetType() { return getRef(TYPE_CHAMP_COMBO); } function F4a917fa4() { return 14; } } class CControleurChampTable_Web extends CControleurChamp_Web { function CControleurChampTable_Web ( &$pclModele) { parent::CControleurChamp_Web($pclModele); } function F0bf0c400($eAction, $Parametere = null) { $bRes = false; switch ($eAction) { case ACTION_WEB_SELECTION: { $eActionWebResultat = parent::F4d821ce0($eAction); if (ACTION_WEB_RESULTAT_OK != $eActionWebResultat) return $eActionWebResultat; } $bRes = $this->Fb8240ada($Parametere); break; case ACTION_WEB_TABLE_ENROULEDEROULE: $bRes = $this->F31c2964b($Parametere); break; default: return parent::F0bf0c400($eAction); } return $bRes ? ACTION_WEB_RESULTAT_OK : ACTION_WEB_RESULTAT_ERREUR; } function Fb8240ada($Parametere) { return false; } function F31c2964b($Parametre) { $pclChampRuptureBase =& $this->m_pclModele; $nNumLigneWL = intval($Parametre); if ( (NUMLIGNE_INVALIDE != $nNumLigneWL) && (PHP_INT_MAX != $nNumLigneWL) && (0 < $nNumLigneWL) && ($pclChampRuptureBase->TableOccurrence(TO_TOTAL) >= $nNumLigneWL)) { $nNumLigneC = $nNumLigneWL - 1; $nIndiceRupture = -1; if ($pclChampRuptureBase->GetType() === ID_TABLEHIERARCHIQUE) { if (isset($pclChampRuptureBase->TabLigne[$nNumLigneC+1])) { $pclLigne =& $pclChampRuptureBase->TabLigne[$nNumLigneC+1]; $pclLigne->m_bDeroule=!$pclLigne->m_bDeroule; if(Feef890d7()) { F9402f437($pclChampRuptureBase->GetNom(), $pclChampRuptureBase); $pclChampRuptureBase->F8723e249($pclChampRuptureBase->GetFirstIndex() + 1 ); } } } elseif ( (false !== $this->Fb5398a4d($nIndiceRupture)) && (0 <= $nIndiceRupture) && ($pclChampRuptureBase->Fdf310505() > $nIndiceRupture)) { $pclChampRuptureBase->Fc018951f($nNumLigneC, (int)$nIndiceRupture); if(Feef890d7()) { F2afdeace($pclChampRuptureBase->m_sNomPHP); $pclChampRuptureBase->F8723e249($pclChampRuptureBase->GetFirstIndex() + 1 ); } } } return true; } } class CTableZRCommun extends CListe { var $TabAttribut = array(); var $TabAttributNomAlias = array(); var $TabAttributNomPHP; var $_Optim_bPcodeAffichageBasRupture = null; var $_Optim_bPcodeAffichageHautRupture = null; var $m_bEstAjax = false; var $m_bHauteurLigneVariable = false; var $bPcodeAffichageEnCours = false; var $m_pclIterateur; var $m_nGetDernierRuptureVisible = 0; var $m_nNbColonnesOuAttributs = null; function Fb6718f6a() { return $this->m_nGetDernierRuptureVisible + 1; } var $m_bGlienActif = true; var $m_bAuMoinsUnGLien = false; var $sRubriqueParcoursAffichee= ""; var $m_bAvecLigneInvisible = false; var $m_bSaisieCascade = false; var $TabRupture = array(); var $TabIndiceLigneModifAjax = null; var $nReloadFrom = -1; var $m_sStyle = ''; var $nNbColonneParLigne = 1; var $m_bRepetitionVertical = false; var $m_bEstNavigateur = false; var $nNbTotalEnreg = -1; var $Reglette = null; var $m_nLigneAffichee = 0; var $TabSauvegarde = array(); var $TabSauvegardeProp = array(); function CTableZRCommun() { parent::CListe(); } function lierVM($sNomVM, $sNomWL, $sNomPHP) { parent::lierVM($sNomVM,$sNomWL,$sNomPHP); $clVMManager =& F08aafbb0(); $clVM =& $clVMManager->Fe26ffff2($sNomVM); foreach (array_keys($this->TabAttribut) as $sNomAttribut) { $clVM->F73935150($sNomAttribut,$sNomPHP); } foreach (array_keys($this->TabRupture) as $nIndiceRupture) { if (!isset($this->TabRupture[$nIndiceRupture][ZR_RUPTURE_ATTRIBUT])) { if (isset($this->TabRupture[$nIndiceRupture][ZR_RUPTURE_HAUT])) { call_user_func_array(array($this,'AjouteRupture'),$this->TabRupture[$nIndiceRupture][ZR_RUPTURE_HAUT]); } if (isset($this->TabRupture[$nIndiceRupture][ZR_RUPTURE_BAS])) { call_user_func_array(array($this,'AjouteRupture'),$this->TabRupture[$nIndiceRupture][ZR_RUPTURE_BAS]); } } } } function AjouteAttribut($sNomPHP, $sNomAttribut , $sAlias, $nIndiceAttribut, $sNomFichierBase='', $sNomRubriqueParcours='', $xValeurParDefaut=null, $sFichierRelie1 = "", $sRubriqueRelie1 = "", $sRubriqueAffichee1 = "", $sFichierRelie2 = "", $sRubriqueRelie2= "", $sRubriqueAffichee2="") { if (!isset($nIndiceAttribut)) { $nIndiceAttribut=-1; foreach ($this->TabAttribut as $pclAtt) { $nIndiceAttribut = max($nIndiceAttribut,$pclAtt->Fe5aaeca8()); } if (isset($this->TabColonnes)) { foreach ($this->TabColonnes as $pclAtt) { $nIndiceAttribut = max($nIndiceAttribut,$pclAtt->Fe5aaeca8()); } } ++$nIndiceAttribut; } if(isset($this->TabAttribut)) { $Attribut = new CAttributZR($sNomAttribut, $nIndiceAttribut, $sNomFichierBase, $sNomRubriqueParcours, $sFichierRelie1, $sRubriqueRelie1, $sRubriqueAffichee1, $sFichierRelie2, $sRubriqueRelie2, $sRubriqueAffichee2); $Attribut->m_sNomPHP = $sNomPHP; if (isset($xValeurParDefaut)) $Attribut->m_xValeurParDefaut = $xValeurParDefaut; $this->TabAttribut[ $sNomAttribut ] =& $Attribut; $this->TabAttributNomAlias[ $sAlias ] = $sNomAttribut; $this->TabAttributNomPHP[ $sNomPHP ] = $sNomAttribut; $GLOBALS[$sNomPHP] =& $this->TabAttribut[ $sNomAttribut ]; global $MaPage; $MaPage->WB_AjouteChamp($sNomAttribut,$sAlias,$GLOBALS[$sNomPHP],$sNomPHP); } return $nIndiceAttribut; } function F18f1a158(&$pclChamp,$sNomPHP,$sFichierBase, $sRubriqueBase, $sFichierRelie1 ="", $sRubriqueRelie1 ="", $sRubriqueAffichee1 ="", $sFichierRelie2 ="", $sRubriqueRelie2 ="", $sRubriqueAffichee2 ="") { $sNomPHPAtt = uniqid($pclChamp->Alias); $sNomAtt = F686c9523($pclChamp,'Valeur',$sNomPHP); $sAliasAtt = 'ATT_'.$pclChamp->Alias; $nIndiceAttribut = null; if (isset($this->TabColonnes)) { foreach ($this->TabColonnes as $pclColonne) { if (isset($pclColonne->m_sAliasChampPrincipal) && $pclColonne->m_sAliasChampPrincipal==$pclChamp->Alias) { $nIndiceAttribut = $pclColonne->Fe5aaeca8(); break; } } } $this->AjouteAttribut($sNomPHPAtt,$sNomAtt,$sAliasAtt, $nIndiceAttribut,$sFichierBase,$sRubriqueBase,null,$sFichierRelie1 , $sRubriqueRelie1 , $sRubriqueAffichee1 , $sFichierRelie2 , $sRubriqueRelie2, $sRubriqueAffichee2); $this->SetLiaisonAttributChamp($sNomPHPAtt,$pclChamp->Alias,'Valeur'); } function SetLiaisonAttributChamp($sNomAttribut, $sAliasChamp, $sNomPropriete = null) { if ( (!isset($this->TabAttributNomPHP[ $sNomAttribut ]))||(!is_object($this->TabAttribut[ $this->TabAttributNomPHP[ $sNomAttribut ] ])) ) return; $Attribut =& $this->TabAttribut[ $this->TabAttributNomPHP[ $sNomAttribut ] ]; $Attribut->F17b9c145($sAliasChamp,$sNomPropriete); global $MaPage; if (isset($MaPage->TabChamp[$sAliasChamp])) { $MaPage->TabChamp[$sAliasChamp]->m_pclChampConteneur =& $this; } else { $MaPage->TabInfoPreGenerationChamp[$sAliasChamp] = array('m_pclChampConteneur' => &$this); } } function Ffe0edf57($sNomAttribut) { if (isset($this->TabAttribut[ $sNomAttribut ])) return $sNomAttribut; if (isset($this->TabAttributNomAlias[ $sNomAttribut ])) return $this->TabAttributNomAlias[ $sNomAttribut ]; if (isset($this->TabAttributNomPHP[ $sNomAttribut ])) return $this->TabAttributNomPHP[ $sNomAttribut ]; foreach (array_keys($this->TabAttribut) as $sNom) { if (Fda9fdf77($sNom,$sNomAttribut,ccSansCasse)==0) return $sNom; } foreach(array_keys($this->TabAttribut) as $sNom) { $Attribut =& $this->TabAttribut[$sNom]; $sCleAttAuto = 'ATT_' . $Attribut->m_sAliasChampLie . '_' . $Attribut->m_nIndicePropServeurWL; if ($sCleAttAuto==$sNomAttribut) { return $Attribut->Nom; } } return ''; } function& F1f9cec38($sNomAttribut) { $RetourParDefaut = null; $sNomAttribut = $this->Ffe0edf57($sNomAttribut); if (!isset($this->TabAttribut[ $sNomAttribut ])) { $clVM =& obtenirVM(); $RetourParDefaut = $clVM->F67af5b5c($sNomAttribut); if (isset($RetourParDefaut) && isset($this->TabAttributNomPHP[ $RetourParDefaut ]) ) { return $this->TabAttribut[ $this->TabAttributNomPHP[ $RetourParDefaut ] ]; } return $RetourParDefaut; } return $this->TabAttribut[$sNomAttribut]; } function& GetValAttributHTML($NomAttribut, $Indice, $Option = null ) { $sRetourParDefaut = ""; if ($Indice == -1) $Indice = $this->Valeur; if (!isset( $this->TabLigne[ $Indice ])) return $sRetourParDefaut; $bAttributExiste = false; $bAttributAuto = is_array($NomAttribut); if (!$bAttributAuto && isset($this->TabColonnes) && (($bAttributExiste=(array_key_exists('ATT_'.$NomAttribut,$this->TabAttributNomPHP))) || isset($GLOBALS[$NomAttribut])) ) { if (!$bAttributExiste) { Fa79fbf41("on a demandé une valeur de colonne par ce getter d'attribut. bizarre, on retourne la valeur de colonne sans plus "); return $GLOBALS[$NomAttribut]->GetValeurAfficheeI($Indice-1); } $Attribut =& $this->TabAttribut[ $this->TabAttributNomPHP[ 'ATT_'.$NomAttribut ] ]; $NumAttribut = $Attribut->nIndiceAttribut; } else { if ($bAttributAuto) { $pclChamp =& $NomAttribut[0]; $sNomProp =& $NomAttribut[1]; $nIndicePropServeurWL = $NomAttribut[2]; $NomAttribut = F686c9523($pclChamp,$sNomProp); } if (isset($this->TabAttributNomPHP[ $NomAttribut ])) $NomAttribut = $this->TabAttributNomPHP[ $NomAttribut ]; if (!isset($this->TabAttribut[ $NomAttribut ])) { if ($bAttributAuto) { $sRetourParDefaut = $pclChamp->{Ffaaa0c13($sNomProp)}($Option); } else Fa79fbf41("att inconnu"); return $sRetourParDefaut; } $Attribut =& $this->TabAttribut[ $NomAttribut ]; $NumAttribut = $Attribut->nIndiceAttribut; if ($bAttributAuto && isset($nIndicePropServeurWL)) { $Attribut->m_nIndicePropServeurWL = $nIndicePropServeurWL; } } $xValeur = (isset($this->TabLigne[ $Indice ]->TabValeur[$NumAttribut])) ? $this->F764725dd($Attribut,$this->TabLigne[ $Indice ]->TabValeur[$NumAttribut], $Option) : null; if (isset($Attribut)) { $Champ =& $GLOBALS['MaPage']->TabChamp[ $Attribut->m_sAliasChampLie ]; if (isset($Champ) && ($Champ->GetType()===ID_RANGESLIDER)) { if (strpos($Attribut->m_sNomProprieteLiee , 'Valeur')===0) { foreach(array_keys($this->TabAttribut) as $sNom) { $AttributCourant =& $this->TabAttribut[$sNom]; if ($AttributCourant->m_sAliasChampLie !== $Attribut->m_sAliasChampLie) continue; $NumAttributCourant = $AttributCourant->nIndiceAttribut; if ( (strpos($AttributCourant->m_sNomProprieteLiee , 'Valeur')===0) && ($AttributCourant->m_sNomProprieteLiee != $Attribut->m_sNomProprieteLiee)) { $xValeur2 = (isset($this->TabLigne[ $Indice ]->TabValeur[$NumAttributCourant])) ? $this->F764725dd($AttributCourant,$this->TabLigne[ $Indice ]->TabValeur[$NumAttributCourant], $Option) : null; $xValeur = min($xValeur,$xValeur2) . ',' . max($xValeur,$xValeur2); } } } } } if (!isset( $xValeur )) { $sRetourParDefaut = $Attribut->m_xValeurParDefaut; return $sRetourParDefaut; } return $xValeur; } function Fbc60c5b9($tabValeur, $NumAttribut = null, $Option = null) { foreach ($tabValeur as $nIndice => $valeur) { foreach (array_keys($this->TabAttribut) as $Indice) { $Attribut =& $this->TabAttribut[$Indice]; if (( $Attribut->nIndiceAttribut == $nIndice )&&(!isset($NumAttribut))) { break; } elseif ((isset($NumAttribut))&&( $Attribut->nIndiceAttribut == $nIndice )&&($nIndice==$NumAttribut)) { return array($nIndice => $this->F764725dd($Attribut,$valeur, $Option)); } } if ( (!isset($Attribut->m_sNomProprieteLiee)) || (!isset($Attribut->m_sAliasChampLie)) || (!isset($GLOBALS['MaPage']->TabChamp[ $Attribut->m_sAliasChampLie ])) || (!is_object($GLOBALS['MaPage']->TabChamp[ $Attribut->m_sAliasChampLie ])) ) continue; $tabValeur[$nIndice] = $this->F764725dd($Attribut,$valeur, $Option ); } return $tabValeur; } function F764725dd($Attribut,$valeur, $Option ) { $Champ =& $GLOBALS['MaPage']->TabChamp[ $Attribut->m_sAliasChampLie ]; if (isset($Champ)) { switch($Champ->GetType()) { case ID_IMAGE: { if ($Champ->eTypeImage < 2) { break; } } default: { if ($Attribut->m_bValeurHTMLSetGettable!==false) { $Attribut->m_bValeurHTMLSetGettable = (is_callable(array($Champ,F0f2ffe8c($Attribut->m_sNomProprieteLiee)))) && (is_callable(array($Champ,Ffaaa0c13($Attribut->m_sNomProprieteLiee)))); } if ($Attribut->m_bValeurHTMLSetGettable===true) { if ($Attribut->m_sNomProprieteLiee == 'Valeur') { if ($Champ->GetType() == ID_INTERRUPTEUR) { return intval($valeur); } $bAjax = Feef890d7(); F3ecf4149(false); $Champ->SetValeur($valeur); F3ecf4149($bAjax); $valeur = $Champ->GetValeurHTML($Option); } else { $bAjax = Feef890d7(); F3ecf4149(false); $Champ->{F0f2ffe8c($Attribut->m_sNomProprieteLiee)}($valeur); F3ecf4149($bAjax); $valeur = $Champ->{Ffaaa0c13($Attribut->m_sNomProprieteLiee)}($Option); } } } } } return $valeur; } function& F1adc5abe($NomAttribut, $Indice ) { $sRetourParDefaut = ''; if (is_numeric($NomAttribut)) { $NumAttribut = intval($NomAttribut) - 1; } else { if (isset($this->TabAttributNomPHP[ $NomAttribut ])) $NomAttribut = $this->TabAttributNomPHP[ $NomAttribut ]; if (!isset($this->TabAttribut[ $NomAttribut ])) { $NomAttributMinuscule = Fcb2d4de8($NomAttribut,ccSansAccent+ccSansCasse); foreach (array_keys($this->TabAttribut) as $sNomTabAttribut) { if ($NomAttributMinuscule == Fcb2d4de8($sNomTabAttribut,ccSansAccent+ccSansCasse)) { $NomAttribut = $sNomTabAttribut; break; } } } if (!isset($this->TabAttribut[ $NomAttribut ])) { $tmp = $Indice; $Indice = $NomAttribut; $NomAttribut = $tmp; if (isset($this->TabAttributNomPHP[ $NomAttribut ])) $NomAttribut = $this->TabAttributNomPHP[ $NomAttribut ]; if (!isset($this->TabAttribut[ $NomAttribut ])) { return $sRetourParDefaut; } } $Attribut = $this->TabAttribut[ $NomAttribut ]; $NumAttribut = $Attribut->Fe5aaeca8(); } if ($Indice == -1) $Indice = $this->Valeur; if (!isset( $this->TabLigne[ $Indice ])) return $sRetourParDefaut; $pclLigne =& $this->TabLigne[ $Indice ]; $pclLigne->F2a3fd3f7($Indice); $Ligne =& $pclLigne->TabValeur; if (!isset( $Ligne[$NumAttribut] )) { return $sRetourParDefaut; } $res = $Ligne[$NumAttribut]; return $res; } function F7d306d49($NomAttribut, $Indice, $Valeur ) { if (isset($this->TabAttributNomPHP[ $NomAttribut ])) $NomAttribut = $this->TabAttributNomPHP[ $NomAttribut ]; if (!isset($this->TabAttribut[ $NomAttribut ])) return ""; $Attribut = $this->TabAttribut[ $NomAttribut ]; $NumAttribut = $Attribut->nIndiceAttribut; if ($Indice == -1) $Indice = $this->Valeur; if (!isset( $this->TabLigne[ $Indice ])) return ""; $this->TabLigne[ $Indice ]->F2a3fd3f7($Indice); $Ligne = &$this->TabLigne[ $Indice ]->TabValeur; $Ligne[$NumAttribut] = $Valeur; $this->Fbe50ddf6($Indice); if(Feef890d7()) { F055fb2fe($this->GetNom(), $this); $this->Ff922bb0a($Indice); } } function Fe4f426a6($EnregReference,$iComp) { $EnregComparaison = $this->TabLigne[$iComp]->TabValeur; $rtabAtttributColonne =& $this->Fb76ff292(); foreach (array_keys($rtabAtttributColonne) as $sNomAtt) { $pclAttCol =& $rtabAtttributColonne[$sNomAtt]; $sNomRubrique = $pclAttCol->RubriqueLiaison->sNom; $pclRubrique =& $this->FichierParcours->TabRubriques[Fcb2d4de8($sNomRubrique,ccSansAccent+ccMinuscule)]; if (!isset($pclRubrique)) continue; if ($pclRubrique->F48bb09ec($EnregComparaison[$pclAttCol->Fe5aaeca8()]) !== $EnregReference[$sNomRubrique]) return false; } return true; } function& Fb76ff292() { if (isset($this->TabColonnes)) return $this->TabColonnes; return $this->TabAttribut; } function F57a77f23() { return isset($this->m_nNbColonnesOuAttributs) ? $this->m_nNbColonnesOuAttributs : count($this->Fb76ff292(),COUNT_NORMAL); } function& GetPoliceTaille() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICETAILLE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceTaille($nPoliceTaille) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICETAILLE"),F3b9ec4ca($this)); } function& GetPoliceSoulignee() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICESOULIGNEE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceSoulignee($bPoliceSoulignee) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICESOULIGNEE"),F3b9ec4ca($this)); } function& GetPoliceNom() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICENOM"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceNom($sPoliceNom) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICENOM"),F3b9ec4ca($this)); } function& GetPoliceItalique() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEITALIQUE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceItalique($bPoliceItalique) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEITALIQUE"),F3b9ec4ca($this)); } function& GetPoliceGras() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEGRAS"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceGras($bPoliceGras) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEGRAS"),F3b9ec4ca($this)); } function& GetHTMLAvant() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_HTMLAVANT"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetHTMLAvant($sHTMLAvant) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_HTMLAVANT"),F3b9ec4ca($this)); } function& GetHTMLApres() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_HTMLAPRES"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetHTMLApres($sHTMLApres) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_HTMLAPRES"),F3b9ec4ca($this)); } function& GetLargeur() { $tmp = $this->m_nLargeur; return $tmp; } function SetLargeur($nLargeur) { Erreur('ErreurProprieteLectureSeule','',Fc34ec142("PROP_NOM_LARGEUR"),F3b9ec4ca($this)); } function& GetHauteur() { $tmp = $this->m_nHauteur; return $tmp; } function SetHauteur($nHauteur) { Erreur('ErreurProprieteLectureSeule','',Fc34ec142("PROP_NOM_HAUTEUR"),F3b9ec4ca($this)); } function& GetOpacite() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_OPACITE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetOpacite($nOpacite) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_OPACITE"),F3b9ec4ca($this)); } function Fdc05d49f($sValeur) { parent::Fdc05d49f($sValeur); if(isset($this->TabPosition[$this->nLastIndex + $this->GetValeur()])) { Fe4e65a90($this->TabPosition[$this->nLastIndex + $this->GetValeur()], H_RP_CONSERVE); } } function F63ff45c7() { if(empty($this->Valeur)||($this->Valeur===-1)) { if(false === array_key_exists(0,$this->TabLigne)) { return -1; } return 1; } return $this->Valeur; } function Ff922bb0a($nIndiceLigne) { if(!isset($this->TabIndiceLigneModifAjax)) { $this->TabIndiceLigneModifAjax = array(); } if (!in_array($nIndiceLigne,$this->TabIndiceLigneModifAjax)) $this->TabIndiceLigneModifAjax[] = $nIndiceLigne; } function F8723e249($nIndice) { if($this->nReloadFrom != -1) { $this->nReloadFrom = min($nIndice, $this->nReloadFrom); } else { $this->nReloadFrom = $nIndice; } } function F76aaaac4() { unset($this->TabIndiceLigneModifAjax); $this->nReloadFrom = -1; } function SetValI( $Indice, $Valeur ) { if($this->F48dce54a()) { if ($Indice == -1) $Indice = $this->Valeur; else $Indice += $this->nFirstIndex; } $this->TableModifie( $Valeur, $Indice ) ; } function& GetValI( $Indice ) { $sRetourDefaut = ''; if (!is_numeric($Indice)) { if ($this->Valeur==-1) return $sRetourDefaut; return $this->F1adc5abe($Indice,$this->Valeur); } return parent::GetValI($Indice); } function& GetValII ( $Ligne, $Colonne ) { if (is_string($Colonne)) return $this->F1adc5abe($Colonne, $Ligne ); $LigneZR =& parent::GetValI($Ligne); return $LigneZR->Fb5eda0a7($Colonne); } function& Fb5eda0a7($Indice) { if(array_key_exists($Indice, $this->TabLigne)) { $this->TabLigne[$Indice]->F2a3fd3f7($Indice); return $this->TabLigne[$Indice]; } elseif (!is_numeric($Indice) && isset($this->TabLigne[$this->Valeur])) { $sNomSansCasse = utf8_strtolower(F03771b65($Indice)); $rtabAtttributColonne =& $this->Fb76ff292(); foreach (array_keys($rtabAtttributColonne) as $nIdColonne) { $pclAttCol =& $rtabAtttributColonne[$nIdColonne]; ; if (utf8_strtolower(F03771b65($pclAttCol->Nom)) == $sNomSansCasse) { return $this->TabLigne[$this->Valeur]->GetValI($pclAttCol->F418f91ca()); } } } $Retour = null; return $Retour; } function WB_RestaureContexte() { foreach (array_keys($this->TabRupture) as $nIndice ) { $tabRuptureI = $this->TabRupture[$nIndice]; if (isset($tabRuptureI[RUPTURE_HAUT])) { $pclRupture =& $tabRuptureI[RUPTURE_HAUT]; $GLOBALS[$pclRupture->m_sNomPHP] =& $pclRupture; } if (isset($tabRuptureI[RUPTURE_BAS])) { $pclRupture =& $tabRuptureI[RUPTURE_BAS]; $GLOBALS[$pclRupture->m_sNomPHP] =& $pclRupture; } } } function AjouteRupture($bHautRupture, $sNomPHP, $sNomWL, $sAlias, $nIndiceRupture, $nIndiceAttributRupture, $sNomAttributRupture, $sFichierLie = null, $nHauteur = -1) { if (!isset($this->TabRupture[$nIndiceRupture])) $this->TabRupture[$nIndiceRupture] = array(ZR_RUPTURE_HAUT=>null,ZR_RUPTURE_BAS=>null,ZR_RUPTURE_ATTRIBUT=>null); $rtabColAtt =& $this->Fb76ff292(); if (count($rtabColAtt,COUNT_NORMAL) < $this->F57a77f23()) { $this->TabRupture[$nIndiceRupture][$bHautRupture ? ZR_RUPTURE_HAUT : ZR_RUPTURE_BAS] = func_get_args(); return; } $pclRupture = new CRuptureZR($this,$bHautRupture,$nIndiceRupture); $pclRupture->m_sNomPHP = $sNomPHP; $pclRupture->Nom = $pclRupture->m_sNomWL = $sNomWL; $pclRupture->Alias = $sAlias; $pclRupture->m_nHauteur = $nHauteur; $GLOBALS[$sNomPHP] =& $pclRupture; $pclAttribut = null; if (!isset($this->TabRupture[$nIndiceRupture][ZR_RUPTURE_ATTRIBUT])) { if ($nIndiceAttributRupture === -1) { $sNomRubrique = $sNomAttributRupture; $sNomAttributRupture = uniqid('NOM_RUBRIQUE_RUPTURE_'); $sAliasAttributRupture = uniqid('ALIAS_RUBRIQUE_RUPTURE_'); $nIndiceAttributRupture = null; $nIndiceAttributRupture=$this->AjouteAttribut($sAliasAttributRupture.'_'.$sNomAttributRupture,$sNomAttributRupture,$sAliasAttributRupture,$nIndiceAttributRupture,$sFichierLie,$sNomRubrique); } if (!empty($sNomAttributRupture) && isset($this->TabAttribut[$sNomAttributRupture])) { $pclAttribut =& $this->TabAttribut[$sNomAttributRupture]; } else { foreach ($rtabColAtt as $sNomAttributRupture => $pclAttribut) { if ($pclAttribut->Fe5aaeca8() === $nIndiceAttributRupture) { $pclAttribut =& $rtabColAtt[$sNomAttributRupture]; break; } } if (($pclAttribut->Fe5aaeca8() !== $nIndiceAttributRupture)) { $pclAttribut = null; } } if (isset($pclAttribut)) { $this->TabRupture[$nIndiceRupture][ZR_RUPTURE_ATTRIBUT] =& $pclAttribut; } } else { if ($nIndiceAttributRupture>-1) { $pclAttribut =& $this->TabRupture[$nIndiceRupture][ZR_RUPTURE_ATTRIBUT]; } } $pclRupture->m_pclChampParent =& $this; $this->TabRupture[$nIndiceRupture][$bHautRupture ? ZR_RUPTURE_HAUT : ZR_RUPTURE_BAS] =& $pclRupture; } function ZoneRepeteeEnroule($nNumLigne = -1, $piRupture = null) { $this->Fddf4cf57($nNumLigne, (($piRupture!==null) ? F9abbf335($piRupture,IND_CHAMP): null), true); } function ZoneRepeteeDeroule($nNumLigne = -1, $piRupture = null) { $this->Fddf4cf57($nNumLigne, (($piRupture!==null) ? F9abbf335($piRupture,IND_CHAMP): null), false); } function TableEnroule($nNumLigne = -1, $piRupture = null) { $this->Fddf4cf57($nNumLigne, (($piRupture!==null) ? F9abbf335($piRupture,IND_CHAMP): null), true); } function TableDeroule($nNumLigne = -1, $piRupture = null) { $this->Fddf4cf57($nNumLigne, (($piRupture!==null) ? F9abbf335($piRupture,IND_CHAMP): null), false); } function TableEnrouleTout() { $this->ZoneRepeteeEnrouleTout(); } function TableDerouleTout() { $this->ZoneRepeteeDerouleTout(); } function ZoneRepeteeEnrouleTout() { $this->F2eb13ec4(); if(Feef890d7()) { F055fb2fe($this->GetNom(), $this); $this->F8723e249($this->GetFirstIndex() + 1); } } function F2eb13ec4() { $this->Fe3795821(true); } function Fe3795821($bEnroule) { $nNbRupture = $this->Fdf310505(); if ($nNbRupture === 0) return; $nNbLigne = $this->F1ac18ca4(); for ($nNumLigne=0;$nNumLigne<$nNbLigne;++$nNumLigne) { $this->F94875a95($nNumLigne, $bEnroule); } } function F94875a95($nNumLigne, $bEnroule) { $nNbRupture = $this->Fdf310505(); for ($nIndiceRupture=0;$nIndiceRupture<$nNbRupture;++$nIndiceRupture) { $this->Feae52488($nNumLigne, $nIndiceRupture, $bEnroule); } } function ZoneRepeteeDerouleTout() { $this->Fb05965cb(); if(Feef890d7()) { F055fb2fe($this->GetNom(), $this); $this->F8723e249($this->GetFirstIndex() + 1); } } function Fb05965cb() { $this->Fe3795821(false); } function Fddf4cf57($nNumLigne,$piRupture,$bEnroule) { $nNumLigneC = 0; if ($nNumLigne==-1) { $nNumLigneC = $this->F63ff45c7(); } else { $nNumLigneC = $nNumLigne - 1; } if ($piRupture !== null) { $nIndiceRupture = $this->F342a28c1($piRupture); if ($nIndiceRupture !== -1) { $this->Feae52488($nNumLigneC, $nIndiceRupture, $bEnroule); } else { Fb9eb0792('ERR_RUPTURENONTROUVEE', $piRupture->Fd464306b(), $this->Fd464306b() ); } } else { Fa79fbf41('TODO : enroulé pour les ligne de table/zr ni rupture ni hiérarchique'); } if(Feef890d7()) { F055fb2fe($this->GetNom(), $this); $this->F8723e249($nNumLigneC+1); } } function F56660bf0( $eTypeControleur) { return $this->Fea7a1f04('CControleurChampTable_Web' , $eTypeControleur); } function F342a28c1(&$pclObjetRupture) { if ($pclObjetRupture->m_bHaut) return $pclObjetRupture->m_nIndice; return -1; } function F9ade75fe($nNumLigne, $nIndiceRupture) { if (NUMLIGNE_INVALIDE == $nNumLigne) return false; $pbHautRupVisible = $pbBasRupVisible = false; $bEnroule = $this->Fd4a2edc8($nNumLigne, $pbHautRupVisible, $pbBasRupVisible ); if (!$bEnroule) return false; if ($this->Fdf310505() === 1) return true; return ($this->Fe0d64c17($nNumLigne) <= $nIndiceRupture); } function Feae52488($nNumLigne, $nIndiceRupture, $bEnroule) { if( $this->Ffec40bc1($nNumLigne, $nIndiceRupture, true) ) { if ($this->F9ade75fe($nNumLigne, $nIndiceRupture) === $bEnroule) return; $this->Fc12c5744($nNumLigne, $nIndiceRupture, $bEnroule); } } function Ffec40bc1($nNumLigne, $nIndiceRupture, $bHaut) { return $this->Ffbadbfe4($nNumLigne, $nIndiceRupture, ($bHaut ? 1 : 0) | 2); } function Ffbadbfe4($nNumLigne, $nIndiceRupture, $nOptionTest ) { if ((0 > $nNumLigne) || ($nNumLigne >= $this->F1ac18ca4())) return false; if (($nIndiceRupture < 0) || ($nIndiceRupture >= $this->Fdf310505()) || (!array_key_exists($nIndiceRupture,$this->TabRupture))) return false; $pclRuptHaut =& $this->TabRupture[$nIndiceRupture][RUPTURE_HAUT]; $pclRuptBas =& $this->TabRupture[$nIndiceRupture][RUPTURE_BAS]; if ( F5f7235e7($nOptionTest, 2) && ( (Fdef56c7f($nOptionTest, 1) && (false === $pclRuptHaut->Visible)) || (F5f7235e7($nOptionTest, 1) && (false === $pclRuptBas->Visible)))) return false; if (Fdef56c7f($nOptionTest, 1)) { if (0 === $nNumLigne) { $this->m_nGetDernierRuptureVisible = $nNumLigne; return true; } } else { if (false != $this->Fa0f182be($nNumLigne)) { return true; } ++$nNumLigne; } if ($this->F4feb52a9($nIndiceRupture, $nNumLigne) == false) { return false; } else { $this->m_nGetDernierRuptureVisible = $nNumLigne; return true; } } function Fc12c5744($nNumLigneBase, $nIndiceRupture, $bEnroule) { if ($nNumLigneBase === -1) return; $nNumLigneFin = $nNumLigneBase +1; $nMax = $this->F1ac18ca4(); while ($nNumLigneFin<$nMax) { if ($this->Ffec40bc1($nNumLigneFin, $nIndiceRupture, true)) break; ++$nNumLigneFin; } $this->m_bAvecLigneInvisible = true; for ($i=$nNumLigneBase;$i<$nNumLigneFin;++$i) { $pstElem =& $this->TabLigne[$i+1]; if ($pstElem != null) { if ($bEnroule) $pstElem->F2931cb31( $nIndiceRupture ); else $pstElem->F9cb3649a( $nIndiceRupture ); } if ($pstElem === null) continue; $nFlagEtat = $this->F53234ef2($i); if ($bEnroule) { F9c19fb37($nFlagEtat, 1024); if ($i === $nNumLigneBase) F9c19fb37($nFlagEtat, 4096); if ($i === $nNumLigneFin-1) F9c19fb37($nFlagEtat, 8192); } else { if ($pstElem->Fcc8136ce() === -1) { F27efdc07($nFlagEtat, 1024 | 8192 | 4096); } } $pstElem->dwFlag = Ffecd99cc($nFlagEtat,1); } } function bDebutFinLigne($bDebut) { $piIndicePosition =& $this->m_pclIterateur; if (!isset($this->m_pclIterateur)) return true; $return = 0; if ($bDebut) $return = $piIndicePosition->Fa31ce44e(); else $return = $piIndicePosition->Fcc6f142d(); return $return==2; } function bLigneRepliee() { $piIndicePosition =& $this->m_pclIterateur; if (!isset($piIndicePosition)) return false; return $piIndicePosition->bLigneRepliee(); } function F0f3ddc5a($nLigne, &$rnIndiceRuptureVisibleSiRepliee) { $nLigneSuivante = $this->F505c9c54($nLigne, 16); if (false !== $this->F5cd2b1ce($nLigneSuivante)) { $pbHautRupVisible = $pbBasRupVisible = false; if (false == $this->Fd4a2edc8($nLigneSuivante,$pbHautRupVisible,$pbBasRupVisible)) { $rnIndiceRuptureVisibleSiRepliee = -1; } else { $rnIndiceRuptureVisibleSiRepliee = $this->Fe0d64c17($nLigneSuivante); } return $nLigneSuivante; } else { $rnIndiceRuptureVisibleSiRepliee = -1; return NUMLIGNE_INVALIDE; } } function Fe0d64c17($nNumLigne) { $pstElem =& $this->TabLigne[ $nNumLigne+1 ]; if ($pstElem === null) return -1; return $pstElem->Fcc8136ce(); } function F505c9c54($nPos, $dwFlag) { $nLigneSuivante = $this->Fd72d7013($nPos, $dwFlag); if (Fdef56c7f($dwFlag, 4|2)) { while ($this->Fc5c4e5d8($nLigneSuivante)) { if ($this->Fa0f182be($nLigneSuivante)) { return NUMLIGNE_INVALIDE; } $nLigneSuivante = $this->Fd72d7013($nLigneSuivante, $dwFlag); } return $nLigneSuivante; } if ($this->m_bAvecLigneInvisible) { while ($this->Fee74c8e6($nLigneSuivante)) { if ($this->Fa0f182be($nLigneSuivante)) { return NUMLIGNE_INVALIDE; } $nLigneSuivante = $this->Fd72d7013($nLigneSuivante, $dwFlag); } return $nLigneSuivante; } return $nLigneSuivante; } function Fd72d7013($nPos, $dwFlags) { $nLigneSuivante = 0; if ( F5f7235e7($dwFlags, 1) || (1===$this->nNbColonneParLigne)) { $nLigneSuivante = $nPos+1; } else { if ($this->nNbColonneParLigne>1 && count($this->TabRupture,COUNT_NORMAL)>0) { $nLigneSuivante = ($nPos + 1); $i = 2; while (($nLigneSuivante <= $nPos) && ($i <= $this->nNbColonneParLigne)) { $nLigneSuivante = ($nPos + $i); ++$i; } } else { $nLigneSuivante = $nPos + $this->nNbColonneParLigne; } } return $nLigneSuivante; } function Fee74c8e6($nNumLigne) { if ($this->m_bAvecLigneInvisible === false) return false; $dwFlags = $this->F53234ef2($nNumLigne); if (Fdef56c7f($dwFlags, 512)) { return true; } if (F5f7235e7($dwFlags, 1024)) return false; if (F5f7235e7($dwFlags, 4096|8192)) return true; if (!isset($this->TabLigne[$nNumLigne+1])) return true; if (Fdef56c7f($dwFlags, 4096)) return false; if (Fdef56c7f($dwFlags, 8192)) { $nRuptureReplieMax = $this->Fe0d64c17($nNumLigne); if ($nRuptureReplieMax>0) return false; } return true; } function Fa0f182be($nNumLigne) { if ($nNumLigne < 0) return false; $nNbLigne = $this->F1ac18ca4(); return ($nNumLigne === $nNbLigne - 1); } function Fc5c4e5d8($nNumLigne) { return $this->F6fbc68ff($nNumLigne, 128 | 256 | 512 | 1024); } function F6fbc68ff($nNumLigne, $dwFlags) { return Fdef56c7f($this->F53234ef2($nNumLigne), $dwFlags) ;} function F53234ef2($nNumLigne) { if ($nNumLigne !== NUMLIGNE_INVALIDE) { if (isset($this->TabLigne[ $nNumLigne+1 ])) { $pstElem =& $this->TabLigne[ $nNumLigne+1 ]; } else { $pstElem = null; } if ($pstElem != null) { $return = $pstElem->dwFlag; Ffe2e63ad($return,1,$pstElem->IsSelected()); return $return; } } return 0; } function F5cd2b1ce($nNumLigne) { return $nNumLigne>=0 && isset($this->TabLigne[$nNumLigne+1]); } function Fd4a2edc8($nNumLigne, &$pbHautRupVisible, &$pbBasRupVisible) { if ($this->m_bAvecLigneInvisible === false) return false; $dwFlags = $this->F53234ef2($nNumLigne); if (Fdef56c7f($dwFlags, 1024|4096|8192)) { $pbHautRupVisible = Fdef56c7f($dwFlags, 4096); $pbBasRupVisible = Fdef56c7f($dwFlags, 8192); return true; } return false; } function Fa6ba222c($nNumLigne, &$rbInvisibleOuEntierementRepliee, &$rbRepliee, &$rnIndiceRuptureVisibleSiRepliee) { $rnIndiceRuptureVisibleSiRepliee = -1; if (false === $this->m_bAvecLigneInvisible) { $rbInvisibleOuEntierementRepliee = false; $rbRepliee = false; } else { $dwFlags = $this->F53234ef2($nNumLigne); $rbInvisibleOuEntierementRepliee = Fdef56c7f($dwFlags, 512); $rbRepliee = Fdef56c7f($dwFlags, 1024); if (false !== $rbRepliee) { if (F5f7235e7($dwFlags, 4096 | 8192)) { $rbInvisibleOuEntierementRepliee = true; } else { $rnIndiceRuptureVisibleSiRepliee = $this->Fe0d64c17($nNumLigne); if (F5f7235e7($dwFlags, 4096)) { if (0 == $rnIndiceRuptureVisibleSiRepliee) { $rbInvisibleOuEntierementRepliee = true; } } } } } } function Fedd556b7( $nNumLigne ) { $this->m_bAvecLigneInvisible = true; } function Fa404b0d1() { return $this->nFirstIndex; } function Fc18c1bcc($nIndice) { $nIndiceWL = $nIndice + 1; ++$nIndiceWL; while(isset($this->TabLigne[$nIndiceWL]) && ($this->TabLigne[$nIndiceWL]->Visible!==true)) ++$nIndiceWL; if (!isset($this->TabLigne[$nIndiceWL])) return -1; return $nIndiceWL-1; } function Fad3ced73() { if ($this->bEstZoneRepetee) { if ($this->bLineaire) { return 1; } else { return $this->nNbColonneParLigne; } } else { return 1; } } function F736efcde() { return $this->nMaxLignePage * $this->nNbColonneParLigne; } function F204fdac3($nIndiceWL) { switch ($this->GetType()) { default: case 7: case TYPE_CHAMP_TABLE: case TYPE_CHAMP_ZRLINEAIRE: return false; case TYPE_CHAMP_ZR: { $nNbRutpures = $this->Fdf310505(); for ($nRupture = 0; $nRupture < $nNbRutpures; ++$nRupture) if (false !== $this->F9e62af8e($nRupture, $nIndiceWL)) return true; } return false; } } function Fdf310505() { return count($this->TabRupture,COUNT_NORMAL); } function Fa2c5b186() { return ($this->Fdf310505() !== 0); } function F9e62af8e($nIndiceRupture, $nIndiceLigne) { return $this->Ffbadbfe4($nIndiceLigne - 1, $nIndiceRupture, 0); } function F9559b2d0($nIndiceRupture,$nIndiceLigne) { return $this->Ffbadbfe4($nIndiceLigne - 1, $nIndiceRupture, 1); } function Fa0eb486e($nIndiceRupture, $nIndiceLigne, $bAvecVisible) { if (($nIndiceRupture < 0) || ($nIndiceRupture >= count($this->TabRupture,COUNT_NORMAL)) || !isset($this->TabRupture[$nIndiceRupture])) return false; if (($nIndiceLigne < 1) || (!array_key_exists($nIndiceLigne , $this->TabLigne))) return false; if ((false !== $bAvecVisible) && (false === $this->TabRupture[$nIndiceRupture][ZR_RUPTURE_BAS]->Visible)) return false; $nNbElements=count($this->TabLigne,COUNT_NORMAL); if ($nIndiceLigne === $nNbElements) { return true; } if ($this->F4feb52a9($nIndiceRupture, $nIndiceLigne) === false) { return false; } else { $this->m_nGetDernierRuptureVisible = $nIndiceLigne + 1; return true; } } function F4feb52a9($nIndiceRupture, $nIndiceLigne) { $clVal1 = $this->F1adc5abe($this->TabRupture[$nIndiceRupture][ZR_RUPTURE_ATTRIBUT]->F418f91ca(),$nIndiceLigne); $clVal2 = $this->F1adc5abe($this->TabRupture[$nIndiceRupture][ZR_RUPTURE_ATTRIBUT]->F418f91ca(),$nIndiceLigne+1); if (Fa4014e81($clVal1,$clVal2)===0) { if ($nIndiceRupture !== 0) { return $this->F4feb52a9($nIndiceRupture - 1, $nIndiceLigne); } else { return false; } } return true; } function F593512b9() { $nNbVisibles = 0; $nNbMaxAffichables = $this->nMaxLignePage * $this->nNbColonneParLigne; if ($nNbMaxAffichables == 0) $nNbMaxAffichables = PHP_INT_MAX; $nNbLignes = $this->GetOccurrence(); if ($nNbLignes < $nNbMaxAffichables) { $nNbVisibles = $nNbLignes; if ($nNbVisibles < 0) $nNbVisibles=0; } else { $nNbVisibles = $nNbLignes; if ($nNbVisibles < 0) $nNbVisibles = 0; if ($nNbVisibles > $nNbMaxAffichables) $nNbVisibles = $nNbMaxAffichables; } return $nNbVisibles; } function F3337675a($nIndiceWL) { if (false === $this->m_bAvecLigneInvisible) return $nIndiceWL; $nNbLignesInvisibles = 0; for($nIndice=1; $nIndice<$nIndiceWL; ++$nIndice) { if (isset($this->TabLigne[$nIndice])) { $nIndiceRuptureVisibleSiRepliee = -1; $bInvisibleOuEntierementRepliee = $bRepliee = false; $this->Fa6ba222c($nIndice-1,$bInvisibleOuEntierementRepliee,$bRepliee,$nIndiceRuptureVisibleSiRepliee); if ($bInvisibleOuEntierementRepliee) { ++$nNbLignesInvisibles; } } else ++$nNbLignesInvisibles; } return $nIndiceWL - $nNbLignesInvisibles; } function Fcc72e355($nIndiceVisibleMax=null) { if (false === $this->m_bAvecLigneInvisible) return 0; $nNbLignesVisibles = 0; $nNbLignesInvisibles = 0; foreach (array_keys($this->TabLigne) as $nIndice) { if (isset($this->TabLigne[$nIndice])) { $nIndiceRuptureVisibleSiRepliee = -1; $bInvisibleOuEntierementRepliee = $bRepliee = false; $this->Fa6ba222c($nIndice-1,$bInvisibleOuEntierementRepliee,$bRepliee,$nIndiceRuptureVisibleSiRepliee); if ($bInvisibleOuEntierementRepliee) { ++$nNbLignesInvisibles; } else { ++$nNbLignesVisibles; if (isset($nIndiceVisibleMax) && $nNbLignesVisibles>=$nIndiceVisibleMax) break; } } else { ++$nNbLignesInvisibles; } } return $nNbLignesInvisibles; } function F0de68f17() { $nNbElementTotal = $this->F1ac18ca4() + intval($this->m_bSaisieCascade); if (count($this->TabLigne,COUNT_NORMAL)===0) return $nNbElementTotal; return ($nNbElementTotal - $this->Fcc72e355()); } function bAfficheRupture($bHaut, $nIndiceRupture, $nIndiceWL, $nIndiceVisible) { { if ($this->m_bEstNavigateur) return true; $piIndicePosition =& $this->m_pclIterateur; $nGetIndiceRuptureVisibleSiRepliee = $piIndicePosition->Fa0da8468(); $return = true; if (-1 !== $nGetIndiceRuptureVisibleSiRepliee) { if ($bHaut) { $return = ($nIndiceRupture <= $nGetIndiceRuptureVisibleSiRepliee); } else { $return = ($nIndiceRupture < $nGetIndiceRuptureVisibleSiRepliee); } } if (false !== $return) { $nIndiceWLPourRupture = $piIndicePosition->Fa22d2512($bHaut?RUPTURE_HAUT:RUPTURE_BAS); if ($bHaut) { $return = $this->F9559b2d0($nIndiceRupture, $nIndiceWLPourRupture); } else { $return = $this->F9e62af8e($nIndiceRupture, $nIndiceWLPourRupture) != false; } } } if ($return) { XVERIFY($this->F7498d9a4($nIndiceWL,$nIndiceRupture,$bHaut)); } return $return; } function F7498d9a4($nIndice,$nIndiceRupture,$bHaut) { if (!isset($this->_Optim_bPcodeAffichageHautRupture )) { $pclRupture =& $this->TabRupture[$nIndiceRupture][ZR_RUPTURE_HAUT]; if (!isset($pclRupture)) return false; if (ExecuteTraitement($pclRupture->m_sNomPHP,trtAffichageLigne,false,true)===false) { $this->_Optim_bPcodeAffichageHautRupture = false; } else $this->_Optim_bPcodeAffichageHautRupture = true; $pclRupture =& $this->TabRupture[$nIndiceRupture][ZR_RUPTURE_BAS]; if (!isset($pclRupture)) return false; if (ExecuteTraitement($pclRupture->m_sNomPHP,trtAffichageLigne,false,true)===false) { $this->_Optim_bPcodeAffichageBasRupture = false; } else $this->_Optim_bPcodeAffichageBasRupture = true; } if ( ($bHaut) ? ($this->_Optim_bPcodeAffichageHautRupture===false) : ($this->_Optim_bPcodeAffichageBasRupture===false)) { return true; } $pclRupture =& $this->TabRupture[$nIndiceRupture][$bHaut ? ZR_RUPTURE_HAUT : ZR_RUPTURE_BAS]; if (!isset($pclRupture)) return false; if ($this->bPcodeAffichageEnCours === true) return true; $this->bPcodeAffichageEnCours = true; $nAncienneValeur = $this->Valeur; if ($this->F48dce54a()) { $nPosition = $this->FichierParcours->Fd172163b($this->RubriqueParcours); } $bAjax = Feef890d7(); F3ecf4149(false); if ($this->F48dce54a()) { $nIndice-=$this->nFirstIndex; } $this->F37bb1c9f($nIndice); F3ecf4149($bAjax); ExecuteTraitement($pclRupture->m_sNomPHP,trtAffichageLigne,false); $this->bPcodeAffichageEnCours = false; F3ecf4149(false); $this->F37bb1c9f($nAncienneValeur); F3ecf4149($bAjax); if ($this->F48dce54a()) { Fe4e65a90($nPosition); } return true; } function F46bf4b9c($nLignePosAbsolue,$bHaut) { $nNbRuptures = count($this->TabRupture,COUNT_NORMAL); for ($nRupture = 0; $nRupture < $nNbRuptures; ++$nRupture) { if (false !== $this->Ffec40bc1($nLignePosAbsolue,$nRupture, $bHaut)) return true; } return false; } function F98cfc964(&$pclRupture, $nIndice) { $bHaut = $pclRupture->m_bHaut; $nIndiceRupture = $pclRupture->m_nIndice; if ($nIndiceRupture < 0) return -1; return $this->F182053f5($nIndiceRupture, $nIndice, $bHaut); } function F182053f5($nNumeroRupture, $nLigne, $bHaut) { if (!isset($this->TabLigne[$nLigne+1])) { return -1; } $pstLigneCourante =& $this->TabLigne[$nLigne+1]; if ($bHaut) { while ($nLigne > 0) { $pstLignePrecedente =& $this->TabLigne[$nLigne]; if ($pstLignePrecedente == null) { return -1; } $bEgaux = !$this->F4feb52a9($nNumeroRupture,$nLigne); if ($bEgaux == false) break; --$nLigne; $pstLigneCourante =& $pstLignePrecedente; } } else { $nTableOccurrence = $this->GetOccurrence(); while ($nLigne < $nTableOccurrence-1) { if (!isset($this->TabLigne[$nLigne+2])) { return -1; } $pstLigneSuivante =& $this->TabLigne[$nLigne+2]; $bEgaux = !$this->F4feb52a9($nNumeroRupture,$nLigne+1); if ($bEgaux == false) break; ++$nLigne; $pstLigneCourante =& $pstLigneSuivante; } } return $nLigne; } function Fc018951f($nNumLigne, $nIndiceRupture) { $bEnrouleActuel = $this->F9ade75fe($nNumLigne, $nIndiceRupture); $this->Fc12c5744($nNumLigne, $nIndiceRupture, !$bEnrouleActuel); } function F0dcb9be9(&$sResultat, $nLignePosAbsolue, $nLignePosVisible, $bHaut, $bBas) { $bRes = true; if ($bHaut || $bBas) $sResultat.= '<RUPTURES>'; if ($bHaut) $bRes &= $this->F1d5471a2($sResultat, $nLignePosAbsolue, true); if ($bBas) $bRes &= $this->F1d5471a2($sResultat, $nLignePosAbsolue, false); if ($bHaut || $bBas) $sResultat.= '</RUPTURES>'; return $bRes; } function F1d5471a2(&$sResultat,$nLignePosAbsolue, $bHaut) { $sResultat.= $bHaut ? '<HAUT>' : '<BAS>'; $sResultat .= '<![CDATA['; $nIndiceLigneVisible = $this->F3337675a($nLignePosAbsolue+1); $sResultat .= call_user_func_array('construireRupture' . ( $bHaut? 'Haut' : 'Bas' ) . 'ZR_'.$this->F960e3ffe(), array(&$this, $nLignePosAbsolue+1,&$nIndiceLigneVisible)); $sResultat .= ']]>'; $sResultat.= $bHaut ? '</HAUT>' : '</BAS>'; return true; } function F236bb7fa($bAvecSelection = true) { if ($this->m_bEstAjax) { return "<REFRESH RESETTABLE=\"0\" DEBUT=\"0\"/>"; } $sResultat = ''; if(isset($this->TabIndiceLigneModifAjax) || ($this->nReloadFrom > -1) || ($this->GetOccurrence() == 0)) { if($this->GetOccurrence() == 0) { $nPremierIndice = 0; $nNbLigneAffichees = 0; } else { $nPremierIndice = $this->GetFirstIndex() + 1; $nNbLigneAffichees = max(0, $this->GetLastIndex() - $this->GetFirstIndex()) + 1; } $nMax = $nPremierIndice + $nNbLigneAffichees; $sResetTable = ''; if($this->nReloadFrom > -1) { $sResetTable = ' RESETTABLE="1"'; $nMax = $this->nReloadFrom; $nNbLignesDisponiblesPourAffichage = $nNbLigneAffichees; $nNbLigneAffichees = 0; $pclIterateur=&CIterateurChampLignes_s_pclCreate($this,$nIndiceLigneVisible); for($i=$nMax;$nNbLignesDisponiblesPourAffichage>0&& $pclIterateur->vbParcoursNonFini();--$nNbLignesDisponiblesPourAffichage,$i++,$pclIterateur->vParcoursAvance()) { while(( $nIndiceCorrige = $pclIterateur->vnGetIndiceWL() )<$nMax && !$pclIterateur->vbParcoursNonFini()) {$pclIterateur->vParcoursAvance(); } $nIndiceCallback = $nIndiceCorrige; if (!isset($this->TabLigne[$nIndiceCallback])) { continue; } $nIndiceRuptureVisibleSiRepliee = -1; $bInvisibleOuEntierementRepliee = $bRepliee = false; $this->Fa6ba222c($i-1, $bInvisibleOuEntierementRepliee, $bRepliee, $nIndiceRuptureVisibleSiRepliee); while($i<$nIndiceCorrige) { $sResultat .= '<LIGNE INDICE="'.$i.'" INVISIBLE="'.($bInvisibleOuEntierementRepliee?'1':'0').'" REPLIEE="'.($bRepliee?'1':'0').'"/>' ; ++$nNbLignesDisponiblesPourAffichage; ++$nNbLigneAffichees; ++$i; $this->Fa6ba222c($i-1, $bInvisibleOuEntierementRepliee, $bRepliee, $nIndiceRuptureVisibleSiRepliee); } $sResultat .= '<LIGNE INDICE="'.$nIndiceCorrige.'"'; if (false !== $bInvisibleOuEntierementRepliee) { $sResultat .= ' INVISIBLE="1"'; ++$nNbLignesDisponiblesPourAffichage; } if (false != $bRepliee) { $sResultat .= ' REPLIEE="1"'; } $sResultat .= '>'; if (false === $bInvisibleOuEntierementRepliee) { $sResultat .= $this->F4bdd5276($nIndiceCallback,$nIndiceLigneVisible=$this->F3337675a($nIndiceCallback)); } $sResultat .= '</LIGNE>'; ++$nNbLigneAffichees; } $pclIterateur=null; unset($pclIterateur); $this->RestoreChamps(-1); } $sSelection = $bAvecSelection ? (' SELECTION="'.$this->Valeur.'"') : ''; $sSelection .= (($nNbRuptures=count($this->TabRupture,COUNT_NORMAL))>0) ? (' RUPTURES="'.$nNbRuptures.'"') : ''; if (isset($this->nNbColonneParLigne) && $this->nNbColonneParLigne>1) $sSelection.= ' COLONNES="'.$this->nNbColonneParLigne.'"'; $sResultat = '<LIGNES DEBUT="'.$nPremierIndice.'" NOMBRE="'.$nNbLigneAffichees.'"'.$sSelection.$sResetTable.'%1>' . $sResultat; if(isset($this->TabIndiceLigneModifAjax)) { foreach ($this->TabIndiceLigneModifAjax as $nIndiceLigne) { if($nIndiceLigne >= $nPremierIndice && $nIndiceLigne < $nMax) { $nIndiceRuptureVisibleSiRepliee = -1; $bInvisibleOuEntierementRepliee = $bRepliee = false; $this->Fa6ba222c($nIndiceLigne-1, $bInvisibleOuEntierementRepliee, $bRepliee, $nIndiceRuptureVisibleSiRepliee); $pclIterateur=&CIterateurChampLignes_s_pclCreate($this,$nIndiceLigneVisible); while($pclIterateur->vnGetIndiceWL()!=$nIndiceLigne && $pclIterateur->vbParcoursNonFini()) { $pclIterateur->vParcoursAvance(); } $sResultat .= '<LIGNE INDICE="'.$nIndiceLigne.'"'; if (false !== $bInvisibleOuEntierementRepliee) $sResultat .= ' INVISIBLE="1"'; if (false != $bRepliee) $sResultat .= ' REPLIEE="1"'; $sResultat .= '>'.$this->F4bdd5276($nIndiceLigne,$nIndiceLigneVisible=$this->F3337675a($nIndiceLigne)); $sResultat .= '</LIGNE>'; $pclIterateur=null; unset($pclIterateur); } } $this->RestoreChamps(-1); } $sResultat .= '</LIGNES>'; $sResultat = FMK_ChaineConstruit($sResultat,$this->m_sStyle); $this->m_sStyle =''; } return $sResultat; } function F4bdd5276($Indice,$nIndiceVisible) { Fa79fbf41('REDEF'); } function UpdateChamps(&$j) { if ($this->m_bEstNavigateur) return true; $bAjax = Feef890d7(); F3ecf4149(false); $this->m_nLigneAffichee = $j; $nNbAttributs = count($this->TabAttribut,COUNT_NORMAL); $tabKeysAttributs = array_keys($this->TabAttribut); $nLigneSelectioneeZR = $this->GetValeur(); for($i=0; $i<$nNbAttributs; $i++) { $sAliasChamp = $this->TabAttribut[$tabKeysAttributs[$i]]->m_sAliasChampLie; $pclChamp =& $GLOBALS['MaPage']->TabChamp[$sAliasChamp]; if (!isset($pclChamp)) continue; $nType = $pclChamp->GetType(); $bCloneEtSetpropRequis = ($nType == 47); $sPropriete = $this->TabAttribut[$tabKeysAttributs[$i]]->m_sNomProprieteLiee; if (!$bCloneEtSetpropRequis) { switch ($nType) { case TYPE_CHAMP_LISTE: case TYPE_CHAMP_COMBO: { if (($sPropriete === 'ContenuInitial') && (false==$pclChamp->F48dce54a())) { $bCloneEtSetpropRequis=true; } } break; default: } } if (!$bCloneEtSetpropRequis) continue; $xValeurAttribut = $this->TabLigne[$j]->TabValeur[$i]; $bProprieteExiste = (is_callable(array($pclChamp,F2080fcae($sPropriete,SETTER_PROPRIETE)))); if ($bProprieteExiste && !isset($this->TabSauvegarde[$sAliasChamp])) { $this->TabSauvegarde[$sAliasChamp] = _clone($pclChamp); if ($nType == 47)$pclChamp->m_clMoisCourantZR = null; } if ($nType == 47) { if ( (!isset($this->TabSauvegardeProp[$j])||!isset($this->TabSauvegardeProp[$j][$tabKeysAttributs[$i]])) || ($nLigneSelectioneeZR != $j) ) { $this->TabSauvegardeProp[$j][$tabKeysAttributs[$i]] = $pclChamp->F8b6fb5ae($sPropriete,$xValeurAttribut); } if (isset($this->TabSauvegardeProp[$j][$tabKeysAttributs[$i]])) { $pclChamp->Fbae54012($this->TabSauvegardeProp[$j][$tabKeysAttributs[$i]],$sPropriete); } } if ($bProprieteExiste) { $pclChamp->F9656d042($sPropriete, $xValeurAttribut); } } F3ecf4149($bAjax); return true; } function RestoreChamps($j) { if ($this->m_bEstNavigateur) return; $nNbAttributs = count($this->TabAttribut,COUNT_NORMAL); if (Feef890d7()) { if ($j!=-1) { $this->m_nLigneAffichee = 0; return; } } else { if ($j != $this->GetOccurrence()) { $this->m_nLigneAffichee = 0; return; } } $bAjax = Feef890d7(); F3ecf4149(false); $tabKeysAttributs = array_keys($this->TabAttribut); for($i=0; $i<$nNbAttributs; $i++) { $sAliasChamp = $this->TabAttribut[$tabKeysAttributs[$i]]->m_sAliasChampLie; $pclChamp =& $GLOBALS['MaPage']->TabChamp[$sAliasChamp]; if (!is_object($pclChamp)) continue; if (!isset($this->TabSauvegarde[$sAliasChamp])) { continue; } $pclChampClone =& $this->TabSauvegarde[$sAliasChamp]; $sPropriete = $this->TabAttribut[$tabKeysAttributs[$i]]->m_sNomProprieteLiee; if (is_callable(array($pclChampClone,F2080fcae($sPropriete,GETTER_PROPRIETE)))) $xValeurAttribut = $pclChampClone->getProp($sPropriete); if (is_callable(array($pclChampClone,F2080fcae($sPropriete,SETTER_PROPRIETE)))) $pclChampClone->F9656d042($sPropriete, $xValeurAttribut); } for($i=0; $i<$nNbAttributs; $i++){ if (isset($this->TabSauvegarde[$this->TabAttribut[$tabKeysAttributs[$i]]->m_sAliasChampLie])) unset($this->TabSauvegarde[$this->TabAttribut[$tabKeysAttributs[$i]]->m_sAliasChampLie]); } $this->m_nLigneAffichee = 0; F3ecf4149($bAjax); } } ?>