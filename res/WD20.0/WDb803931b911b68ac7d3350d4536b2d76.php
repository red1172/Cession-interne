<?php
//20.0.56.0 IHM/Champ/Bouton/Bouton.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 if (!defined('__INC__FMK/Disque.php')) { define('__INC__FMK/Disque.php',true); include_once(WB_INCLUDE_PATH.'WD99bd5984d9c78e9239c729a52b83e562.php'); } if (!defined('__INC__IHM/Champ/Champ.php')) { define('__INC__IHM/Champ/Champ.php',true); include_once(WB_INCLUDE_PATH.'WD7c939e6867492a5e5416bd4b4327fac0.php'); } class CBouton extends CChamp { var $EstBouton; function CBouton() { parent::CChamp(); $this->EstBouton = true; } function& GetType() { return getRef(4); } function Fc6eb41aa() { } function F9888ce5c() { } function F4a917fa4() { return 4; } function SetValeur($NewVal) { $this->SetLibelle($NewVal); } function& GetValeur() { return $this->GetLibelle(); } function F46a8f50b() { return 0; } } class CCornage extends CBouton { function CCornage() { parent::CBouton(); } function& GetType() { return getRef(79); } function F4a917fa4() { return 79; } } class CFichierUpload extends CObjetBase { var $m_sNomFichierServeur; var $m_sNomFichierNavigateur; function CFichierUpload($tabInfoInit = null) { parent::CObjetBase(null); if (isset($tabInfoInit)) { $pclChampParent =& $tabInfoInit[0]; $nIndiceFichier = $tabInfoInit[1]; $this->m_sNomFichierNavigateur = $pclChampParent->Fdc81ad45($nIndiceFichier,false); $this->m_sNomFichierServeur = $pclChampParent->Fdc81ad45($nIndiceFichier,true); } } function& GetValeur() { return $this->F0960a925(); } function& F0c09ca0f() { return $this->m_sNomFichierServeur; } function& F0960a925() { return $this->m_sNomFichierNavigateur; } } define('szSEPARATEUR_FICHIERNOM',';'); define('szSEPARATEUR_FICHIER',RC); class stUPLOADFICHIER { var $m_sNomNavigateur; var $m_sNomServeur; var $m_nTaille; } function F43178b3b($sFichierServeur) { return utf8_sprintf('%s_WBUPLOAD', $sFichierServeur); } class CChampUpload extends CBouton { var $m_tabFichierUploades; var $m_bMultiFichier; var $m_sFiltre; function CChampUpload() { parent::CBouton(); $this->m_tabFichierUploades = array(); $this->m_bMultiFichier = true; $this->m_sFiltre = null; $this->Fa8903904(false); $this->F12f87182(); } function F4a917fa4() { return 73; } function F12828e6d( $eTypeVue) { return $this->F0198de68('CVueChamp_Web' , $eTypeVue); } function F56660bf0( $eTypeControleur) { return $this->Fea7a1f04('CControleurChampUpload_Web' , $eTypeControleur); } function& operateurSub( $clIndice1 ) { $n = F075ca95b($clIndice1); if (!$this->Fcd15dc5e($n-1)) { Fe81a7f9e('ERR_OUTOFBOUNDCROCHET',$this->GetNom(),$n,$this->GetOccurrence()); } $clFichier = new CFichierUpload(array(&$this,$n-1)); return $clFichier; } function& GetType() { return getRef(ID_CHAMPUPLOAD); } function& GetOccurrence() { $n = count($this->m_tabFichierUploades,COUNT_NORMAL); return $n; } function& GetVide() { $b = (count($this->m_tabFichierUploades,COUNT_NORMAL) === 0); return $b; } function& GetValeur() { $sListe = $this->F9349c668(false); return $sListe; } function& GetContenu() { $sListe = $this->F9349c668(false); return $sListe; } function& GetMultiSelection() { return $this->m_bMultiFichier; } function SetMultiSelection($p) { $this->m_bMultiFichier = VersBooleen($p); } function& GetTypeFichiers() { return $this->m_sFiltre; } function SetTypeFichiers($p) { if (!is_string($p)) { Fe81a7f9e('ERR_PROPRIETE_CHAINE','PROP_NOM_TYPEFICHIERS',$this->GetNom(),$this->F3b9ec4ca()); return; } if (false === $this->Fe2adccf8($p)) { Fe81a7f9e('ERR_PROPRIETE_FORMAT','PROP_NOM_TYPEFICHIERS',$this->GetNom(),$this->F3b9ec4ca()); } $this->m_sFiltre = $p; } function UploadNomFichier($bLocalisation = true, $nIndice = 1) { return $this->Fdc81ad45($nIndice-1,$bLocalisation); } function UploadCopieFichier($sCheminServeur, $sNomFichier, $nIndice = 1) { return F406b3c6d($this->Fdc81ad45($nIndice-1,true),$this->Fdc81ad45($nIndice-1,false),$sCheminServeur, $sNomFichier, true ); } function Fdc81ad45($nFichier, $bLocal) { if (false != $this->Fcd15dc5e($nFichier)) { $rstFichier =& $this->m_tabFichierUploades[$nFichier]; return $bLocal ? $rstFichier->m_sNomServeur : $rstFichier->m_sNomNavigateur; } return null; } function F4814e2c8($sNomNavigateur, $sNomServeur) { $stFichier = new stUPLOADFICHIER(); if ($this->Fe73e45f2($sNomNavigateur,$sNomServeur, $stFichier) !== false) { $this->m_tabFichierUploades[] =& $stFichier; return true; } unset($stFichier); return false; } function Fa8903904($bSupprimeDisqueSystematiquement) { $bSupprimeDisque = $bSupprimeDisqueSystematiquement; $nNbElements = count($this->m_tabFichierUploades,COUNT_NORMAL); for ($nFichier = 0; $nFichier < $nNbElements; ++$nFichier) { $this->F79f86ef1($this->m_tabFichierUploades[$nFichier], $bSupprimeDisque); unset($this->m_tabFichierUploades[$nFichier]); } $this->m_tabFichierUploades = null; } function F79f86ef1( & $rstFichier, $bSupprimeDisque) { if (false !== $bSupprimeDisque) { if (F22eab6af($rstFichier->m_sNomServeur)) { XVERIFY(Fc0adeacb($rstFichier->m_sNomServeur)); } } unset($rstFichier->m_sNomServeur); unset($rstFichier->m_sNomNavigateur); } function Fe73e45f2($sNomNavigateur, $sNomServeur, & $rstFichier) { F67cfd262(); F6b1e3687(); if ( (F22eab6af($sNomServeur) !== false) && (($rstFichier->m_nTaille = F53e7b3e7($sNomServeur)) !== false ) ) { $rstFichier->m_sNomNavigateur = $sNomNavigateur; $rstFichier->m_sNomServeur = F43178b3b($sNomServeur); XVERIFY( Ff578b8aa($sNomServeur,$rstFichier->m_sNomServeur) ); $return = true; } else { $return = false; } F1e7b0563(); $sMessageErreurPHP = F1abae4f0(); if (!$return)Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_FICHIER_UPLOAD_IMPOSSIBLE"),$sNomServeur)); if (!empty($sMessageErreurPHP)) { Fdd46bacf($sMessageErreurPHP,errMessageSysteme); } return $return; } function Fcd15dc5e($nFichier) { return isset($this->m_tabFichierUploades[intval($nFichier)]); } function F9349c668($bAvecNomNav) { $sNomFichiers = ''; $nNbElements = count($this->m_tabFichierUploades,COUNT_NORMAL); for ($nFichier = 0; $nFichier < $nNbElements; ++$nFichier) { $sNomFichier = $this->m_tabFichierUploades[$nFichier]->m_sNomServeur; if (F8b98af41($sNomFichier)) { if (false === empty($sNomFichiers)) { $sNomFichiers .= szSEPARATEUR_FICHIER; Fe2f2efa3($sNomFichiers); } if (false != $bAvecNomNav) { $sNomFichiers .= $this->m_tabFichierUploades[$nFichier]->m_sNomNavigateur . szSEPARATEUR_FICHIERNOM; Fe2f2efa3($sNomFichiers); } $sNomFichiers .= $sNomFichier; Fe2f2efa3($sNomFichiers); } } return $sNomFichiers; } function Fe2adccf8($sFiltre) { if (false !== empty($sFiltre)) return true; $nPosDebut = 0; while (-1 !== $nPosDebut) { $nPosFin = utf8_strpos($sFiltre, RC, $nPosDebut); $sUnFiltre = ''; if (false !== $nPosFin) { $sUnFiltre = utf8_substr($sFiltre,$nPosDebut,$nPosFin-$nPosDebut); $nPosDebut = $nPosFin + utf8_strlen(RC); } else { $sUnFiltre = utf8_substr($sFiltre,$nPosDebut); $nPosDebut = -1; } if (false === $this->F5e146e0b($sUnFiltre)) return false; } return true; } function F5e146e0b($sUnFiltre) { if (false !== empty($sUnFiltre)) return false; $nPosTAB = utf8_strpos($sUnFiltre,TAB); if ( (false===$nPosTAB) || (utf8_strlen($sUnFiltre) - utf8_strlen(TAB) === $nPosTAB) ) return false; return ( false !== utf8_strpos($sUnFiltre,'*', $nPosTAB + utf8_strlen(TAB)) ); } } class CControleurChampUpload_Web extends CControleurChamp_Web { function CControleurChampUpload_Web ( &$pclModele) { parent::CControleurChamp_Web($pclModele); } function Fe27642cb($eAction, $bInterditSiInactif) { switch ($eAction) { case ACTION_WEB_UPLOAD_FICHIER: case ACTION_WEB_UPLOAD_FICHIERDERNIER: case ACTION_WEB_UPLOAD_REVEIL: return parent::Fe27642cb($eAction, $bInterditSiInactif); default: return ACTION_WEB_RESULTAT_ERREUR; } } function F0bf0c400( $eAction, $Parametere = null) { switch ($eAction) { case ACTION_WEB_UPLOAD_FICHIER: return $this->Fbbc922ea(); case ACTION_WEB_UPLOAD_FICHIERDERNIER: { $eResultat = $this->Fbbc922ea(); $eResultatPCode = $this->Fc83dab54(); if (($eResultat == ACTION_WEB_RESULTAT_OK) && ($eResultatPCode != ACTION_WEB_RESULTAT_OK)) { $eResultat = $eResultatPCode; } return $eResultat; } case ACTION_WEB_UPLOAD_REVEIL: return ACTION_WEB_RESULTAT_OK; default: return parent::F0bf0c400($eAction); } } function Fbbc922ea() { $pclModele =& $this->Fda201604(); if (!isset($_FILES['Filedata'])) { return ACTION_WEB_RESULTAT_ERREUR; } $sNomClient = $_FILES['Filedata']['name']; $sNomServeur = $_FILES['Filedata']['tmp_name']; $bRes = $pclModele->F4814e2c8($sNomClient, $sNomServeur); return ($bRes !== false) ? ACTION_WEB_RESULTAT_OK : ACTION_WEB_RESULTAT_ERREUR; } function Fc83dab54() { $pclChampUpload =& $this->Fda201604(); $bRes = ExecuteTraitement($pclChampUpload->F960e3ffe(),TRT_UploadFichier,false); $pclChampUpload->Fa8903904(true); return ($bRes!==false) ? ACTION_WEB_RESULTAT_OK : ACTION_WEB_RESULTAT_ERREUR; } } ?>