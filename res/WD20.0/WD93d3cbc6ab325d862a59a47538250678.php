<?php
//20.0.56.0 FMK/Reseau.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 define('FMK_Reseau_Ftp',true); if (!defined('__INC__FMK/Disque.php')) { define('__INC__FMK/Disque.php',true); include_once(WB_INCLUDE_PATH.'WD99bd5984d9c78e9239c729a52b83e562.php'); } if (!defined('__INC__FMK/Disque/Fichier.php')) { define('__INC__FMK/Disque/Fichier.php',true); include_once(WB_INCLUDE_PATH.'WD5e394596c6434eec95aa14dd761a6e59.php'); } if (!defined('__INC__FMK/Disque/Repertoire.php')) { define('__INC__FMK/Disque/Repertoire.php',true); include_once(WB_INCLUDE_PATH.'WDfd5c09692e88cd1a210ee4e600f1b98b.php'); } define("FTPModeBinaire",(defined('FTP_BINARY')?FTP_BINARY:1),true); define("FTPModeASCII",(defined('FTP_ASCII')?FTP_ASCII:1),true); define("SepInfoFTP"," ",true); define("SepLienInfoFTP","->",true); define("FTPFichier",1,true); define("FTPRépertoire",2,true); define("FTPFichierRépertoire",(FTPFichier + FTPRépertoire),true); class FMK_Reseau_Ftp { var $NomDernierFichierFTP; var $AttributDernierFichierFTP; var $DateDernierFichierFTP; var $HeureDernierFichierFTP; var $TailleDernierFichierFTP; function FMK_Reseau_Ftp() { $this->NomDernierFichierFTP = ""; $this->AttributDernierFichierFTP = AttributErreur; $this->DateDernierFichierFTP = ""; $this->HeureDernierFichierFTP = ""; $this->TailleDernierFichierFTP = RetourErreur_Entier; } } $_FMK_Reseau_Ftp = new FMK_Reseau_Ftp(); class FMK_ParamTransfertFTP { var $Connexion; var $RepSource; var $RepDest; var $ModeTransfert; function FMK_ParamTransfertFTP($Connexion = RetourErreur_Entier, $RepSource = "", $RepDest = "", $ModeTransfert = FTPModeBinaire) { $this->Connexion = $Connexion; $this->RepSource = $RepSource; $this->RepDest = $RepDest; $this->ModeTransfert = $ModeTransfert; } } function F29ff73cb($Connexion,$Repertoire) { if (F89ba6a91($Connexion,F4487752e( F4487752e($Repertoire,SepRepURL),SeparateurRepertoire),true) != AttributErreur) return true; $Père = dirname($Repertoire); if ($Père == $Repertoire) return true; if (!F29ff73cb($Connexion,$Père)) return false; return ftp_mkdir($Connexion,$Repertoire) !== false; } function F89ba6a91($Connexion = null,$NomFichier = "",$Prive = false) { global $_FMK_Reseau_Ftp; $Attribut = $Prive ? AttributErreur : null; F9c5d4add($Connexion,$NomFichier,$Attribut); return $Prive ? $Attribut : $_FMK_Reseau_Ftp->AttributDernierFichierFTP; } function F9c5d4add($Connexion, $NomFichier, &$Attribut, $InfoFichier = null) { global $_FMK_Reseau_Ftp; if ($Connexion === null) return; if ($Connexion == RetourErreur_Entier) { if ($Attribut !== null) return; $_FMK_Reseau_Ftp->AttributDernierFichierFTP = AttributErreur; $_FMK_Reseau_Ftp->DateDernierFichierFTP = ""; $_FMK_Reseau_Ftp->HeureDernierFichierFTP = ""; $_FMK_Reseau_Ftp->TailleDernierFichierFTP = RetourErreur_Entier; $_FMK_Reseau_Ftp->NomDernierFichierFTP = ""; return; } $Nom = basename($NomFichier); $Racine = $Nom == ""; $Trouve = $Racine || ($InfoFichier != null); if ($InfoFichier === null) { $RepParent = F76ebf021($NomFichier); $tabInfoNomFichier = null; $Info = F6d729e5d($Connexion,$RepParent,$tabInfoNomFichier); if ($Info!==false && count($Info) > 0) { $nBorneMax =count($Info); for ($i = 0; (!$Trouve) && ($i < $nBorneMax); $i++) { $Trouve = F0728da76(utf8_strtoupper(F05ad8ed4($Info[$i],1,SepInfoFTP . SepLienInfoFTP)),utf8_strtoupper(SepInfoFTP . $Nom)); if ($Trouve) { break; } } if ($Trouve) $InfoFichier = $Info[$i]; } } $AttributFichier = (!$Trouve) ? AttributErreur : ((($Racine || (utf8_strspn(utf8_substr($InfoFichier,0,1),"ld") == 1) || (utf8_stristr($InfoFichier,"<DIR>") !== false)) ? AttributRepertoire : "") . (((!$Racine) && (utf8_strcasecmp(utf8_substr($InfoFichier,2,1),"-") == 0) && (utf8_strspn(utf8_substr($InfoFichier,1,1),"r-") == 1)) ? AttributLectureSeule : "")); if ($Attribut !== null) { $Attribut = $AttributFichier; return; } $_FMK_Reseau_Ftp->AttributDernierFichierFTP = $AttributFichier; if (($DateHeure = ftp_mdtm($Connexion,$NomFichier))== RetourErreur_Entier) { $_FMK_Reseau_Ftp->DateDernierFichierFTP = ""; $_FMK_Reseau_Ftp->HeureDernierFichierFTP = ""; } else { $_FMK_Reseau_Ftp->DateDernierFichierFTP = F2d4ebc64($DateHeure); $_FMK_Reseau_Ftp->HeureDernierFichierFTP = F5c7df4c9($DateHeure); } $_FMK_Reseau_Ftp->TailleDernierFichierFTP = ftp_size($Connexion,$NomFichier); $_FMK_Reseau_Ftp->NomDernierFichierFTP = $Nom; } function F76ebf021($Chemin) { $Rep = F7816de1e($Chemin,fDisqueRépertoire); if (F0728da76($Rep,SeparateurRepertoire)) $Rep = utf8_substr($Rep,0,utf8_strlen($Rep) - utf8_strlen(SeparateurRepertoire)) . SepRepURL; return $Rep; } function F6d729e5d($Connexion, $NomFicRep, &$tabInfoNomFichier) { $sFicExt = F7816de1e($NomFicRep,fFichierExtension); if ($sFicExt == JokerFichierChaine || ($sFicExt == JokerFichierChaine.SepExtension.JokerFichierChaine)) $NomFicRep = utf8_substr($NomFicRep,0,utf8_strlen($NomFicRep) - utf8_strlen($sFicExt)); $ChangeRep = (($MemoRep = ftp_pwd($Connexion)) !== false) && ftp_chdir($Connexion,($NomFicRep == RépertoireCourant . SepRepURL) ? RépertoireCourant : $NomFicRep); if (UNICODE_PAGE_UTF8 && PHPVERSION_5) ftp_raw($Connexion,'OPTS UTF8 ON'); $Info = ftp_rawlist($Connexion,RépertoireCourant); if ($tabInfoNomFichier!==null) $tabInfoNomFichier = ftp_nlist($Connexion,RépertoireCourant); if ($ChangeRep) ftp_chdir($Connexion,$MemoRep); return $Info; } function F745539b6($Serveur, $Utilisateur = "anonymous", $MotDePasse = "", $NumeroPort = 21, $TypeConnexion = true, $DelaiConnexion = 20) { if (($Connexion = ftp_connect($Serveur,$NumeroPort,$DelaiConnexion)) === false) return RetourErreur_Entier; if (($Utilisateur != "") && (!ftp_login($Connexion,$Utilisateur,$MotDePasse))) { ftp_quit($Connexion); return RetourErreur_Entier; } ftp_pasv($Connexion,$TypeConnexion); return $Connexion; } function Fbe3fcdf8($Session) { return ftp_close($Session); } function F1b53b37b($Session, $Commande) { return ftp_site($Session,$Commande); } function Ff88d9f7a($Info) { return F7816de1e(F05ad8ed4($Info,(F05ad8ed4($Info,2,SepInfoFTP,DepuisFin) == SepLienInfoFTP) ? 3 : 1,SepInfoFTP,DepuisFin),fFichierExtension); } function F0b272156($Connexion = null,$NomFichier = "") { global $_FMK_Reseau_Ftp; $Attribut = null; F9c5d4add($Connexion,$NomFichier,$Attribut); return $_FMK_Reseau_Ftp->DateDernierFichierFTP; } function F6f640a27($Connexion = null,$NomFichier = "") { global $_FMK_Reseau_Ftp; $Attribut = null; F9c5d4add($Connexion,$NomFichier,$Attribut); return $_FMK_Reseau_Ftp->HeureDernierFichierFTP; } function F5a94a6d0($Connexion, $NomRepSrc, $NomRepDst, $ModeTransfert = FTPModeBinaire) { if ($Connexion == RetourErreur_Entier) return false; if (false!==($bRepSrcIsDir=is_dir(F9486bf1a($NomRepSrc)))) $NomRepDst = F6a46867d($NomRepDst) . basename($NomRepSrc); if (!F29ff73cb($Connexion,$NomRepDst)) return false; $SourceSepFin = F6a46867d($NomRepSrc); $Arret = false; F640e06e4($bRepSrcIsDir ? ($SourceSepFin . JokerFichierChaine) : $NomRepSrc,"FMK_ProcedureEnvoiFTP",$Arret,new FMK_ParamTransfertFTP($Connexion,($bRepSrcIsDir ? $SourceSepFin : F7816de1e($NomRepSrc,fDisqueRépertoire)),F6a46867d($NomRepDst),$ModeTransfert),flPremierFichier,true,true); return !$Arret; } function Ff8731187($Attribut) { return utf8_strstr($Attribut,AttributRepertoire) !== false; } function Fea4f7bed($Connexion,$Repertoire) { return Ff8731187(F89ba6a91($Connexion,$Repertoire,true)); } function F4487752e($Chemin, $Sep) { return ((utf8_strlen($Chemin) > utf8_strlen($Sep)) && F0728da76($Chemin,$Sep)) ? utf8_substr($Chemin,0,utf8_strlen($Chemin) - utf8_strlen($Sep)) : $Chemin; } function F65ece976($Connexion, $NomFicRepSrc, $NomFicRepDst, $ModeTransfert = FTPModeBinaire) { if ((!is_file(F9486bf1a($NomFicRepSrc))) || (F7816de1e($NomFicRepDst,fFichierExtension) == "")) { return F5a94a6d0($Connexion,$NomFicRepSrc,$NomFicRepDst,$ModeTransfert); } if (!F29ff73cb($Connexion,dirname($NomFicRepDst))) { return false; } if (Fea4f7bed($Connexion,$NomFicRepDst)) { $NomFicRepDst .= SepRepURL . F7816de1e($NomFicRepSrc,fFichierExtension); } return ftp_put($Connexion,$NomFicRepDst,$NomFicRepSrc,$ModeTransfert); } function FMK_ProcedureEnvoiFTP($Répertoire, $Fichier, $Indicateur, $ParamTransfertFTP) { $RetourParDefaut = -1; $Destination = $ParamTransfertFTP->RepDest . F3449a00a($Répertoire,utf8_strlen($ParamTransfertFTP->RepSource) + 1); if ($Fichier == "") { if (!F29ff73cb($ParamTransfertFTP->Connexion,$Destination)) return 0; } else if (!F65ece976($ParamTransfertFTP->Connexion, $Répertoire . $Fichier, $Destination . $Fichier, $ParamTransfertFTP->ModeTransfert)) return 0; return $RetourParDefaut; } function Fbf1590d7($Connexion,$NomFicRep, $NomProc, $Indicateur = FTPFichierRépertoire, $Param = 0, $Récursif = false, $Prive = false) { $Arret = false; return Fee1a04a2($Connexion,$NomFicRep, $NomProc, $Arret, $Indicateur , $Param , $Récursif , $Prive ); } function Fee1a04a2($Connexion,$NomFicRep, $NomProc, &$Arrêt, $Indicateur = FTPFichierRépertoire, $Param = 0, $Récursif = false, $Prive = false) { global $_FMK_Reseau_Ftp; if ($Connexion == RetourErreur_Entier) return 0; $Arrêt = false; if (!function_exists($NomProc)) return 0; $NbFic = 0; $Répertoire = F76ebf021($NomFicRep); $tabInfoNomFichier=array(); $ListeFichier = F6d729e5d($Connexion,$NomFicRep,$tabInfoNomFichier); $nBorneMax = ($ListeFichier!==false) ? count($ListeFichier) : 0; for ($i = 0; $i < $nBorneMax; $i++) { $Fichier = $tabInfoNomFichier[$i]; $Attribut = $Prive ? AttributErreur : null; F9c5d4add($Connexion,F76ebf021($NomFicRep) . $Fichier,$Attribut,$ListeFichier[$i]); $EstRepertoire = Ff8731187($Prive ? $Attribut : $_FMK_Reseau_Ftp->AttributDernierFichierFTP); if (((($Indicateur & FTPFichier) == FTPFichier) && (!$EstRepertoire)) || ((($Indicateur & FTPRépertoire) == FTPRépertoire) && ($EstRepertoire))) { ++$NbFic; $tab = array( $Fichier,$_FMK_Reseau_Ftp->TailleDernierFichierFTP,$_FMK_Reseau_Ftp->AttributDernierFichierFTP,$_FMK_Reseau_Ftp->DateDernierFichierFTP,$_FMK_Reseau_Ftp->HeureDernierFichierFTP,$Param ); if (PHPVERSION_5_3) foreach (array_keys($tab) as $tabindex) $tab[$tabindex] =& $tab[$tabindex]; if (call_user_func_array($NomProc,$tab) === 0) { $Arrêt = true; break; } } if ($Récursif && (!$Arrêt) && $EstRepertoire && (!F1842f4fe($Fichier))) { $SousRépertoire = $Répertoire . $Fichier; $NbFic += Fee1a04a2($Connexion,$SousRépertoire . F2e9b4751($NomFicRep) . F7816de1e($NomFicRep,fFichierExtension),$NomProc,$Arrêt,$Indicateur,$Param,$Récursif,$Prive); if ($Arrêt) break; } } return $NbFic; } function F5166dcf5() { global $_FMK_Reseau_Ftp; return $_FMK_Reseau_Ftp->NomDernierFichierFTP; } function FMK_ProcedureRecupFichierFTP($Fichier, $Taille, $Attribut, $Date, $Heure, $ParamTransfertFTP) { $RetourParDefaut = -1; $Destination = F6a46867d($ParamTransfertFTP->RepDest) . F7816de1e($ParamTransfertFTP->RepSource,fFichierExtension); if ($Fichier == "") { if (!Fd0f24521($Destination)) { F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_DOSSIER_DROITS_INSUFFISANTS"),$Destination)); return 0; } } else if (!Feb999699($ParamTransfertFTP->Connexion,F6a46867d($ParamTransfertFTP->RepSource) . $Fichier, $Destination . $Fichier)) return 0; return $RetourParDefaut; } function F92dc010a($Connexion,$Source,$Destination,$ModeTransfert,$Récursif = 0) { if (!Fd0f24521($Destination)) { F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_DOSSIER_DROITS_INSUFFISANTS"),$Destination)); return false; } $SourceSepFin = F6a46867d($Source); Fbf1590d7($Connexion,($EstRep = Fea4f7bed($Connexion,$Source)) ? ($SourceSepFin . JokerFichierChaine) : $Source,"FMK_ProcedureRecupFichierFTP",$Arrêt = false,FTPFichierRépertoire,new FMK_ParamTransfertFTP($Connexion,($EstRep ? $SourceSepFin : F76ebf021($Source)),F6a46867d($Destination),$ModeTransfert),$Récursif,true); return !$Arrêt; } function Feb999699($Connexion, $FicRepRecup, $FicRepDest, $ModeTransfert = FTPModeBinaire) { $Attribut = F89ba6a91($Connexion,$FicRepRecup); $SourceRep = Ff8731187($Attribut); if (($Attribut == AttributErreur) || $SourceRep || (F7816de1e($FicRepDest,fFichierExtension) == "")) return F92dc010a($Connexion,$FicRepRecup,$SourceRep ? (F6a46867d($FicRepDest) . F7816de1e($FicRepRecup,fFichierExtension)) : $FicRepDest,$ModeTransfert); return ftp_get($Connexion,is_dir(F9486bf1a($FicRepDest)) ? (F6a46867d($FicRepDest) . F7816de1e($FicRepRecup,fFichierExtension)) : $FicRepDest,$FicRepRecup,$ModeTransfert); } function F2ebfcb78($Connexion, $sAncienNom, $sNouveauNom) { return ftp_rename($Connexion, $sAncienNom, $sNouveauNom); } function F9f473974($Connexion, $sNom) { return ftp_delete($Connexion, $sNom); } function F7c20408d($Connexion, $Repertoire = null) { return ($Repertoire === null) ? ((($Rep = ftp_pwd($Connexion)) === false) ? "" : $Rep) : ftp_chdir($Connexion,$Repertoire); } function F8a160d7f($Connexion, $Repertoire) { $EstRep = Fea4f7bed($Connexion,$Repertoire); $MasqueRep = $EstRep ? (F6a46867d($Repertoire) . JokerFichierChaine) : $Repertoire; return $EstRep && (Fbf1590d7($Connexion,$MasqueRep,"FMK_ProcedureRepSupprimeFTP",$Arrêt = false,FTPFichierRépertoire,new FMK_ParamTransfertFTP($Connexion,$Repertoire,"",0),false,true) > 0) && (!$Arrêt) && ftp_rmdir($Connexion,$Repertoire); } function FMK_ProcedureRepSupprimeFTP($FicRep, $Taille, $Attribut, $Date, $Heure, $ParamFTP) { $RetourParDefaut = -1; $FicRep = F6a46867d($ParamFTP->RepSource) . $FicRep; if (!Fea4f7bed($ParamFTP->Connexion,$FicRep)) { if (!ftp_delete($ParamFTP->Connexion,$FicRep)) return 0; } else if (!F8a160d7f($ParamFTP->Connexion,$FicRep)) return 0; return $RetourParDefaut; } function F38356f58($Connexion = null,$NomFichier = "") { global $_FMK_Reseau_Ftp; $Attribut = null; F9c5d4add($Connexion,$NomFichier,$Attribut); return $_FMK_Reseau_Ftp->TailleDernierFichierFTP; } ?>