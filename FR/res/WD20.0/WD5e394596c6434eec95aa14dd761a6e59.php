<?php
//20.0.56.0 FMK/Disque/Fichier.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 define('FMK_Disque_Fichier',true); if (!defined('__INC__FMK/Disque/Repertoire.php')) { define('__INC__FMK/Disque/Repertoire.php',true); include_once(WB_INCLUDE_PATH.'WDfd5c09692e88cd1a210ee4e600f1b98b.php'); } if (!defined('__INC__FMK/Langue.php')) { define('__INC__FMK/Langue.php',true); include_once(WB_INCLUDE_PATH.'WD4d84d6208fe7c636ffccdb9635ac4cf0.php'); } if (!defined('__INC__FMK/Disque.php')) { define('__INC__FMK/Disque.php',true); include_once(WB_INCLUDE_PATH.'WD99bd5984d9c78e9239c729a52b83e562.php'); } if (!defined('__INC__FMK/Chaine.php')) { define('__INC__FMK/Chaine.php',true); include_once(WB_INCLUDE_PATH.'WD55acb2e708e26f23cb8956cd93e98123.php'); } if (!defined('__INC__FMK/Date.php')) { define('__INC__FMK/Date.php',true); include_once(WB_INCLUDE_PATH.'WD97af71f4453b9d548e8ff90b4bbaba9f.php'); } define("UNICODE_BOM", "\xEF\xBB\xBF" ); define("UNICODE_BOM_SIZE", 3 ); $_RepertoireParcouru = false; $_NomRepertoireParcouru = ""; $_FiltreRepertoireParcouru = ""; $_FichierRépertoire = frFichier; function F7816de1e($CheminFichier, $Partie) { if (utf8_trim($CheminFichier)=="") return ""; $SepFin = Fe3b56f25($CheminFichier); $Extraction = pathinfo(F9486bf1a($CheminFichier) . ($SepFin ? JokerFichierChaine : "")); if (($Extraction[PartieCheminRepertoire] == SeparateurRepertoire) && (utf8_substr($CheminFichier,0,1) == SepRepURL)) $Extraction[PartieCheminRepertoire] = SepRepURL; $URL = F61bc61eb($CheminFichier,DebutURL); $UNC = F61bc61eb($CheminFichier,DebutUNC); $Protocole = (FMK_Position($CheminFichier,ProtocoleURL) > 0); $Resultat = ""; $Répertoire = array_key_exists(PartieCheminRepertoire,$Extraction) ? $Extraction[PartieCheminRepertoire] : ""; if (Fdef56c7f($Partie , fRepertoire)) $Resultat = ($Répertoire==='.') ? '' : F0ac3fb91((($Partie & fDisque) || $Protocole) ? $Répertoire : ($URL ? Fea4fdf36($Répertoire,SepRepURL) : ($UNC ? Fea4fdf36($Répertoire,SeparateurRepertoire) : F05ad8ed4($Répertoire,2,SepDisque))),F2e9b4751($CheminFichier)); else if ((Fdef56c7f($Partie , fDisque)) && (!$Protocole)) $Resultat = $URL ? Fcee211e8($Répertoire,SepRepURL) : ($UNC ? Fcee211e8($Répertoire,SeparateurRepertoire) : ((utf8_strstr($Répertoire,SepDisque) === false) ? "" : (F05ad8ed4($Répertoire,1,SepDisque) . SepDisque))); if ($SepFin) return $Resultat; $Extension = array_key_exists(PartieCheminExtension,$Extraction) ? $Extraction[PartieCheminExtension] : ""; if ((F44b84d9d($Partie , fFichierExtension))) $Resultat .= (array_key_exists(PartieCheminFichier,$Extraction) ? $Extraction[PartieCheminFichier] : ""); else if (Fdef56c7f($Partie , fFichier)) $Resultat .= basename($CheminFichier,SepExtension . $Extension); else if (Fdef56c7f($Partie , fExtension)) $Resultat .= SepExtension . $Extension; return $Resultat; } function Fea4fdf36($Chemin, $Sep) { return F3449a00a($Chemin,F1e689842($Chemin,$Sep,OccurrenceSepDisqueUnifié)); } function F0a2479f9($NomFichier, $Mode = foLectureEcriture) { $Rep = F7816de1e($NomFichier,fDisqueRépertoire); if ( (''!==$Rep) && !is_dir(F9486bf1a($Rep))) return RetourErreur_Entier; $bCreerNouveauFichier = false; if ((!is_file(F9486bf1a($NomFichier)))) { if ( (!($Mode & (foCreation | foCreationSiInexistant)))) return RetourErreur_Entier; $bCreerNouveauFichier = true; } $sModeOuverture = ''; $bEnLectureSeule = false; if ($Mode & foCreation) { $sModeOuverture = 'w'; } elseif ($Mode & (foCreationSiInexistant)) { $sModeOuverture = (is_file($NomFichier)) ? (($Mode & (foAjout)) ? 'a' : 'r') : 'w'; } elseif ($Mode & (foAjout)) { $sModeOuverture = 'a'; } else { $sModeOuverture = 'r'; $bEnLectureSeule = true; } if ($Mode & foEcriture) { $sModeOuverture.= '+'; $bEnLectureSeule = false; } F6b1e3687(); $Fichier = fopen(F9486bf1a($NomFichier),$sModeOuverture); F1e7b0563(); if ($Fichier === false) { $msg = F1abae4f0(); if (!empty($msg)) F853b7085($msg,errMessageSysteme); return RetourErreur_Entier; } if ($Mode & foUnicode) { F6b1e3687(); if (feof($Fichier) || filesize(F9486bf1a($NomFichier))<UNICODE_BOM_SIZE) { $bBomPresent = false; } else { fseek($Fichier,0); $data = fgets($Fichier,UNICODE_BOM_SIZE+1); $bBomPresent = (strcmp($data,UNICODE_BOM)===0); fseek($Fichier,0); } if ($bBomPresent) { fseek($Fichier,UNICODE_BOM_SIZE); } else { if ($bCreerNouveauFichier && !$bEnLectureSeule) { fclose($Fichier);$Fichier = fopen($NomFichier,'w+'); fseek($Fichier,0); fwrite($Fichier,UNICODE_BOM,UNICODE_BOM_SIZE); fclose($Fichier); $Fichier = fopen(F9486bf1a($NomFichier),$sModeOuverture); } } $msg = F1abae4f0(); if (!empty($msg)) F853b7085($msg,errMessageSysteme); F1e7b0563(); } return $Fichier; } function Ff1eaa899($NomFichier) { return F0a2479f9($NomFichier,foCreation + foLectureEcriture); } function Fae814d9e($Fichier) { if ($Fichier == RetourErreur_Entier) return RetourErreur_Entier; return (is_resource($Fichier)&&fclose($Fichier)) ? 0 : RetourErreur_Entier; } function F24f63604($Fichier, $NbOctet) { if ($Fichier == RetourErreur_Entier) return ""; return (($Res = fread($Fichier,$NbOctet)) === false) ? "" : $Res; } function F71eaba88($Fichier) { if ($Fichier == RetourErreur_Entier) return ""; if (feof($Fichier)) return EOT; $Res = fgets($Fichier); if ($Res === false) return ''; $nTaille = utf8_strlen($Res); if (utf8_substr($Res,$nTaille-1,1) === "\n") { $Res = utf8_substr($Res,0,$nTaille-1); --$nTaille; } if (utf8_substr($Res,$nTaille-1,1) === "\r") $Res = utf8_substr($Res,0,$nTaille-1); return $Res; } function Fe80480f8($Fichier, $Ecrit, $NbOctet = -1) { if ($Fichier == RetourErreur_Entier) return RetourErreur_Entier; return (($Res = (($NbOctet = -1) ? fwrite($Fichier,$Ecrit) : fwrite($Fichier,$Ecrit,$NbOctet))) === false) ? RetourErreur_Entier : $Res; } function Fa40bd700($Fichier, $Ecrit) { if ($Fichier == RetourErreur_Entier) return false; return fwrite($Fichier,$Ecrit . RC); } function Fa118c401($Fichier, $Position, $Origine) { if ($Fichier == RetourErreur_Entier) return RetourErreur_Entier; switch ($Origine) { case fpDebut : $Origine = SEEK_SET; break; case fpCourant : $Origine = SEEK_CUR; break; case fpFin : $Origine = SEEK_END; break; default: return RetourErreur_Entier; } if (fseek($Fichier,$Position,$Origine) == -1) return RetourErreur_Entier; return (($Position = ftell($Fichier)) === false) ? RetourErreur_Entier : $Position; } function Fc0adeacb($NomFichier) { if (is_dir(F9486bf1a($NomFichier)) && (!is_file(F9486bf1a($NomFichier)))) return false; if (!is_file(F9486bf1a($NomFichier))) return fRepSupprime($NomFichier,0,true); F6b1e3687(); $return = is_writable(F9486bf1a($NomFichier)) && unlink(F9486bf1a($NomFichier)); F1e7b0563(); $msg = F1abae4f0(); if (!empty($msg)) Fdd46bacf($msg,errMessageSysteme); return $return; } function Ff578b8aa($NomFichierSrc, $NomFichierDst, $Récursif = false) { if ((!is_file(F9486bf1a($NomFichierSrc))) || (F7816de1e($NomFichierDst,fFichierExtension) == "")) return F8b2ea819($NomFichierSrc,$NomFichierDst,$Récursif); if (!Fd0f24521($dirname=dirname(F9486bf1a($NomFichierDst)))) { F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_DOSSIER_DROITS_INSUFFISANTS"),$dirname)); return false; } if (is_dir(F9486bf1a($NomFichierDst))) return true; return copy(F9486bf1a($NomFichierSrc),F9486bf1a($NomFichierDst)); } function F70df4179($NomSrc,$NomDst) { if ((!file_exists($NomSrcACP=F9486bf1a($NomSrc))) || file_exists($NomDstACP=F9486bf1a($NomDst))) return false; return rename($NomSrcACP,$NomDstACP); } function F53e7b3e7($NomFichier) { if (!is_file($NomFichierACP=F9486bf1a($NomFichier))) { if (is_resource($NomFichierACP)) { $tabInfos = fstat($NomFichierACP); if (isset($tabInfos['size'])) return $tabInfos['size']; } return RetourErreur_Entier; } return (($Taille = filesize($NomFichierACP)) === false) ? RetourErreur_Entier : $Taille; } function F23459603($DateChaine, $DateHeure) { $RecupDateHeure = getdate($DateHeure); return mktime($RecupDateHeure[PartieDateHeureHeure],$RecupDateHeure[PartieDateHeureMinute],$RecupDateHeure[PartieDateHeureSeconde],utf8_substr($DateChaine,DebutMoisDansDateHeure,TailleMoisDansDateHeure),utf8_substr($DateChaine,DebutJourDansDateHeure,TailleJourDansDateHeure),utf8_substr($DateChaine,DebutAnneeDansDateHeure,TailleAnneeDansDateHeure)); } function F2d4ebc64($DateHeure) { if ($DateHeure === false) return ""; $RecupDateHeure = getdate($DateHeure); return Fbd2cdc8b($RecupDateHeure[PartieDateHeureAnnee],$RecupDateHeure[PartieDateHeureMois],$RecupDateHeure[PartieDateHeureJour]); } function F736e4943($NomFichier, $DateModif = "", $TypeDate = fModification) { if (!file_exists($NomFichierACP=F9486bf1a($NomFichier))) return ""; if (($DateModif != "") && ((!is_writable($NomFichierACP)) || (!(($TypeDate == fAcces) ? touch($NomFichierACP,filemtime($NomFichierACP),F23459603($DateModif,fileatime($NomFichierACP))) : touch($NomFichierACP,F23459603($DateModif,filemtime($NomFichierACP))))))) return ""; filemtime(""); fileatime(""); return F2d4ebc64(($TypeDate == fAcces) ? fileatime($NomFichierACP) : filemtime($NomFichierACP)); } function F019644ae($HeureChaine, $DateHeure) { $RecupDateHeure = getdate($DateHeure); return mktime(utf8_substr($HeureChaine,DebutHeureDansHeure,TailleHeureDansDateHeure),utf8_substr($HeureChaine,DebutMinuteDansHeure,TailleMinuteDansDateHeure),utf8_substr($HeureChaine,DebutSecondeDansHeure,TailleSecondeDansDateHeure),$RecupDateHeure[PartieDateHeureMois],$RecupDateHeure[PartieDateHeureJour],$RecupDateHeure[PartieDateHeureAnnee]); } function F5c7df4c9($DateHeure) { if ($DateHeure === false) return ""; $RecupDateHeure = getdate($DateHeure); return utf8_sprintf(ChaineFormatDateHeureHeureSeconde,$RecupDateHeure[PartieDateHeureHeure],$RecupDateHeure[PartieDateHeureMinute],$RecupDateHeure[PartieDateHeureSeconde]); } function F0fda4c12($NomFichier, $HeureModif = "", $TypeHeure = fModification) { if (!file_exists($NomFichierACP=F9486bf1a($NomFichier))) return ""; if (($HeureModif != "") && ((!is_writable($NomFichierACP)) || (!(($TypeHeure == fAcces) ? touch($NomFichierACP,filemtime($NomFichierACP),F019644ae($HeureModif,fileatime($NomFichierACP))) : touch($NomFichierACP,F019644ae($HeureModif,filemtime($NomFichierACP))))))) return ""; filemtime(""); fileatime(""); return F5c7df4c9(($TypeHeure == fAcces) ? fileatime($NomFichierACP) : filemtime($NomFichierACP)); } function F8ca52887($NomFichier) { return (!is_file($NomFichierACP=F9486bf1a($NomFichier))) ? '' : file_get_contents($NomFichierACP); } function F7973cde3($NomFichier, $Texte) { if (($Fichier = F0a2479f9($NomFichier,foCreation)) == RetourErreur_Entier) return false; F6b1e3687(); $Res = !(fwrite($Fichier,$Texte) === false); fclose ($Fichier); F1e7b0563(); $msg = F1abae4f0(); if (!empty($msg)) F853b7085($msg,errMessageSysteme); return $Res; } function Fdecb127d($NomFichier) { if (!file_exists($NomFichierACP=F9486bf1a($NomFichier))) return AttributErreur; return (is_dir($NomFichierACP) ? AttributRepertoire : AttributArchive) . (is_writable($NomFichierACP) ? "" : AttributLectureSeule); } function Fede2d60a() { global $_RepertoireParcouru, $_NomRepertoireParcouru; if ($_RepertoireParcouru === false) return; closedir($_RepertoireParcouru); $_RepertoireParcouru = false; $_NomRepertoireParcouru = ""; } function F91780034($NomFicRep, $FicRep) { return (($FicRep == frFichier) && !Fe3b56f25($NomFicRep) && F22eab6af($NomFicRep))|| (($FicRep == frRepertoire) && Fd994850b($NomFicRep)); } function Fdbf241ef($NomFicRep, $FicRep = frFichier, $FermerRépertoire = true) { global $_RepertoireParcouru, $_NomRepertoireParcouru, $_FiltreRepertoireParcouru, $_FichierRépertoire; if ($NomFicRep != fRepSuite) { $_FichierRépertoire = $FicRep; if ($FermerRépertoire) Fede2d60a(); if (F91780034($NomFicRep,$_FichierRépertoire)) return basename($NomFicRep); if (Fe3b56f25($NomFicRep) || (!is_dir($_NomRepertoireParcouru = dirname($NomFicRep))) || (($_RepertoireParcouru = opendir($_NomRepertoireParcouru)) === false)) return fRepEchec; $_FiltreRepertoireParcouru = basename($NomFicRep); } if ($_RepertoireParcouru === false) return fRepEchec; while (false!==($Res = readdir($_RepertoireParcouru))) { $Res = F8df7b692($Res); if (preg_match('/'.ExpRegDebut . utf8_str_replace( array(SepExtension . JokerFichierChaine ,ExpRegCaractere ,ExpRegDebut ,ExpRegFin ,JokerFichierChaine ,JokerFichierCaractere ), array(JokerFichierChaine ,ExpRegEchap . ExpRegCaractere ,ExpRegEchap . ExpRegDebut ,ExpRegEchap . ExpRegFin ,ExpRegCaractereRepete ,ExpRegCaractere . ExpRegUnMaxi),$_FiltreRepertoireParcouru) . ExpRegFin . '/' .UNICODE_REGEXP. 'i',$Res) && F91780034($_NomRepertoireParcouru . F2e9b4751($NomFicRep) . $Res, $_FichierRépertoire) && (!F1842f4fe($Res))) return $Res; } Fede2d60a(); return fRepEchec; } function FMK_ProcedureRepSupprime($Répertoire, $Fichier, $Indicateur, $SourceDestination, $Paramètre = 0) { if ($Fichier == "") { if (!Fb593fee5($Répertoire)) { return 0; } } else if (!Fc0adeacb($Répertoire . $Fichier)) { return 0; } return null; } function FMK_ProcedureCopieFichier($Répertoire, $Fichier, $Indicateur, $SourceDestination) { $Destination = F05ad8ed4($SourceDestination,2) . F3449a00a($Répertoire,utf8_strlen(F05ad8ed4($SourceDestination,1)) + 1); if ($Fichier == "") { if (!Fd0f24521($Destination)) { F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_DOSSIER_DROITS_INSUFFISANTS"),$Destination)); return 0; } } else if (!Ff578b8aa($Répertoire . $Fichier, $Destination . $Fichier)) return 0; } function F1842f4fe($Répertoire) { return ($Répertoire == RépertoireCourant) || ($Répertoire == RépertoirePère); } function Fd994850b($sNomDuRépertoire) { return ( (utf8_strpos($sNomDuRépertoire,JokerFichierCaractere)===false) && (utf8_strpos($sNomDuRépertoire,JokerFichierChaine)===false) && is_dir(F9486bf1a($sNomDuRépertoire)) ); } function F289f359f($sChemin, $nOptions = frRecursif){ return Fb6ee524b($sChemin,'',0,$nOptions,false); } function Fd2d7b6a5($sChemin, $sProcedure, $nPointeur = 0, $nOptions = frRecursif){ return Fb6ee524b($sChemin,$sProcedure,$nPointeur,$nOptions,true); } function Fb6ee524b($sChemin, $sProcedure, $nPointeur = 0, $nOptions = frRecursif, $bExecute){ if (!Fd994850b($sChemin)) { F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_DOSSIER_INEXISTANT"),$sChemin)); return ''; } $listeArborescence = ''; $listeSousArborescence = ''; $nDossierArborescence = 0; if (!is_readable(F9486bf1a($sChemin))) { F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_DOSSIER_DROITS_INSUFFISANTS"),$sChemin)); return ''; } $sCheminComplet = F0ac3fb91($sChemin); $dossierOrigine = false; F6b1e3687(); $dossierOrigine = opendir(F9486bf1a($sChemin)); F1e7b0563(); if ($dossierOrigine) { F6b1e3687(); $sFichierCourant = readdir($dossierOrigine); F1e7b0563(); while ($sFichierCourant !== false) { if ($sFichierCourant != '.' && $sFichierCourant != '..') { if (is_dir(F9486bf1a($sSousDossier = $sCheminComplet.$sFichierCourant))) { F6b1e3687(); $dossierSousDossier = opendir(F9486bf1a($sSousDossier)); F1e7b0563(); if ($dossierSousDossier) { closedir($dossierSousDossier); if (!$bExecute) { $listeArborescence.= RC . $sSousDossier; } else { $nChange = ($nDossierArborescence==0) ? flChangeRépertoire : flRepertoire; $tab=array(F0ac3fb91($sChemin),$sFichierCourant,$nChange,$nPointeur); if (PHPVERSION_5_3) foreach (array_keys($tab) as $tabindex) $tab[$tabindex] =& $tab[$tabindex]; call_user_func_array($sProcedure,$tab); ++$nDossierArborescence; } if ($nOptions & frRecursif) { if (!$bExecute) { $listeNiveauInferieurs = F289f359f($sSousDossier,$nOptions); if ($listeNiveauInferieurs!='') $listeSousArborescence.= RC . $listeNiveauInferieurs; } else { $nDossierArborescence+= Fd2d7b6a5($sSousDossier, $sProcedure, $nPointeur, $nOptions); } } } else { F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_DOSSIER_DROITS_INSUFFISANTS"),$sChemin)); } } } $sFichierCourant = readdir($dossierOrigine); } closedir($dossierOrigine); } else { F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_DOSSIER_DROITS_INSUFFISANTS"),$sChemin)); return ''; } if (!$bExecute) { if ($listeSousArborescence!='') $listeArborescence.= $listeSousArborescence; $nLongueurArborescence = utf8_strlen($listeArborescence); return ($nLongueurArborescence>0) ? utf8_substr($listeArborescence,utf8_strlen(RC),$nLongueurArborescence-utf8_strlen(RC)) : ''; } else { return $nDossierArborescence; } } function Ff116711f($sFichierOrigine,$sFichierDestination) { F6b1e3687(); $bResultat = rename(F9486bf1a($sFichierOrigine), F9486bf1a($sFichierDestination)); F1e7b0563(); return $bResultat; } function F0af6a1c7($sChemin, $sNouvelleDate = '', $sTypeDateHeure = fModification) { if ( ($sNouvelleDate == '') ) { if ($sTypeDateHeure == fAcces) return date ('YmdHis', fileatime($sChemin)); if ($sTypeDateHeure == fModification) return date ('YmdHis', filemtime($sChemin)); return ''; } if ( ( utf8_strlen($sNouvelleDate) != 14) || (!is_numeric($sNouvelleDate)) ){ F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_PARAMETRE_VALEUR_INCORRECT"),'fDateHeure')); return ''; } $année = utf8_substr($sNouvelleDate,0,4); $mois = utf8_substr($sNouvelleDate,4,2); $jour = utf8_substr($sNouvelleDate,6,2); $heure = utf8_substr($sNouvelleDate,8,2); $minute = utf8_substr($sNouvelleDate,10,2); $seconde = utf8_substr($sNouvelleDate,12,2); $time = mktime($heure,$minute,$seconde,$mois,$jour,$année); if ( ($time == -1) || ($time == 0) ){ F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_PARAMETRE_VALEUR_INCORRECT"),'fDateHeure')); return ''; } filectime(""); fileatime(""); clearstatcache(); $sCheminACP=F9486bf1a($sChemin); $timeMTime = filemtime($sCheminACP); $timeATime = fileatime($sCheminACP); clearstatcache(); if ( $sTypeDateHeure == fModification+fAcces ) return touch ( $sCheminACP, $time , $time ); if ( $sTypeDateHeure == fModification ) return touch ( $sCheminACP , $time, $timeATime ); if ( $sTypeDateHeure == fAcces ) return touch ( $sCheminACP , $timeMTime, $time ); F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_COMPORTEMENT_NUL"),'fDateHeure')); return ''; } function Fc6678c4a($sNomDuRepertoire,$sAttributs = false) { $sResultat = ''; $sNomDuRepertoireACP=F9486bf1a($sNomDuRepertoire); if ($sAttributs!==false) { $bReussi = false; if (utf8_strpos($sAttributs,'R') !== false) { F6b1e3687(); $bReussi = chmod( $sNomDuRepertoireACP, 0555 ); F1e7b0563(); } else { F6b1e3687(); $bReussi = chmod( $sNomDuRepertoireACP, 0777 ); F1e7b0563(); } if (!$bReussi){ F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_DOSSIER_DROITS_INSUFFISANTS"),$sNomDuRepertoire)); return 'ERR'; } } F6b1e3687(); $bOuvertureReussie = opendir($sNomDuRepertoireACP); F1e7b0563(); if (!$bOuvertureReussie){ return 'ERR'; } clearstatcache(); if ( Fd994850b($sNomDuRepertoire)) $sResultat.='D'; if (!is_writeable($sNomDuRepertoireACP)) $sResultat.='R'; return $sResultat; } function Fb459705a($NomFicRep, $NomProc = null, $Param = 0, $Indicateur = flPremierFichier, $Récursif = true, $ListeRépertoire = false) { $Arrêt = false; if (!isset($NomProc)) { $GLOBALS['_fListeFichier_'] = ""; $sNomProc = create_function('$sChemin,$sNomFic,$nChange,$nPointeur','if($sNomFic=="") return; if ($GLOBALS[\'_fListeFichier_\']!=""){$GLOBALS[\'_fListeFichier_\'].=RC;} $GLOBALS[\'_fListeFichier_\'].=$sChemin . $sNomFic;'); F640e06e4($NomFicRep, $sNomProc, $Arrêt, $Param, $Indicateur, $Récursif, $ListeRépertoire); $Retour = $GLOBALS['_fListeFichier_']; unset($GLOBALS['_fListeFichier_']); return $Retour; } else { return F640e06e4($NomFicRep, $NomProc, $Arrêt, $Param, $Indicateur, $Récursif, $ListeRépertoire); } } function F640e06e4($NomFicRep, $NomProc, &$Arrêt, $Param = 0, $Indicateur = flPremierFichier, $Récursif = true, $ListeRépertoire = false) { global $_RepertoireParcouru, $_NomRepertoireParcouru, $_FiltreRepertoireParcouru; $Arrêt = false; if (!function_exists($NomProc)) return 0; $NbFic = 0; $MémoRep = $_RepertoireParcouru; $MémoNomRep = $_NomRepertoireParcouru; $MémoFiltre = $_FiltreRepertoireParcouru; $Répertoire = F7816de1e($NomFicRep,fDisqueRépertoire); $FichierRecherche = F7816de1e($NomFicRep,fFichierExtension); $ListeRep = $Récursif && (!$ListeRépertoire) && ($FichierRecherche == RépertoireCourant); $Fichier = Fdbf241ef($NomFicRep,$ListeRep ? frRepertoire : frFichier,false); while ($Fichier != fRepEchec) { ++$NbFic; $tmp = $ListeRep ? F7816de1e(basename($Répertoire),fFichierExtension) : $Fichier; if (call_user_func_array($NomProc,array(&$Répertoire,&$tmp,&$Indicateur,&$Param)) === 0) { $Arrêt = true; break; } $Indicateur = flFichier; $Fichier = $ListeRep ? fRepEchec : Fdbf241ef(""); } if (!$ListeRep) Fede2d60a(); if ($Récursif && (!$Arrêt)) { $Fichier = Fdbf241ef($Répertoire . (($ListeRépertoire && (!$ListeRep)) ? $FichierRecherche : JokerFichierChaine),frRepertoire,false); while ($Fichier != fRepEchec) { if (!F1842f4fe($Fichier)) { $SousRépertoire = $Répertoire . $Fichier; $NbFic += F640e06e4($SousRépertoire . F2e9b4751($NomFicRep) . $FichierRecherche,$NomProc,$Arrêt,$Param,flChangeRépertoire,$Récursif,$ListeRépertoire); if ($Arrêt) break; } $Fichier = Fdbf241ef(""); } Fede2d60a(); } if ($ListeRépertoire && (!$Arrêt) && Fd994850b($Répertoire) ) { ++$NbFic; call_user_func($NomProc,$Répertoire,"",$Indicateur,$Param); } $_RepertoireParcouru = $MémoRep; $_NomRepertoireParcouru = $MémoNomRep; $_FiltreRepertoireParcouru = $MémoFiltre; return $NbFic; } function F8b2ea819($Source,$Destination,$Récursif = 0) { $bSourceIsDir = is_dir(F9486bf1a($Source)); if ((!$bSourceIsDir) && (utf8_strstr($FichierJoker = F7816de1e($Source,fFichierExtension),JokerFichierCaractere) === false) && (utf8_strstr($FichierJoker,JokerFichierChaine) === false)) return false; if (!Fd0f24521($Destination)) { F853b7085(FMK_ChaineConstruit(F1ac3f040("ERR_DOSSIER_DROITS_INSUFFISANTS"),$Destination)); return false; } $SourceSepFin = F6a46867d($Source); $Arret = false; F640e06e4( $bSourceIsDir ? ($SourceSepFin . JokerFichierChaine) : $Source,"FMK_ProcedureCopieFichier", $Arret, ($bSourceIsDir ? $SourceSepFin : F7816de1e($Source,fDisqueRépertoire)) . TAB . F6a46867d($Destination), flPremierFichier, $Récursif, true ); return !$Arret; } function Fb593fee5($NomRep, $Récursif = 0, $Joker = false) { $bEstUnRep = is_dir($NomRepACP=F9486bf1a($NomRep)); $MasqueRep = $bEstUnRep ? (F6a46867d($NomRep) . JokerFichierChaine) : $NomRep; if ($bEstUnRep) { if (!($Rep = opendir($NomRepACP))) return false; $Vide = true; while (false!==($Fic = readdir($Rep))) if (!($Vide = F1842f4fe($Fic))) break; closedir($Rep); is_dir(""); if ($Vide) { return rmdir($NomRepACP); } elseif (!$Récursif) { return false; } } $Arret=false; return ($Joker || $bEstUnRep) && (F640e06e4($MasqueRep,"FMK_ProcedureRepSupprime",$Arret,0,flPremierFichier,$Récursif,$Récursif) > 0) && (!$Arret); } function Fc8a3a30c($VariableEnv) { return is_dir(F9486bf1a($Repertoire = getenv($VariableEnv))) ? $Repertoire : false; } function F064e9774() { return (($Repertoire = Fc8a3a30c("TEMP")) || ($Repertoire = Fc8a3a30c("TMP"))) ? F6a46867d($Repertoire) : ""; } function F4574f559($Prefixe = null, $Repertoire = null) { if (!is_dir($RepertoireACP=F9486bf1a( ($Repertoire != null) ? $Repertoire : ($Repertoire = F064e9774())))) return ""; if (($Fichier = tempnam($RepertoireACP,F9486bf1a($Prefixe))) == null) return ""; $Fichier = F8df7b692($Fichier); Fc0adeacb($Fichier); return $Fichier; } function F22eab6af($sNomFichier) { return (utf8_strpos($sNomFichier,JokerFichierCaractere)===false) && (utf8_strpos($sNomFichier,JokerFichierChaine)===false) && is_file(F9486bf1a($sNomFichier)); } function F38281c13($Repertoire = "") { if (!F1cd18e7d($Repertoire)) if ((!is_dir($RepertoireACP=F9486bf1a($Repertoire))) || (!chdir($RepertoireACP))) return RetourErreur_Entier; return F8df7b692(getcwd()); } function Ff169dd4e($sCheminFichier1, $sCheminFichier2) { if(strcmp($sCheminFichier1, $sCheminFichier2) == 0) { return 0; } if(!is_file($sCheminFichier1ACP=F9486bf1a($sCheminFichier1))) { return -1; } if(!is_file($sCheminFichier2ACP=F9486bf1a($sCheminFichier2))) { return -2; } if(filesize($sCheminFichier1ACP) != filesize($sCheminFichier2ACP)) { return 1; } F6b1e3687(); $nIdFichier1 = fopen($sCheminFichier1ACP, 'r'); $nIdFichier2 = fopen($sCheminFichier2ACP, 'r'); F1e7b0563(); if($nIdFichier1 === false || $nIdFichier2 === false) { return -1; } do { $resLecture1 = fread($nIdFichier1, 2048); $resLecture2 = fread($nIdFichier2, 2048); if($resLecture1 !== $resLecture2) { return 1; } } while(!feof($nIdFichier1) && !feof($nIdFichier2)); return 0; } function F19a62e7a($czVideoFichier) { return !empty($czVideoFichier) && ($czVideoFichier[0]!='.') && ( ($czVideoFichier[0]==='/') || (isset($czVideoFichier[1]) && ($czVideoFichier[1]===':') )); } function F10e1ac24($czFichier) { $czURLFichier = realpath(F9486bf1a($czFichier)); if (false === $czURLFichier) return $czFichier; $czURLFichier = F8df7b692($czURLFichier); $sBaseChemin=F0ac3fb91(F8df1dd0e()); if (Fd1fcabe5($sBaseChemin,$czURLFichier) === 0) return $czFichier; $sPrefix = '.'; while($sBaseChemin!=='.' && utf8_strpos($czURLFichier, $sBaseChemin ) !== 0) { $sBaseChemin = F0ac3fb91($sBaseChemin); $sPrefix .= DIRECTORY_SEPARATOR . '..'; $sBaseChemin=F8df7b692(dirname(F9486bf1a($sBaseChemin))); } $czURLFichier = utf8_substr($czURLFichier,utf8_strlen($sBaseChemin)); if ($czURLFichier=='') return ''; while (utf8_strpos($czURLFichier,'.' . DIRECTORY_SEPARATOR )===0) $czURLFichier = utf8_substr($czURLFichier,2); return $czURLFichier; } function F8df1dd0e() { return F8df7b692(realpath(WB_BASE_DIR . '/../..')); } ?>