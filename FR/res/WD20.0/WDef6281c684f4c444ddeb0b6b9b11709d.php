<?php
//20.0.56.0 WL/XML/XML.php GF 
//VersionVI: 30F200066p
//(c) 2006-2008 PC SOFT  - Release
 if (!defined('__INC__FMK/Chaine.php')) { define('__INC__FMK/Chaine.php',true); include_once(WB_INCLUDE_PATH.'WD55acb2e708e26f23cb8956cd93e98123.php'); } if (!defined('__INC__FMK/Xml.php')) { define('__INC__FMK/Xml.php',true); include_once(WB_INCLUDE_PATH.'WD6858a680f0c75714b0d504fc4f5e9b76.php'); } if (!defined('__INC__TYPE/Serialisation.php')) { define('__INC__TYPE/Serialisation.php',true); include_once(WB_INCLUDE_PATH.'WD77a2580b4fb8d10177b22b15a4b1e654.php'); } $TabVariableGlobaleXML = array(); define("XML",0); $sNomDerniereFonctionXML = ""; define("XML_ERREUR", -1); define("XML_BALISE", 1); define("XML_ATTRIBUT", 2); define("XML_ELEMENT", 3); define("XML_VALEUR", 4); define("XML_EXACT", 1); define("XML_COMMENCE_PAR", 2); define("XML_CONTIENT", 4); define("XML_IGNORE_LA_CASSE", 16); define("XML_AVEC_NAMESPACE", 32); define("XML_CONTINUE", 64); define("XML_NIVEAU_COURANT", 32); define("XML_SOUS_ELEMENT", 16); define("XML_ELEMENT_PRECEDENT", 1); define("XML_ELEMENT_SUIVANT", 2); define("XML_RP_CONSERVE" , 2); define("XML_RP_DEFAUT" , 4); define("XML_RP_FILTRE" , 8); define("XML_DOCUMENT_DEFAUT", 0); define("XML_POSITION_COURANTE", 1); define("XML_SANS_ENTETE", 2); define("XML_ENCODAGE_AUCUN", 1); define("XML_ENCODAGE_UTF8", 2); define('PSD_XML',512); define('PSD_BINAIRE',256); function XML_SauveVariableGlobaleInterne(&$pclPage) { global $TabVariableGlobaleXML; $pclPage->TabVarGlobaleInterneComposante["XML"] = $TabVariableGlobaleXML; } function XML_RestaureVariableGlobaleInterne(&$pclPage) { global $TabVariableGlobaleXML; if (!isset($pclPage->TabVarGlobaleInterneComposante["XML"])) return; $TabVariableGlobaleXML = $pclPage->TabVarGlobaleInterneComposante["XML"]; } function TexteVersXML($sChaine) { return F78d2adc5($sChaine); } function F78d2adc5($sChaine) { if(!isset($sChaine) || empty($sChaine)) { return ""; } $sChaine = utf8_htmlspecialchars($sChaine, ENT_QUOTES); $sChaine = utf8_str_replace("&#039;", "&apos;", $sChaine); $sChaine = utf8_str_replace("\n", "&#10;", $sChaine); $sChaine = utf8_str_replace("\r", "&#13;", $sChaine); return $sChaine; } function XMLDocument($sNomDocument, $sCodeXML="", $nOption = 0) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_DOCUMENT"); F67cfd262(); $DocumentXML = Fb9098312($sNomDocument, false); if(isset($DocumentXML)) { Erreur('ErreurWL_1_Param',"ErreurDocXMLExistant", $sNomDocument, $sNomDerniereFonctionXML); return false; } return F737c3836($sNomDocument,$sCodeXML,$nOption); } function F737c3836($sNomDocument,$sCodeXML,$nOption = 0) { $DocumentXML = new FMK_DocumentXML($sNomDocument); $xml_parser = xml_parser_create(F86d71bbb($sCodeXML)); $parser = new FMK_ParseurXML($DocumentXML); xml_set_object($xml_parser,$parser); xml_parser_set_option($xml_parser, XML_OPTION_CASE_FOLDING, false); xml_set_element_handler($xml_parser, "startElement", "endElement"); xml_set_default_handler($xml_parser, "unparsedData"); xml_set_character_data_handler($xml_parser, "characterData"); if ($sCodeXML==="") { $bParse = true; } else { $bParse = xml_parse($xml_parser, $sCodeXML, true); } if(!$bParse && xml_get_error_code($xml_parser) != XML_ERROR_NO_ELEMENTS && (!($parser->bJamaisAppele && preg_match("/\s*<\?xml.*?\?>\s*/".UNICODE_REGEXP."i",$sCodeXML) ))) { Fdd46bacf(Fc34ec142("ERR_FORMAT_XML")); } else { global $TabVariableGlobaleXML; if(!isset($TabVariableGlobaleXML[XML])) { $TabDocumentXML = array(); $TabVariableGlobaleXML[XML] = &$TabDocumentXML; } else { $TabDocumentXML = &$TabVariableGlobaleXML[XML]; } $TabDocumentXML[utf8_strtolower($sNomDocument)] = $DocumentXML; } xml_parser_free($xml_parser); return $bParse; } function XMLExtraitChaine($sCodeXML, $sNomBalise, $nIndice= 1, $nOptionRecherche = XML_EXACT) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_EXTRAIT_CHAINE"); F67cfd262(); $parserXML = xml_parser_create(F86d71bbb($sCodeXML)); xml_parser_set_option($parserXML, XML_OPTION_CASE_FOLDING, false); xml_set_element_handler($parserXML, "startElement", "endElement"); xml_set_default_handler($parserXML, "unparsedData"); $parser = new FMK_ParseurXMLExtraitChaine($sNomBalise, $nOptionRecherche == XML_IGNORE_LA_CASSE, $nIndice); xml_set_object($parserXML,$parser); $bParse = xml_parse($parserXML, $sCodeXML, true); if($parser->nPosDebut >=0 && $parser->nPosFin >=0) { $sResultat = utf8_trim(utf8_substr($sCodeXML, $parser->nPosDebut, $parser->nPosFin- $parser->nPosDebut)); $sResultatFormate = utf8_trim($sResultat); $sBaliseFormate = utf8_trim($sNomBalise); if (utf8_strcasecmp(utf8_substr($sResultatFormate,utf8_strlen($sResultatFormate)-utf8_strlen($sNomBalise)-1),$sBaliseFormate.'>')===0) { $sResultat = utf8_substr(utf8_rtrim($sResultat),0,utf8_strlen(utf8_rtrim($sResultat))-utf8_strlen($sNomBalise)-3); } $sResultat = utf8_trim($sResultat,RC); if (PHPVERSION_5 && utf8_strpos($sResultat,"<")===0) { $sResultat = RC.$sResultat.RC; } return $sResultat; } xml_parser_free($parserXML); return ""; } function XMLRacine($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_RACINE"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); unset($docXML->StructRecherche); $docXML->StructRecherche = null; return $docXML->racine(); } function XMLEnDehors($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_EN_DEHORS"); F67cfd262(); $docXML = Fb9098312($sNomDocument); return $docXML->bEnDehors; } function XMLTrouve($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_TROUVE"); F67cfd262(); $docXML = Fb9098312($sNomDocument); return $docXML->bTrouve; } function XMLNomElement($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_NOM_ELEMENT"); F67cfd262(); $docXML = Fb9098312($sNomDocument); $Element = $docXML->F97b061a2(); if(!isset($Element)) { return ""; } else { return $Element->F74438c68(); } } function XMLNomParent($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_NOM_PARENT"); F67cfd262(); $docXML = Fb9098312($sNomDocument); $Element = $docXML->F97b061a2(); if(!isset($Element)) { return ""; } else { return $Element->F086b3936(); } } function XMLTypeElement($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_TYPE_ELEMENT"); F67cfd262(); $docXML = Fb9098312($sNomDocument); $Element = $docXML->F97b061a2(); if(!isset($Element)) { return XML_ERREUR; } else { return $Element->Ffb92bfbf(); } } function XMLDonnee($sNomDocument, $sNomAttribut='', $nModeRecherche = XML_EXACT) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_DONNE"); F67cfd262(); $docXML = Fb9098312($sNomDocument); $Element = $docXML->F97b061a2(); if(!isset($Element)) { return ""; } else { if(isset($sNomAttribut) && !empty($sNomAttribut)) { return $Element->Fabe87489($sNomAttribut, $nModeRecherche); } else { return $Element->getValeur(); } } } function XMLFils($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_FILS"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); unset($docXML->StructRecherche); $docXML->StructRecherche = null; return $docXML->F399fc126(); } function XMLParent($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_PARENT"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); unset($docXML->StructRecherche); $docXML->StructRecherche = null; return $docXML->Fa4f09cfe(); } function XMLPremier($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_PREMIER"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); unset($docXML->StructRecherche); $docXML->StructRecherche = null; return $docXML->F7168f84a(); } function XMLDernier($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_DERNIER"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); unset($docXML->StructRecherche); $docXML->StructRecherche = null; return $docXML->F048c5f73(); } function XMLRenomme($sNomDocument, $sNouveauNom) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_RENOMME"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $Element = &$docXML->F97b061a2(); if(!isset($Element)) { return false; } else { return $Element->Fb2bb120f($sNouveauNom); } } function XMLRecherche($sNomDocument, $valeur, $nTypeParcours=XML_ELEMENT, $nOptionRecherche=XML_EXACT) { global $sNomDerniereFonctionXML, $DocumentXMLCourant; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_RECHERCHE"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $Element = &$docXML->F97b061a2(); if(!isset($Element)) { $docXML->bTrouve = false; $docXML->bEnDehors = true; return false; } $StructRecherche = new FMK_StructRechercheXML(); $StructRecherche->bValeur = (($nTypeParcours & XML_VALEUR) == XML_VALEUR); if (($nTypeParcours & XML_BALISE) == XML_BALISE) { $StructRecherche->nTypeElement += XML_BALISE; } if (($nTypeParcours & XML_ATTRIBUT) == XML_ATTRIBUT) { $StructRecherche->nTypeElement += XML_ATTRIBUT; } if(!$StructRecherche->bValeur && !isset($StructRecherche->nTypeElement)) { $StructRecherche->nTypeElement = XML_ELEMENT; } if (($nTypeParcours & XML_NIVEAU_COURANT) == XML_NIVEAU_COURANT) { $StructRecherche->nTypeParcours += XML_NIVEAU_COURANT; } if (($nTypeParcours & XML_SOUS_ELEMENT) == XML_SOUS_ELEMENT) { $StructRecherche->nTypeParcours += XML_SOUS_ELEMENT; } if (($nTypeParcours & XML_CONTINUE) == XML_CONTINUE) { $StructRecherche->nTypeParcours += XML_CONTINUE; } if(!isset($StructRecherche->nTypeParcours)) { $StructRecherche->nTypeParcours = XML_SOUS_ELEMENT + XML_CONTINUE; } if(($nOptionRecherche & XML_IGNORE_LA_CASSE) == XML_IGNORE_LA_CASSE) { $StructRecherche->bIgnoreCasse = true; $nOptionRecherche -= XML_IGNORE_LA_CASSE; } $StructRecherche->nMode = $nOptionRecherche; $StructRecherche->ElementDepart = &$Element; $StructRecherche->valeurRecherche = $valeur; $docXML->StructRecherche = &$StructRecherche; $DocumentXMLCourant = $docXML->sNomDocument; $bResultat = $Element->Fc2588602($StructRecherche); $docXML->bTrouve = $bResultat; $docXML->bEnDehors = !$bResultat; return $bResultat; } function XMLSuivant($sNomDocument) { global $sNomDerniereFonctionXML,$DocumentXMLCourant; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_SUIVANT"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $Element = &$docXML->F97b061a2(); if(!isset($Element)) { $docXML->bTrouve = false; $docXML->bEnDehors = true; return false; } $DocumentXMLCourant = $docXML->sNomDocument; if(isset($docXML->StructRecherche)) { $bResultat = $Element->Fc2588602($docXML->StructRecherche); $docXML->bTrouve = $bResultat; $docXML->bEnDehors = !$bResultat; return $bResultat; } else { $Frere = &$Element->Fafabbcd1(); $bResultat = isset($Frere); if($bResultat) { $docXML->ElementCourant = &$Frere; } $docXML->bTrouve = $bResultat; $docXML->bEnDehors = !$bResultat; return $bResultat; } } function XMLPrecedent($sNomDocument) { global $sNomDerniereFonctionXML,$DocumentXMLCourant; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_PRECEDENT"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $Element = &$docXML->F97b061a2(); if(!isset($Element)) { $docXML->bTrouve = false; $docXML->bEnDehors = true; return false; } $DocumentXMLCourant = $docXML->sNomDocument; if(isset($docXML->StructRecherche)) { $bResultat = $Element->F1c6d54cf($docXML->StructRecherche); $docXML->bTrouve = $bResultat; $docXML->bEnDehors = !$bResultat; return $bResultat; } else { $Frere = &$Element->Ff3f4e29a(); $bResultat = isset($Frere); if($bResultat) { $docXML->ElementCourant = &$Frere; } $docXML->bTrouve = $bResultat; $docXML->bEnDehors = !$bResultat; return $bResultat; } } function F2f7503e2(&$pclDoc,$sFulxXML) { $pclDoc = new FMK_XML_Doc($sFulxXML); if (!isset($pclDoc->m_pclNoeud)) { global $sNomDerniereFonctionXML; Erreur('ErreurPHP',FMK_ChaineConstruit(F1ac3f040("ERR_FCT"),$sNomDerniereFonctionXML),F1ac3f040("ERR_EXTENSION_DOMXML_ABSENTE")); return false; } return true; } function XMLExecuteXPath($sNomDocument, $sRequeteXPath) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_EXECUTEXPATH"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); if (!isset($docXML)) return false; $pclDoc =& $docXML->m_pclDom; $sFluxXML = Ff4eeaced($sNomDocument); $pclDoc = null; F2f7503e2($pclDoc,$sFluxXML); $tabNodes = $pclDoc->F53d255a9($sRequeteXPath); $bModeSelection = is_array($tabNodes); if ($bModeSelection) { Erreur('ErreurGenerique',ERR_LIMITATION_XPATH_CALCUL); } else { $docXML->bTrouve = false; $docXML->bEnDehors = true; $xResultat = $tabNodes; $docXML->m_xmlResultat = $xResultat; } return true; } function XMLLit($sNomDocument,$sXPath,$sValeurSiNonTrouve='') { F67cfd262(); global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_LIT"); $sFluxXML = Ff4eeaced($sNomDocument); $pclDoc = null; F2f7503e2($pclDoc,$sFluxXML); if ($sXPath[0]!='/') { $docXML = &Fb9098312($sNomDocument); $pclRacine =& $docXML->Racine; $sRacine = ''; if (isset($pclRacine)) $sRacine='/' .$pclRacine->sNomElement; $sXPath = $sRacine .'/'. $sXPath; } $sRetour = $pclDoc->xmlLit($sXPath,$sValeurSiNonTrouve); if ($sRetour === $sValeurSiNonTrouve) { Fdd46bacf(Fc34ec142('ERR_XML_XPATH_INCORRECT')); } return $sRetour; } function XMLEcrit($sNomDocument,$sXPath,$sValeur) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_ECRIT"); $sFluxXML = Ff4eeaced($sNomDocument); $docXML = &Fb9098312($sNomDocument); if ($docXML->sEnteteDocument==$sFluxXML) { $nFinBalise = utf8_strpos($sXPath,'/',1); if ($nFinBalise===false) { $sBalise = utf8_substr($sXPath,1); } else { $sBalise = utf8_substr($sXPath,1,$nFinBalise-1); } $sFluxXML = '<'.$sBalise.'></'.$sBalise.'>'; } $pclDoc = null; F2f7503e2($pclDoc,$sFluxXML); if ($sXPath[0]!='/') { $pclRacine =& $docXML->Racine; $sRacine = ''; if (isset($pclRacine)) $sRacine='/' .$pclRacine->sNomElement; $sXPath = $sRacine .'/'. $sXPath; } $bEcritureOK = $pclDoc->xmlEcrit($sXPath,$sValeur); if (!$bEcritureOK) return false; F737c3836($sNomDocument,$pclDoc->F778e8c6e()); unset($pclDoc); return true; } function XMLResultat($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_RESULTAT"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); if (!isset($docXML)) return null; return $docXML->m_xmlResultat; } function XMLAnnuleRecherche($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_ANNULE_RECHERCHE"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); unset($docXML->StructRecherche); $docXML->StructRecherche = null; } function XMLAjouteAttribut($sNomDocument, $sNomAttribut, $sValeurAttribut="", $bModifPosition = false) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_AJOUTE_ATTRIBUT"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $Element = &$docXML->F97b061a2(); if(!isset($Element)) { return false; } $sValeurAttribut = F78d2adc5($sValeurAttribut); $Attribut = &$Element->F73935150($sNomAttribut, $sValeurAttribut, false); if($bModifPosition && isset($Attribut)) { $docXML->ElementCourant = &$Attribut; $docXML->bTrouve = true; $docXML->bEnDehors = false; } return true; } function XMLAjouteFils($sNomDocument, $sNomElement, $sValeurElement="", $bModifPosition = false) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_AJOUTE_FILS"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $Balise = new FMK_BaliseXML($sNomElement); $Balise->setValeur($sValeurElement); if(!isset($docXML->Racine)) { $docXML->Racine = &$Balise; $docXML->ElementCourant = &$Balise; } else { $Element = &$docXML->F97b061a2(); if(!isset($Element)) { return false; } $Element->Fb35cfc09($Balise); if($bModifPosition && isset($Balise)) { $docXML->ElementCourant = &$Balise; $docXML->bTrouve = true; $docXML->bEnDehors = false; } } return true; } function XMLInsereElement($sNomDocument, $sNomElement, $sValeurElement="", $nPositionInsertion = XML_ELEMENT_SUIVANT, $bModifPosition = false) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_INSERE_ELEMENT"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); if(!isset($docXML->Racine)) { $Balise = new FMK_BaliseXML($sNomElement); $Balise->setValeur($sValeurElement); $docXML->Racine = &$Balise; $docXML->ElementCourant = &$Balise; $docXML->bTrouve = true; $docXML->bEnDehors = false; return true; } $ElementCourant = &$docXML->F97b061a2(); if(!isset($ElementCourant)) { return false; } $ElementInsertion = null; if($ElementCourant->Ffb92bfbf() == XML_ATTRIBUT) { $ElementInsertion = new FMK_AttributXML($sNomElement, $sValeurElement); } else { $ElementInsertion = new FMK_BaliseXML($sNomElement); $ElementInsertion->setValeur($sValeurElement); } if($nPositionInsertion == XML_ELEMENT_PRECEDENT) { $nPositionInsertion = $ElementCourant->nPositionElement; } else { if($ElementInsertion->Ffb92bfbf() != XML_ATTRIBUT) { $ElementInsertion->sBFData = $ElementCourant->sBFData; $ElementCourant->sBFData= ""; } $nPositionInsertion = $ElementCourant->nPositionElement + 1; } $Parent = &$ElementCourant->Parent; if(!isset($Parent)) { Fdd46bacf(Fc34ec142("ERR_INSERTION_RACINE")); return false; } $Parent->F9e414f2b($ElementInsertion, $nPositionInsertion); if($bModifPosition && isset($ElementInsertion)) { $docXML->ElementCourant = &$ElementInsertion; $docXML->bTrouve = true; $docXML->bEnDehors = false; } return true; } function XMLFilsExiste($sNomDocument, $nTypeFils = XML_ELEMENT) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_FILS_EXISTE"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $ElementCourant = &$docXML->F97b061a2(); if(!isset($ElementCourant) || $ElementCourant->Ffb92bfbf() == XML_ATTRIBUT) { return false; } foreach ($ElementCourant->lstFils as $Fils) { if(($Fils->Ffb92bfbf() & $nTypeFils) == $Fils->Ffb92bfbf()) { return true; } } return false; } function XMLModifie($sNomDocument, $Valeur) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_MODIFIE"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $ElementCourant = &$docXML->F97b061a2(); if(!isset($ElementCourant)) { return false; } $ElementCourant->setValeur($Valeur); return true; } function XMLSupprime($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_SUPPRIME"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $ElementCourant = &$docXML->F97b061a2(); if(!isset($ElementCourant)) { return false; } $ElementCourant->bSupprime = true; $Parent = &$ElementCourant->Parent; if(!isset($Parent)) { unset($docXML->Racine); unset($docXML->ElementCourant); } else { $Parent->F2fb53daf($ElementCourant->nPositionElement); $docXML->ElementCourant = &$Parent; } return true; } function XMLTermine($sNomDocument) { global $sNomDerniereFonctionXML, $TabVariableGlobaleXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_TERMINE"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); unset($docXML->Racine); $TabDocumentXML = &$TabVariableGlobaleXML[XML]; unset($TabDocumentXML[utf8_strtolower($sNomDocument)]); return true; } function XMLNamespace($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_NAMESPACE"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $ElementCourant = &$docXML->F97b061a2(); if(!isset($ElementCourant) || $ElementCourant->Ffb92bfbf() == XML_ATTRIBUT) { return ""; } if(isset($ElementCourant->sPrefixe) && $ElementCourant->bPrefixeNS) { return $ElementCourant->sPrefixe; } return ""; } function XMLNamespaceURI($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_NAMESPACE_URI"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $ElementCourant = &$docXML->F97b061a2(); if(!isset($ElementCourant) || $ElementCourant->Ffb92bfbf() == XML_ATTRIBUT) { return ""; } return $ElementCourant->F7a733a32($ElementCourant->sPrefixe); } function XMLExtraitDocument($sNomDocumentSource, $sNomNouveauDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_EXTRAIT_DOCUMENT"); F67cfd262(); $docXMLSource = &Fb9098312($sNomDocumentSource); $ElementCourant = &$docXMLSource->F97b061a2(); if(!isset($ElementCourant)) { return false; } $NouveauDocXML = new FMK_DocumentXML($sNomNouveauDocument); $NouveauDocXML->Racine =& $ElementCourant; $NouveauDocXML->ElementCourant =& $ElementCourant; global $TabVariableGlobaleXML; $TabDocumentXML = &$TabVariableGlobaleXML[XML]; $TabDocumentXML[utf8_strtolower($sNomNouveauDocument)] = $NouveauDocXML; return true; } function XMLPosition($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_POSITION"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $ElementCourant = &$docXML->F97b061a2(); if(!isset($ElementCourant)) { return ""; } return $ElementCourant->F2968ad2b(); } function XMLSauvePosition($sNomDocument) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_SAUVE_POSITION"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); $ElementCourant = &$docXML->F97b061a2(); if(!isset($ElementCourant)) { return -1; } $PositionXML = new FMK_PositionXML(); $PositionXML->StructRecherche = $docXML->StructRecherche; $PositionXML->bTrouve = $docXML->bTrouve; $PositionXML->bEnDehors = $docXML->bEnDehors; $PositionXML->ElementCourant = $docXML->ElementCourant; $docXML->lstPosition[] = &$PositionXML; return count($docXML->lstPosition) - 1; } function XMLRetourPosition($sNomDocument, $nPosition, $nOption = XML_RP_DEFAUT) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_RETOUR_POSITION"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); if(!isset($docXML->lstPosition[$nPosition])) { Erreur('ErreurWL_1_Param',"ErreurValeurParam", "Position", $sNomDerniereFonctionXML); } $Position = &$docXML->lstPosition[$nPosition]; $docXML->bTrouve = $Position->bTrouve; $docXML->bEnDehors = $Position->bEnDehors; if(($nOption & XML_RP_FILTRE) == XML_RP_FILTRE) { $docXML->StructRecherche = $Position->StructRecherche; } $ElementCourant = $Position->ElementCourant; if(isset($ElementCourant) && !$ElementCourant->bSupprime) { $docXML->ElementCourant = &$Position->ElementCourant; } else { unset($docXML->ElementCourant); } if(($nOption & XML_RP_CONSERVE) != XML_RP_CONSERVE) { $docXML->lstPosition[$nPosition] = null; } return true; } function XMLInsereDocument($sNomDocumentCible, $sNomDocumentSource, $nPositionInsertion = XML_SOUS_ELEMENT) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_INSERE_DOCUMENT"); F67cfd262(); $docXMLCible = &Fb9098312($sNomDocumentCible); $docXMLSource = &Fb9098312($sNomDocumentSource); $ElementCourant = &$docXMLCible->F97b061a2(); if(!isset($ElementCourant)) { return false; } $RacineSource = &$docXMLSource->Racine; if($nPositionInsertion != XML_SOUS_ELEMENT) { $Parent = &$ElementCourant->Parent; if(!isset($Parent)) { return true; } if($nPositionInsertion == XML_ELEMENT_PRECEDENT) { $nPositionInsertion = $ElementCourant->nPositionElement; } else { $nPositionInsertion = $ElementCourant->nPositionElement + 1; } $Parent->F9e414f2b($RacineSource, $nPositionInsertion); } else { $ElementCourant->Fb35cfc09($RacineSource); } return true; } function Ff4eeaced($sNomDocument, $nOption = XML_DOCUMENT_DEFAUT, $nEncodage = XML_ENCODAGE_AUCUN) { global $sNomDerniereFonctionXML; $s = $sNomDerniereFonctionXML; $sRetour = XMLConstruitChaine($sNomDocument, $nOption, $nEncodage); $sNomDerniereFonctionXML = $s; return $sRetour; } function XMLConstruitChaine($sNomDocument, $nOption = XML_DOCUMENT_DEFAUT, $nEncodage = XML_ENCODAGE_AUCUN) { global $sNomDerniereFonctionXML; $sNomDerniereFonctionXML = Fc34ec142("FCT_XML_CONSTRUIT_CHAINE"); F67cfd262(); $docXML = &Fb9098312($sNomDocument); if(($nOption & XML_SANS_ENTETE) == XML_SANS_ENTETE) { $docXML->sEnteteDocument = preg_replace("/\s*<\?xml.*?\?>\s*/".UNICODE_REGEXP."i", "", $docXML->sEnteteDocument); } else { if(!preg_match("/<\?xml.*?\?>/".UNICODE_REGEXP."i", $docXML->sEnteteDocument)) { $docXML->sEnteteDocument = "<?xml version=\"1.0\" encoding=\"". (($nEncodage==XML_ENCODAGE_UTF8) ? 'UTF-8' : 'ISO-8859-1') ."\"?>\n".$docXML->sEnteteDocument; } } $sResultat = $docXML->sEnteteDocument; if(($nOption & XML_POSITION_COURANTE) == XML_POSITION_COURANTE) { $ElementCourant = &$docXML->F97b061a2(); if(!isset($ElementCourant)) { return $sResultat; } $sResultat .= $ElementCourant->F2b7f24ee(); } else { if(isset($docXML->Racine)) { $sResultat .= $docXML->Racine->F2b7f24ee(); } } return $sResultat; } function XMLVersTexte($sChaine) { if(!isset($sChaine)) { $sChaine =""; } $sChaine = utf8_str_replace("&apos;","'",$sChaine); return utf8_html_entity_decode($sChaine, ENT_QUOTES); } function& Fb9098312($sNomDocument, $bErreurSiInexistant = true) { global $TabVariableGlobaleXML, $sNomDerniereFonctionXML; if(isset($TabVariableGlobaleXML[XML])) { $TabDocumentXML = &$TabVariableGlobaleXML[XML]; if(isset($TabDocumentXML[utf8_strtolower($sNomDocument)])) { return $TabDocumentXML[utf8_strtolower($sNomDocument)]; } } if($bErreurSiInexistant) { Erreur('ErreurWL_1_Param',"ErreurDocXMLInexistant", $sNomDocument, $sNomDerniereFonctionXML); } $tmp = null; return $tmp; } function F7ce0defa($valeur1, $valeur2, $nOptionRecherche = XML_EXACT, $bIgnoreCasse = false) { if($bIgnoreCasse) { $valeur1 = utf8_strtolower($valeur1); $valeur2 = utf8_strtolower($valeur2); } switch($nOptionRecherche) { default : case XML_EXACT : return $valeur1 == $valeur2; case XML_CONTIENT : return (utf8_strpos($valeur1, $valeur2) !== false); case XML_COMMENCE_PAR : return (utf8_strpos($valeur1, $valeur2) === 0); } } class FMK_DocumentXML { var $Racine; var $sNomDocument = ""; var $ElementCourant = null; var $bTrouve = false; var $bEnDehors = true; var $lstPosition = array(); var $sEnteteDocument = ""; var $StructRecherche = null; var $m_xmlResultat = null; function FMK_DocumentXML($sNom) { $this->sNomDocument = $sNom; } function F8a7479ce() { return $this->sNomDocument; } function F32669fba() { $this->ElementCourant =& $this->ElementCourant->Fafabbcd1(); return isset($this->ElementCourant); } function& F97b061a2() { $RetourParDefaut = null; if(!isset($this->ElementCourant)) { Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_XML_NO_POSITION"), $this->sNomDocument)); return $RetourParDefaut; } else { return $this->ElementCourant; } } function racine() { if(isset($this->Racine)) { $this->ElementCourant = &$this->Racine; return true; } return false; } function Fa4f09cfe() { $Element = &$this->F97b061a2(); if(isset($Element)) { if(isset($Element->Parent)) { $this->bTrouve = true; $this->bEnDehors = false; $this->ElementCourant= &$Element->Parent; return true; } else { Fdd46bacf(Fc34ec142("ERR_XML_POSITION_RACINE")); } } $this->bTrouve = false; $this->bEnDehors = true; return false; } function F048c5f73() { if(isset($this->ElementCourant)) { $this->bTrouve = true; $this->bEnDehors = false; if(isset($this->ElementCourant->Parent)) { $fils = &$this->ElementCourant->Parent->F3274bcf8(XML_ELEMENT); if(isset($fils)) { $this->ElementCourant= &$fils; } } return true; } $this->bTrouve = false; $this->bEnDehors = true; return false; } function F7168f84a() { if(isset($this->ElementCourant)) { $this->bTrouve = true; $this->bEnDehors = false; if(isset($this->ElementCourant->Parent)) { $fils = &$this->ElementCourant->Parent->F4629af12(XML_ELEMENT); if(isset($fils)) { $this->ElementCourant= &$fils; } } return true; } $this->bTrouve = false; $this->bEnDehors = true; return false; } function F399fc126() { if(isset($this->ElementCourant)) { $fils = &$this->ElementCourant->F4629af12(); if(isset($fils)) { $this->bTrouve = true; $this->bEnDehors = false; $this->ElementCourant= &$fils; return true; } } $this->bTrouve = false; $this->bEnDehors = true; return false; } } class FMK_ParseurXML { var $DocumentXML = null; var $ElementCourant = null; var $ParentElement = null; var $lastElement = null; var $bNew = false; var $lstPrefixeNS = array(); var $bJamaisAppele = true; function FMK_ParseurXML(&$document) { $this->DocumentXML = &$document; } function startElement($parser, $tagName, $attrs) { $this->bNew = true; global $lastTag, $tabTags; $lastTag = $tagName; if (!isset($tabTags)) $tabTags = array(); array_push($tabTags,$tagName); if(($nPosition = utf8_strpos($tagName, ":")) !== false) { $sPrefixe = utf8_substr($tagName,0,$nPosition); $tagName = utf8_substr($tagName,$nPosition+1, utf8_strlen($tagName) -$nPosition - 1); } $Balise = new FMK_BaliseXML($tagName); $Balise->sCheminXPath = (!isset($this->ParentElement)) ? '/'.utf8_implode('/',$tabTags) : $this->ParentElement->sCheminXPath . '/' . $tagName; if(isset($sPrefixe)) { $Balise->sPrefixe = $sPrefixe; if(in_array($sPrefixe, $this->lstPrefixeNS)) { $Balise->bPrefixeNS = true; } } if(!isset($this->ParentElement)) { $this->DocumentXML->Racine = &$Balise; $this->DocumentXML->ElementCourant = &$Balise; $this->DocumentXML->bTrouve = true; $this->DocumentXML->bTrouve = false; } else { $this->ParentElement->Fb35cfc09($Balise); } foreach($attrs as $sNom => $valeur) { if(utf8_strpos(utf8_strtolower($sNom),"xmlns") === 0) { if(($nPosition = utf8_strpos($sNom, ":")) !== false) { $sPrefixe = utf8_substr($sNom,$nPosition+1,utf8_strlen($sNom) - $nPosition - 1); $Balise->lstNameSpaceURI[$sPrefixe] = $valeur; array_unshift($this->lstPrefixeNS, $sPrefixe); if(strcmp($Balise->sPrefixe, $sPrefixe) == 0) { $Balise->bPrefixeNS = true; } } else { $Balise->lstNameSpaceURI[""] = $valeur; array_unshift($this->lstPrefixeNS, ""); } } else { $Balise->F73935150($sNom, $valeur); } } $this->ParentElement= &$Balise; $this->ElementCourant = &$Balise; } function endElement($parser,$tagName) { global $tabTags; array_pop($tabTags); if(isset($this->ElementCourant->lstNameSpaceURI)) { foreach($this->ElementCourant->lstNameSpaceURI as $sPrefixe=>$sURI) { $nPosition = array_search($sPrefixe, $this->lstPrefixeNS); if($nPosition !== false) { array_splice($this->lstPrefixeNS,$nPosition,1); } } } $this->bNew = false; $this->lastElement = &$this->ElementCourant; if(isset($this->ElementCourant)) { $this->ParentElement = &$this->ElementCourant->Parent; $this->ElementCourant = &$this->ElementCourant->Parent; } } function characterData($parser, $data) { if($this->bNew) { $this->ElementCourant->sBOData .= $data; $this->ElementCourant->F71d595fc($data); } else { $this->lastElement->sBFData .= $data; } } function unparsedData($parser, $data) { $this->bJamaisAppele = false; global $lastTag; if(isset($this->ElementCourant)) { if($lastTag == $this->ElementCourant->sNomElement) { $this->ElementCourant->sBOData .= $data; } else { $this->lastElement->sBFData .= $data; } } else { if(isset($this->lastElement)) { $this->lastElement->sBFData .= $data; } else { $this->DocumentXML->sEnteteDocument .= $data; } } } } class FMK_ElementXML { var $Parent = null; var $Valeur = ""; var $sNomElement = ""; var $nPositionElement = 0; var $bSupprime = false; var $sCheminXPath = null; function FMK_ElementXML($sNom, $valeur='') { $this->sNomElement = $sNom; $this->Valeur = $valeur; } function F72b26638(&$pclFils,$nbBalises,$pclParent=null) { if (!isset($pclParent)) $pclParent =& $pclFils; if (isset($pclFils->lstFils )) { $nOccurrence = count( $pclFils->lstFils ); for($i = 0; $i < $nOccurrence; $i++) { $this->F72b26638($pclFils->lstFils[ $i ], $nbBalises, $pclParent); } } $pclFils->sCheminXPath = utf8_str_replace($pclParent->sCheminXPath, $pclParent->sCheminXPath.'['.$nbBalises.']', $pclFils->sCheminXPath); } function F74438c68() { return $this->sNomElement; } function F6c668a45() { return $this->sNomElement; } function Fb2bb120f($sNomElement) { if($this->Fe2b7b03e($sNomElement)) { $this->sNomElement = $sNomElement; return true; } return false; } function Fe2b7b03e($sNom) { $bValide = preg_match(Fd7624002("/^[A-Za-z_àâäèêéëîïôöùûüç._:-][A-Za-z0-9_àâäèêéëîïôöùûüç._:-]*$/" . UNICODE_REGEXP), $sNom); if(!$bValide) { Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_XML_NOM_INVALIDE"), $sNom)); } return $bValide; } function setValeur($valeur) { $valeur = F78d2adc5($valeur); $this->Valeur = $valeur; } function getValeur() { return $this->Valeur ; } function F71d595fc($valeur) { $this->Valeur .= $valeur; } function F2b7f24ee() { } function F2968ad2b() { } function F086b3936() { if(isset($this->Parent)) { return $this->Parent->F74438c68(); } return ""; } function Ffb92bfbf() { return XML_ERREUR; } function& F73935150($sNom, $valeur, $bDernierFils = true) { $RetourParDefaut = null; return $RetourParDefaut; } function Fb35cfc09(&$ElementXML) { } function F2fb53daf($nPositionFils) { } function F9e414f2b(&$ElementXML, $nPositionInsertion) { } function Fabe87489($sNomAttribut, $nOption = XML_EXACT) { Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_XML_ATTRIBUT_INEXISTANT"), $sNomAttribut)); return ""; } function& F4629af12($nType=null) { $RetourParDefaut = null; return $RetourParDefaut; } function& F3274bcf8($nType=null) { $RetourParDefaut = null; return $RetourParDefaut; } function& F748637f9($nIndexFils) { $RetourParDefaut = null; return $RetourParDefaut; } function F7aa8814f() { $RetourParDefaut = 0; return $RetourParDefaut; } function& Fafabbcd1() { $RetourParDefaut = null; if(isset($this->Parent)) { return $this->Parent->F748637f9($this->nPositionElement + 1); } return $RetourParDefaut; } function& Ff3f4e29a() { $RetourParDefaut = null; if(isset($this->Parent)) { return $this->Parent->F748637f9($this->nPositionElement - 1); } return $RetourParDefaut; } function Fc2588602(&$StructRecherche) { $bResultat = false; if(isset($StructRecherche)) { if(($StructRecherche->nTypeParcours & XML_SOUS_ELEMENT) == XML_SOUS_ELEMENT) { $nIndex = 0; while(!$bResultat && $nIndex < $this->F7aa8814f()) { array_push($StructRecherche->pile, $nIndex); $Fils = $this->F748637f9($nIndex); $bResultat = $Fils->Fe008d554($StructRecherche); if(!$bResultat) { $bResultat = $Fils->Fc2588602($StructRecherche); } ++$nIndex; } if(!$bResultat) { $nNiveau = array_pop($StructRecherche->pile); if(isset($nNiveau)) { $Element = &$this->F52816a33($nNiveau, $StructRecherche->pile); if(isset($Element)) { $bResultat = $Element->Fe008d554($StructRecherche); if(!$bResultat) { $bResultat = $Element->Fc2588602($StructRecherche); } } } } } if(!$bResultat && ($StructRecherche->nTypeParcours & XML_NIVEAU_COURANT) == XML_NIVEAU_COURANT) { $Frere = &$StructRecherche->ElementDepart->Fafabbcd1(); if(isset($Frere)) { $StructRecherche->ElementDepart = &$Frere; $bResultat = $Frere->Fe008d554($StructRecherche); if(!$bResultat) { $bResultat = $Frere->Fc2588602($StructRecherche); } } } if(!$bResultat && ($StructRecherche->nTypeParcours & XML_CONTINUE) == XML_CONTINUE) { $Frere = &$StructRecherche->ElementDepart->Fafabbcd1(); if(isset($Frere)) { $StructRecherche->ElementDepart = &$Frere; $bResultat = $Frere->Fe008d554($StructRecherche); if(!$bResultat) { $bResultat = $Frere->Fc2588602($StructRecherche); } } else { $Parent = &$StructRecherche->ElementDepart->Parent; if(isset($Parent)) { $Frere = &$Parent->Fafabbcd1(); if(isset($Frere)) { $StructRecherche->ElementDepart = &$Frere; $bResultat = $Frere->Fe008d554($StructRecherche); if(!$bResultat) { $bResultat = $Frere->Fc2588602($StructRecherche); } } } } } } return $bResultat; } function F1c6d54cf(&$StructRecherche) { $bResultat = false; if(isset($StructRecherche)) { if(($StructRecherche->nTypeParcours & XML_SOUS_ELEMENT) == XML_SOUS_ELEMENT) { $nIndex = $this->F7aa8814f()-1; while(!$bResultat && $nIndex >= 0) { array_push($StructRecherche->pile, $nIndex); $Fils = $this->F748637f9($nIndex); $bResultat = $Fils->Fe008d554($StructRecherche); if(!$bResultat) { $bResultat = $Fils->F1c6d54cf($StructRecherche); } --$nIndex; } if(!$bResultat) { $nNiveau = array_pop($StructRecherche->pile); if(isset($nNiveau)) { $Element = &$this->F4b744371($nNiveau, $StructRecherche->pile); if(isset($Element)) { $bResultat = $Element->Fe008d554($StructRecherche); if(!$bResultat) { $bResultat = $Element->F1c6d54cf($StructRecherche); } } } } } if(!$bResultat && ($StructRecherche->nTypeParcours & XML_NIVEAU_COURANT) == XML_NIVEAU_COURANT) { $Frere = &$StructRecherche->ElementDepart->Ff3f4e29a(); if(isset($Frere)) { $StructRecherche->ElementDepart = &$Frere; $bResultat = $Frere->Fe008d554($StructRecherche); if(!$bResultat) { $bResultat = $Frere->F1c6d54cf($StructRecherche); } } } if(!$bResultat && ($StructRecherche->nTypeParcours & XML_CONTINUE) == XML_CONTINUE) { $Frere = &$StructRecherche->ElementDepart->Ff3f4e29a(); if(isset($Frere)) { $StructRecherche->ElementDepart = &$Frere; $bResultat = $Frere->Fe008d554($StructRecherche); if(!$bResultat) { $bResultat = $Frere->F1c6d54cf($StructRecherche); } } else { $Parent = &$StructRecherche->ElementDepart->Parent; if(isset($Parent)) { $Frere = &$Parent->Ff3f4e29a(); if(isset($Frere)) { $StructRecherche->ElementDepart = &$Frere; $bResultat = $Frere->Fe008d554($StructRecherche); if(!$bResultat) { $bResultat = $Frere->F1c6d54cf($StructRecherche); } } } } } } return $bResultat; } function& F52816a33($nNiveau, &$pile) { $Element = null; if(isset($this->Parent)) { $Element = &$this->Parent->F748637f9($nNiveau+1); if(!isset($Element)) { $nNiveau = array_pop($pile); if(isset($nNiveau)) { $Element = &$this->Parent->F52816a33($nNiveau, $pile); } } else { array_push($pile, $nNiveau+1); } } return $Element; } function& F4b744371($nNiveau, &$pile) { $Element = null; if(isset($this->Parent)) { $Element = &$this->Parent->F748637f9($nNiveau-1); if(!isset($Element)) { $nNiveau = array_pop($pile); if(isset($nNiveau)) { $Element = &$this->Parent->F4b744371($nNiveau, $pile); } } else { array_push($pile, $nNiveau-1); } } return $Element; } function Fe008d554($StructRecherche) { $bResultat = false; if($StructRecherche->bValeur) { if(!isset($StructRecherche->valeurRecherche)) { $bResultat = true; } else { $bResultat = F7ce0defa($this->Valeur, $StructRecherche->valeurRecherche, $StructRecherche->nMode, $StructRecherche->bIgnoreCasse); } } if(!$bResultat && isset($StructRecherche->nTypeElement)) { $nTypeElement = $this->Ffb92bfbf(); if(($nTypeElement & $StructRecherche->nTypeElement) == $nTypeElement) { if(!isset($StructRecherche->valeurRecherche)) { $bResultat = true; } else { $sNomElement = $this->sNomElement; if(($StructRecherche->nMode & XML_AVEC_NAMESPACE) == XML_AVEC_NAMESPACE) { $sNomElement = $this->F6c668a45(); } $bResultat = F7ce0defa($sNomElement, $StructRecherche->valeurRecherche, $StructRecherche->nMode, $StructRecherche->bIgnoreCasse); } } } if($bResultat) { global $DocumentXMLCourant; $docXML = &Fb9098312($DocumentXMLCourant); $docXML->ElementCourant = &$this; } return $bResultat; } } class FMK_AttributXML extends FMK_ElementXML { function Ffb92bfbf() { return XML_ATTRIBUT; } function& F73935150($sNom, $valeur, $bDernierFils = true) { return $this->Parent->F73935150($sNom, $valeur, $bDernierFils); } function Fb35cfc09(&$ElementXML) { return $this->Parent->Fb35cfc09($ElementXML); } function F2b7f24ee() { $sChaine = " ".$this->sNomElement."=\"".$this->Valeur."\""; return $sChaine; } function F2968ad2b() { return $this->Parent->F2968ad2b()."/@".$this->sNomElement; } function F6c668a45() { if(isset($this->sPrefixe)) { return $this->sPrefixe.":".$this->sNomElement; } else { return parent::F6c668a45(); } } } class FMK_BaliseXML extends FMK_ElementXML { var $lstFils = array(); var $sPrefixe = null; var $bPrefixeNS = false; var $lstNameSpaceURI = null; var $sBOData = ""; var $sBFData = ""; function Ffb92bfbf() { return XML_BALISE; } function F6c668a45() { if(isset($this->sPrefixe) && $this->bPrefixeNS) { return $this->sPrefixe.":".$this->sNomElement; } else { return parent::F6c668a45(); } } function& F73935150($sNom, $valeur, $bDernierFils = true) { $sPrefixeAtt = null; if(($nPosition = utf8_strpos($sNom, ":")) !== false) { $sPrefixeAtt = utf8_substr($sNom,0,$nPosition); $sNom = utf8_substr($sNom,$nPosition+1, utf8_strlen($sNom) -$nPosition - 1); } $Attribut = new FMK_AttributXML($sNom, $valeur); $Attribut->sCheminXPath = $this->sCheminXPath . '/@' . $sNom; $Attribut->Parent = &$this; if($bDernierFils) { $Attribut->nPositionElement = count($this->lstFils); $this->lstFils[] = $Attribut; } else { $nIndex = 0; foreach($this->lstFils as $Fils) { if($Fils->Ffb92bfbf() != XML_ATTRIBUT) { break; } ++$nIndex; } $Attribut->nPositionElement = $nIndex; $tab = array(); $tab[0] =& $Attribut; array_splice($this->lstFils, $nIndex, 0, $tab); $nBorneMax = count($this->lstFils); for($i=$nIndex+1;$i<$nBorneMax;$i++) { $Fils = &$this->lstFils[$i]; $Fils->nPositionElement++; } } return $Attribut; } function F9e414f2b(&$ElementXML, $nPositionInsertion) { $nPositionInsertion = max(0, $nPositionInsertion); $nPositionInsertion = min(count($this->lstFils), $nPositionInsertion); $ElementXML->nPositionElement = $nPositionInsertion; $tab = array(); $tab[0] =& $ElementXML; array_splice($this->lstFils, $nPositionInsertion, 0, $tab); $nBorneMax = count($this->lstFils); for($i=$nPositionInsertion+1;$i<$nBorneMax;$i++) { $Fils = &$this->lstFils[$i]; $Fils->nPositionElement++; } $ElementXML->Parent = &$this; } function F71d595fc($valeur) { parent::F71d595fc($valeur); } function setValeur($valeur) { $valeur = F78d2adc5($valeur); $this->Valeur = $valeur; $this->sBOData = $valeur; } function F2b7f24ee() { $nNbBaliseFille = 0; if(isset($this->sPrefixe) && !empty($this->sPrefixe)) { $sChaine = "<".$this->sPrefixe.":".$this->sNomElement; } else { $sChaine = "<".$this->sNomElement; } if(isset($this->lstNameSpaceURI)) { foreach($this->lstNameSpaceURI as $sPrefixe=>$sURI) { if(!empty($sPrefixe)) { $sChaine .= " xmlns:".$sPrefixe."=\"".$sURI."\""; } else { $sChaine .= " xmlns"."=\"".$sURI."\""; } } } if(count($this->lstFils) > 0) { $nIndex = 0; $nBorneMax = count($this->lstFils); for($nIndex=0;$nIndex<$nBorneMax;$nIndex++) { $Element = $this->lstFils[$nIndex]; if($Element->Ffb92bfbf() == XML_ATTRIBUT) { $sChaine .= $Element->F2b7f24ee(); } else { break; } } if($nIndex < count($this->lstFils)) { $sChaine .= ">".$this->sBOData; } $nBorneMax = count($this->lstFils); for($nIndex;$nIndex<$nBorneMax;$nIndex++) { $Element = $this->lstFils[$nIndex]; $sChaine .= $Element->F2b7f24ee(); ++$nNbBaliseFille; } } if($nNbBaliseFille == 0) { if(utf8_strcasecmp("",$this->Valeur) == 0) { $sChaine .= "/>".$this->sBFData; } else { $sChaine .= ">".$this->sBOData; if(isset($this->sPrefixe) && !empty($this->sPrefixe)) { $sChaine .= "</".$this->sPrefixe.":".$this->sNomElement.">".$this->sBFData; } else { $sChaine .= "</".$this->sNomElement.">".$this->sBFData; } } } else { if(isset($this->sPrefixe) && !empty($this->sPrefixe)) { $sChaine .= "</".$this->sPrefixe.":".$this->sNomElement.">".$this->sBFData; } else { $sChaine .= "</".$this->sNomElement.">".$this->sBFData; } } return $sChaine; } function F2968ad2b() { $sResultat = ""; if(isset($this->Parent)) { $sResultat = $this->Parent->F2968ad2b(); } $sResultat .= "/".$this->F6c668a45(); $nPosition = $this->F3e0d87c9(); if($nPosition > 0) { $sResultat .= "[".$nPosition."]"; } return $sResultat; } function F3e0d87c9() { $nNbJumeau = 0; $nPosition = 0; if(isset($this->Parent)) { foreach($this->Parent->lstFils as $Fils) { if($Fils->Ffb92bfbf() == XML_BALISE) { if(strcmp($Fils->F74438c68(), $this->F74438c68()) == 0) { if($this->nPositionElement == $Fils->nPositionElement) { $nPosition = $nNbJumeau + 1; } else { ++$nNbJumeau; if($nPosition > 0) { break; } } } } } } if($nNbJumeau > 0) { return $nPosition; } return -1; } function F7a733a32($sPrefixe) { if(!isset($sPrefixe)) { $sPrefixe = ""; } if(isset($this->lstNameSpaceURI[$sPrefixe])) { return $this->lstNameSpaceURI[$sPrefixe]; } if(isset($this->Parent)) { return $this->Parent->F7a733a32($sPrefixe); } return ""; } function Fb35cfc09(&$ElementXML) { $ElementXML->Parent= &$this; $nNbFils = count($this->lstFils); $ElementXML->nPositionElement = $nNbFils; $this->lstFils[] = &$ElementXML; if (!isset($this->tabBalises[$ElementXML->sNomElement])) $this->tabBalises[$ElementXML->sNomElement] = 1; else ++$this->tabBalises[$ElementXML->sNomElement]; $nbBalises = $this->tabBalises[$ElementXML->sNomElement]; if ($nbBalises>1) { if ($nbBalises===2) { $pclPremierFils =& $this->lstFils[0]; $this->F72b26638($pclPremierFils,1); } $pclFils =& $this->lstFils[$ElementXML->nPositionElement]; $this->F72b26638($pclFils,$nbBalises); } } function F2fb53daf($nPositionFils) { $nBorneMax = count($this->lstFils)-1; for($i=$nPositionFils;$i<$nBorneMax;$i++) { $Fils = &$this->lstFils[$i+1]; $Fils->nPositionElement--; $this->lstFils[$i] = &$Fils; } unset($this->lstFils[$nBorneMax]); } function& F748637f9($nIndexFils) { $RetourParDefaut = null; if($nIndexFils >= 0 && $nIndexFils < count($this->lstFils)) { return $this->lstFils[$nIndexFils]; } return $RetourParDefaut; } function F7aa8814f() { return count($this->lstFils); } function& F4629af12($nType=null) { $RetourParDefaut = null; if(!isset($nType)) { if(isset($this->lstFils[0])) { return $this->lstFils[0]; } } else { $count = count($this->lstFils); for($i=0;$i<$count;$i++) { $Fils = &$this->lstFils[$i]; if($nType = XML_ELEMENT || $Fils->Ffb92bfbf() == $nType) { return $Fils; } } } return $RetourParDefaut; } function& F3274bcf8($nType=null) { $RetourParDefaut = null; if(!isset($nType)) { return $this->lstFils[count($this->lstFils) - 1]; } else { for($i=count($this->lstFils)-1;$i>=0;$i--) { $Fils = &$this->lstFils[$i]; if($nType = XML_ELEMENT || $Fils->Ffb92bfbf() == $nType) { return $Fils; } } } return $RetourParDefaut; } function Fabe87489($sNomAttribut, $nOption = XML_EXACT) { $bIgnoreCasse = false; if(($nOption & XML_IGNORE_LA_CASSE) == XML_IGNORE_LA_CASSE) { $bIgnoreCasse = true; $nOption -= XML_IGNORE_LA_CASSE; } $sValeurAttribut = null; foreach($this->lstFils as $element) { if($element->Ffb92bfbf() != XML_ATTRIBUT) { break; } if(F7ce0defa($element->sNomElement, $sNomAttribut, $nOption, $bIgnoreCasse)) { $sValeurAttribut = $element->getValeur(); break; } } if(!isset($sValeurAttribut)) { Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_XML_ATTRIBUT_INEXISTANT"), $sNomAttribut)); return ""; } return $sValeurAttribut; } } class FMK_StructRechercheXML { var $valeurRecherche = null; var $bValeur; var $nTypeElement; var $nMode; var $bIgnoreCasse = false; var $nTypeParcours; var $pile = array(); var $ElementDepart = null; } class FMK_PositionXML { var $StructRecherche = null; var $bTrouve = false; var $bEnDehors = true; var $ElementCourant = null; } class FMK_ParseurXMLExtraitChaine { var $sNomBalise = ""; var $bIgnoreCasse = false; var $nIndiceBalise = 1; var $nNbBalise = 0; var $bTrouve = false; var $nPosDebut = -1; var $nPosFin = -1; var $nSousOccurrence = 0; function FMK_ParseurXMLExtraitChaine($sNomBalise, $bIgnoreCasse, $nIndice) { $this->sNomBalise = $sNomBalise; $this->bIgnoreCasse = $bIgnoreCasse; $this->nIndiceBalise = $nIndice; } function startElement($parser, $tagName, $attrs) { if($this->bIgnoreCasse && utf8_strcasecmp($tagName, $this->sNomBalise) == 0 || !$this->bIgnoreCasse && strcmp($tagName, $this->sNomBalise) == 0) { $this->nNbBalise++; if($this->bTrouve) { $this->nSousOccurrence++; } if($this->nNbBalise == $this->nIndiceBalise) { $this->bTrouve = true; $this->nPosDebut = -1; } } } function endElement($parser,$tagName) { if($this->bTrouve) { if($this->nSousOccurrence > 0) { $this->nSousOccurrence--; } else { if($this->bIgnoreCasse && utf8_strcasecmp($tagName, $this->sNomBalise) == 0 || !$this->bIgnoreCasse && strcmp($tagName, $this->sNomBalise) == 0) { $this->nPosFin = xml_get_current_byte_index($parser); $this->bTrouve = false; } } } } function unparsedData($parser, $data) { if($this->bTrouve && $this->nPosDebut == -1) { $this->nPosDebut = xml_get_current_byte_index($parser); } } } function F36d8246b($sNomTable,$tabColTitre,$bSansTitre) { $sRetour = F927d00f8($sNomTable); $sRetour .= Ff0f137d0($sNomTable,$tabColTitre,$bSansTitre); $sRetour .= F918834c5($tabColTitre); $sRetour .= F130c716a(); return $sRetour; } function F927d00f8($sNomTable) { $sEncodage = (UNICODE_PAGE_UTF8 ? 'UTF-8' : 'ISO-8859-1'); return <<<EOT
<?xml version="1.0" encoding="$sEncodage" ?>
<html xmlns:xsl="http://www.w3.org/TR/WD-xsl">
<body bgcolor="FFFFD9">
<table border="0" bgcolor="0066CC" width="100%%">
<tr>
<td><font face="Tahoma" color="FFFFD9" size="+2">$sNomTable</font></td>
</tr>
</table>
<p/>
<center>
<table border="1" bordercolor="FFFFD9" cellpadding="3">
<tr>
EOT;
} function Ff0f137d0($sNomTable,$tabColTitre,$bSansTitre) { $sResultat = ''; foreach ($tabColTitre as $sTitre) { $sResultat .= '<td bgcolor="A0A0A0"><font face="Tahoma"><b>'.($bSansTitre ? '' : $sTitre).'</b></font></td>'.RC; } $sResultat .= '</tr>'.RC.'<xsl:for-each select="'.XML_DEFAULT_DOCUMENTNAME.'/'.$sNomTable.'">'.RC.'  <tr>' . RC; return $sResultat; } function F918834c5($tabColTitre) { define('RGB_PREMIERE_COLONNE' ,'C9E3ED'); define('RGB_COLONNE' ,'EFEFEF'); $sResultat = ''; $bPremiere = true; foreach ($tabColTitre as $sTitre) { if ($bPremiere) { $nCouleur = RGB_PREMIERE_COLONNE; $bPremiere = false; } else { $nCouleur = RGB_COLONNE; } $sResultat .= '<td bgcolor="'.$nCouleur.'"><font face="Tahoma" size="-1"><xsl:value-of select="'.$sTitre.'" /></font></td>'.RC; } return $sResultat; } function F130c716a() { return <<<EOT
  </tr>
</xsl:for-each>
</table>
</center>
</body>
</html>
EOT;
} function Serialise( &$variable, &$buffer, $nParametre) { if ($nParametre == PSD_BINAIRE) { Fe81a7f9e('SERIALISATION_BINAIRE_INTERDITE'); } if(!is_object($variable) || !($variable->Ffe33562a())) { Fe81a7f9e('TYPE_INVALIDE_POUR_SERIALISATION'); } if(!F4997830d($buffer,true) ) { Fe81a7f9e('FORMAT_SERIALISATION_INCORRECT'); } $serialiseur = new WDSerialiseur(); $buffer->SetValeur($serialiseur->F0dd88e14($variable)); } function Deserialise( &$variable, &$buffer,$nParametre) { if ($nParametre == PSD_BINAIRE) { Fe81a7f9e('SERIALISATION_BINAIRE_INTERDITE'); } if(!is_object($variable) || !($variable->Ffe33562a())) { Fe81a7f9e('TYPE_INVALIDE_POUR_SERIALISATION'); } $deserialiseur = new WDDeserialiseur(); $deserialiseur->Fc929eb5e($variable, VersChaine($buffer)); } ?>