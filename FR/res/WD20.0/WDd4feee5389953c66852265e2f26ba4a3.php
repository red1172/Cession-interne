<?php
//20.0.56.0 IHM/Champ/Liste/Table/Table.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 if (!defined('__INC__FMK/Dessin/Couleur.php')) { define('__INC__FMK/Dessin/Couleur.php',true); include_once(WB_INCLUDE_PATH.'WD2521e084cbaf10ef8d5f4ede4dc6baa2.php'); } if (!defined('__INC__FMK/Dessin/Style.php')) { define('__INC__FMK/Dessin/Style.php',true); include_once(WB_INCLUDE_PATH.'WDe97303bfc6e1e49621ac71fab8c177e5.php'); } if (!defined('__INC__FMK/Chaine.php')) { define('__INC__FMK/Chaine.php',true); include_once(WB_INCLUDE_PATH.'WD55acb2e708e26f23cb8956cd93e98123.php'); } if (!defined('__INC__IHM/CompoObjConst.php')) { define('__INC__IHM/CompoObjConst.php',true); include_once(WB_INCLUDE_PATH.'WD491e0f4a2e48dd39cd8c7caa2a6eddf4.php'); } if (!defined('__INC__IHM/Champ/Liste/Liste.php')) { define('__INC__IHM/Champ/Liste/Liste.php',true); include_once(WB_INCLUDE_PATH.'WD83a9f9fff5598133a55ffc6567590f9e.php'); } if (!defined('__INC__IHM/Champ/Liste/Table/LigneTable.php')) { define('__INC__IHM/Champ/Liste/Table/LigneTable.php',true); include_once(WB_INCLUDE_PATH.'WDa97a9c08804dc165a4606ca1d64dee7f.php'); } if (!defined('__INC__IHM/Champ/Liste/Table/Colonne/ColonneDate.php')) { define('__INC__IHM/Champ/Liste/Table/Colonne/ColonneDate.php',true); include_once(WB_INCLUDE_PATH.'WD6d1038bb543f19a1b221b88b6555d059.php'); } if (!defined('__INC__IHM/Champ/Liste/Table/Colonne/ColonneHeure.php')) { define('__INC__IHM/Champ/Liste/Table/Colonne/ColonneHeure.php',true); include_once(WB_INCLUDE_PATH.'WDf8361f3a1f46b8bf11322e48ca82265b.php'); } if (!defined('__INC__IHM/Champ/Liste/Table/Colonne/ColonneNumerique.php')) { define('__INC__IHM/Champ/Liste/Table/Colonne/ColonneNumerique.php',true); include_once(WB_INCLUDE_PATH.'WD65f654d44745e524587b98cd7af02c62.php'); } if (!defined('__INC__IHM/Champ/Liste/Table/Colonne/ColonneMonetaire.php')) { define('__INC__IHM/Champ/Liste/Table/Colonne/ColonneMonetaire.php',true); include_once(WB_INCLUDE_PATH.'WD580a04c99cfd43422ffb262321ea521d.php'); } if (!defined('__INC__IHM/Champ/Liste/Table/Colonne/Colonne.php')) { define('__INC__IHM/Champ/Liste/Table/Colonne/Colonne.php',true); include_once(WB_INCLUDE_PATH.'WD3822829e5f2af4a164b121dbfb7ea8b2.php'); } function F0838abd5($sNomTable) { if ( (F1c7c7cae($GLOBALS[$sNomTable])) && ( $GLOBALS[$sNomTable]->getNom() == $sNomTable ) ) { return $GLOBALS[$sNomTable]; } foreach ($GLOBALS as $nIndice => $objetTable) { if (!F1c7c7cae($objetTable)) continue; if ( $objetTable->getNom() == $sNomTable ) return $nIndice; } return null; } function F34f7300e($sNomCol) { foreach ($GLOBALS as $nIndice => $objetTable) { if (!F1c7c7cae($objetTable)) continue; if (is_array($objetTable->TabColonnes)) { foreach (array_keys($objetTable->TabColonnes) as $nIndiceColonne) { if ($objetTable->TabColonnes[$nIndiceColonne]->getNom() == $sNomCol) { return $nIndice; } } } } return null; } function TableTrieColonnes($mixParam) { $nNbArg = func_num_args(); if ($nNbArg == 1) { $tabColonnes = utf8_explode(TAB,$mixParam); } else { $tabColonnes = func_get_args(); } $tableATrier = null; if (count($tabColonnes)===0) return false; $sCol = $tabColonnes[0]; if ( ($sCol[0]=='-') || ($sCol[0]=='+') ) { $sCol = utf8_substr($sCol,1); } $sTable = null; if (utf8_strpos($sCol,'.')!==false) { $tabNomTable = utf8_explode('.',$sCol); $sTable = $tabNomTable[count($tabNomTable)-2]; $sCol = $tabNomTable[count($tabNomTable)-1]; } if ($sTable!=null) $tableATrier = &$GLOBALS[F0838abd5($sTable)]; if ($tableATrier==null) $tableATrier = &$GLOBALS[F34f7300e($sCol)]; if(!F1c7c7cae($tableATrier)) { Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_PARAMETRE_VALEUR_INCORRECT"),Fc34ec142("FCT_TABLE_TABLETRIE"))); return false; } if ($tableATrier->GetType() == ID_TABLEHIERARCHIQUE) return $tableATrier->Fe67060d9($tabColonnes,null); $listeColonnes = utf8_implode(TAB,$tabColonnes); return $tableATrier->TableTrieColonnes($listeColonnes); } class CTable extends CTableZRCommun { var $TabColonnes; var $StyleLigneImpaire; var $StyleLignePaire; var $StyleLigneSelect; var $nIndiceColonneTri = -1; var $nSensTri = 0; var $nModeSelection = MODE_SELECTION_SIMPLE; var $m_tabIndiceColonneTri = array(); var $m_clTabValeurSauveSiFiltre = null; var $m_clFiltreUser = null; var $m_bTabValeurSauveActif = false; function CTable() { parent::CTableZRCommun(); $this->TabColonnes = array(); $this->StyleLignePaire = new FMK_Dessin_Style(); $this->StyleLigneImpaire = new FMK_Dessin_Style(); $this->StyleLigneSelect = new FMK_Dessin_Style(); } function& Fd135d1c5($Valeur) { $pclLigne = new CLigneTable($this,$Valeur); return $pclLigne; } function lierVM($sNomVM, $sNomWL, $sNomPHP) { $clVMManager =& F08aafbb0(); $clVM =& $clVMManager->Fe26ffff2($sNomVM); parent::lierVM($sNomVM,$sNomWL,$sNomPHP); foreach (array_keys($this->TabColonnes) as $nIndice) { $clVM->F73935150($this->TabColonnes[$nIndice]->Nom,$this->F960e3ffe()); } } function vnGetColspanPourRuptureHTML() { $nColspan = 0; $bDerniereColonneVisibleEstRedimensionnable = FALSE; $nNbColonneEdition = $this->F57a77f23(); for ($nColonne = 1; $nColonne <= $nNbColonneEdition; ++$nColonne) { if (!isset($this->TabColonnes[$nColonne])) continue; $pclColonne =& $this->TabColonnes[$nColonne]; if ($pclColonne->Visible) { $bDerniereColonneVisibleEstRedimensionnable = $pclColonne->F66cc6b76(); $nColspan += ($bDerniereColonneVisibleEstRedimensionnable) ? 2 : 1; } } if ($bDerniereColonneVisibleEstRedimensionnable) { --$nColspan; } return $nColspan; } function nGetColRedimPourRuptureHTML() { for ($nColonne = $this->F57a77f23(); 1 <= $nColonne; --$nColonne) { if (!isset($this->TabColonnes[$nColonne])) continue; $pclColonne =& $this->TabColonnes[$nColonne]; if ($pclColonne->Visible) { if ($pclColonne->F66cc6b76()) { return $nColonne; } else { return NUMCOLONNE_INVALIDE; } } } return NUMCOLONNE_INVALIDE; } function F3a0785c7($dwCoul, $dwCoulFond) { $this->StyleLignePaire = new FMK_Dessin_Style($dwCoul,$dwCoulFond); } function& Fd5bae806() { return $this->StyleLignePaire; } function Fdbd18680($dwCoul, $dwCoulFond) { $this->StyleLigneImpaire = new FMK_Dessin_Style($dwCoul,$dwCoulFond); } function& Fb588e0fb() { return $this->StyleLigneImpaire; } function Febba64cf($dwCoul, $dwCoulFond) { $this->StyleLigneSelect = new FMK_Dessin_Style($dwCoul,$dwCoulFond); } function& F4680d4de() { return $this->StyleLigneSelect; } function& F24bef4f5($IndiceLigne, $IndiceColonne = -1) { if($this->selected($IndiceLigne)) { $Style =& $this->F4680d4de(); return $Style->GetCouleur(); } if(array_key_exists($IndiceLigne,$this->TabLigne)) { if($this->TabLigne[$IndiceLigne]->F2bd61426()) { $Style =& $this->TabLigne[$IndiceLigne]->Feb7b0854(); if($Style->GetCouleur() != -1) { return $Style->GetCouleur(); } } } if($IndiceColonne != -1) { if(array_key_exists($IndiceColonne,$this->TabColonnes)) { if($this->TabColonnes[$IndiceColonne]->F2bd61426()) { $Style =& $this->TabColonnes[$IndiceColonne]->Fae1e96ac(); if($Style->GetCouleur() != -1) { return $Style->GetCouleur(); } } } } if($this->F3337675a($IndiceLigne)%2 == 0) { return $this->StyleLignePaire->GetCouleur(); } else { return $this->StyleLigneImpaire->GetCouleur(); } } function& F3e95d7a4($IndiceLigne, $IndiceColonne = -1) { if($this->selected($IndiceLigne)) { $Style =& $this->F4680d4de(); return $Style->GetCouleurFond(); } if(array_key_exists($IndiceLigne,$this->TabLigne)) { if($this->TabLigne[$IndiceLigne]->F2bd61426()) { $Style =& $this->TabLigne[$IndiceLigne]->Feb7b0854(); if($Style->GetCouleurFond() != -1) { return $Style->GetCouleurFond(); } } } if($IndiceColonne != -1) { if(array_key_exists($IndiceColonne,$this->TabColonnes)) { if($this->TabColonnes[$IndiceColonne]->F2bd61426()) { $Style =& $this->TabColonnes[$IndiceColonne]->Fae1e96ac(); if($Style->GetCouleurFond() != -1) { return $Style->GetCouleurFond(); } } } } if($this->F3337675a($IndiceLigne)%2 == 0) { return $this->StyleLignePaire->GetCouleurFond(); } else { return $this->StyleLigneImpaire->GetCouleurFond(); } } function& GetType() { return getRef(9); } function F4a917fa4() { return 9; } function& GetColonne($Indice) { if (isset($this->TabColonnes[$Indice])) return $this->TabColonnes[$Indice]; $null=null; return $null; } function& Fd94d3bbc($sNomWL) { foreach ($this->TabColonnes as $nIndice => $Colonne) { if (utf8_strcasecmp(F03771b65($Colonne->Nom),F03771b65($sNomWL))===0) { return $this->TabColonnes[$nIndice]; } } $null=null; return $null; } function ListeDeplaceLigne($nIndexSource, $DestinationOuInc, $nType = null, $sFonctionOrigine = 'FCT_LISTEDEPLACELIGNE') { $bLigneSelectioneeDeplacee = false; if ($nIndexSource == LIGNE_SELECTIONEE) { if ($this->nModeSelection != MODE_SELECTION_SIMPLE) { Fe81a7f9e('ERR_PARAMETRE_VALEUR_INCORRECT',$sFonctionOrigine); } $nIndexSource = $this->Valeur; $bLigneSelectioneeDeplacee = true; } if ($DestinationOuInc == TD_PAGEPRECEDENT) { if ($this->nMaxLignePage == 0) { $DestinationOuInc = 1; } else { $DestinationOuInc = $nIndexSource - $this->nMaxLignePage; } } elseif ($DestinationOuInc == TD_PAGESUIVANT) { if ($this->nMaxLignePage == 0) { $DestinationOuInc = $this->Occurrence; } else { $DestinationOuInc = $nIndexSource + $this->nMaxLignePage; } } $Retour = parent::ListeDeplaceLigne($nIndexSource,$DestinationOuInc,$nType,$sFonctionOrigine); if ($bLigneSelectioneeDeplacee) { $this->TabSelect[ $nIndexSource ] = 0; $this->TabSelect[ $this->Valeur ] = 1; } return $Retour; } function TableEnumereColonne($nIndiceColonne) { if (($nIndiceColonne<1)||($nIndiceColonne>count($this->TabColonnes))) return ''; return $this->TabColonnes[$nIndiceColonne]->GetNom(); } function TableColonnesTriees() { if (($nNombreColonnesTriees = count($this->m_tabIndiceColonneTri))>0) { $sChaineRetour = ''; for ($i=0;$i<$nNombreColonnesTriees;$i++) { $nIndiceEnCours = intval($this->m_tabIndiceColonneTri[$i]); $sSens = ($nIndiceEnCours<0) ? '-' : ''; $colTri = $this->GetColonne(abs($nIndiceEnCours)); if ($i==0) $sChaineRetour.=$sSens.$colTri->getNom(); else $sChaineRetour.= TAB . $sSens.$colTri->getNom(); } return $sChaineRetour; } else { if ($this->nIndiceColonneTri == -1) return ''; $sSens = ($this->nSensTri==0) ? '-' : ''; $colTri = $this->GetColonne($this->nIndiceColonneTri); return $sSens.$colTri->getNom(); } } function TableTrie($sFlag = '+', $sNomTable = 'this') { if ($sFlag == false) { $this->m_bEstTrie = false; return true; } if ($sNomTable == 'this') $objetTable = $this; else { if ($sNomTable[0] == '-') { $sNomTable = utf8_substr($sNomTable,1); $sFlag = '-'; } if ($sNomTable[0] == '+') { $sNomTable = utf8_substr($sNomTable,1); $sFlag = '+'; } if (utf8_strpos($sNomTable,'.')>0) { $tabNomTable = utf8_explode('.',$sNomTable); $sNomTable = $tabNomTable[count($tabNomTable)-1]; } global ${$sNomTable}; $objetTable = ${$sNomTable}; if (!is_object($objetTable)) { Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_PARAMETRE_VALEUR_INCORRECT"),Fc34ec142("FCT_TABLE_TABLETRIE"))); return false; } } if ( ($sFlag!='-') && ($sFlag!='+') ) $sFlag = ''; $sColonnesVisibles = ''; $cptCol = 0; foreach(array_keys($objetTable->TabColonnes) as $nTabColIndice) { ++$cptCol; $TabColCourant =& $objetTable->TabColonnes[$nTabColIndice]; if ($TabColCourant->Visible!=0) { $sColonnesVisibles .= ($sColonnesVisibles=='') ? $sFlag.$TabColCourant->getNom() : TAB . $sFlag . $TabColCourant->getNom(); } if ( $cptCol >= 10 ) break; } return $objetTable->TableTrieColonnes($sColonnesVisibles); } function TableTrieColonnes($mixParam) { $nNbArg = func_num_args(); if ($nNbArg == 1) { $tabColonnes = utf8_explode(TAB,$mixParam); } else { $tabColonnes = func_get_args(); } $tableATrier = null; if ( (!isset($this))||($this == null) ) { $sCol = $tabColonnes[0]; if ( ($sCol[0]=='-') || ($sCol[0]=='+') ) { $sCol = utf8_substr($sCol,1); } $sTable = null; if (utf8_strpos($sCol,'.')!==false) { $tabNomTable = utf8_explode('.',$sCol); $nCountTabNomTable = count($tabNomTable); $sTable = $tabNomTable[$nCountTabNomTable-2]; $sCol = $tabNomTable[$nCountTabNomTable-1]; } if ($sTable!=null) $tableATrier = &$GLOBALS[F0838abd5($sTable)]; if ($tableATrier==null) $tableATrier = &$GLOBALS[F34f7300e($sCol)]; } else $tableATrier = &$this; if(!F1c7c7cae($tableATrier)) { Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_PARAMETRE_VALEUR_INCORRECT"),Fc34ec142("FCT_TABLE_TABLETRIE"))); return false; } if(!isset($tableATrier->TabLigne) || count($tableATrier->TabLigne) == 0) return true; $nNbColonnes = count($tabColonnes); $tempAncienneColonnesTriees = $tableATrier->m_tabIndiceColonneTri; $tableATrier->m_tabIndiceColonneTri = array(); for ($i=0; $i<$nNbColonnes; $i++) { $sParam = $tabColonnes[$i]; $nSens = 1; if ($sParam!='') { if ( ($sParam[0]=='-') || ($sParam[0]=='+') ) { $nSens = ($sParam[0]=='-') ? 0 : 1; $sParam = utf8_substr($sParam,1); } if (utf8_strpos($sParam,'.')!==false) { $tabParam = utf8_explode('.',$sParam); $sParam = $tabParam[count($tabParam)-1]; } $nIndiceColonneCourante = -1; $nBorneMax = count($tableATrier->TabColonnes); for ($ii=1; $ii<=$nBorneMax;$ii++){ if ($tableATrier->TabColonnes[$ii]->getNom()==$sParam) { $nIndiceColonneCourante = $ii; } } if ($nIndiceColonneCourante<=0) { Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_PARAMETRE_VALEUR_INCORRECT"),Fc34ec142("FCT_TABLE_TABLETRIE"))); return false; } $tableATrier->m_tabIndiceColonneTri[] = ($nSens==0) ? -$nIndiceColonneCourante : $nIndiceColonneCourante; if($tableATrier->F48dce54a()) { $tableATrier->m_bTriSens = ($nSens==1); $tableATrier->F7c500a79($nIndiceColonneCourante, $tableATrier->m_bTriSens); $tableATrier->m_tabIndiceColonneTri = array($tableATrier->m_tabIndiceColonneTri[0]); $tableATrier->m_nTriOptions = triTableDéfaut; $tableATrier->m_bEstTrie = true; $tableATrier->nIndiceColonneTri = -1; $tableATrier->nSensTri = 0; return true; } } else { Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_PARAMETRE_VALEUR_INCORRECT"),Fc34ec142("FCT_TABLE_TABLETRIE"))); } } $temp = $tableATrier->TabLigne; if(utf8_usort($temp, array($tableATrier,"_procCompareLigne_Table"))) { $tableATrier->TabLigne = array(); $nIndex = 1; foreach($temp as $valeur) { $tableATrier->TabLigne[$nIndex] = $valeur; ++$nIndex; } $tableATrier->m_bEstTrie = true; if(Feef890d7()) { F9402f437($tableATrier->GetNom(), $tableATrier); } } else { $tableATrier->m_tabIndiceColonneTri = $tempAncienneColonnesTriees; $tableATrier->m_bEstTrie = false; } return $tableATrier->m_bEstTrie; } function Fc9bccf76($cligneNouvelle) { foreach ($this->TabLigne as $nIndice => $cligneEnCours) { $nResultat = $this->_procCompareLigne_Table($cligneNouvelle,$cligneEnCours); if ( ($nResultat == -1) || ($nResultat == 0) ) { $this->Fcfb6d1e2($cligneNouvelle,$nIndice); return $nIndice; } } $nIndice=count($this->TabLigne,COUNT_NORMAL)+1; $this->Fcfb6d1e2($cligneNouvelle,$nIndice); return $nIndice; } function _procCompareLigne_Table($valeur1, $valeur2) { $__nIndiceColonneTri = 0; $nResultat = 0; if(!isset($valeur1)) { $nResultat = 1; } else if(!isset($valeur2)) { $nResultat = 1; } else { while( ($nResultat == 0) && ($__nIndiceColonneTri<count($this->m_tabIndiceColonneTri)) ) { $nIndiceEnCours = abs($this->m_tabIndiceColonneTri[$__nIndiceColonneTri]); $colEnCours =& $this->GetColonne($nIndiceEnCours); if (isset($colEnCours)) { $nOptions = $colEnCours->m_nTriOptions; if ($nOptions & ccSansCasse) $nOptions=$nOptions-ccSansCasse+ccMinuscule; if ($nOptions & ccOrdreLexicographique) $nOptions=$nOptions+ccSansAccent; $nTypeColonne = $colEnCours->GetType(); if ( ($nTypeColonne == 20004) || ($nTypeColonne == 20005) ) { $nOptions+=ccRespecteNumerique; } } $svaleur1 = $valeur1->GetValI($nIndiceEnCours); $svaleur2 = $valeur2->GetValI($nIndiceEnCours); $svaleur1 = Fcb2d4de8($svaleur1, $nOptions); $svaleur2 = Fcb2d4de8($svaleur2, $nOptions); if ($svaleur1 != $svaleur2) { if ( ($svaleur1!='') && ($svaleur2!='') ) { if ($nOptions & ccOrdreLexicographique) { $nTailleCommune = Fd1fcabe5($svaleur1,$svaleur2,DepuisDebut); if ($nTailleCommune>0) { $subValeur1 = utf8_substr($svaleur1,$nTailleCommune); $subValeur2 = utf8_substr($svaleur2,$nTailleCommune); } else { $subValeur1 = $svaleur1; $subValeur2 = $svaleur2; } if ( utf8_substr($subValeur1,0,1) == utf8_substr($subValeur2,0,1) ) { $nResultat = 1; } elseif ( utf8_substr($subValeur1,0,1) == utf8_substr($subValeur2,0,1) ) { $nResultat = -1; } } if ($nOptions & ccRespecteNumerique) { if (($nOrdreNum = Fe556daf7($svaleur1,$svaleur2))!=0) $nResultat = $nOrdreNum; } } if ($nResultat == 0) { $nResultat = strcmp($svaleur1,$svaleur2); } } else { ++$__nIndiceColonneTri; } } } if ($__nIndiceColonneTri == count($this->m_tabIndiceColonneTri)) return 0; if($this->m_tabIndiceColonneTri[$__nIndiceColonneTri]<0) { return -$nResultat; } return $nResultat; } function AjouteColonne($sNomPHP, $sNomColonne, $sAlias, $nType, $nIndiceColonne, $sNomFichierBase = "", $sNomRubriqueParcours = "", $sFichierRelie1 = "", $sRubriqueRelie1 = "", $sRubriqueAffichee1 = "", $sFichierRelie2 = "", $sRubriqueRelie2= "", $sRubriqueAffichee2="") { global $MaPage; $Colonne = null; switch($nType) { case TYPE_COLONNE_DATE : $Colonne = new CColonneDate($sNomColonne, $this, $nIndiceColonne+1); break; case TYPE_COLONNE_HEURE : $Colonne = new CColonneHeure($sNomColonne, $this, $nIndiceColonne+1); break; case TYPE_COLONNE_NUMERIQUE : case TYPE_COLONNE_NUMERIQUE_HP : $Colonne = new CColonneNumerique($sNomColonne, $this, $nIndiceColonne+1); break; case TYPE_COLONNE_MONETAIRE : case TYPE_COLONNE_MONETAIRE_EURO : $Colonne = new CColonneMonetaire($sNomColonne, $this, $nIndiceColonne+1); break; case TYPE_COLONNE_DUREE : $Colonne = new CColonneDuree($sNomColonne, $this, $nIndiceColonne+1); break; case TYPE_COLONNE_IMAGE: $Colonne = new CColonneImage($sNomColonne,$this,$nIndiceColonne+1); break; case TYPE_COLONNE_CONTENEUR: $Colonne = new CColonneConteneur($sNomColonne,$this,$nIndiceColonne+1); break; case TYPE_COLONNE_TEXTE : default : $pclChampLie = null; $Colonne = new CColonneFormat($pclChampLie,$sNomColonne, $this, $nIndiceColonne+1); break; } $Colonne->Alias = $sAlias; $Colonne->m_sNomPHP = $sNomPHP; $Colonne->nTypeColonne = $nType; $Colonne->SetLiaisonFichier($sNomFichierBase, $sNomRubriqueParcours, $sFichierRelie1, $sRubriqueRelie1, $sRubriqueAffichee1, $sFichierRelie2, $sRubriqueRelie2, $sRubriqueAffichee2); $GLOBALS[$sNomPHP] =& $Colonne; $MaPage->WB_AjouteChamp($sNomColonne,$sAlias,$GLOBALS[$sNomPHP],$sNomPHP); $this->F144fd5f2($GLOBALS[$sNomPHP],$nIndiceColonne+1); } function F144fd5f2(&$Colonne,$nIndiceColonne = null) { if (!isset($nIndiceColonne)) { if (empty($this->TabColonnes)) { $this->TabColonnes[1] =& $Colonne; } else { $this->TabColonnes[] =& $Colonne; } } else { $nNbColonnes=count($this->TabColonnes,COUNT_NORMAL); for ($i=$nNbColonnes+1; $i<$nIndiceColonne; ++$i) $this->TabColonnes[$i] = null; $this->TabColonnes[$nIndiceColonne] =& $Colonne; } } function WB_RestaureContexte() { parent::WB_RestaureContexte(); foreach ($this->TabColonnes as $Nom => $RefColonne ) { if (isset($RefColonne->m_sNomPHP)) { $Nom = $RefColonne->m_sNomPHP; $GLOBALS[$Nom] = &$this->TabColonnes[$RefColonne->IndiceColonne]; } } } function ListeAjoute($ELEMENT = '') { if($this->F48dce54a()) { return false; } $nNouvelIndice = 1; $TabStrLigne = utf8_explode( "\n", $ELEMENT ); if ($this->m_bEstTrie) { foreach ( $TabStrLigne as $szLigne ) { $Ligne = $this->Fd135d1c5($szLigne); $nNouvelIndice = $this->Fc9bccf76($Ligne); } } else { foreach ( $TabStrLigne as $szLigne ) { $Ligne = $this->Fd135d1c5($szLigne); parent::F5eadf367($Ligne); } $nNouvelIndice = count($this->TabLigne,COUNT_NORMAL); } if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->Ff922bb0a($nNouvelIndice); } $this->Fbe50ddf6($this->GetOccurrence()); return true; } function F07f90bd2($Ligne) { $LigneTable = $this->Fd135d1c5($Ligne); $bResultat = $this->F5eadf367($LigneTable); if($bResultat) { if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->Ff922bb0a(count($this->TabLigne,COUNT_NORMAL)); } } $this->Fbe50ddf6($this->GetOccurrence()); return $bResultat; } function ListeModifie( $ELEMENT, $Indice=-1) { $this->TableModifie($ELEMENT, $Indice); } function TableModifie( $ELEMENT, $Indice=-1) { if ($Indice == -1) $Indice = $this->Valeur; $Ligne = utf8_explode("\t", $ELEMENT); $Indice = $this->F8992c0d4($Indice, $Ligne, false); if($Indice) { if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->Ff922bb0a($Indice); } } $this->Fbe50ddf6($Indice); } function TableModifieLigne() { $nNbArg = func_num_args(); $nNumLigne = func_get_arg(0); $TabArg = array(); for ($i=0;$i<$nNbArg-1;$i++) { $TabArg[$i] = func_get_arg($i+1); } $nNumLigne = $this->F8992c0d4($nNumLigne, $TabArg, false); if($nNumLigne) { if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->Ff922bb0a($nNumLigne); } } $this->Fbe50ddf6($nNumLigne); } function F8992c0d4($nIndiceLigneModif, $ContenuLigne, $bUpdateFichier = true) { $nPositionCourante = null; if(isset($this->TabLigne[$nIndiceLigneModif])) { $Ligne = &$this->TabLigne[$nIndiceLigneModif]; $bModifFichierLiaison = false; if($this->F48dce54a() && $bUpdateFichier) { if(isset($this->TabPosition[$nIndiceLigneModif])) { $nPositionCourante = $this->FichierParcours->Fd172163b($this->RubriqueParcours); if(Fe4e65a90($this->TabPosition[$nIndiceLigneModif], H_RP_CONSERVE)) { $bModifFichierLiaison = true; } } } foreach(array_keys($ContenuLigne) as $i) { if(key_exists($i+1,$this->TabColonnes)) { $Colonne = &$this->TabColonnes[$i + 1]; $Valeur = $ContenuLigne[$i]; $Ligne->TabValeur[$i] = $Valeur; if($bModifFichierLiaison && $Colonne->bAvecLiaison) { $Colonne->F5e4dcbfa($Valeur); } } } foreach(array_keys($this->TabAttribut) as $sNom) { $Attribut =& $this->TabAttribut[$sNom]; if(key_exists($Attribut->Fe5aaeca8(),$ContenuLigne)) { $Ligne->TabValeur[$Attribut->Fe5aaeca8()] = $ContenuLigne[$Attribut->Fe5aaeca8()]; } if($bModifFichierLiaison && $Attribut->bAvecLiaison) { $Attribut->F5e4dcbfa($Ligne->TabValeur[$Attribut->Fe5aaeca8()]); } } if($bModifFichierLiaison) { if($this->FichierParcours->F3f143f5b(0)) { Fbd3b8aac($this->TabPosition[$nIndiceLigneModif]); $this->TabPosition[$nIndiceLigneModif] = $this->FichierParcours->Fd172163b($this->RubriqueParcours); } } if(isset($nPositionCourante)) { Fe4e65a90($nPositionCourante); } } else { $nIndiceLigneModif = -1; } return $nIndiceLigneModif; } function ListeInsere( $ELEMENT, $Indice=-1 ) { if($this->F48dce54a()) { return false; } if (is_string($ELEMENT)) { $TabStrLigne = utf8_explode( "\n", $ELEMENT ); $TabStrLigne = array_reverse($TabStrLigne); } elseif (is_array($ELEMENT) && array_key_exists(0,$ELEMENT)) { if (is_array($ELEMENT[0])) { $TabStrLigne = $ELEMENT; } else { $TabStrLigne = array(0=>$ELEMENT); } } else return false; foreach ( $TabStrLigne as $szLigne ) { $Ligne = $this->Fd135d1c5($szLigne); if ($this->m_bEstTrie) { $this->Fc9bccf76($Ligne); } else { $this->Fcfb6d1e2($Ligne,$Indice); } } $this->Fbe50ddf6($Indice); return true; } function Fcfb6d1e2( $ELEMENT, $Indice=-1 ) { if ($Indice == -1) $Indice = $this->Valeur; if ($Indice > count($this->TabLigne,COUNT_NORMAL)) { parent::F5eadf367($ELEMENT); $Indice = count($this->TabLigne,COUNT_NORMAL); } else { if ($Indice <= 0) $Indice = 1; $BorneMax = count($this->TabLigne,COUNT_NORMAL); for($i=$BorneMax;$i>=$Indice;$i--) { $this->TabLigne[$i+1] = $this->TabLigne[$i]; } $this->TabLigne[$Indice] = &$ELEMENT; ++$this->Occurrence; } if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->Ff922bb0a($Indice); } return $Indice; } function ListeSupprime( $Indice=-1 ) { $this->TableSupprime($Indice); } function ListeCherche( $ValeurRech ) { return $this->TabColonnes[key($this->TabColonnes)]->TableCherche($ValeurRech); } function TableSelectMoins() { $deselection = func_get_args(); if (count($deselection) == 0) $this->ListeSelectMoins(); else $this->ListeSelectMoins($deselection); } function ListeSelectPlus() { $selection = func_get_args(); if(!isset($selection) || empty($selection)) { return; } parent::ListeSelectPlus($selection[0]); if(isset($this->TabPosition[$this->nLastIndex + $this->GetValeur()])) { Fe4e65a90($this->TabPosition[$this->nLastIndex + $this->GetValeur()], H_RP_CONSERVE); } if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->F8723e249($this->GetFirstIndex() + 1); } } function ListeSelect($Indice=1) { return parent::ListeSelect($Indice); } function TableSelectOccurrence() { return $this->ListeSelectOccurrence(); } function ListeOccurrence() { if($this->F48dce54a()) { return $this->TableOccurrence(TO_AFFICHEE); } else { return $this->TableOccurrence(TO_TOTAL); } } function TableAjoute($ELEMENT = '') { if($this->F48dce54a()) { return false; } call_user_func_array(array(&$this,'TableAjouteLigne'),explode("\t",$ELEMENT)); return true; } function TableAjouteLigne() { $arg = func_get_args(); $Ligne = $this->Fd135d1c5($arg); if ($this->m_bEstTrie) { $this->Fc9bccf76($Ligne); } else { parent::F5eadf367($Ligne); } if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->Ff922bb0a(count($this->TabLigne,COUNT_NORMAL)); } $nResultat = count($this->TabLigne,COUNT_NORMAL); $this->Fbe50ddf6($nResultat); return $nResultat; } function TableSupprimeSelect() { $tabIndices = $this->TabSelect; krsort($tabIndices); foreach( $tabIndices as $nIndice => $bSelect) { if (!$bSelect) continue; $this->TableSupprime($nIndice); } } function F0f529e11(&$Indice) { if($this->F48dce54a()) { if ($Indice == -1) $Indice = $this->Valeur - $this->nFirstIndex; if ($Indice < 1) return ; if ($Indice > $this->F1ac18ca4()) return NUMLIGNE_INVALIDE; $BorneMax = $this->GetLastIndex() + 1; $nIndexTabLigne = $Indice + $this->nFirstIndex; Fe4e65a90($this->nLastPosition, H_RP_CONSERVE); if($nIndexTabLigne == ($this->nLastIndex+1)) { if(isset($this->TabPosition[$nIndexTabLigne+1])) { $this->nLastPosition = $this->TabPosition[$nIndexTabLigne+1]; } else { $this->nLastPosition = -1; } } if(isset($this->TabPosition[$nIndexTabLigne])) { Fe4e65a90($this->TabPosition[$nIndexTabLigne]); if($bHSupprime=$this->FichierParcours->F8ca9a29d(0)) { --$this->nNbTotalEnreg; } for($i=$nIndexTabLigne;$i<$BorneMax;$i++) { $this->TabLigne[$i] = $this->TabLigne[$i+1]; $this->TabPosition[$i] = $this->TabPosition[$i+1]; } unset( $this->TabLigne[$BorneMax] ); unset( $this->TabPosition[$BorneMax] ); } else { for($i=$nIndexTabLigne;$i<$BorneMax;$i++) { $this->TabLigne[$i] = $this->TabLigne[$i+1]; $this->TabPosition[$i] = $this->TabPosition[$i+1]; } unset( $this->TabLigne[$BorneMax] ); unset( $this->TabPosition[$BorneMax] ); if ($Indice !== 1) { $this->FichierParcours->Fec3a1557($this->RubriqueParcours, $this->bParcoursAsc, $Indice - 1); } $LastRubrique = &$this->FichierParcours->LastRubrique; $this->FichierParcours->LastRubrique = &$this->RubriqueParcours; if($bHSupprime=$this->FichierParcours->F8ca9a29d(0)) { --$this->nNbTotalEnreg; } $this->FichierParcours->LastRubrique = &$LastRubrique; } return $Indice; } else { return parent::ListeSupprime($Indice); } } function TableSupprime($Indice=-1) { $nResultat = $this->F0f529e11($Indice); if ($nResultat === NUMLIGNE_INVALIDE) return; if($this->F48dce54a()) { $this->SetFirstIndex($this->nFirstIndex); if(isset($this->TabPosition[$Indice])) { Fe4e65a90($this->TabPosition[$Indice], H_RP_CONSERVE); } else if(isset($this->TabPosition[$Indice-1])) { Fe4e65a90($this->TabPosition[$Indice-1], H_RP_CONSERVE); } else if ($this->nLastPosition > -1) { Fe4e65a90($this->nLastPosition, H_RP_CONSERVE); } } if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->F8723e249($nResultat); } } function ListeSupprimeTout() { $this->TabLigne = array(); $this->Occurrence = 0; $this->Valeur = -1; if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->F8723e249(0); } } function TableSupprimeTout() { if($this->F48dce54a()) { return; } $this->ListeSupprimeTout(); } function TableInsere($ELEMENT, $Indice=-1) { return $this->ListeInsere($ELEMENT, $Indice); } function TableInsereLigne() { $nNbArg = func_num_args(); $nNumLigne = func_get_arg(0); $TabArg = array(); for ($i=0;$i<$nNbArg-1;$i++) { $TabArg[$i] = func_get_arg($i+1); } $Ligne = $this->Fd135d1c5($TabArg); if ($this->m_bEstTrie) { $nResultat = $this->Fc9bccf76($Ligne); } else { $nResultat = $this->Fcfb6d1e2($Ligne, $nNumLigne); } $this->Fbe50ddf6($nResultat); return $nResultat; } function TableSelectPlus() { $selection = func_get_args(); if(!isset($selection) || empty($selection)) { return; } $this->ListeSelectPlus($selection[0]); } function TableSelect($Indice = 1) { return $this->ListeSelect($Indice); } function TableOccurrence($nTypeInfo = null) { if(!isset($nTypeInfo)) { $nTypeInfo = TO_TOTAL; } switch ($nTypeInfo) { case TO_AFFICHEE : return $this->GetLastIndex() - $this->nFirstIndex + 1; case TO_VISIBLE : return $this->nMaxLignePage; case TO_TOTAL : return $this->F1ac18ca4(); case TO_COLONNE : return count($this->TabColonnes); default: return -1; } } function ListeAffiche($nPosition = TA_DEBUT) { $this->TableAffiche($nPosition); } function ZoneRepeteeAffiche($nPosition = TA_DEBUT) { $this->TableAffiche($nPosition); } function TableAffiche($nPosition = TA_DEBUT) { if($this->Feb0bfada($nPosition) && Feef890d7()) { F9402f437($this->GetNom(), $this); $this->F8723e249($this->GetFirstIndex() + 1); } } function selected( $Indice ) { if ($this->Valeur == 0) { if ($Indice == 1) return true; else return false; } return $this->Valeur == $Indice; } function nGetNbLigneAffichees() { return $this->Occurrence; } function SetValII( $Ligne, $Colonne, $Valeur ) { if($this->F48dce54a()) { if ($Ligne == -1) $Ligne = $this->Valeur; else $Ligne += $this->nFirstIndex; } $LigneTable = &$this->Fb5eda0a7( $Ligne ) ; $Cellule = &$LigneTable->Fb5eda0a7( $Colonne ) ; $Cellule->SetValeur( $Valeur ) ; $this->Fbe50ddf6($Ligne); if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->Ff922bb0a($Ligne); } } function F41b8b5af( $nIndice, $szPropriete , $Val ) { if($this->F48dce54a()) { if ($nIndice == -1) $nIndice = $this->Valeur; else $nIndice += $this->nFirstIndex; } $szMethodetoCall = F0f2ffe8c( $szPropriete ) ; $LigneTable = &$this->Fb5eda0a7($nIndice); $MethodsArray = get_class_methods(get_class($LigneTable)); $MethodsArray = array_flip(utf8_array_change_key_case(array_flip($MethodsArray),CASE_LOWER)); foreach ( $MethodsArray as $szNomMethode ) { if ( strcmp( utf8_strtolower($szMethodetoCall), utf8_strtolower($szNomMethode) ) == 0 ) return call_user_func( array(&$LigneTable,$szMethodetoCall),$Val ) ; } Erreur('ErreurGenerique',Fc34ec142("ERR_WLL"),Fc34ec142("ERR_FATAL"), FMK_ChaineConstruit(Fc34ec142("ERR_PROP_LIGNE_NONDISPO"), 'SetPropI', $szPropriete, $this->Nom)); return null; } function& F30cb3c0f( $nIndice, $szPropriete ) { if (func_num_args() == 3) { $args = func_get_args(); return $this->Fce686bd8($args[0],$args[1],$args[2]); } if($this->F48dce54a()) { if ($nIndice == -1) $nIndice = $this->Valeur; else $nIndice += $this->nFirstIndex; } $szMethodetoCall = Ff88f3cc3( $szPropriete ) ; $LigneTable =& $this->Fb5eda0a7($nIndice); $MethodsArray = get_class_methods(get_class($LigneTable)); $MethodsArray = array_flip(utf8_array_change_key_case(array_flip($MethodsArray),CASE_LOWER)); foreach ( $MethodsArray as $szNomMethode ) { if ( strcmp( utf8_strtolower($szMethodetoCall), utf8_strtolower($szNomMethode) ) == 0 ) return $LigneTable->{$szMethodetoCall}(); } Erreur('ErreurGenerique',Fc34ec142("ERR_WLL"),Fc34ec142("ERR_FATAL"), FMK_ChaineConstruit(Fc34ec142("ERR_PROP_LIGNE_NONDISPO"), 'GetPropI', $szPropriete, $this->Nom) ); return null; } function F92b0da5b( $nLigne, $nColonne, $szPropriete , $Val ) { if($this->F48dce54a()) { if ($nLigne == -1) $nLigne = $this->Valeur; else $nLigne += $this->nFirstIndex; } $szMethodetoCall = F0f2ffe8c( $szPropriete ) ; $LigneTable = &$this->Fb5eda0a7($nLigne); if (isset($LigneTable)) { $Cellule = &$LigneTable->Fb5eda0a7($nColonne); if (isset($Cellule)) { $MethodsArray = get_class_methods(get_class($Cellule)); $MethodsArray = array_flip(utf8_array_change_key_case(array_flip($MethodsArray),CASE_LOWER)); foreach ( $MethodsArray as $szNomMethode ) { if ( strcmp( utf8_strtolower($szMethodetoCall), utf8_strtolower($szNomMethode) ) == 0 ) return call_user_func( array(&$Cellule,$szMethodetoCall),$Val ) ; } Erreur('ErreurGenerique',Fc34ec142("ERR_WLL"),Fc34ec142("ERR_FATAL"), FMK_ChaineConstruit(Fc34ec142("ERR_PROP_CELLULE_NONDISPO"), 'SetPropII', $szPropriete, $this->Nom) ); } return null; } else { Erreur('ErreurWL_3_Param',"ErreurIndiceTableau",count($this->TabLigne,COUNT_NORMAL),$nLigne,$this->m_sNomWL); return null; } } function& Fce686bd8( $nLigne, $nColonne, $szPropriete ) { if($this->F48dce54a()) { if ($nLigne == -1) $nLigne = $this->Valeur; else $nLigne += $this->nFirstIndex; } $szMethodetoCall = Ff88f3cc3( $szPropriete ) ; $LigneTable =& $this->Fb5eda0a7($nLigne); $Cellule =& $LigneTable->Fb5eda0a7($nColonne); $MethodsArray = get_class_methods(get_class($Cellule)); $MethodsArray = array_flip(utf8_array_change_key_case(array_flip($MethodsArray),CASE_LOWER)); foreach ( $MethodsArray as $szNomMethode ) { if ( strcmp( utf8_strtolower($szMethodetoCall), utf8_strtolower($szNomMethode) ) == 0 ) return $Cellule->{$szMethodetoCall}(); } Erreur('ErreurGenerique',Fc34ec142("ERR_WLL"),Fc34ec142("ERR_FATAL"), FMK_ChaineConstruit(Fc34ec142("ERR_PROP_CELLULE_NONDISPO"), 'GetPropII', $szPropriete, $this->Nom) ); return null; } function F7b66f7f8() { return $this->nMaxLignePage; } function F56a8269c() { return $this->F7b66f7f8(); } function SetMaxLignePage($nNbLigne) { $this->nMaxLignePage = $nNbLigne; } function GetFirstIndex() { return $this->nFirstIndex; } function FichierVersTableMemoire($sNomFichier) { if ($this->F48dce54a()) return; if (is_string($sNomFichier)) $hfFichier = &Fbad7a601($sNomFichier); else $hfFichier = $sNomFichier; $Rub = null; if (($Rub = $this->RubriqueParcours) == null) { $hfFichier->Fad8a73f6(); $Rub = $hfFichier->BestRub; } $this->TableSupprimeTout(); $hfFichier->Fa84e48aa($Rub); do { $tabAvecIndiceChaine = $hfFichier->EnregCourant; $tabAvecIndiceEntier = array_chunk($tabAvecIndiceChaine,count($tabAvecIndiceChaine)); $this->F5eadf367( $this->Fd135d1c5($tabAvecIndiceEntier[0]) ); } while ($hfFichier->Fec3a1557($Rub)); if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->Valeur = $this->GetFirstIndex() + 1; $this->F8723e249($this->GetFirstIndex() + 1); } } function SetFirstIndex($nIndex) { $bTableVide = (count($this->TabLigne,COUNT_NORMAL) == 0); $this->nFirstIndex = $nIndex; if($this->F48dce54a()) { $bAvecPCodeFiltre = (ExecuteTraitement($this->m_sNomPHP,TRT_Filtre_Page,false,true)===true); $bAvecPCodeAffLigne = (ExecuteTraitement($this->m_sNomPHP,trtAffichageLigne,false,true)===true); if( $bAvecPCodeFiltre || (!isset($this->TabLigne[$nIndex + 1]) || ($this->F7b66f7f8()>0&&!isset($this->TabLigne[$nIndex + $this->F7b66f7f8()]))) ) { if( ( (isset($this->m_clFiltreUser) && $this->m_clFiltreUser->F6de7a78e()) || $bAvecPCodeFiltre) || ($this->nLastPosition == -1)) { $this->nNbTotalEnreg = $this->FichierParcours->F7f79f122(0, $this->sValeurRecherche, $this->RubriqueParcours, true); if(!empty($this->sValeurRecherche)) { $this->FichierParcours->Fd7f91600($this->RubriqueParcours, array($this->sValeurRecherche)); } $this->nNbTotalEnreg = $this->FichierParcours->F7f79f122(0, "", $this->RubriqueParcours, true); $this->FichierParcours->Fa84e48aa($this->RubriqueParcours, $this->bParcoursAsc, H_RESPECTE_FILTRE); if(!empty($this->sRubriqueMemorisee)) { $this->TabValeurMemorisee = array(); } $nNbEnregLu = 0; if (isset($this->m_clFiltreUser) || $bAvecPCodeFiltre) { while($this->FichierParcours->bHTrouve) { if (!$this->F689fe026() || ($bAvecPCodeFiltre&&($this->Fb40d01a9($nIndex+$nNbEnregLu+1) != nFILTRE_OK) ) ) { --$this->nNbTotalEnreg; } $this->FichierParcours->Fec3a1557($this->RubriqueParcours, $this->bParcoursAsc); ++$nNbEnregLu; } $nNbEnregLu = 0; $this->FichierParcours->Fa84e48aa($this->RubriqueParcours, $this->bParcoursAsc, H_RESPECTE_FILTRE); } } else { Fe4e65a90($this->nLastPosition, H_RP_CONSERVE); if($nIndex > $this->nLastIndex) { $this->FichierParcours->Fec3a1557($this->RubriqueParcours, $this->bParcoursAsc, $nIndex - $this->nLastIndex); } else if($nIndex < $this->nLastIndex) { $this->FichierParcours->Fec3a1557($this->RubriqueParcours, !$this->bParcoursAsc, $this->nLastIndex - $nIndex); } } $nNbEnregLu = 0; if($this->FichierParcours->bHTrouve) { $this->nLastPosition = $this->FichierParcours->Fd172163b($this->RubriqueParcours); $this->nLastIndex = $this->nFirstIndex; } $nIndiceLigne = $nIndex; $nNbEnregUtilises = 0; $nNbEnregPrecedent = 0; if (isset($this->nLimiteChargementMemoire)) { $nMaxLignes = $this->nLimiteChargementMemoire; } elseif (isset($this->Reglette)) $nMaxLignes = $this->nMaxLignePage; else $nMaxLignes = 0; $this->Fce964bfc($nIndex,0,$nMaxLignes,$nNbEnregUtilises,$bAvecPCodeFiltre,$bAvecPCodeAffLigne,$nIndiceLigne,$nNbEnregLu,$nNbEnregPrecedent,$nNbEnregUtilises); if ($this->GetType()===ID_TABLEHIERARCHIQUE) { $Colonne =& $this->TabColonnes[$this->m_nNumColonneHierarchique]; $Colonne->sFichierBase = $this->Fc2d70165(0); $Colonne->sRubriqueBase= $this->F5eaaa473(0); $Colonne->FichierLiaison =& Fbad7a601($Colonne->sFichierBase); $Colonne->RubriqueLiaison =& F2b6640f3($Colonne->FichierLiaison,$Colonne->sRubriqueBase); } if (isset($this->nLimiteChargementMemoire)&&($nMaxLignes>0)) { $this->nNbTotalEnreg = min($nMaxLignes,$nNbEnregUtilises); } } $this->Occurrence = $this->F1ac18ca4(); if(isset($this->TabPosition[$nIndex + 1])) { Fe4e65a90($this->TabPosition[$nIndex + 1], H_RP_CONSERVE); } } if($bTableVide & count($this->TabLigne,COUNT_NORMAL) > 0) { $this->F37bb1c9f(1); } } function Fce964bfc($nIndex,$nProfondeur,&$nMaxLignes,&$nNbEnregUtilises,$bAvecPCodeFiltre,$bAvecPCodeAffLigne,&$nIndiceLigne,&$nNbEnregLu,&$nNbEnregPrecedent,&$nNbEnregUtilises,$nValeurLiaison=null) { $nProfondeurMax = 0; $bTableH = ($this->GetType() == ID_TABLEHIERARCHIQUE); $pclTableH =& getRef($this); if ($bTableH && !$pclTableH->F01a71686()) { $nProfondeurMax = count($pclTableH->m_tabInfosContenu,COUNT_NORMAL)-1; } if ($nProfondeur!=0 && $nProfondeur<100 && !$pclTableH->F01a71686() && !$pclTableH->Faa2ea0ef($nProfondeur)) { return; } $pclFichierParcours =& $this->FichierParcours; $pclRubriqueParcours =& $this->RubriqueParcours; if ($bTableH) { if ($nProfondeur===0) $this->nNbTotalEnreg = 0; $pclFichierParcours =& Fbad7a601($pclTableH->Fc2d70165($nProfondeur)); $pclRubriqueParcours =& F2b6640f3($pclFichierParcours,$pclTableH->F097b10d0($nProfondeur)); if ($nProfondeur>0) { $pclRubriquePrecedente =& F2b6640f3($pclFichierParcours,$pclTableH->Fa98aecf0($nProfondeur)); $pclFichierParcours->Fcae1f5c6($pclRubriquePrecedente,array($nValeurLiaison)); $pclFichierParcours->Fa84e48aa($pclRubriqueParcours,$this->bParcoursAsc,H_RESPECTE_FILTRE); } else if ($pclTableH->F01a71686()) { $pclRubriquePrecedente =& F2b6640f3($pclFichierParcours,$pclTableH->Fa98aecf0($nProfondeur)); $pclFichierParcours->Ff83132b7($pclRubriquePrecedente,0); $pclFichierParcours->Fa84e48aa($pclRubriqueParcours,$this->bParcoursAsc,H_RESPECTE_FILTRE); } } while($pclFichierParcours->bHTrouve && ($nMaxLignes == 0 || $nNbEnregUtilises < $nMaxLignes)) { if ($bTableH) { $this->FichierParcours =& $pclFichierParcours; $this->RubriqueParcours =& $pclRubriqueParcours; } if ($this->F689fe026()) { $nResFiltre = $bAvecPCodeFiltre ? $this->Fb40d01a9($nIndex+$nNbEnregLu+1) : nFILTRE_OK; if ($nResFiltre == nFILTRE_FIN) { break; } elseif ($nResFiltre == nFILTRE_OK) { $nPosReflexive=null; if ($bAvecPCodeFiltre && $nNbEnregPrecedent<$nIndex) { ++$nNbEnregPrecedent; } else { $Ligne = array(); $nNbColonnes=0; foreach(array_keys($this->TabColonnes) as $sNom) { ++$nNbColonnes; $Colonne =& $this->TabColonnes[$sNom]; if($Colonne->bAvecLiaison) { if ($bTableH && $Colonne->IndiceColonne === $pclTableH->m_nNumColonneHierarchique) { $Colonne->sFichierBase = $pclTableH->Fc2d70165($nProfondeur); $Colonne->sRubriqueBase= $pclTableH->F5eaaa473($nProfondeur); $Colonne->FichierLiaison =& Fbad7a601($Colonne->sFichierBase); $Colonne->RubriqueLiaison =& F2b6640f3($Colonne->FichierLiaison,$Colonne->sRubriqueBase); } $Ligne[$Colonne->IndiceColonne-1] = $Colonne->F6a54070c($pclFichierParcours); } else { $Ligne[$Colonne->IndiceColonne-1] = ''; } } foreach(array_keys($this->TabAttribut) as $sNom) { $Attribut =& $this->TabAttribut[$sNom]; if (!$Attribut->bAvecLiaison && $Attribut->Fe5aaeca8() < $nNbColonnes) continue; if($Attribut->bAvecLiaison) { $Ligne[$Attribut->Fe5aaeca8()] = $Attribut->F6a54070c($pclFichierParcours); } else { $Ligne[$Attribut->Fe5aaeca8()] = ''; } } if(isset($Ligne)) { $this->TabLigne[$nIndiceLigne + 1] = $this->Fd135d1c5($Ligne); $this->TabLigne[$nIndiceLigne + 1]->m_nProfondeur = $nProfondeur; $nPosReflexive = $this->TabPosition[$nIndiceLigne + 1] = $pclFichierParcours->Fd172163b($pclRubriqueParcours); if ($bAvecPCodeAffLigne)$this->Fbe50ddf6($nIndiceLigne + 1); ++$nIndiceLigne; if(!empty($this->sRubriqueMemorisee)) { $this->TabValeurMemorisee[$nIndiceLigne] = $pclFichierParcours->EnregCourant[$this->sRubriqueMemorisee]; } ++$nNbEnregUtilises; if ($bTableH) ++$this->nNbTotalEnreg; } } if ($bTableH) { $pclRubriqueSuivante =& F2b6640f3($pclFichierParcours,$pclTableH->F6122fefc($nProfondeur)); $this->Fce964bfc($nIndex,$nProfondeur+1,$nMaxLignes,$nNbEnregUtilises,$bAvecPCodeFiltre,$bAvecPCodeAffLigne,$nIndiceLigne,$nNbEnregLu,$nNbEnregPrecedent,$nNbEnregUtilises,$pclRubriqueSuivante->GetValeur()); $this->FichierParcours =& $pclFichierParcours; $this->RubriqueParcours =& $pclRubriqueParcours; if (isset($nPosReflexive) && $pclTableH->F01a71686()) { Fe4e65a90($nPosReflexive,H_RP_CONSERVE | H_RP_FILTRE); } } } } if ($nMaxLignes == 0 || $nNbEnregUtilises < $nMaxLignes) { $pclFichierParcours->Fec3a1557($pclRubriqueParcours, $this->bParcoursAsc); ++$nNbEnregLu; } } } function GetLastIndex() { if($this->nMaxLignePage == 0) { return $this->F1ac18ca4() - 1; } $nMin = min($this->F1ac18ca4(), $this->nFirstIndex + $this->nMaxLignePage); return $nMin - 1; } function F1ac18ca4() { if($this->nNbTotalEnreg > -1) { return $this->nNbTotalEnreg; } return count($this->TabLigne,COUNT_NORMAL); } function GetNbEnregAffiche() { if($this->nMaxLignePage == 0) { return $this->F1ac18ca4(); } return min($this->nMaxLignePage, $this->F1ac18ca4() - $this->nFirstIndex); } function SetSourceRemplissage($sFichierParcours, $sRubriqueParcours=null, $sRubriqueAffichee=null, $sRubriqueMemorisee=null, $bParcoursAsc=null, $sValeurRecherche=null, $nNbMaxLigne=null) { F01ae1302(); $this->FichierParcours = &Fbad7a601($sFichierParcours); if(!empty($sRubriqueParcours)) { $this->RubriqueParcours = $sRubriqueParcours; } $this->sRubriqueMemorisee = $sRubriqueMemorisee; $this->bParcoursAsc = $bParcoursAsc; $this->sValeurRecherche = $sValeurRecherche; } function InitRemplissage() { if (false === $this->F7f821e68()) return; $this->SetFirstIndex(0); $this->bInitRemplissage = true; } function SetValeur($NewVal) { $this->Valeur = (int)($NewVal); if(Feef890d7()) { F9402f437($this->GetNom(), $this); $this->F8723e249($this->GetFirstIndex() + 1); } } function& GetValeur() { if(!empty($this->sRubriqueMemorisee) && isset($this->TabValeurMemorisee) && array_key_exists($this->Valeur,$this->TabValeurMemorisee)) { $nRetour = $this->TabValeurMemorisee[$this->Valeur]; } else { $nRetour = $this->F63ff45c7(); } return $nRetour; } function F7c500a79($nIndiceColonne = 1, $bAsc = true) { $Colonne = $this->GetColonne($nIndiceColonne); if(isset($Colonne)) { $sNomRubrique = $Colonne->sRubriqueBase; if(isset($sNomRubrique) && !empty($sNomRubrique)) { $cSens = ($bAsc) ? '' : '-'; $this->SetRubriqueParcourue($cSens.$sNomRubrique); $this->nSensTri = ($bAsc) ? 1 : 0; } } else return false; return true; } function Fe67060d9($nIndiceColonne, $bAsc) { if($this->nIndiceColonneTri == $nIndiceColonne && $this->nSensTri == ($bAsc ? 1 : 0)) { return; } if($this->F48dce54a()) { if ($this->F7c500a79($nIndiceColonne,$bAsc)) { $this->nIndiceColonneTri = $nIndiceColonne; $this->nSensTri = ($bAsc ? 1 : 0); } } else { if(!isset($this->TabLigne) || count($this->TabLigne,COUNT_NORMAL) == 0) { return; } global $_bSensAsc, $_nIndiceColonneTri; $_bSensAsc = $bAsc; $_nIndiceColonneTri = $nIndiceColonne; $temp = $this->TabLigne; $this->m_nTriOptions = triTableDéfaut; $this->m_bTriSens = $bAsc; $this->m_tabIndiceColonneTri = array(); $bColonneDeRuptureDejaTriee=false; foreach (array_keys($this->TabRupture) as $nIndiceRupture) { $pclRupture =& $this->TabRupture[$nIndiceRupture][ZR_RUPTURE_ATTRIBUT]; $this->m_tabIndiceColonneTri[] = $pclRupture->F418f91ca() * (( ($bColonneDeRuptureDejaTriee=($nIndiceColonne==$pclRupture->F418f91ca())) && !$bAsc) ? -1 : 1); } if (!$bColonneDeRuptureDejaTriee) { $this->m_tabIndiceColonneTri[] = ($bAsc ? 1 : -1) * $nIndiceColonne; } if(utf8_usort($temp, array(&$this,"_procCompareLigne_Table"))) { $this->TabLigne = array(); $nIndex = 1; foreach($temp as $valeur) { $this->TabLigne[$nIndex] = $valeur; ++$nIndex; } $this->nIndiceColonneTri = $nIndiceColonne; $this->nSensTri = ($bAsc ? 1 : 0); } } unset($this->m_tabIndiceColonneTri); $this->m_tabIndiceColonneTri = array(); $this->m_bEstTrie = false; } function F03b82a62($nLigne=null) { if (!isset($nLigne)) $nLigne=$this->ListeSelect(); if($this->F48dce54a()) { if(isset($this->TabPosition[$nLigne])) { Fe4e65a90($this->TabPosition[$nLigne], H_RP_CONSERVE); } } $this->Fc1a6d5f6(trtSelection); } function F4bdd5276($Indice,$nIndiceVisible) { $sResultat = ''; $sResultat .= '<DEBUT><![CDATA[]]></DEBUT>'; $sResultat .= '<CORPS><![CDATA['; $sResultat .= call_user_func_array('construireLigneTable_'.$this->F960e3ffe(), array(&$this, $Indice, &$nIndiceVisible)); $sResultat .= ']]></CORPS>'; $sResultat .= '<FIN><![CDATA[]]></FIN>'; return $sResultat; } function Fac671d6a($nNumCol, $nTypeFiltre, $xValeurFiltre, $bAvecFormatage=true) { if (!isset($this->m_clFiltreUser)) $this->m_clFiltreUser = new CFiltreTable(); if ($this->F48dce54a()&&$bAvecFormatage) { foreach(array_keys($this->TabColonnes) as $sNom) { $Colonne =& $this->TabColonnes[$sNom]; if($Colonne->IndiceColonne == $nNumCol) { if (isset($Colonne->RubriqueLiaison)) { $xValeurFiltre = $this->FichierParcours->F137bdb94($Colonne->RubriqueLiaison,$xValeurFiltre); } break; } } } $this->m_clFiltreUser->F667a231e($nNumCol, $nTypeFiltre, $xValeurFiltre); $this->Fbe9e7c64(); } function F689fe026() { $bTrouve = false; if (!isset($this->m_clFiltreUser)) return true; $i=0; while(isset($this->m_clFiltreUser->m_clListeFiltre[$i])) { $pclFiltre =& $this->m_clFiltreUser->m_clListeFiltre[$i]; $bTrouve = false; foreach(array_keys($this->TabColonnes) as $sNom) { $Colonne =& $this->TabColonnes[$sNom]; if($Colonne->IndiceColonne == $pclFiltre->nNumCol) { $xValeurATester = $Colonne->F6a54070c($this->FichierParcours); if (!$pclFiltre->F47e324be($xValeurATester)) return false; $bTrouve = true; } } ++$i; } return true; } function Fbe9e7c64() { if ($this->F48dce54a()) { $this->InitRemplissage(); return; } if ($this->m_clFiltreUser->F6de7a78e() && !$this->m_bTabValeurSauveActif) { $this->F4751428b(); } else if (!$this->m_clFiltreUser->F6de7a78e() && $this->m_bTabValeurSauveActif) { $this->F426af9f6(); } if ($this->m_clFiltreUser->F6de7a78e()) { $this->TabLigne = array(); $this->Occurrence = 0; $this->Valeur = -1; $nNbLigneSauve = count($this->m_clTabValeurSauveSiFiltre,COUNT_NORMAL); $tabLignesVerifiantFiltre = array(); for ($i=1;$i<=$nNbLigneSauve;$i++) { if ($this->m_clFiltreUser->Fa54e0722($this->m_clTabValeurSauveSiFiltre[$i], $this) !== false) { $nOffsetParent = 0; if (is_object($this->m_clTabValeurSauveSiFiltre[$i]) && $this->m_clTabValeurSauveSiFiltre[$i]->m_nProfondeur>0) { $nOffsetParent = 1; while( isset($this->m_clTabValeurSauveSiFiltre[$i-$nOffsetParent]) && $this->m_clTabValeurSauveSiFiltre[$i-$nOffsetParent]->m_nProfondeur>0 ) ++$nOffsetParent; } for($j=$i-$nOffsetParent; $j<=$i; ++$j) $tabLignesVerifiantFiltre[] = $j; } } foreach (array_keys(array_flip($tabLignesVerifiantFiltre)) as $nIndice) $this->F5eadf367($this->m_clTabValeurSauveSiFiltre[$nIndice]); } if (($this->GetOccurrence()>0)&&($this->Valeur!=-1)) { $this->F03b82a62($this->Valeur); } } function F4751428b() { if ($this->m_bTabValeurSauveActif) return; $nNbValeur = count($this->m_clTabValeurSauveSiFiltre,COUNT_NORMAL); $i=1; while(isset($this->m_clTabValeurSauveSiFiltre[$i])) unset($this->m_clTabValeurSauveSiFiltre[$i++]); unset($this->m_clTabValeurSauveSiFiltre); $this->m_clTabValeurSauveSiFiltre = null; $this->m_bTabValeurSauveActif = true; $nNbLigne = $this->GetOccurrence(); if ($nNbLigne === 0) return; $this->m_clTabValeurSauveSiFiltre = array(); for ($i = 1; $i <= $nNbLigne; $i++) { $this->m_clTabValeurSauveSiFiltre[$i] = $this->TabLigne[$i]; } $this->TabLigne = array(); $this->Occurrence = 0; $this->Valeur = -1; } function F426af9f6() { if (!$this->m_bTabValeurSauveActif) return; $this->TabLigne = array(); $this->Occurrence = 0; $this->Valeur = -1; $nNbLigneSauve = count($this->m_clTabValeurSauveSiFiltre,COUNT_NORMAL); for ($i=1;$i<=$nNbLigneSauve;$i++) { $this->F5eadf367($this->m_clTabValeurSauveSiFiltre[$i]); } $i=1; while(isset($this->m_clTabValeurSauveSiFiltre[$i])) unset($this->m_clTabValeurSauveSiFiltre[$i++]); unset($this->m_clTabValeurSauveSiFiltre); $this->m_clTabValeurSauveSiFiltre = null; $this->m_bTabValeurSauveActif = false; } function F52613228() { if (!isset($this->m_clFiltreUser)) return; $this->m_clFiltreUser->F2f1df2f6(); $this->Fbe9e7c64(); } function F87f3f9f2($nNumCol) { if (!isset($this->m_clFiltreUser)) return; $this->m_clFiltreUser->F89b2d7dc($nNumCol); $this->Fbe9e7c64(); } function Ff8a71d2b($rclColonneDeTable, $bAJAX) { $bExecuteCodeColonne = false; switch ($rclColonneDeTable->m_eAction) { case Aucune: $bExecuteCodeColonne = false; break; case CodeClicTable: $bExecuteCodeColonne = true; break; case CodeClic: case CodeClicBouton: { $pclBouton =& $rclColonneDeTable->F3bc5682e(); if (isset($pclBouton)) { $pclBouton->Fc1a6d5f6(trtClic); return true; } } $bExecuteCodeColonne = false; break; default: $bExecuteCodeColonne = false; break; } if (false!= $bExecuteCodeColonne) return $rclColonneDeTable->Fc1a6d5f6(TRT_clic_Page); else return true; } } function Ff7b3b2f0($nTypeFiltre) { return ($nTypeFiltre>=31978) && ($nTypeFiltre<=31989); } class CFiltreTable { var $m_clListeFiltre = array(); function F667a231e($nNumCol, $nTypeFiltre, $xValeurFiltre) { $this->m_clListeFiltre[] = new STInfoFiltre($nNumCol, $nTypeFiltre, $xValeurFiltre); } function F6de7a78e() { return count($this->m_clListeFiltre)>0; } function F2f1df2f6() { $i=0; while(isset($this->m_clListeFiltre[$i])) unset($this->m_clListeFiltre[$i++]); unset($this->m_clListeFiltre); $this->m_clListeFiltre = array(); } function F89b2d7dc($nCol) { $i=0; while(isset($this->m_clListeFiltre[$i])) { if ($this->m_clListeFiltre[$i]->nNumCol === $nCol) { unset($this->m_clListeFiltre[$i]); break; } ++$i; } $this->m_clListeFiltre = array_values($this->m_clListeFiltre); } function Fa54e0722($Ligne,&$pclTable) { $i=0; while(isset($this->m_clListeFiltre[$i])) { $pclFiltre =& $this->m_clListeFiltre[$i]; if (isset($pclTable->TabColonnes[$pclFiltre->nNumCol])) { $Colonne =& $pclTable->TabColonnes[$pclFiltre->nNumCol]; $xValeurATester = (is_array($Ligne)) ? $Ligne[$Colonne->IndiceColonne] : $Ligne->TabValeur[$Colonne->IndiceColonne-1]; if (!$pclFiltre->F47e324be($xValeurATester)) return false; } ++$i; } return true; } } class STInfoFiltre { var $nNumCol = -1; var $nTypeFiltre; var $clValFiltre; function STInfoFiltre($nNumCol,$nTypeFiltre,$clValFiltre) { $this->nNumCol = $nNumCol; $this->nTypeFiltre = $nTypeFiltre; $this->clValFiltre = $clValFiltre; } function F47e324be($xValeurATester) { $clValFiltre = $this->clValFiltre; $clValTest = $xValeurATester; $nTypeFiltre = $this->nTypeFiltre; if (empty($clValFiltre)) return true; if (empty($xValeurATester)) return false; $bOK=true; switch ( $nTypeFiltre) { case 31978: $bOK = (Fa4014e81( $clValTest, $clValFiltre ) === 0); break; case 31979: $bOK = (strcmp(Fd2078f0c( $clValTest, utf8_strlen($clValFiltre) ),$clValFiltre)===0); break; case 31980: $bOK = (utf8_strpos( $clValTest, $clValFiltre ) !== false); break; case 31981: $bOK = (strcmp(Fbe774e59( $clValTest, utf8_strlen($clValTest)-utf8_strlen($clValFiltre)+1 ),$clValFiltre)===0); break; case 31982: $bOK = (Fa4014e81( $clValTest, $clValFiltre ) !== 0); break; case 31983: $bOK = (strcmp(Fd2078f0c( $clValTest, utf8_strlen($clValFiltre) ),$clValFiltre)!==0); break; case 31984: $bOK = (utf8_strpos( $clValTest, $clValFiltre ) === false); break; case 31985: $bOK = (strcmp(Fbe774e59( $clValTest, utf8_strlen($clValTest)-utf8_strlen($clValFiltre)+1 ),$clValFiltre)!==0); break; case 31986: $bOK = (Fa4014e81( $clValTest, $clValFiltre ) > 0); break; case 31987: $bOK = (Fa4014e81( $clValTest, $clValFiltre ) >= 0); break; case 31988: $bOK = (Fa4014e81( $clValTest, $clValFiltre ) < 0); break; case 31989: $bOK = (Fa4014e81( $clValTest, $clValFiltre ) <= 0); break; default: $bOK = false; } return $bOK; } } function TableActiveFiltre(&$pclColonne,$nTypeFiltre,$xValeurFiltre) { if (is_object($pclColonne)) { if (!$pclColonne->F70cea20e()) { $sNomColonne = VersChaine($pclColonne); } } else { $sNomColonne = $pclColonne; } if (isset($sNomColonne)) { $pclColonne =& F9abbf335($sNomColonne,IND_CHAMP); } if (!isset($pclColonne->Table)) { Fe81a7f9e('ERR_NO_COLONNE', $pclColonne->Fd464306b(), F3b9ec4ca($pclColonne)); return; } if (Ff7b3b2f0($nTypeFiltre) === false) { Fe81a7f9e('ERR_BAD_CONSTANT', $nTypeFiltre, 'FCT_TABLE_TABLEACTIVEFILTRE'); return; } $pclTable =& F9abbf335($pclColonne->Table,IND_CHAMP); $nNumCol = $pclColonne->IndiceColonne; $pclTable->F87f3f9f2($nNumCol); $pclTable->Fac671d6a($nNumCol, $nTypeFiltre, $xValeurFiltre, false); $pclTable->Feb0bfada(TA_DEBUT); $pclColonne->m_nFiltreEncours=$nTypeFiltre; if(Feef890d7()) { F9402f437($pclTable->GetNom(), $pclTable); } } function TableDesactiveFiltre(&$pclColonne) { if (is_object($pclColonne)) { if (!$pclColonne->F70cea20e()) { $sNomColonne = VersChaine($pclColonne); } } else { $sNomColonne = $pclColonne; } if (isset($sNomColonne)) { $pclColonne =& F9abbf335($sNomColonne,IND_CHAMP); } if (!isset($pclColonne)) { Fe81a7f9e('ERR_NO_COLONNE', $pclColonne->Nom, F3b9ec4ca($pclColonne)); return; } switch ($pclColonne->GetType()) { case TYPE_CHAMP_ZR: case TYPE_CHAMP_ZRLINEAIRE: case TYPE_CHAMP_TABLE: { $pclTable =& $pclColonne; $pclTable->F52613228(); } break; case 20001: case 20002: case 20003: case 20004: case 20005: case 20006: { $pclTable =& F9abbf335($pclColonne->Table,IND_CHAMP); $nNumCol = $pclColonne->IndiceColonne; $pclTable->F87f3f9f2($nNumCol); } break; default: Fe81a7f9e('ERR_NO_COLONNE', $pclColonne->Fd464306b(), F3b9ec4ca($pclColonne)); return; } $pclTable->Feb0bfada(TA_DEBUT); $pclColonne->m_nFiltreEncours=0; if(Feef890d7()) { F9402f437($pclTable->GetNom(), $pclTable); } } ?>