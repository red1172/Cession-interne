<?php
//20.0.56.0 IHM/Champ/Image/Image.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 if (!defined('__INC__IHM/Champ/Champ.php')) { define('__INC__IHM/Champ/Champ.php',true); include_once(WB_INCLUDE_PATH.'WD7c939e6867492a5e5416bd4b4327fac0.php'); } if (!defined('__INC__FMK/Dessin.php')) { define('__INC__FMK/Dessin.php',true); include_once(WB_INCLUDE_PATH.'WD5951fddf83c5123cd2f610985503d9e2.php'); } if (!defined('__INC__FMK/Dessin/Image/Gd.php')) { define('__INC__FMK/Dessin/Image/Gd.php',true); include_once(WB_INCLUDE_PATH.'WDedf4e7d3e10c54021a3e363a59ce7702.php'); } if (!defined('__INC__FMK/Dessin/Pixel.php')) { define('__INC__FMK/Dessin/Pixel.php',true); include_once(WB_INCLUDE_PATH.'WDd83a61888ef9d1ce07cad1a92c22ef3e.php'); } if (!defined('__INC__FMK/Dessin/Couleur.php')) { define('__INC__FMK/Dessin/Couleur.php',true); include_once(WB_INCLUDE_PATH.'WD2521e084cbaf10ef8d5f4ede4dc6baa2.php'); } if (!defined('__INC__FMK/Compat/xsystem.php')) { define('__INC__FMK/Compat/xsystem.php',true); include_once(WB_INCLUDE_PATH.'WD14183cc5dbbd843da831afdd3bf106e4.php'); } FMK_CHarge('FMK/Disque.php'); class CControleurChampImage_Web extends CControleurChamp_Web { function CControleurChampImage_Web ( &$pclModele) { parent::CControleurChamp_Web($pclModele); } function Fb29dfdd9($pszDonneesUTF8) { $pszDonneesUTF8 = parent::Fb29dfdd9($pszDonneesUTF8); if (false !== $this->m_pclModele->m_bDefilementAutomatique) { if (0 === utf8_strncmp($pszDonneesUTF8, szJS_TRUE, utf8_strlen(szJS_TRUE))) { $this->m_pclModele->m_bDefilementActif = true; } else if (0 === utf8_strncmp($pszDonneesUTF8, szJS_FALSE, utf8_strlen(szJS_FALSE))) { $this->m_pclModele->m_bDefilementActif = false; } else { } if (false === $this->Fca9da5c1(true, $pszDonneesUTF8)) return null; $this->m_pclModele->F11cba892(intval($pszDonneesUTF8)); } else { } return $pszDonneesUTF8; } } class CImage extends CChamp { var $m_fmkImageGD = null; var $_m_nOptionsDebutDessin = -1; var $CouleurFondDessin = wlCouleurDefaut; var $nModeAffichage = null; var $nTransparence = null; var $eTypeImage; var $sConteneurAliasOuFond = wlCouleurDefaut; var $bForceTailleReelle = false; var $m_bDefilementAutomatique; var $m_bDefilementLancementAutomatique; var $m_bDefilementModeRepertoire; var $m_nDefilementTemporisation; var $m_bDefilementTriActif; var $m_nDefilementTriOptions; var $m_tabDefilementImage; var $m_bDefilementActif; var $m_nDefilementPosition; function CImage($nLargeur = 1, $nHauteur = 1, $CouleurFond = wlCouleurDefaut) { parent::CChamp(); global $_GLOBAL_IMAGE_COURANTE; $_GLOBAL_IMAGE_COURANTE = $this; if ($nLargeur==null) $nLargeur = 1; if ($nHauteur==null) $nHauteur = 1; $this->m_nLargeur = $nLargeur; $this->m_nHauteur = $nHauteur; $this->CouleurFondDessin = $CouleurFond; $this->m_bDefilementAutomatique = false; $this->m_bDefilementLancementAutomatique = true; $this->m_bDefilementModeRepertoire = true; $this->m_tabDefilementImage = array(); $this->m_bDefilementActif = false; $this->m_nDefilementPosition = 0; $this->m_bDefilementTriActif = false; $this->m_nDefilementTriOptions = -1; $this->m_nDefilementTemporisation = 1000; } function lierVM($sNomVM, $sNomWL, $sNomPHP) { parent::lierVM($sNomVM, $sNomWL, $sNomPHP); global $MaPage; if (isset($MaPage) && (!$MaPage->bAvecContexte) && ($this->eTypeImage===2)) { Fe81a7f9e('ERR_SANS_CONTEXTE_IMAGE_GENEREE',$sNomWL); return; } } function F12828e6d( $eTypeVue) { return $this->F0198de68('CVueChampImage_Web' , $eTypeVue); } function F56660bf0( $eTypeControleur) { return $this->Fea7a1f04('CControleurChampImage_Web' , $eTypeControleur); } function F7593ffad($dwFlags) { parent::F7593ffad($dwFlags); switch ($this->eTypeImage) { case 2: $cdependancesPHP = FMK_Dependance(); if (isset($cdependancesPHP)) { if (!$cdependancesPHP->F0b5f8f06('gd')) { Fe81a7f9e('ERR_EXTENSION_GD_ABSENTE'); } } break; } } function Fb560a68a($dwFlags) { parent::Fb560a68a($dwFlags); $this->m_bDefilementActif = $this->m_bDefilementAutomatique && $this->m_bDefilementLancementAutomatique; } function Fb3dcf02b($dwFlags) { if (parent::Fb3dcf02b($dwFlags) === false) return false; return true; } function Fbc7a07d8($eDefilement) { switch ($eDefilement) { case 0: $this->m_bDefilementActif = true; break; case 1: $this->F4a906f12($this->Valeur, true, false); $this->Fbc7a07d8(0); break; case 2: { $nPosition = $this->m_nDefilementPosition; $this->Fbc7a07d8(1); $this->m_nDefilementPosition = $nPosition; } break; case 3: $this->m_bDefilementActif = false; break; case 4: $this->m_nDefilementPosition = 0; break; case 5: $this->F11cba892($this->m_nDefilementPosition - 1); break; case 6: $this->F11cba892($this->m_nDefilementPosition + 1); break; case 7: $this->F11cba892(count($this->m_tabDefilementImage,COUNT_NORMAL) - 1); break; default: break; } } function F11cba892($nPosition) { $nPositionOccurrence = count($this->m_tabDefilementImage,COUNT_NORMAL); if (0 === $nPositionOccurrence) { $this->m_nDefilementPosition = 0; } elseif (0 > $nPosition) { $this->m_nDefilementPosition = intval( $nPosition + intval($nPosition / $nPositionOccurrence) * $nPositionOccurrence ); if ($this->m_nDefilementPosition < 0) { $this->m_nDefilementPosition += $nPositionOccurrence; } } else if ($nPositionOccurrence <= $nPosition) { $this->m_nDefilementPosition = 0; } else { $this->m_nDefilementPosition = $nPosition; } } function F4c8b7365() { $nCouleurFond = $this->GetCouleurFond(); if (isset($nCouleurFond)&&($nCouleurFond!=Transparent)) return $nCouleurFond; if (is_numeric($this->sConteneurAliasOuFond)) { if ($this->sConteneurAliasOuFond==Transparent) return wlCouleurDefaut; return $this->sConteneurAliasOuFond; } global $MaPage; $pclChamp = ($this->sConteneurAliasOuFond==$MaPage->m_sNomPHP) ? $MaPage : $MaPage->TabChamp[$this->sConteneurAliasOuFond]; if (!isset($pclChamp)) return wlCouleurDefaut; if (Fba68c6f1($pclChamp)) { return $pclChamp->GetCouleurLigne($pclChamp->m_nLigneAffichee,false); } return $pclChamp->GetCouleurFond(); } function& GetPoliceTaille() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICETAILLE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceTaille($nPoliceTaille) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICETAILLE"),F3b9ec4ca($this)); } function& GetPoliceSoulignee() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICESOULIGNEE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceSoulignee($bPoliceSoulignee) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICESOULIGNEE"),F3b9ec4ca($this)); } function& GetPoliceNom() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICENOM"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceNom($sPoliceNom) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICENOM"),F3b9ec4ca($this));; } function& GetPoliceItalique() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEITALIQUE"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceItalique($bPoliceItalique) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEITALIQUE"),F3b9ec4ca($this)); } function& GetPoliceGras() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEGRAS"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetPoliceGras($bPoliceGras) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_POLICEGRAS"),F3b9ec4ca($this)); } function& GetCadrageVertical() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_CADRAGEVERTICAL"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetCadrageVertical($nCadrageVertical) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_CADRAGEVERTICAL"),F3b9ec4ca($this)); } function& GetCadrageHorizontal() { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_CADRAGEHORIZONTAL"),F3b9ec4ca($this)); return RetourErreur_Entier; } function SetCadrageHorizontal($nCadrageHorizontal) { Erreur('ErreurProprieteInconnue','',Fc34ec142("PROP_NOM_CADRAGEHORIZONTAL"),F3b9ec4ca($this)); } function& GetValeur() { if(!isset($this->Valeur)) { $sRetour = ""; return $sRetour; } return $this->Valeur; } function& GetValeurAffichee() { if (false === $this->m_bDefilementAutomatique) { return $this->GetValeur(); } else { $this->F11cba892($this->m_nDefilementPosition); if (0 < count($this->m_tabDefilementImage,COUNT_NORMAL)) { return $this->m_tabDefilementImage[$this->m_nDefilementPosition]; } else { return getRef(''); } } } function Fb2784a04() { switch($this->eTypeImage) { case 0: case 1: { return $this->GetValeur(); } break; case 2: { if ($this->GetValeurHTML()=='') return ''; FMK_Charge('WL/IMG/Img.php' ); return Fa266c493($this->m_fmkImageGD->F8ddf8952(),array('retour'=>true)); } break; default: return $this->GetValeur(); } } function SetValeur($Valeur) { if (false === $this->m_bDefilementAutomatique) { $this->Fe98976d5($Valeur); } else { XVERIFY( $this->F4a906f12($Valeur) ); } } function& GetImage() { return $this->GetValeurAffichee(); } function GetImageHTML($TypeConvertion=0) { return $this->GetValeurHTML($TypeConvertion); } function SetImage($pImage) { $this->SetValeur( $pImage ); } function F4a906f12($clValeur) { unset($this->m_tabDefilementImage); $this->m_tabDefilementImage = array(); if (false === is_string($clValeur)) { Fe81a7f9e('ERR_PROPRIETE_CHAINE','PROP_NOM_VALEUR',$this->GetNom(),$this->F3b9ec4ca()); return false; } if ('' === $clValeur) { return $this->Fe98976d5($clValeur); } $bRes = false; if (false != $this->m_bDefilementModeRepertoire) { $bRes = $this->F64ad5b9b($clValeur); } else { $bRes = $this->Fb1e89dc5($clValeur); } if (false === $bRes) { return $this->Fe98976d5($clValeur); } $this->Valeur = $clValeur; $this->F45d5b2a7(); $this->m_nDefilementPosition = 0; if(Feef890d7()) { F4c16799e($this->m_sNomPHP, PROP_INVALID_MIN); } return true; } function F64ad5b9b($rcszValeur) { if (false !== utf8_strpos($rcszValeur,RC)) { Fe81a7f9e('ERR_PROPRIETE_FORMAT','PROP_NOM_VALEUR',$this->GetNom(),$this->F3b9ec4ca()); return false; } $cszCheminDisqueAvecFiltre = $cszCheminRepertoireWEB = ''; $bAvecFiltre = false; if (false === $this->F2b2ddd9c($rcszValeur, $cszCheminDisqueAvecFiltre, $cszCheminRepertoireWEB, $bAvecFiltre)) return false; unset($this->m_tabDefilementImage); $this->m_tabDefilementImage= array(); $tabDefilementImage = utf8_explode("\n",str_replace("\r","\n",str_replace("\r\n","\n",Fb459705a($cszCheminDisqueAvecFiltre,null,0,flPremierFichier,false)))); global $gszRepLangue; if (isset($gszRepLangue)) { $sCheminPrefixe= '/'; } else { $sCheminPrefixe = ('/' . (basename(F5a48be2d()) . '/')); } $sImage = current($tabDefilementImage); $cszCheminRepertoireWEB_Parent=null; while($sImage!==false && (utf8_strpos($sImage,$cszCheminRepertoireWEB)!==0) && ($cszCheminRepertoireWEB!=($cszCheminRepertoireWEB_Parent=dirname($cszCheminRepertoireWEB)))) { $cszCheminRepertoireWEB = F0ac3fb91($cszCheminRepertoireWEB_Parent); if ($sCheminPrefixe==='/' || $sCheminPrefixe[0]=='.') { $sCheminPrefixe.='../'; } else { $sCheminPrefixe = utf8_substr($sCheminPrefixe,0,utf8_strlen($sCheminPrefixe)-utf8_strpos(utf8_strrev($sCheminPrefixe),'/',1)); } } foreach ($tabDefilementImage as $sImage) { if ($bAvecFiltre || utf8_strpos('.png.jpg.jpeg.gif.bmp.',utf8_strtolower(F7816de1e($sImage,fExtension)))!==false) { $this->m_tabDefilementImage[] = utf8_substr(utf8_str_replace('\\','/',utf8_str_replace($cszCheminRepertoireWEB,$sCheminPrefixe,$sImage)),1); } } return true; } function F2b2ddd9c($cszValeur, &$rcszCheminDisqueAvecFiltre, &$rcszCheminRepertoireWEB, &$bAvecFiltre) { $rcszCheminRepertoireWEB = F0ac3fb91(F8df1dd0e()); $sFiltre = '*'; $nPosFiltre = utf8_strpos($cszValeur,'*'); if ($nPosFiltre!==false) { $sFiltre = utf8_substr($cszValeur,$nPosFiltre); $bAvecFiltre = true; $cszValeur = utf8_substr($cszValeur,0,$nPosFiltre); } else { $bAvecFiltre = false; } if (!F19a62e7a($cszValeur)) { $rcszCheminDisqueAvecFiltre = F8df7b692(realpath(F9486bf1a($cszValeur))); } else { $rcszCheminDisqueAvecFiltre = $cszValeur; } if (!is_dir(F9486bf1a($cszValeur))) { $rcszCheminDisqueAvecFiltre = F8df7b692(dirname(F9486bf1a($cszValeur))); if (!is_dir(F9486bf1a($rcszCheminDisqueAvecFiltre))) { return false; } $rcszCheminDisqueAvecFiltre = F8df7b692(realpath(F9486bf1a($rcszCheminDisqueAvecFiltre))); } $rcszCheminDisqueAvecFiltre = F0ac3fb91($rcszCheminDisqueAvecFiltre) . $sFiltre; return true; } function Fb1e89dc5($cszValeur) { if (false !== empty($cszValeur)) return false; $this->m_tabDefilementImage = utf8_explode("\n",utf8_str_replace(RC,"\n",$cszValeur)); global $gszRepLangue; $sCheminPrefixe = (isset($gszRepLangue)) ? '' : utf8_str_replace('\\','/',basename(F5a48be2d())).'/'; $cszCheminRepertoireWEB = utf8_str_replace('\\','/',F0ac3fb91(realpath('.'))); foreach ($this->m_tabDefilementImage as $nImage => $sImage) { $sImage = utf8_str_replace('\\','/',$sImage); if (!F19a62e7a($sImage)) { $sImage = $sCheminPrefixe . $sImage; } else { $sImage = utf8_str_replace($cszCheminRepertoireWEB,$sCheminPrefixe,$sImage); } $this->m_tabDefilementImage[$nImage] = $sImage; } return true; } function F45d5b2a7() { if (false !== $this->m_bDefilementTriActif) { Ff3c49668($this->m_tabDefilementImage,TT_FONCTION_INTERNE,array(array(&$this, 'F32579987'))); } } function Fe98976d5($Valeur) { if (($this->eTypeImage===2)) { DebutErreurAttendue(); $bEstUnFichier = file_exists(F9486bf1a($Valeur)); FinErreurAttendue(); { if ($this->dDebutDessin(dEffacer,false,true)) { if ($bEstUnFichier) { $this->m_fmkImageGD->Faeaf760a($Valeur,$this->bForceTailleReelle,$this->nTransparence,$this->nModeAffichage,$this->F4c8b7365()); parent::SetValeur($Valeur); } else { if ($this->m_fmkImageGD->F0e527c40($Valeur,$this->bForceTailleReelle,$this->nTransparence,$this->nModeAffichage,$this->F4c8b7365())) { parent::SetValeur(''); } else { parent::SetValeur($Valeur); unset($this->m_fmkImageGD); } } return true; } } } parent::SetValeur($Valeur); if ( $this->_HasGD()) { $return = $this->dDebutDessin(dEffacer,false,true); if ($return && file_exists(F9486bf1a($Valeur))) { $this->m_fmkImageGD->Faeaf760a($Valeur,$this->bForceTailleReelle,$this->nTransparence,$this->nModeAffichage,$this->F4c8b7365()); } } return true; } function _HasGD($bCreerSiNon = false) { if (isset($this->m_fmkImageGD) && ($this->m_fmkImageGD->_HasGD(false,$this->m_fmkImageGD->F8ddf8952()))) { return ($this->m_fmkImageGD->_HasGD($bCreerSiNon,$this->m_fmkImageGD->F8ddf8952())); } else if ($bCreerSiNon) { return $this->dDebutDessin(dSansEffacer,true); } else { return false; } } function F16d5955d() { global $gszRepLangue; if (isset($gszRepLangue)) { return $gszRepLangue . $this->GetValeurHTML('AJAX'); } else { return $this->GetValeurHTML('AJAX'); } } function F19536274() { $this->SetValeur($this->Valeur); $this->bImageOK=true; } function GetValeurHTML( $TypeConvertion = 0 ) { $bViaWebservice = false; if (isset($this->m_fmkImageGD) && $this->m_fmkImageGD->F19164dfa()) { $bViaWebservice = true; } else { if (!isset($this->m_fmkImageGD)&&($this->eTypeImage!==0)&&(!$this->_HasGD())) { if (!(isset($this->bImageOK))||!$this->bImageOK) { $this->F19536274(); } } if($this->_HasGD()) { $this->m_fmkImageGD->Ffcc8144c(); $this->m_fmkImageGD->F7a6ad42d(); $bViaWebservice = true; } } if ($bViaWebservice) { $clChargeur =& FMK_Chargeur(); $sSeparateurParametres = ($TypeConvertion === 'AJAX') ? '&' : '&amp;'; return $clChargeur->F06090cce('Webservice.php?_WB_='.WB_MONPROJET.$sSeparateurParametres.'_WS_=STREAMIMAGE'.$sSeparateurParametres.'STREAMIMAGE='.$this->m_fmkImageGD->F8ddf8952().$sSeparateurParametres. $this->Alias . '='.time()); } else { if (isset($this->m_tabDefilementImage[$this->m_nDefilementPosition])) { global $gszRepLangue; $Path = F5a48be2d(); $sCheminImage = (utf8_strpos($this->m_tabDefilementImage[$this->m_nDefilementPosition],'/' . (isset($gszRepLangue) ? $gszRepLangue : basename($Path))) === 0) ? ('.'.utf8_substr($this->m_tabDefilementImage[$this->m_nDefilementPosition], ( isset($gszRepLangue) ? utf8_strlen($gszRepLangue) : 0 ) + utf8_strlen(basename($Path))+1)) : ('../'.$this->m_tabDefilementImage[$this->m_nDefilementPosition]); if (isset($gszRepLangue)) { $sCheminImage = $gszRepLangue . $sCheminImage; } } else { $sCheminImage = $this->GetValeur(); } if (empty($sCheminImage)) return $sCheminImage; if((utf8_strpos($sCheminImage,'ftp:/')===0)||(utf8_strpos($sCheminImage,'http:/')===0)) { return $sCheminImage; } if(utf8_strpos($sCheminImage,':')===1) { $sCheminReelImage=F8df7b692(realpath(F9486bf1a($sCheminImage))); $sBaseChemin=F8df7b692(realpath(WB_BASE_DIR . '/../..')); $sCheminImage = '.'.utf8_substr($sCheminReelImage,utf8_strlen($sBaseChemin)); } elseif($sCheminImage[0]==='/') { $sCheminImage = '.' . $sCheminImage; } return $sCheminImage."?refresh=".time(); } } function& GetType() { return getRef(ID_IMAGE); } function F4a917fa4() { return 8; } function dFinDessin() { F67cfd262(); if (!($this->_HasGD())) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DFINDESSIN"))); return false; } $_return = $this->m_fmkImageGD->dFinDessin(); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DFINDESSIN"))); if (Feef890d7()) F4c16799e($this->m_sNomPHP,XML_CHAMP_PROP_NUM_VALEUR); return $_return; } function dDebutDessin($nOptions = dEffacer,$bAppelInterne=false, $bSansCreation = false) { F67cfd262(); $sFctEnCours = $bAppelInterne ? '' : Fc34ec142("FCT_DDEBUTDESSIN"); $cdependancesPHP = FMK_Dependance(); if (isset($cdependancesPHP)) if (!$cdependancesPHP->F0b5f8f06('gd')) { Erreur('ErreurPHP',FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),$sFctEnCours),Fc34ec142("ERR_EXTENSION_GD_ABSENTE")); } $bFin = false; if ($this->_HasGD()) { $image = $this->m_fmkImageGD; $bFin = $this->m_fmkImageGD->m_bFinDessin; if ($this->m_fmkImageGD->F19164dfa()) $this->m_fmkImageGD->Fc421bd92(); } if ( ($this->m_nLargeur===0) || ($this->m_nHauteur===0) ) { Fdd46bacf(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),$sFctEnCours)); return false; } $this->m_fmkImageGD = new FMK_Dessin_Image_Gd($this, $this->m_nLargeur, $this->m_nHauteur, $this->CouleurFondDessin,$bSansCreation); if (!$bSansCreation) { if ( $nOptions == dEffacer ) { $this->m_fmkImageGD->F9fa19304(); } if ($nOptions & dSansEffacer ) { if (!$bFin && (isset($image)) && ($image->_HasGD())) { $this->m_fmkImageGD = &$image; } elseif (($Valeur=$this->GetValeur())!="") { if (file_exists(F9486bf1a($Valeur))) { $this->m_fmkImageGD->Faeaf760a($Valeur,$this->bForceTailleReelle,$this->nTransparence,$this->nModeAffichage,$this->F4c8b7365()); if ($this->m_fmkImageGD->m_bAvecOpacite) { $nOptions |= dAvecOpacite; } } } } if ( $nOptions & dAvecOpacite ) { $this->m_fmkImageGD->Fd2ea6e89(); } else if ( $nOptions & dQuadrillageOpacite ) { $this->m_fmkImageGD->Fd2ea6e89(); $this->m_fmkImageGD->F327ae7ad(); } else { $this->m_fmkImageGD->F1c45c627(); } if (!($this->_HasGD())) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),$sFctEnCours)); return false; } } F418548d8($this->m_sNomPHP); $this->_m_nOptionsDebutDessin = $nOptions; if (Feef890d7()) F4c16799e($this->m_sNomPHP,XML_CHAMP_PROP_NUM_VALEUR); return true; } function dPixelCouleur($x,$y) { F67cfd262(); if (!($this->_HasGD())) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DFINDESSIN"))); return false; } return $this->m_fmkImageGD->dPixelCouleur($x,$y); } function dPixelOpacite($x,$y) { F67cfd262(); if (!($this->_HasGD())) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DFINDESSIN"))); return false; } return $this->m_fmkImageGD->dPixelOpacite($x,$y); } function dRedimensionne($nNouvelleLargeur,$nNouvelleHauteur) { F67cfd262(); if (!($this->_HasGD())) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DREDIMENSIONNE"))); return false; } if (!$this->m_fmkImageGD->dRedimensionne($nNouvelleLargeur,$nNouvelleHauteur)) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DREDIMENSIONNE"))); return false; } if (Feef890d7()) F4c16799e($this->m_sNomPHP,XML_CHAMP_PROP_NUM_VALEUR); return true; } function dRotation($nAngle) { F67cfd262(); if (!($this->_HasGD())) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DROTATION"))); return false; } if (!$this->m_fmkImageGD->dRotation($nAngle)) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DROTATION"))); return false; } if (Feef890d7()) F4c16799e($this->m_sNomPHP,XML_CHAMP_PROP_NUM_VALEUR); return true; } function dSauveImageBMP($sNomFichier , $nNbCouleurs = null) { F67cfd262(); $this->_HasGD(true); $_return = $this->m_fmkImageGD->dSauveImageBMP($sNomFichier,$nNbCouleurs); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DSAUVEIMAGEBMP"))); return $_return; } function dSauveImagePNG($sNomFichier, $CouleurTransparente = null,$bForceCommeAffichage=false) { F67cfd262(); $this->_HasGD(true); $_return = $this->m_fmkImageGD->dSauveImagePNG($sNomFichier,$CouleurTransparente,$bForceCommeAffichage); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DSAUVEIMAGEPNG"))); return $_return; } function dSauveImageGIF($sNomFichier,$nNbCouleurs = null) { F67cfd262(); $this->_HasGD(true); $_return = $this->m_fmkImageGD->dSauveImageGIF($sNomFichier,$nNbCouleurs); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DSAUVEIMAGEGIF"))); return $_return; } function dSauveImageJPEG($sNomFichier,$nQualite=null) { F67cfd262(); $this->_HasGD(true); $_return = $this->m_fmkImageGD->dSauveImageJPEG($sNomFichier,$nQualite); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DSAUVEIMAGEJPEG"))); return $_return; } function dInverseCouleur() { F67cfd262(); if (!($this->_HasGD())) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DINVERSECOULEUR"))); return false; } $_return = $this->m_fmkImageGD->dInverseCouleur(); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DINVERSECOULEUR"))); if (Feef890d7()) F4c16799e($this->m_sNomPHP,XML_CHAMP_PROP_NUM_VALEUR); return $_return; } function dModifieTSL($Teinte,$Saturation,$Luminosite, &$ImageDest) { F67cfd262(); if ( (!($this->_HasGD())) || ( ($ImageDest!=null) && ((!is_callable(array($ImageDest,'_HasGD'))) || (!($ImageDest->_HasGD(true)))) )) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DMODIFIETSL"))); return false; } if ($ImageDest==null) $ImageDest =& $this; $_return = $this->m_fmkImageGD->dModifieTSL($Teinte,$Saturation,$Luminosite,$ImageDest->m_fmkImageGD); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DMODIFIETSL"))); if (Feef890d7()) { F4c16799e($ImageDest->m_sNomPHP,XML_CHAMP_PROP_NUM_VALEUR); } return $_return; } function dModifieTeinte($Teinte,&$ImageDest) { F67cfd262(); if ( (!($this->_HasGD())) || ( ($ImageDest!=null) && ((!is_callable(array($ImageDest,'_HasGD'))) || (!($ImageDest->_HasGD(true)))) )) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DMODIFIETEINTE"))); return false; } if ($ImageDest==null) $ImageDest =& $this; $_return = $this->dModifieTSL($Teinte,0,0,$ImageDest); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DMODIFIETEINTE"))); return $_return; } function dModifieLuminosite($Luminosite,&$ImageDest) { F67cfd262(); if ( (!($this->_HasGD())) || ( ($ImageDest!=null) && ((!is_callable(array($ImageDest,'_HasGD'))) || (!($ImageDest->_HasGD(true)))) )) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DMODIFIELUMINOSITE"))); return false; } if ($ImageDest==null) $ImageDest =& $this; $_return = $this->dModifieTSL(0,0,$Luminosite,$ImageDest); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DMODIFIELUMINOSITE"))); return $_return; } function dModifieSaturation($Saturation,&$ImageDest) { F67cfd262(); if ( (!($this->_HasGD())) || ( ($ImageDest!=null) && ((!is_callable(array($ImageDest,'_HasGD'))) || (!($ImageDest->_HasGD(true)))) )) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DMODIFIESATURATION"))); return false; } if ($ImageDest==null) $ImageDest =& $this; $_return = $this->dModifieTSL(0,$Saturation,0,$ImageDest); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DMODIFIESATURATION"))); return $_return; } function dSymetrieHorizontale() { F67cfd262(); if (!($this->_HasGD())) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DSYMETRIEHORIZONTALE"))); return false; } $_return = $this->m_fmkImageGD->dSymetrieHorizontale(); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DSYMETRIEHORIZONTALE"))); if (Feef890d7()) F4c16799e($this->m_sNomPHP,XML_CHAMP_PROP_NUM_VALEUR); return $_return; } function dSymetrieVerticale() { F67cfd262(); if (!($this->_HasGD())) { Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN_NULL"),Fc34ec142("FCT_DSYMETRIEVERTICALE"))); return false; } $_return = $this->m_fmkImageGD->dSymetrieVerticale(); if (!$_return) Fdd279d21(FMK_ChaineConstruit(Fc34ec142("ERR_DESSIN"),Fc34ec142("FCT_DSYMETRIEVERTICALE"))); if (Feef890d7()) F4c16799e($this->m_sNomPHP,XML_CHAMP_PROP_NUM_VALEUR); return $_return; } function Fc6eb41aa() { if ($this->m_bDefilementAutomatique) { $this->F19536274(); } } function F32579987($pszChemin1, $pszChemin2) { return Fd01c6d85($pszChemin1,$pszChemin2,$this->m_nDefilementTriOptions); } function pszGetContenuHTML() { return F42d47045($this,false); } function F1b51450d($eDefilement) { if ($this->m_bDefilementAutomatique) { $this->Fbc7a07d8($eDefilement); Fd057c510($this, PROP_INVALID_MIN); } } function ImageArreteDefilement () { $this->F1b51450d(3); } function ImagePremier () { $this->F1b51450d(4); } function ImagePrecedent () { $this->F1b51450d(5); } function ImageSuivant () { $this->F1b51450d(6); } function ImageDernier () { $this->F1b51450d(7); } function ImageLanceDefilement($nAction=0) { if (($nAction >= 0) || ($nAction <= 2)) { $this->F1b51450d($nAction); } else { Fb9eb0792('ERR_BAD_CONSTANT', $nAction); } } function ImagePositionDefilement($nPosition = null) { if (!isset($nPosition)) { if ($this->m_bDefilementAutomatique) { return $this->m_nDefilementPosition + 1; } else { return 0; } } else { if ($this->m_bDefilementAutomatique) { $this->F11cba892($nPosition-1); Fd057c510($this, PROP_INVALID_MIN); } } } function ImageOccurrence() { if ($this->m_bDefilementAutomatique) { return count($this->m_tabDefilementImage,COUNT_NORMAL); } else { return 0; } } } class CVueChampImage_Web extends CVueChamp_Web { function CVueChampImage_Web(&$pclModele) { parent::CVueChamp_Web($pclModele); } function Fd0d72590($eDernier, &$rclParametres) { $pclModele =& $this->Fda201604(); $rclParametres->F4ccc5457('m_nTemporisation', $eDernier, $pclModele->m_nDefilementTemporisation); } function F5d67aaa5($eDernier,&$rclParametres) { $pclModele =& $this->Fda201604(); $this->Fc12ed48a(array(&$this, 'F3836dad3'),'m_tabImages', count($pclModele->m_tabDefilementImage,COUNT_NORMAL), DERNIER_NON, $rclParametres); $rclParametres->F7373ec8a('m_bActif', DERNIER_NON, $pclModele->m_bDefilementActif); $rclParametres->F4ccc5457('m_nImage', $eDernier, $pclModele->m_nDefilementPosition); } function F3836dad3($nImage, &$rclParametres) { $pclModele =& $this->Fda201604(); $rstImage = $pclModele->m_tabDefilementImage[$nImage]; $rclParametres->F105675ec(); $rclParametres->F2f67ca8f('m_sSrc', DERNIER_OUI, true, $rstImage); $rclParametres->F1ebdc972(DERNIER_OUI); } } class CVignette extends CImage { var $Vignette = null; var $bVignetteBuffer = false; var $m_bDansZR = null; var $bVignetteOK = false; var $bImageOK = false; var $bHREFdejaFAIT = false; var $tabNomAttribut=null; var $m_bForceVignetteGeneree=false; var $bIgnoreTraitementVignette = false; function CVignette($nLargeur = 1, $nHauteur = 1, $CouleurFond = wlCouleurDefaut) { parent::CImage($nLargeur, $nHauteur, $CouleurFond); $this->bForceTailleReelle = true; } function& GetType() { return getRef(26); } function F4a917fa4() { return 26; } function Fb557c3b6() { if (isset($this->m_bDansZR))return $this->m_bDansZR; $pclChampConteneur =& $this->m_pclChampConteneur; return $this->m_bDansZR = (isset($pclChampConteneur) && Fba68c6f1($pclChampConteneur) ); } function SetValeur($pImage) { if ($this->Fb557c3b6()===true) { } else { if ($this->eTypeImage<2) { $this->SetImage($pImage); } else { $this->SetVignette($pImage,true); $this->SetImage($pImage); } } } function& GetImage() { return $this->GetValeur(); } function SetImage($pImage) { parent::SetValeur( $pImage ); $this->bImageOK=true; if ( (!$this->bVignetteOK) && ($this->eTypeImage===2) ) { $this->SetVignette($pImage,true); } } function& GetVignette() { if ($this->bVignetteBuffer) return getRef(''); return $this->Vignette; } function SetVignette($pVignette,$bForceBufferisation = false) { $this->bIgnoreTraitementVignette = !$bForceBufferisation; F6b1e3687(); $bVignetteFichier = file_exists($pVignetteACP=F9486bf1a($pVignette)); F1e7b0563(); if ($bForceBufferisation && $bVignetteFichier) { $pVignette = file_get_contents($pVignetteACP); $bVignetteFichier = false; } if (!$bVignetteFichier) { $this->Vignette = $pVignette; $this->bVignetteBuffer = true; } else { $sCheminSite = F8df7b692(realpath(WB_BASE_DIR . '/../..')); $sCheminImage = F8df7b692(realpath($pVignetteACP)); if ((!$this->bIgnoreTraitementVignette && ($this->nModeAffichage!==3)) || (!empty($pVignette) && ($pVignette[0]!='.')&& (utf8_strpos($sCheminImage,$sCheminSite)!==0))) { $this->Vignette = file_get_contents($pVignetteACP); $this->bVignetteBuffer = true; } else { $this->Vignette = $pVignette; $this->bVignetteBuffer = false; } } $this->bVignetteOK=true; if(Feef890d7()) { } } function GetVignetteHTML($TypeConvertion=0) { if (!$this->bVignetteOK && !empty($this->Vignette)) $this->SetVignette($this->Vignette); if (empty($this->Vignette) && ($this->eTypeImage==1)) { return $this->GetImageHTML($TypeConvertion); } if (!$this->bVignetteBuffer) return $this->Vignette; $clContexte =& FMK_Contexte(); if (!isset($this->m_fmkImageGD)) $this->m_fmkImageGD = new FMK_Dessin_Image_Gd($this,$this->m_nLargeur,$this->m_nHauteur,null,true); $sNOCACHE = ''; if (isset($this->m_fmkImageGD) && empty($this->Vignette)) { } else { $clContexte->F4c8f9bd4('STREAMBUFFER_'.$this->m_fmkImageGD->F8ddf8952(), $this->Vignette); if ($clContexte->F1a1d6423('STREAMBUFFER_TRAITEE_'.$this->m_fmkImageGD->F8ddf8952())!==false) { $clContexte->Ff9d5e233('STREAMBUFFER_TRAITEE_'.$this->m_fmkImageGD->F8ddf8952()); } $this->Vignette = ''; $sNOCACHE = '&' . $this->Alias . '='.time(); } $clChargeur =& FMK_Chargeur(); return $clChargeur->F06090cce('Webservice.php?_WB_='.WB_MONPROJET. '&amp;hauteur=' . $this->m_nHauteur . '&amp;largeur=' . $this->m_nLargeur . '&amp;modeAffichage=' . $this->nModeAffichage . '&amp;transparence=' . $this->nTransparence . '&amp;fond=' . $this->F4c8b7365() . '&amp;_WS_=STREAMBUFFER&amp;streamBUFFER='.$this->m_fmkImageGD->F8ddf8952().$sNOCACHE); } function GetValeurHTML($TypeConvertion=0) { if ($this->Fb557c3b6()===true) { if (!$this->bHREFdejaFAIT) { if (!isset($this->tabNomAttribut)) { $this->tabNomAttribut = array(); foreach(array_keys($this->m_pclChampConteneur->TabAttribut) as $sNomAttribut) { $clAttribut =& $this->m_pclChampConteneur->TabAttribut[$sNomAttribut]; if ($clAttribut->m_sAliasChampLie == $this->Alias) { $this->tabNomAttribut[$clAttribut->m_sNomProprieteLiee] = $sNomAttribut; } } if (isset($this->tabNomAttribut['Valeur'])&&isset($this->tabNomAttribut['Image'])) { $this->tabNomAttribut['Image'] = $this->tabNomAttribut['Valeur']; unset($this->tabNomAttribut['Valeur']); } if (isset($this->tabNomAttribut['Valeur'])&&!isset($this->tabNomAttribut['Image'])) { $this->tabNomAttribut['Image'] = $this->tabNomAttribut['Valeur']; unset($this->tabNomAttribut['Valeur']); } if (!isset($this->tabNomAttribut['Vignette'])) { $this->tabNomAttribut['Vignette'] = $this->tabNomAttribut['Image']; $this->m_bForceVignetteGeneree = ($this->eTypeImage===2); } else { $this->m_bForceVignetteGeneree = false; } } $b = Feef890d7(); F3ecf4149(false); $clAttribut =& $this->m_pclChampConteneur->TabAttribut[$this->tabNomAttribut['Image']]; $this->SetImage($this->m_pclChampConteneur->TabLigne[$this->m_pclChampConteneur->m_nLigneAffichee]->TabValeur[$clAttribut->nIndiceAttribut]); $clAttribut =& $this->m_pclChampConteneur->TabAttribut[$this->tabNomAttribut['Vignette']]; $this->SetVignette($this->m_pclChampConteneur->TabLigne[$this->m_pclChampConteneur->m_nLigneAffichee]->TabValeur[$clAttribut->nIndiceAttribut],$this->m_bForceVignetteGeneree); F3ecf4149($b); $sRetour = parent::GetValeurHTML($TypeConvertion); } else { $sRetour = $this->GetVignetteHTML(); } if ($this->m_pclChampConteneur->m_nLigneAffichee>0) $this->bHREFdejaFAIT = !$this->bHREFdejaFAIT; return $sRetour; } else { return $this->GetImageHTML($TypeConvertion); } } function GetImageHTML($TypeConvertion=0) { if (!$this->bImageOK) { $this->SetImage($this->Valeur); } return parent::GetValeurHTML($TypeConvertion); } } class stONDE { var $m_dAmplitude; var $m_dFrequence; } class stDISTORSION { var $nNbOndes; var $m_tabOndes; var $m_dAmplitude; function stDISTORSION($nNbOndes) { $this->nNbOndes = $nNbOndes; $this->m_tabOndes = array_fill(0,$nNbOndes,new stONDE()); if (PHPVERSION_5) $this->m_tabOndes = array_map('_clone',$this->m_tabOndes); } } class stMODEVAGUE { var $m_stOndesX; var $m_stOndeYSurX; var $m_stOndeY; function stMODEVAGUE($_stDISTORSION) { $this->m_stOndesX = new $_stDISTORSION(3); $this->m_stOndeYSurX = new $_stDISTORSION(1); $this->m_stOndeY = new $_stDISTORSION(1); } } class stMODEPARAMETRE { var $m_stModeVague; function stMODEPARAMETRE() { $this->m_stModeVague = new stMODEVAGUE('stDISTORSION'); } } define('CChampCaptcha_ms_tabPlagesCaracteres_' . 0 . '_m_pwzCaracteres','abcdefghjkmnpqrstuvwxyz'); define('CChampCaptcha_ms_tabPlagesCaracteres_' . 0 . '_m_nNombre',utf8_strlen(constant('CChampCaptcha_ms_tabPlagesCaracteres_' . 0 . '_m_pwzCaracteres'))); define('CChampCaptcha_ms_tabPlagesCaracteres_' . 1 . '_m_pwzCaracteres','ABCDEFGHJKLMNPRSTUVWXYZ'); define('CChampCaptcha_ms_tabPlagesCaracteres_' . 1 . '_m_nNombre',utf8_strlen(constant('CChampCaptcha_ms_tabPlagesCaracteres_' . 1 . '_m_pwzCaracteres'))); define('CChampCaptcha_ms_tabPlagesCaracteres_' . 2 . '_m_pwzCaracteres','0123456789'); define('CChampCaptcha_ms_tabPlagesCaracteres_' . 2 . '_m_nNombre',utf8_strlen(constant('CChampCaptcha_ms_tabPlagesCaracteres_' . 2 . '_m_pwzCaracteres'))); define('CChampCaptcha_ms_tabModesObfuscation_' . 0 . '_m_pfInitParametres', 'F37586a00'); define('CChampCaptcha_ms_tabModesObfuscation_' . 0 . '_m_pfDessineValeur', 'Fb1a33fd8'); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_nNbOndes',3); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stDefaut_m_tabOndes_0_m_dAmplitude',5.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stDefaut_m_tabOndes_0_m_dFrequence',20); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stDefaut_m_tabOndes_1_m_dAmplitude',3.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stDefaut_m_tabOndes_1_m_dFrequence',14); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stDefaut_m_tabOndes_2_m_dAmplitude',1.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stDefaut_m_tabOndes_2_m_dFrequence',7); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stDefaut_m_dAmplitude',11.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stVariation_m_tabOndes_0_m_dAmplitude',1.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stVariation_m_tabOndes_0_m_dFrequence',5.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stVariation_m_tabOndes_1_m_dAmplitude',0.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stVariation_m_tabOndes_1_m_dFrequence',3.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stVariation_m_tabOndes_2_m_dAmplitude',0.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stVariation_m_tabOndes_2_m_dFrequence',1.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_stVariation_m_dAmplitude',11.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndesX_m_bAmplitudeOpposee',true); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeYSurX_nNbOndes',1); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeYSurX_m_stDefaut_m_tabOndes_0_m_dAmplitude',5.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeYSurX_m_stDefaut_m_tabOndes_0_m_dFrequence',20.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeYSurX_m_stDefaut_m_dAmplitude',5.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeYSurX_m_stVariation_m_tabOndes_0_m_dAmplitude',1.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeYSurX_m_stVariation_m_tabOndes_0_m_dFrequence',5.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeYSurX_m_stVariation_m_dAmplitude',1.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeYSurX_m_bAmplitudeOpposee',true); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeY_nNbOndes',1); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeY_m_stDefaut_m_tabOndes_0_m_dAmplitude',5.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeY_m_stDefaut_m_tabOndes_0_m_dFrequence',20.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeY_m_stDefaut_m_dAmplitude',5.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeY_m_stVariation_m_tabOndes_nNbOndes',1); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeY_m_stVariation_m_tabOndes_0_m_dAmplitude',1.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeY_m_stVariation_m_tabOndes_0_m_dFrequence',5.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeY_m_stVariation_m_dAmplitude',1.0); define('CChampCaptcha_ms_stModeVagueInit_m_stOndeY_m_bAmplitudeOpposee',true); define('OBJ_DESACTIVE_CAPTCHA_OPACITE',true); define('CAPTCHA_DESSIN_SANS_ESPACEMENT_ENTRE_CARACTERE',true); define('CAPTCHA_DESSIN_SANS_TRANSFORMATION',false); define('CAPTCHA_DESSIN_SANS_FONT',false); define('CAPTCHA_BENCH',false); define('CAPTCHA_OPTIM_GD',true); define('nREDUCTION_ESPACEMENT',3); class CChampCaptcha extends CImage { var $m_nTexteLongeur; var $m_stModeVague; var $m_tabPlageCaractereAutorise; var $m_eModeObfuscation; var $m_tabModeObfuscationAutorise; var $m_bRedessin = false; var $m_eModeObfuscationEffectif; var $m_stModeParametre; function CChampCaptcha($nLargeur = 1, $nHauteur = 1, $CouleurFond = wlCouleurDefaut) { parent::CImage($nLargeur, $nHauteur, $CouleurFond); $this->m_tabPlageCaractereAutorise = array_fill(0,3,true); $this->m_tabModeObfuscationAutorise = array_fill(0,1,true); $this->m_nTexteLongeur = 8; $this->m_eModeObfuscation = -1; $this->m_bRedessin = true; $this->m_eModeObfuscationEffectif = 0; $this->m_stModeParametre = new stMODEPARAMETRE(); $this->eTypeImage = 2; $this->m_tabPlageCaractereAutorise[1] = false; } function Fc6eb41aa() { CChamp::Fc6eb41aa(); } function SetValeur($Valeur) { $this->Valeur = $Valeur; $this->Fde43eee9(true); if(Feef890d7()) { F4c16799e($this->m_sNomPHP, XML_CHAMP_PROP_NUM_VALEUR); } } function& GetValeur() { return CChamp::GetValeur(); } function SetTaille($Taille) { $this->m_nTexteLongeur = (!is_numeric($Taille)) ? 8 : intval($Taille); if (isset($this->ValeurInitiale)) $this->Fb3dcf02b(dwrvAUCUNE); } function& GetTaille() { return $this->m_nTexteLongeur; } function& GetType() { return getRef(ID_CAPTCHA); } function F4a917fa4() { return 82; } function SetCouleur($nCouleur) { parent::SetCouleur($nCouleur); $this->Fde43eee9(false); } function SetCouleurFond($nCouleur) { parent::SetCouleurFond($nCouleur); $this->Fde43eee9(false); } function SetPoliceTaille($nPoliceTaille) { CChamp::SetPoliceTaille($nPoliceTaille); $this->Fde43eee9(false); } function SetPoliceSoulignee($bPoliceSouligne) { CChamp::SetPoliceSoulignee($bPoliceSouligne); $this->Fde43eee9(false); } function SetPoliceNom($sPoliceNom) { CChamp::SetPoliceNom($sPoliceNom); $this->Fde43eee9(false); } function SetPoliceItalique($bPoliceItalique) { CChamp::SetPoliceItalique($bPoliceItalique); $this->Fde43eee9(false); } function SetPoliceGras($bPoliceGras) { CChamp::SetPoliceGras($bPoliceGras); $this->Fde43eee9(false); } function& GetPoliceGras() { return CChamp::GetPoliceGras(); } function& GetPoliceItalique() { return CChamp::GetPoliceItalique(); } function& GetPoliceNom() { return CChamp::GetPoliceNom(); } function& GetPoliceSoulignee() { return CChamp::GetPoliceSoulignee(); } function& F8655e085() { return CChamp::F8655e085(); } function& GetPoliceTaille() { return CChamp::GetPoliceTaille(); } function CaptchaInitialise() { $this->Fb560a68a(dwrvAUCUNE); } function CaptchaVerifie($rcwzValeurUtilisateur) { return $this->F7a77d069($rcwzValeurUtilisateur); } function F0883364d($ePlage) { return constant('CChampCaptcha_ms_tabPlagesCaracteres_' . $ePlage . '_m_nNombre'); } function F349db720($ePlage) { return constant('CChampCaptcha_ms_tabPlagesCaracteres_' . $ePlage . '_m_pwzCaracteres'); } function Fed450f40($eModeObfuscation) { return constant('CChampCaptcha_ms_tabModesObfuscation_' . $eModeObfuscation . '_m_pfInitParametres'); } function F09704078($eModeObfuscation) { return constant('CChampCaptcha_ms_tabModesObfuscation_' . $eModeObfuscation . '_m_pfDessineValeur'); } function F939e23dd() { return 'CChampCaptcha_ms_stModeVagueInit_m_stOndesX'; } function F6313898f() { return 'CChampCaptcha_ms_stModeVagueInit_m_stOndeYSurX'; } function F58334aae() { return 'CChampCaptcha_ms_stModeVagueInit_m_stOndeY'; } function F834f9e66($rstDistorsionInit,$nOnde) { return $rstDistorsionInit . '_m_stDefaut_m_tabOndes_' . $nOnde; } function F8d55e6f5($rstDistorsionInit,$nOnde){ return $rstDistorsionInit . '_m_stVariation_m_tabOndes_' . $nOnde; } function Faa70c0f4($sDistorsion) { return constant($sDistorsion . '_m_bAmplitudeOpposee'); } function F41dfc2ff($sDistorsion) { return constant($sDistorsion . '_m_stDefaut_m_dAmplitude'); } function F3dcd897a($sDistorsion) { return constant($sDistorsion . '_m_stDefaut_m_dFrequence'); } function F9f73b4ad($sDistorsion) { return constant($sDistorsion . '_m_stVariation_m_dAmplitude'); } function F9a1fa3f8($sDistorsion) { return constant($sDistorsion . '_m_stVariation_m_dFrequence'); } function F8a1f0b43($sOnde) { return constant($sOnde . '_m_dAmplitude'); } function Fd2ad0fff($sOnde) { return constant($sOnde . '_m_dFrequence'); } function F0019f4bf($rstDistorsion) { return constant($rstDistorsion.'_nNbOndes'); } function Fc077a343($ePlage, $bAutorise) { $this->m_tabPlageCaractereAutorise[$ePlage] = $bAutorise; } function F89d94df4($ePlage) { return $this->m_tabPlageCaractereAutorise[$ePlage]; } function F4eddbca3($eModeObfuscation) { $this->m_eModeObfuscation = $eModeObfuscation; } function F86e5c000() { return $this->m_eModeObfuscation; } function F517c92d7($eModeObfuscation, $bAutorise) { $this->m_tabModeObfuscationAutorise[$eModeObfuscation] = $bAutorise; } function F5db4b27a($eModeObfuscation) { return $this->m_tabModeObfuscationAutorise[$eModeObfuscation]; } function F19536274() { if (false != $this->m_bRedessin) { $this->m_bRedessin = false; $this->F1551bdbe(); } } function Fb3dcf02b($dwFlags) { $this->F8909a566(); $bRes = parent::Fb3dcf02b($dwFlags); return $bRes; } function F7a77d069($cwzValeurUtilisateur) { $cwzValeurAffichee = $this->Valeur; $this->F993eaa85($cwzValeurAffichee); $this->F993eaa85($cwzValeurUtilisateur); return ($cwzValeurAffichee === $cwzValeurUtilisateur); } function F993eaa85( &$rcwzValeur) { if ($this->m_tabPlageCaractereAutorise[0] != $this->m_tabPlageCaractereAutorise[1]) { $rcwzValeur = utf8_strtoupper($rcwzValeur); } $rcwzValeur = utf8_strtr($rcwzValeur,array( 'i' => '1', 'I' => '1', 'l' => '1', '0' => '0', 'o' => '0', 'O' => '0', 'Q' => '0', '6' => '6', 'b' => '6', 'G' => '6', '21'=> 'u', )); } function F239c3623($eModeObfuscation) { return (null != $this->F09704078($eModeObfuscation)); } function F8909a566() { $sValeur = utf8_str_pad('',$this->m_nTexteLongeur,'0'); $nNbCaracteres = 0; for ($ePlage = 0; $ePlage < 3; ++$ePlage) { if (false != $this->m_tabPlageCaractereAutorise[$ePlage]) { $nNbCaracteres += $this->F0883364d($ePlage); } } for ($nPosition = 0; $nPosition < $this->m_nTexteLongeur; ++$nPosition) { $nCaractere = rand() % $nNbCaracteres; for ($ePlage = 0; $ePlage < 3; ++$ePlage) { if (false != $this->m_tabPlageCaractereAutorise[$ePlage]) { if ($this->F0883364d($ePlage) > $nCaractere) { $sValeur[$nPosition] = utf8_substr($this->F349db720($ePlage),$nCaractere,1); break; } else { $nCaractere -= $this->F0883364d($ePlage); } } } } $this->ValeurInitiale = $sValeur; } function Fde43eee9($bValeurChange) { if (CAPTCHA_BENCH) { FMK_Charge('WL/VM/VM.php',false); ChronoDebut(); } $this->m_bRedessin = true; if (isset($this->m_fmkImageGD) && $this->m_fmkImageGD->F19164dfa()) { $this->m_fmkImageGD->Fc421bd92(); $this->m_fmkImageGD->F7a6ad42d(); unset($this->m_fmkImageGD); $this->m_fmkImageGD = null; $this->bImageOK = false; if(Feef890d7()) { F4c16799e($this->m_sNomPHP, XML_CHAMP_PROP_NUM_VALEUR); } } if (false != $bValeurChange) { $this->m_eModeObfuscationEffectif = $this->F9fc7fed1(); call_user_func(array(&$this,$this->Fed450f40($this->m_eModeObfuscationEffectif))); } if (CAPTCHA_BENCH) { Trace('CAPTCHA BENCH INIT ' . $this->m_eModeObfuscationEffectif . ' : ' . ChronoFin()); } } function F9fc7fed1() { if (-1 != $this->F86e5c000()) { return $this->Fc743b853(); } else { return $this->F11d6caf9(); } } function Fc743b853() { if (false != $this->F239c3623($this->F86e5c000())) { return $this->F86e5c000(); } else { return 0; } } function F11d6caf9() { $nNbModesAutorisees = 0; for ($eModeObfuscation = 0; $eModeObfuscation < 1; ++$eModeObfuscation) { if ( (false != $this->m_tabModeObfuscationAutorise[$eModeObfuscation]) && (false != $this->F239c3623($eModeObfuscation))) { ++$nNbModesAutorisees; } } if (0 != $nNbModesAutorisees) { $nIndiceMode = rand() % $nNbModesAutorisees; for ($eModeObfuscation = 0; $eModeObfuscation < 1; ++$eModeObfuscation) { if ( (false != $this->m_tabModeObfuscationAutorise[$eModeObfuscation]) && (false != $this->F239c3623($eModeObfuscation))) { if (0 == $nIndiceMode--) { return $eModeObfuscation; } } } } return 0; } function F1551bdbe() { if (CAPTCHA_BENCH) { ob_clean(); echo Ff11192e9(); ChronoDebut(); } if ($this->dDebutDessin(((OBJ_DESACTIVE_CAPTCHA_OPACITE) ? dEffacer: (dEffacer+dAvecOpacite)))) { call_user_func(array(&$this,$this->F09704078($this->m_eModeObfuscationEffectif))); } if (CAPTCHA_BENCH) { die('CAPTCHA BENCH DESSIN ' . $this->m_eModeObfuscationEffectif . ' : ' . ChronoFin()); } } function F37586a00() { $this->F5f69fea9($this->F939e23dd(), $this->m_stModeParametre->m_stModeVague->m_stOndesX); $this->F5f69fea9($this->F6313898f(), $this->m_stModeParametre->m_stModeVague->m_stOndeYSurX); $this->F5f69fea9($this->F58334aae(), $this->m_stModeParametre->m_stModeVague->m_stOndeY); } function F5f69fea9($rstDistorsionInit, &$rstDistorsion) { $dSommeAmplitudesOndes = 0.0; $bAmplitudeOpposee = $this->Faa70c0f4($rstDistorsionInit) ? ((rand() % 2) != 0) : false; $nNbOndes = $this->F0019f4bf($rstDistorsionInit); for ($nOnde = 0; $nOnde < $nNbOndes; ++$nOnde) { $pclOnde =& $rstDistorsion->m_tabOndes[$nOnde]; $this->Ff1962513($this->F834f9e66($rstDistorsionInit,$nOnde), $this->F8d55e6f5($rstDistorsionInit,$nOnde), $bAmplitudeOpposee, $pclOnde); $dSommeAmplitudesOndes += abs($pclOnde->m_dAmplitude); } $this->Fbe2b3027($this->F41dfc2ff($rstDistorsionInit), $this->F9f73b4ad($rstDistorsionInit), false, $rstDistorsion->m_dAmplitude); $rstDistorsion->m_dAmplitude /= $dSommeAmplitudesOndes; } function Ff1962513($rstOndeDefaut, $rstOndeVariation, $bAmplitudeOpposee, &$rstOnde) { $this->Fbe2b3027($this->F8a1f0b43($rstOndeDefaut), $this->F8a1f0b43($rstOndeVariation), $bAmplitudeOpposee , $rstOnde->m_dAmplitude); $this->Fbe2b3027($this->Fd2ad0fff($rstOndeDefaut), $this->Fd2ad0fff($rstOndeVariation), false , $rstOnde->m_dFrequence); } function Fbe2b3027($dDefaut, $dVariation, $bOpposee, &$rdValeur) { $rdValeur = $dDefaut + $dVariation * (((double)rand()) / ((double)getrandmax()) * 2.0 - 1.0); if (false != $bOpposee) $rdValeur = -$rdValeur; } function Fb1a33fd8() { $nLargeur = $this->GetLargeur(); $nHauteur = $this->GetHauteur(); $xpiPeintreTexte = new FMK_Dessin_Image_Gd($this,$nLargeur,$nHauteur); $xpiPeintreTexte->Fd2ea6e89(); if (!is_resource($xpiPeintreTexte->m_image)) return; $nCouleurFondConteneur = $this->F4c8b7365(); $clCouleurFondConteneur = new CCouleur($nCouleurFondConteneur); if (false === $clCouleurFondConteneur->F01589132()) { $clCouleurFondConteneur = Fa7c04636(); } $clCouleurFond = new FMK_Dessin_Couleur($clCouleurFondConteneur->m_dwColor); unset($clCouleurFondConteneur); $this->F63c00e8a($xpiPeintreTexte, $nLargeur, $nHauteur, $clCouleurFond); $this->F81728dc3($xpiPeintreTexte, $nLargeur, $nHauteur, $clCouleurFond); unset($xpiPeintreTexte); unset($clCouleurFond); } function F63c00e8a(&$piPeintreTexte, $nLargeur, $nHauteur, $clCouleurFond) { if (!OBJ_DESACTIVE_CAPTCHA_OPACITE) { $piPeintreTexte->Fd2ea6e89(); $piPeintreTexte->F30829ce1(); } else { $piPeintreTexte->F9fa19304(); $piPeintreTexte->dRemplissage(0,0,$clCouleurFond->F57dd4c6c(CouleurFormatWL),Transparent); } if (!CAPTCHA_DESSIN_SANS_FONT) { $sPoliceNom = $this->GetPoliceNom(); $nPoliceTaille = $this->GetPoliceTaille(); if (!empty($sPoliceNom) && (intval($nPoliceTaille)>0)) { $nAttributs = iNormal; if (CChamp::GetPoliceGras()) F9c19fb37($nAttributs,iGras); if (CChamp::GetPoliceItalique()) F9c19fb37($nAttributs,iItalique); if (CChamp::GetPoliceSoulignee()) F9c19fb37($nAttributs,iSouligné); if (CChamp::F8655e085()) F9c19fb37($nAttributs,iBarre); $piPeintreTexte->dPolice($sPoliceNom,intval($nPoliceTaille),$nAttributs); } } $cwzValeur = $this->Valeur; $nTexteLongeur = utf8_strlen($cwzValeur); if (0 === $nTexteLongeur) { return; } $nCouleurTexte = (($this->GetCouleur()===Transparent) ? wlCouleurNoir : $this->GetCouleur()); if (!CAPTCHA_DESSIN_SANS_ESPACEMENT_ENTRE_CARACTERE) { $piPeintreTexte->dTexte(auMilieu,auCentre,$cwzValeur,$nCouleurTexte); } else { $tabTailleCaractere = array(); $nHauteurCaractere = 0; $nLargeurTotale = 0; $nHauteurMaximale = 0; for($nCaractere=0; $nCaractere<$nTexteLongeur; ++$nCaractere) { $piPeintreTexte->F3c6482ea(utf8_substr($cwzValeur,$nCaractere,1),$tabTailleCaractere[$nCaractere],$nHauteurCaractere) ; $tabTailleCaractere[$nCaractere] = array('x'=>max($tabTailleCaractere[$nCaractere],nREDUCTION_ESPACEMENT), 'y'=>max($nHauteurCaractere,nREDUCTION_ESPACEMENT)); $nLargeurTotale += $tabTailleCaractere[$nCaractere]['x']; $nHauteurMaximale = max($nHauteurMaximale, $nHauteurCaractere); } $nLargeurTotale -= nREDUCTION_ESPACEMENT * $nTexteLongeur; if ($nLargeurTotale > $nLargeur) { $nLargeurTotale = $nLargeur; } $nPositiontexteX = ceil( ($nLargeur - $nLargeurTotale) / 2); $nPositiontexteY = ceil( ($nHauteur - $nHauteurMaximale) / 2); for ($nCaractere = 0; $nCaractere < $nTexteLongeur; ++$nCaractere) { $piPeintreTexte->dTexte($nPositiontexteX,$nPositiontexteY + ($nHauteurMaximale-$tabTailleCaractere[$nCaractere]['y']),utf8_substr($cwzValeur,$nCaractere,1),$nCouleurTexte); $nPositiontexteX += $tabTailleCaractere[$nCaractere]['x'] - nREDUCTION_ESPACEMENT; } unset($tabTailleCaractere); } } function F81728dc3(&$piPeintreTexte, $nLargeur, $nHauteur, $clCouleurFond) { $xpiTexteEffetImage = new FMK_Dessin_Image_Gd($this,$piPeintreTexte->m_nLargeur,$piPeintreTexte->m_nHauteur); $piPeintreTexte->dCopieImage($piPeintreTexte,$xpiTexteEffetImage); if (OBJ_DESACTIVE_CAPTCHA_OPACITE && $piPeintreTexte->F0b8659df()) $xpiTexteEffetImage->Fd2ea6e89(); $xpiImageEffetImage = new FMK_Dessin_Image_Gd(null,$piPeintreTexte->m_nLargeur,$piPeintreTexte->m_nHauteur); if (OBJ_DESACTIVE_CAPTCHA_OPACITE && $piPeintreTexte->F0b8659df()) $xpiImageEffetImage->Fd2ea6e89(); if (CAPTCHA_OPTIM_GD) { $crCouleurFond = F81ed08ab($clCouleurFond->m_nRouge,$clCouleurFond->m_nVert,$clCouleurFond->m_nBleu,0); if (gdCouleurDéfaut == $crCouleurFond)$xpiImageEffetImage->dRemplissage(0,0,wlCouleurDefaut-1,IMG_COLOR_TRANSPARENT); } else { $crCouleurFond = F4f6e8051($clCouleurFond->m_nRouge,$clCouleurFond->m_nVert,$clCouleurFond->m_nBleu,0); if (wlCouleurDefaut == $crCouleurFond)$xpiImageEffetImage->dRemplissage(0,0,wlCouleurDefaut-1,IMG_COLOR_TRANSPARENT); } $clPoint = new FMK_Dessin_Pixel(); if (CAPTCHA_OPTIM_GD) { $crTexteCouleur = 0; } else { $crTexteCouleur = new FMK_Dessin_Couleur(); } for ($clPoint->m_nX=0; $clPoint->m_nX < $nLargeur; ++$clPoint->m_nX) { for ($clPoint->m_nY=0; $clPoint->m_nY < $nHauteur; ++$clPoint->m_nY) { $dXSource = $dYSource = 0; if (CAPTCHA_DESSIN_SANS_TRANSFORMATION) { $dXSource = $clPoint->m_nX; $dYSource = $clPoint->m_nY; if (CAPTCHA_OPTIM_GD) { $crTexteCouleur = imagecolorat($xpiTexteEffetImage->m_image,$dXSource,$dYSource); if (OBJ_DESACTIVE_CAPTCHA_OPACITE) $crTexteCouleur &= 0x00FFFFFF; } else { $crTexteCouleur->setCouleur($xpiTexteEffetImage->dPixelCouleur($dXSource,$dYSource)); if (!OBJ_DESACTIVE_CAPTCHA_OPACITE) $crTexteCouleur->Fe28c2b57($xpiTexteEffetImage->dPixelOpacite($dXSource,$dYSource)); } } else { $this->F86d4467b($clPoint, $dXSource, $dYSource); $nX1 = $nY1 = 0; $dDeltaX = $dDeltaY = 0; if ($dXSource <= 0) { $nX1 = 0; $dDeltaX = 0.0; } else if ($dXSource >= ($nLargeur - 1)) { $nX1 = $nLargeur - 2; $dDeltaX = 1.0; } else { $nX1 = (int)$dXSource; $dDeltaX = $dXSource - $nX1;} if ($dYSource <= 0) { $nY1 = 0; $dDeltaY = 0.0; } else if ($dYSource >= ($nHauteur - 1)) { $nY1 = $nHauteur - 2; $dDeltaY = 1.0; } else { $nY1 = (int)$dYSource; $dDeltaY = $dYSource - $nY1;} $dPoids0 = (1 - $dDeltaX) * (1 - $dDeltaY); $dPoids1 = $dDeltaX * (1 - $dDeltaY); $dPoids2 = (1 - $dDeltaX) * $dDeltaY; $dPoids3 = $dDeltaX * $dDeltaY; $crCouleur00 = imagecolorat($xpiTexteEffetImage->m_image,$nX1,$nY1); $crCouleur10 = imagecolorat($xpiTexteEffetImage->m_image,$nX1+1,$nY1); $crCouleur01 = imagecolorat($xpiTexteEffetImage->m_image,$nX1,$nY1+1); $crCouleur11 = imagecolorat($xpiTexteEffetImage->m_image,$nX1+1,$nY1+1); $crTexteCouleur = 65536 * intval(($dPoids0 * ($crCouleur00 >> 16 & 0xFF) + $dPoids1 * ($crCouleur10 >> 16 & 0xFF) + $dPoids2 * ($crCouleur01 >> 16 & 0xFF) + $dPoids3 * ($crCouleur11 >> 16 & 0xFF) + 0.5)) +256 * intval(($dPoids0 * ($crCouleur00 >> 8 & 0xFF) + $dPoids1 * ($crCouleur10 >> 8 & 0xFF) + $dPoids2 * ($crCouleur01 >> 8 & 0xFF) + $dPoids3 * ($crCouleur11 >> 8 & 0xFF) + 0.5)) + intval(($dPoids0 * ($crCouleur00 & 0xFF) + $dPoids1 * ($crCouleur10 & 0xFF) + $dPoids2 * ($crCouleur01 & 0xFF) + $dPoids3 * ($crCouleur11 & 0xFF) + 0.5)) ; if (!OBJ_DESACTIVE_CAPTCHA_OPACITE) { $crTexteCouleur += (intval(($dPoids0 * ($crCouleur00 >> 24 & 0xFF) + $dPoids1 * ($crCouleur10 >> 24 & 0xFF) + $dPoids2 * ($crCouleur01 >> 24 & 0xFF) + $dPoids3 * ($crCouleur11 >> 24 & 0xFF) + 0.5) ) & 0xFF) << 24; } else { $crTexteCouleur &= 0x00FFFFFF; } } $this->F9debf546($xpiImageEffetImage, $clPoint, $crTexteCouleur, $crCouleurFond); } } $this->dDebutDessin( (OBJ_DESACTIVE_CAPTCHA_OPACITE && $piPeintreTexte->F0b8659df()) ? dEffacer+dAvecOpacite : dEffacer ); $this->m_fmkImageGD->dCopieImage($xpiImageEffetImage,$this->m_fmkImageGD); unset($xpiImageEffetImage); unset($xpiTexteEffetImage); } function F86d4467b($rclPoint, &$rdXSource, &$rdYSource) { $dX = $rclPoint->m_nX; $dY = $rclPoint->m_nY; $rdXSource = $dX; $dResultat = 0.0; $dValeur = $dX; $rstDistorsion =& $this->m_stModeParametre->m_stModeVague->m_stOndesX; $nMax = $rstDistorsion->nNbOndes+1; while(--$nMax) { $rstOnde =& $rstDistorsion->m_tabOndes[$nMax-1]; $dResultat += $rstOnde->m_dAmplitude * sin($dValeur / $rstOnde->m_dFrequence); } $rdXSource += $dResultat * $rstDistorsion->m_dAmplitude; $dResultat = 0.0; $dValeur = $dX - $dY; $rstDistorsion =& $this->m_stModeParametre->m_stModeVague->m_stOndeYSurX; $nMax = $rstDistorsion->nNbOndes+1; while(--$nMax) { $rstOnde =& $rstDistorsion->m_tabOndes[$nMax-1]; $dResultat += $rstOnde->m_dAmplitude * sin($dValeur / $rstOnde->m_dFrequence); } $rdXSource += $dResultat * $rstDistorsion->m_dAmplitude; $rdYSource = $dY; $dResultat = 0.0; $dValeur = $dY + $dX; $rstDistorsion =& $this->m_stModeParametre->m_stModeVague->m_stOndeY; $nMax = $rstDistorsion->nNbOndes+1; while(--$nMax) { $rstOnde =& $rstDistorsion->m_tabOndes[$nMax-1]; $dResultat += $rstOnde->m_dAmplitude * sin($dValeur / $rstOnde->m_dFrequence); } $rdYSource += $dResultat * $rstDistorsion->m_dAmplitude; } function F9debf546(&$piImageEffetImage, $rclPoint, $crTexteCouleur, $crCouleurFond) { if (CAPTCHA_OPTIM_GD) { $crImageCouleur = imagecolorat($piImageEffetImage->m_image,$rclPoint->m_nX,$rclPoint->m_nY); } else { $crImageCouleur = $piImageEffetImage->dPixelCouleur($rclPoint->m_nX,$rclPoint->m_nY); } $nAlpha = null; if (OBJ_DESACTIVE_CAPTCHA_OPACITE) { if ($crImageCouleur != $crCouleurFond) { if (CAPTCHA_OPTIM_GD) { $crImageCouleur = $crTexteCouleur; } else { $crImageCouleur = $crTexteCouleur->F57dd4c6c(CouleurFormatWL); } } } else { if (CAPTCHA_OPTIM_GD) { if ((($nAlpha=( ($crTexteCouleur>>24) & 0xFF ) ) < 255) && ($crImageCouleur != $crCouleurFond)) { $crImageCouleur = $crTexteCouleur; } } else { if ((($nAlpha=$crTexteCouleur->F43e12208()) < 255) && ($crImageCouleur != $crCouleurFond)) { $crImageCouleur = $crTexteCouleur->F57dd4c6c(CouleurFormatWL); } } } if (CAPTCHA_OPTIM_GD) { imagesetpixel($piImageEffetImage->m_image,$rclPoint->m_nX,$rclPoint->m_nY,$crImageCouleur | ((intval($nAlpha)&0xFF)<<24)); } else { XVERIFY($piImageEffetImage->dPoint($rclPoint->m_nX,$rclPoint->m_nY,$crImageCouleur,$nAlpha)); } } } ?>