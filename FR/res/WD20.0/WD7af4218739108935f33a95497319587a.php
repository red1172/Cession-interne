<?php
//20.0.56.0 IHM/Champ/Calendrier/VueChampcalendrier_Web.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 if (!defined('__INC__IHM/Champ/Calendrier/IVueChampCalendrier.php')) { define('__INC__IHM/Champ/Calendrier/IVueChampCalendrier.php',true); include_once(WB_INCLUDE_PATH.'WD74ad99bc83a9d6ec7fe0b1f73a629e9a.php'); } FMK_Charge("FMK/Dessin/Couleur.php"); FMK_Charge("FMK/Disque/Fichier.php"); if (!defined('__INC__FMK/Wltype.php')) { define('__INC__FMK/Wltype.php',true); include_once(WB_INCLUDE_PATH.'WD6d79f243a7423e4bf72a9488d027d476.php'); } if (!defined('__INC__TYPE/Police.php')) { define('__INC__TYPE/Police.php',true); include_once(WB_INCLUDE_PATH.'WDa064f46531a6c3f4de806f9c4c22dd4b.php'); } if (!defined('__INC__TYPE/Date.php')) { define('__INC__TYPE/Date.php',true); include_once(WB_INCLUDE_PATH.'WD9eb1b78a3600bfc5938930f4f4a2bbcb.php'); } if (!defined('__INC__IHM/Champ/Calendrier/JourCalendrier.php')) { define('__INC__IHM/Champ/Calendrier/JourCalendrier.php',true); include_once(WB_INCLUDE_PATH.'WD5d79653321bdc15d8bd9d52759e1f00a.php'); } if (!defined('__INC__IHM/Champ/CadreLibelle.php')) { define('__INC__IHM/Champ/CadreLibelle.php',true); include_once(WB_INCLUDE_PATH.'WDca2e54604ad98e6dc625c0642acf03cf.php'); } if (!defined('__INC__IHM/Champ/Calendrier/ChampCalendrier.php')) { define('__INC__IHM/Champ/Calendrier/ChampCalendrier.php',true); include_once(WB_INCLUDE_PATH.'WD1aa4dcf1463d195c040c2a3cf17bd5da.php'); } if (!defined('__INC__IHM/Champ/Calendrier/IVueChampCalendrier.php')) { define('__INC__IHM/Champ/Calendrier/IVueChampCalendrier.php',true); include_once(WB_INCLUDE_PATH.'WD74ad99bc83a9d6ec7fe0b1f73a629e9a.php'); } $CGenerationJours_ms_tabEtatStyle = null; function& F073c1f10() { global $CGenerationJours_ms_tabEtatStyle; if (!isset($CGenerationJours_ms_tabEtatStyle)) { $CGenerationJours_ms_tabEtatStyle = array( new stETATJOUR_ELEMENTSTYLE( ETATJOUR_NORMAL , ELEMENTSTYLE_CALENDRIER_JOURBASE ), new stETATJOUR_ELEMENTSTYLE( ETATJOUR_LIGNEIMPAIRE , ELEMENTSTYLE_CALENDRIER_JOURLIGNEIMPAIR ), new stETATJOUR_ELEMENTSTYLE( ETATJOUR_LIGNEPAIRE , ELEMENTSTYLE_CALENDRIER_JOURLIGNEPAIR ), new stETATJOUR_ELEMENTSTYLE( ETATJOUR_DIMANCHE , ELEMENTSTYLE_CALENDRIER_JOURDIMANCHE ), new stETATJOUR_ELEMENTSTYLE( ETATJOUR_SAMEDI , ELEMENTSTYLE_CALENDRIER_JOURSAMEDI ), new stETATJOUR_ELEMENTSTYLE( ETATJOUR_FERIE , ELEMENTSTYLE_CALENDRIER_JOURFERIE ), new stETATJOUR_ELEMENTSTYLE( ETATJOUR_HORSBORNES , ELEMENTSTYLE_CALENDRIER_JOURHORSBORNES ), new stETATJOUR_ELEMENTSTYLE( ETATJOUR_HORSMOIS , ELEMENTSTYLE_CALENDRIER_JOURHORSMOIS ), new stETATJOUR_ELEMENTSTYLE( ETATJOUR_AUJOURDHUI , ELEMENTSTYLE_CALENDRIER_JOURAUJOURDHUI ), new stETATJOUR_ELEMENTSTYLE( ETATJOUR_SELECTION , ELEMENTSTYLE_CALENDRIER_JOURSELECTION ), ); } return $CGenerationJours_ms_tabEtatStyle; } class stETATJOUR_ELEMENTSTYLE { var $eEtatJour; var $eElementStyle; function stETATJOUR_ELEMENTSTYLE($jour,$style) { $this->eEtatJour = $jour; $this->eElementStyle = $style; } } class stGEN_ELEMENTSTYLE { var $m_clSPAN; var $m_pszClass; var $m_clCouleur; } class CChampFilsZR { var $m_pclZRParent; var $m_pclAttribut; var $m_czCodeZR; function CChampFilsZR( &$pclChampCalendrier) { $this->m_pclZRParent =& $pclChampCalendrier->m_pclChampConteneur; $this->m_pclAttribut = null; $this->m_czCodeZR = ''; $pclChampParent =& $pclChampCalendrier->m_pclChampParent; if (isset($pclChampParent) && ($pclChampParent->GetType() == 20002)) $this->m_pclZRParent = null; if (isset($this->m_pclZRParent)) { $this->m_czCodeZR = '_PAGE_.' . $this->m_pclZRParent->Alias . '.value=' . $this->m_pclZRParent->m_nLigneAffichee . ';'; } } } class CGenerationJours extends CChampFilsZR { var $ms_tabEtatStyle; var $m_stInfoMois; var $m_nNbLignes; var $m_cszBordureJour; var $m_czCurseurSouris; var $m_czTDClick; var $m_czBaliseADebut; var $m_clBaliseAFin; var $m_tabCSSStyle; var $m_pszHauteurLigne; var $m_clHTML; function CGenerationJours ( &$pclChampCalendrier) { parent::CChampFilsZR($pclChampCalendrier); $this->m_czCurseurSouris = ''; $this->ms_tabEtatStyle=&F073c1f10(); $this->m_stInfoMois=Fad518364(); $this->m_nNbLignes=0; $pclInterfExe =& Fda6ad30b(); $pclStyleCalendrier =& $pclChampCalendrier->Fd2aab3df(); if (false !== $pclStyleCalendrier->m_bQuadrillage) { if (false !== $pclStyleCalendrier->m_clQuadrillageCouleur->F01589132()) { $clTemp = $pclStyleCalendrier->m_clQuadrillageCouleur->m_dwColor; Fe2f2efa3($this->m_cszBordureJour = "border:1px solid " . $pclInterfExe->F2902774f(COULEURFOND_WEB, $clTemp) . ";"); } } $this->m_czTDClick=utf8_sprintf("\" onclick=\"%scl%s.OnJourClick(event, '" , $this->m_czCodeZR, $pclChampCalendrier->F317347df()); $this->m_czBaliseADebut = utf8_sprintf("<a href=\"javascript:{%scl%s.OnJour(undefined, '",$this->m_czCodeZR,$pclChampCalendrier->F317347df()); $this->m_clBaliseAFin=''; $n = F0bb2840c($this->ms_tabEtatStyle); $this->m_tabCSSStyle = array(); while($n--) $this->m_tabCSSStyle[] = new stGEN_ELEMENTSTYLE(); $this->m_pszHauteurLigne=$pclChampCalendrier->Fd762c94a(OPTIONCALENDRIER_BTNAUJOURDHUI) ? '11%' : '12%'; $this->m_clHTML=''; $this->m_nNbLignes = $pclChampCalendrier->F835e9af9($this->m_stInfoMois); $pszCurseurSourisA = ''; $clCurseurSourisAny = ''; $clCurseurSourisAny = $pclChampCalendrier->F56cebec3(); $pszCurseurSouris = null; if (isset($clCurseurSourisAny)) $pszCurseurSouris = $pclInterfExe->F2902774f(CURSEURSOURIS_WEB,$clCurseurSourisAny); if (F8b98af41($pszCurseurSouris) && (strcmp($pszCurseurSouris, 'auto') != 0)) { $this->m_czCurseurSouris = 'cursor:' . $pszCurseurSouris . ';'; $pszCurseurSourisA = $this->m_czCurseurSouris; } else { $this->m_czCurseurSouris='cursor:pointer;'; $pszCurseurSourisA = ''; } $this->m_clBaliseAFin='\')}" style="text-decoration:none;' . $pszCurseurSourisA . '">'; for ($i = 0; $i < F0bb2840c($this->ms_tabEtatStyle); $i++) { $stOptionsCouleur = new stOPTIONSCOULEUR( false, false ); $pclStyle =& $pclChampCalendrier->vpclGetElementStyleCadreLibelle($this->ms_tabEtatStyle[$i]->eElementStyle,array(&$stOptionsCouleur)); $this->m_tabCSSStyle[$i]->m_clSPAN = '<span class="' . $pclStyle->Fecc05ab6() . '">'; $clFond =& $pclStyle->m_clFond; if (!$pclStyle->m_bFondParDefaut && ($clFond->F01589132() != false)) { $clTemp = intval($clFond->m_dwColor); $this->m_tabCSSStyle[$i]->m_clCouleur = $pclInterfExe->F2902774f(COULEURFOND_WEB, $clTemp); } } } function F5937d6b1( &$pclResultat) { for ($nLigne = 0; $nLigne < $this->m_nNbLignes; $nLigne++) { $this->m_clHTML.="<tr style=\"text-align:center;height:"; $this->m_clHTML.=$this->m_pszHauteurLigne; $this->m_clHTML.="\">"; Fe2f2efa3($this->m_clHTML); for ($nJour = 0; $nJour < NBJOURS_SEMAINE; $nJour++) { $this->Ff61cdf82($this->m_stInfoMois[$nLigne * NBJOURS_SEMAINE + $nJour], ($nLigne+1) % 2); } $this->m_clHTML .= "</tr>" . RC; Fe2f2efa3($this->m_clHTML); } $pclResultat = $this->m_clHTML; } function Ff61cdf82( &$stInfoJour, $bEstImpair) { $this->m_clHTML.="<td style=\"vertical-align:middle;"; Fe2f2efa3($this->m_clHTML); $this->m_clHTML.=$this->m_cszBordureJour; Fe2f2efa3($this->m_clHTML); $this->Fd7e92be4($stInfoJour,$bEstImpair); if (($stInfoJour->nNumero != -1) && !empty($stInfoJour->szDate)) { $this->m_clHTML.= $this->m_czCurseurSouris . $this->m_czTDClick . $stInfoJour->szDate . '\');">' . $this->m_czBaliseADebut . $stInfoJour->szDate . $this->m_clBaliseAFin; Fe2f2efa3($this->m_clHTML); } else { $this->m_clHTML.='">'; Fe2f2efa3($this->m_clHTML); } $nSPANOuvert = $this->F318c80b5($stInfoJour->eEtat); $nSPANOuvert += $this->F7b2fc849($stInfoJour); if ($stInfoJour->nNumero != -1) { $this->m_clHTML .= $stInfoJour->nNumero; Fe2f2efa3($this->m_clHTML); } $this->Fae7fcddc($nSPANOuvert); if (($stInfoJour->nNumero != -1) && !empty($stInfoJour->szDate)) { $this->m_clHTML .= '</a>'; Fe2f2efa3($this->m_clHTML); } $this->m_clHTML .= '</td>'; Fe2f2efa3($this->m_clHTML); } function F021afa8e() { $this->m_clHTML.='</SPAN>'; Fe2f2efa3($this->m_clHTML); } function F46194a62( &$stInfoJour) { $this->F7b2fc849($stInfoJour); } function F7b2fc849( &$stInfoJour) { if (isset($stInfoJour->pclJour)) { $clStyle =& $stInfoJour->pclJour->F06aa9219(); $dwSurcharge = $clStyle->F64634d8a(); if ($dwSurcharge != nSURCHARGESTYLE_AUCUNE) { $this->m_clHTML .= '<span style="'; Fe2f2efa3($this->m_clHTML); $stLogFont = new LOGFONT(); $czTailleCSS=''; $czPoliceCSS=''; $clStyle->F25bb2c10($stLogFont, $czTailleCSS, $czPoliceCSS); $piInterfEXE =& Fda6ad30b(); if (Fdef56c7f($dwSurcharge, nSURCHARGESTYLE_POLICENOM)) { $pszPoliceNom = (empty($czPoliceCSS)) ? $stLogFont->lfFaceName : $czPoliceCSS; if (!empty($pszPoliceNom)) { $this->F51a75cb6('font-family', $pszPoliceNom); } } if (Fdef56c7f($dwSurcharge, nSURCHARGESTYLE_POLICEGRAS)) { if (($stLogFont->lfWeight >= 100) && ($stLogFont->lfWeight <= 900)) { $this->F51a75cb6('font-weight', $stLogFont->lfWeight); } } if (Fdef56c7f($dwSurcharge, nSURCHARGESTYLE_POLICEITALIQUE)) { $this->F51a75cb6('font-style', ($stLogFont->lfItalic ? 'italic' : 'normal') ); } if (Fdef56c7f($dwSurcharge, nSURCHARGESTYLE_POLICESOULIGNE)) { $this->F51a75cb6('text-decoration', ($stLogFont->lfUnderline ? 'underline' : 'none') ); } if (Fdef56c7f($dwSurcharge, nSURCHARGESTYLE_POLICEBARRE)) { $this->F51a75cb6('text-decoration', ($stLogFont->lfUnderline ? 'line-through' : 'none') ); } if (Fdef56c7f($dwSurcharge, nSURCHARGESTYLE_POLICETAILLE)) { $dTaille = -((double)$stLogFont->lfHeight * 72.0) / 96.0; $nTaille = intval($dTaille); if ($dTaille - floor($dTaille) > 0.5) ++$nTaille; $szTemp = $nTaille . 'px'; $this->F51a75cb6('font-size', $szTemp); } if (Fdef56c7f($dwSurcharge, nSURCHARGESTYLE_VALIGN)) { $clTemp = $clStyle->F31f5beee(); $this->F51a75cb6('vertical-align', $piInterfEXE->F2902774f(CADRAGEV_WEB, $clTemp)); } if (Fdef56c7f($dwSurcharge, nSURCHARGESTYLE_HALIGN)) { $clTemp = $clStyle->Fd96630e3(); $this->F51a75cb6('text-align', $piInterfEXE->F2902774f(CADRAGEH_WEB, $clTemp)); } if (Fdef56c7f($dwSurcharge, nSURCHARGESTYLE_COULEURFOND)) { $clTemp = intval( $clStyle->m_clFond->m_dwColor ) ; $this->F51a75cb6('background-color', $piInterfEXE->F2902774f(COULEURFOND_WEB, $clTemp)); } if (Fdef56c7f($dwSurcharge, nSURCHARGESTYLE_COULEURTEXTE)) { $clColor = $clStyle->F1034101c(); $clTemp = intval( $clColor->m_dwColor ); $this->F51a75cb6('color', $piInterfEXE->F2902774f(COULEUR_WEB, $clTemp)); } $this->m_clHTML.='">'; Fe2f2efa3($this->m_clHTML); return 1; } } return 0; } function F51a75cb6( $pszNom, $pszValeur) { $this->m_clHTML .= $pszNom . ':' . $pszValeur . ';'; Fe2f2efa3($this->m_clHTML); } function Fd7e92be4( $stInfoJour,$bEstImpair) { if (isset($stInfoJour->pclJour)) { $clStyle =& $stInfoJour->pclJour->F06aa9219(); if (Fdef56c7f($clStyle->F64634d8a(), nSURCHARGESTYLE_COULEURFOND)) { $clTemp=intval($clStyle->m_clFond->m_dwColor); $pclInterfEXE =& Fda6ad30b(); $this->F51a75cb6('background-color',$pclInterfEXE->F2902774f(COULEURFOND_WEB, $clTemp)); return; } } $eEtatJour = $stInfoJour->eEtat; $pszCouleur = null; for ($i = F0bb2840c($this->ms_tabEtatStyle) - 1; $i > 0; $i--) { if (Fdef56c7f($eEtatJour, $this->ms_tabEtatStyle[$i]->eEtatJour)) { if ($this->m_tabCSSStyle[$i]->m_clCouleur!='') { if ($bEstImpair && ($i==2)) continue; $pszCouleur = $this->m_tabCSSStyle[$i]->m_clCouleur; break; } } } if (null === $pszCouleur) { $pszCouleur = $this->m_tabCSSStyle[0]->m_clCouleur; } if (F8b98af41($pszCouleur)) { $this->F51a75cb6('background-color', $pszCouleur); } else { } } function F318c80b5( $eEtatJour) { $this->m_clHTML.=$this->m_tabCSSStyle[0]->m_clSPAN; Fe2f2efa3($this->m_clHTML); $nNbSPANOuvert = 1; for ($i = 1; $i < F0bb2840c($this->ms_tabEtatStyle); $i++) { if (Fdef56c7f($eEtatJour, $this->ms_tabEtatStyle[$i]->eEtatJour)) { $this->m_clHTML .= $this->m_tabCSSStyle[$i]->m_clSPAN; Fe2f2efa3($this->m_clHTML); ++$nNbSPANOuvert; } } return $nNbSPANOuvert; } function F5b4bdd72( $nNbSPAN) { while ($nNbSPAN-- > 0) { $this->m_clHTML.='</span>'; Fe2f2efa3($this->m_clHTML); } } function Fae7fcddc($p=null) { if (isset($p)) $this->F5b4bdd72($p); else $this->F021afa8e(); } function F1baaf559(&$rclDate, &$rcszJourFormate) {UNUSED($rclDate);UNUSED($rcszJourFormate);} } class CVueChampCalendrier_Web extends CVueChamp_Web { function CVueChampCalendrier_Web(&$pclModele) { parent::CVueChamp_Web($pclModele); } function& Fc12fc07f() { return $this; } function& Fde9abc90() { return $this->Fda201604(); } function F876d90ab() { return true; } function F45e104ce( $e, $j, $nInfoSuppl) { $this->F65a54541(VUEMODIF_UPDATECONTENU, nOMM_DEFAUT, $nInfoSuppl); } function F823cf1cb() { } function Ff21e9a2d( $i, $s1, $s2) { $this->F65a54541(VUEMODIF_UPDATECONTENU, nOMM_DEFAUT, 0); } function F941a3dcb( $ePropriete, $nFlag, $pParam) { if ($ePropriete != PROP_INVALID_MIN) $pParam = 0; parent::F941a3dcb($ePropriete, $nFlag, $pParam); } function F1f68ed08( $clPropCodeHTML, &$pclResultat, &$ppczResultatStatique) { switch ($clPropCodeHTML->Fc30871c3()) { case PARTIE_CODEHTML_CONTENUTOTAL: return parent::F1f68ed08($clPropCodeHTML, $pclResultat, $ppczResultatStatique); case PARTIE_CODEHTML_CALENDRIER_NOMMOIS: { $pclModeleChampCalendrier =& $this->Fde9abc90(); $czResultat = null; $pclModeleChampCalendrier->Fc2b10dbe($czResultat); $pclResultat = $czResultat; } return false; case PARTIE_CODEHTML_CALENDRIER_NOMJOUR: $pclModeleChampCalendrier =& $this->Fde9abc90(); $pclResultat = $pclModeleChampCalendrier->F43597a4b($clPropCodeHTML->F2d263eef()); return false; case PARTIE_CODEHTML_CALENDRIER_AUJOURDHUI: $pclModeleChampCalendrier =& $this->Fde9abc90(); $pclResultat = $pclModeleChampCalendrier->Fe8ac5465(); return false; case PARTIE_CODEHTML_CALENDRIER_JOURS: { $pclCal =& $this->Fde9abc90(); $clGenerationJours = new CGenerationJours($pclCal); $clGenerationJours->F5937d6b1($pclResultat); } return true; case PARTIE_CODEHTML_CALENDRIER_BTNMOIS_VIS: { $eZone = ($clPropCodeHTML->F2d263eef() == 0) ? eCalBtnMoisPrecedent : eCalBtnMoisSuivant; $pclModeleChampCalendrier =& $this->Fde9abc90(); $ppczResultatStatique = $pclModeleChampCalendrier->bBoutonEstGrise($eZone) ? '0' : '1'; return false; } case PARTIE_CODEHTML_CALENDRIER_MOISCOURANT: $pclModeleChampCalendrier =& $this->Fde9abc90(); $pclMoisCourant =& $pclModeleChampCalendrier->Fed58e9ca(); $ppczResultatStatique = $pclMoisCourant->F09992612(); return false; default: return parent::F1f68ed08($clPropCodeHTML, $pclResultat, $ppczResultatStatique); } } function& F53d6c6b5(&$pclChampCalendrier, &$pclStyleJourA,&$rclStyleJourB) { return F4322d50a($pclStyleJourA, $rclStyleJourB, $pclChampCalendrier); } function& F7d423baa(&$pclChampCalendrier, &$pclStyleJourOriginal) { return F34d35b49($pclStyleJourOriginal, $pclChampCalendrier); } function& Fc7cf258a(&$pclChampCalendrier, $nLigne, &$rstInfoJour) { $pclStyle =& $pclChampCalendrier->Fd2aab3df(); $pclStyleJour = _clone($pclStyle->m_clJourBase); if ($nLigne % 2 === 1) { $pclStyleJour =& $this->F53d6c6b5($pclChampCalendrier, $pclStyleJour, $pclStyle->m_clJourLignePair); } else { $pclStyleJour =& $this->F53d6c6b5($pclChampCalendrier, $pclStyleJour, $pclStyle->m_clJourLigneImpair ); } if (Fdef56c7f($rstInfoJour->eEtat, ETATJOUR_DIMANCHE)) { $pclStyleJour =& $this->F53d6c6b5($pclChampCalendrier, $pclStyleJour, $pclStyle->m_clJourDimanche); } if (Fdef56c7f($rstInfoJour->eEtat, ETATJOUR_SAMEDI)) { $pclStyleJour =& $this->F53d6c6b5($pclChampCalendrier, $pclStyleJour, $pclStyle->m_clJourSamedi); } if (Fdef56c7f($rstInfoJour->eEtat, ETATJOUR_FERIE)) { $pclStyleJour =& $this->F53d6c6b5($pclChampCalendrier, $pclStyleJour, $pclStyle->m_clJourFerie); } if (Fdef56c7f($rstInfoJour->eEtat, ETATJOUR_HORSBORNES)) { $pclStyleJour =& $this->F53d6c6b5($pclChampCalendrier, $pclStyleJour, $pclStyle->m_clJourHorsBornes ); } $bHorsMois = Fdef56c7f($rstInfoJour->eEtat, ETATJOUR_HORSMOIS); if ($bHorsMois) { $bSansJourHorsMois = $pclChampCalendrier->Fd762c94a(OPTIONCALENDRIER_HORSMOISMASQUE); if ($bSansJourHorsMois) { $pclStyleJour =& $pclStyle->m_clJourHorsMois; return $pclStyleJour; } $pclStyleJour =& $this->F53d6c6b5($pclChampCalendrier, $pclStyleJour, $pclStyle->m_clJourHorsMois ); } if (Fdef56c7f($rstInfoJour->eEtat, ETATJOUR_AUJOURDHUI)) { $pclStyleJour =& $this->F53d6c6b5($pclChampCalendrier, $pclStyleJour, $pclStyle->m_clJourAujourdhui ); } if ( ($rstInfoJour->pclJour !== null) && (!$bHorsMois || $pclChampCalendrier->Fd762c94a(OPTIONCALENDRIER_HORSMOISSTYLE)) ) { $pclStyleJour =& $this->F53d6c6b5($pclChampCalendrier, $pclStyleJour, $rstInfoJour->pclJour->F06aa9219() ); } if (Fdef56c7f($rstInfoJour->eEtat, ETATJOUR_SELECTION)) { $pclStyleJour =& $this->F53d6c6b5($pclChampCalendrier, $pclStyleJour, $pclStyle->m_clJourSelection ); } $clCouleurTexte = $pclStyleJour->F1034101c(); if ($clCouleurTexte->F01589132() === false) { $pclStyleJour =& $this->F7d423baa($pclChampCalendrier, $pclStyleJour); if (F5f7235e7($rstInfoJour->eEtat, ETATJOUR_HORSBORNES)) { $pclStyleJour->F140ec365(dwCouleurLienNavigateur); } else { $pclStyleJour->F140ec365(dwCouleurNoir); } } if ( (F2c8bba73($rstInfoJour->eEtat, ETATJOUR_LIGNEIMPAIRE | ETATJOUR_LIGNEPAIRE) !== $rstInfoJour->eEtat) && (ID_AGENDA === $pclChampCalendrier->Feb661866()) && (eZoomMois === $pclChampCalendrier->m_eModeZoom)) { if (F5f7235e7($rstInfoJour->eEtat, ETATJOUR_AUJOURDHUI)) { $rclStyleJour =& $pclStyle->m_clJourBase; } else { $rclStyleJour =& $pclStyle->m_clJourAujourdhui; } $pclStyleJour->m_clBordClair = $rclStyleJour->m_clBordClair; $pclStyleJour->m_clBordFonce = $rclStyleJour->m_clBordFonce; $pclStyleJour->m_nEpaisseur = $rclStyleJour->m_nEpaisseur; } return $pclStyleJour; } function Ffe7732d3(&$pclChampCalendrier , $nNumJourDansMois , $bJourDansMois , $bMoisEtAnneeVisibleDansTitre , &$rcszLibelleJour) { $rcszLibelleJour = (string)intval($nNumJourDansMois); if ( (1 === $nNumJourDansMois) && $bJourDansMois && !$bMoisEtAnneeVisibleDansTitre) { FMK_Charge('WL/STD/Std.php',false); $rcszLibelleJour = DateVersChaine($pclChampCalendrier->m_clMoisCourant->F09992612(),'(MMM AAAA) J'); } } } class CVueChampAgenda_Web extends CVueChampCalendrier_Web { var $m_pclEditTitreRDVInPlace = null; var $m_czMasqueTitreJour = ''; var $m_cszImageBtnPrecedent=''; var $m_cszImageBtnSuivant=''; var $m_bToutModifie=true; var $m_tabIDEvenementsModifies; function CVueChampAgenda_Web(&$pclModele) { parent::CVueChampCalendrier_Web($pclModele); $this->m_czMasqueTitreJour = 'JJJJ J'; if (null !== $pclModele) { $pclStyle =& $pclModele->m_pclStyle; if (null !== $pclStyle) { $this->Fb1e7e3dc($pclStyle->m_czImageBtnPrecedent, $this->m_cszImageBtnPrecedent); $this->Fb1e7e3dc($pclStyle->m_czImageBtnSuivant, $this->m_cszImageBtnSuivant); } } $this->m_tabIDEvenementsModifies = array(); } function F73db2270(&$rtabEvenements) { $this->_GestEveMemeDate($this->m_pclModele, $rtabEvenements); } function F5c5271a6() { return 2 | 1; } function F9f6a2f18() { } function F941a3dcb( $ePropriete, $nFlag, $pParam) { if (F5f7235e7($nFlag, nOMM_DEPUISSOUSELEMENT)) { $this->m_bToutModifie = true; $this->m_tabIDEvenementsModifies = array(); } parent::F941a3dcb($ePropriete, $nFlag, $pParam); } function Ffb378882(&$rclDate , $bDessineLigneTitreNumSemaine , $bDessineLigneTitreNomDuMois , &$rcszJourFormate) { if (false !== $bDessineLigneTitreNumSemaine) { $czNumeroDeSemaineFormatee = ''; $pclModele =& $this->m_pclModele; $pclModele->F0ceb67f5($rclDate, $czNumeroDeSemaineFormatee); if (false !== $bDessineLigneTitreNomDuMois) { $nPosition = strpos($rcszJourFormate,'|'); if ($nPosition !== false) { $rcszJourFormate = substr_replace($rcszJourFormate,$czNumeroDeSemaineFormatee . '|',$nPosition,1); } else { $rcszJourFormate .= '|' . $czNumeroDeSemaineFormatee; } } else { $rcszJourFormate = $czNumeroDeSemaineFormatee . '|' . $rcszJourFormate; } } } function F1baaf559(&$rclDate, &$rcszJourFormate) { $pclModele =& $this->m_pclModele; $this->Ffb378882( $rclDate , $pclModele->Fcb7727d8() , false , $rcszJourFormate); } function F2daa5fea(&$pczMasqueTitreJour) { $pczMasqueTitreJour = 'JJJJ J'; } function F2d44acc1(&$pczMasqueTitreJour) { return $this->F2daa5fea($pczMasqueTitreJour); } function Fb7da1be5($pclChampAgenda) { return $pclChampAgenda->F919da3cf(); } function F30407b8e(&$pclChampAgenda) { $nHauteurTitre = $this->Fb7da1be5($pclChampAgenda); if ($pclChampAgenda->Fcb7727d8()) { $nHauteurTitre += $this->Fb7da1be5($pclChampAgenda); } return $nHauteurTitre; } function F876d90ab() { return false; } function Fe7708280(&$pclChampAgenda) { return Fc87fa6b6($pclChampAgenda, $pclChampAgenda->m_eModeZoom); } function Fdf03a221($clCouleurTitre) { return $this->Fd6ff1800($clCouleurTitre, 1); } function F11ed2f8c($clCouleurBordure) { return $this->Fd6ff1800($clCouleurBordure, 2); } function F4a49c746(&$pclChampAgenda) { $eModeZoom = $this->Ff79dc29d($pclChampAgenda); return ( $pclChampAgenda->Fcb923550() && (($eModeZoom === eZoomJournee) || ($eModeZoom === eZoomSemaine))); } function Ff79dc29d(&$pclChampAgenda) { if ($pclChampAgenda === null) return eZoomSemaine; return $pclChampAgenda->m_eModeZoom; } function Fb1e7e3dc($cszNomImage, &$rcszNomImageWeb) { $rcszNomImageWeb = utf8_str_replace(DIRECTORY_SEPARATOR,'/',$cszNomImage); } function Fd83eab1c(&$rclDate,$nOptionDV,$nZone) { if (($nOptionDV == 1) && ($this->m_pclModele->m_eModeZoom != eZoomMois)) { $clDateDuJourMin = new CDateAgenda($rclDate); $clDateDuJourMin->m_dwHeure = $this->m_pclModele->m_clHeureDebutAff->m_dwHeure; $clDateDuJourMax = new CDateAgenda($rclDate); $clDateDuJourMax->m_dwHeure = $this->m_pclModele->m_clHeureFinAff->m_dwHeure; return ( $this->Fd83eab1c($clDateDuJourMin, 0,$nZone) && $this->Fd83eab1c($clDateDuJourMax, 0,$nZone)); } $clDateDebut = new CDateAgenda(); $clDateFin = new CDateAgenda(); $this->F0924d395($clDateDebut, $clDateFin); return $rclDate->F071fcbff($clDateDebut, $clDateFin); } function Fb9c6a718(&$rclDateAvant, &$rclDateApres) { } function F013adc8c(&$pclEvenement) { $this->Fd1b9bf3f(PROP_INVALID_MIN, $this->m_pclModele->F6e4a8c18($pclEvenement), nOMM_DEFAUT); } function Fe5801fdf(&$pclNewEvenement, $nNewEvenement, $pszSaisieInitiale) { $this->m_pclEditTitreRDVInPlace =& $pclNewEvenement; return true; } function F0924d395( &$rclDateMin, &$rclDateMax) { $this->F1d236653($rclDateMin, $rclDateMax); $rclDateMin->Fadb98d95(); $rclDateMax->F35ed58e9(); } function F1d236653( &$rclDateMin, &$rclDateMax) { $this->m_pclModele->F7d08dde4($rclDateMin, $rclDateMax); } function Ffc95365e($pwzParam, $eDernier, $pszMasque, &$rclParametres) { $rclParametres->F13314aff($pwzParam,false); $rclParametres->F702c3cec(); FMK_Charge('WL/STD/Std.php',false); $szHeureBrute = '00000000'; for ($nHeure = 0; $nHeure < 24; ++$nHeure) { $sHeure = F04e7ba0d((string)($nHeure)); $szHeureBrute[0] = $sHeure[0]; $szHeureBrute[1] = $sHeure[1]; $cszHeureFormate = HeureVersChaine($szHeureBrute,$pszMasque); $rclParametres->F23e52de1('', ($nHeure !== 23) ? DERNIER_NON : DERNIER_OUI, true, $cszHeureFormate); } $rclParametres->Ff1f57391($eDernier); } function F0455f0d7($pwzParam, $eDernier, $pszMasqueTitreJour, $eModeZoom, &$rclDateDebut, &$rclDateFin, &$rclParametres) { $pclModele =& $this->Fda201604(); $clMasqueTitreJourMMM = new CMasqueDateHeure($pszMasqueTitreJour . ' (MMM)', true, 'AAAAMMJJ'); $clMasqueTitreJour = new CMasqueDateHeure($pszMasqueTitreJour , true, 'AAAAMMJJ'); $rclParametres->F702c3cec($pwzParam); $clAujourdhui = new CDateTime(); $clAujourdhui->Ff04c7c3b(); $clDate = new CDateTime($rclDateDebut); $cszJourFormate=''; $bMoisEtAnneeVisibleDansTitre = $this->F876d90ab(); $clMoisCourant = new CDateAgenda(); $clMoisCourant->F11eb7106($pclModele->m_clMoisCourant->nGetAnnee(),$pclModele->m_clMoisCourant->nGetMois(),$pclModele->m_clMoisCourant->nGetJour()); $bFini = false; $bMasqueTitreJourEtMois=$pclModele->m_bAjoutMoisDansPremierLibelle && (strpos($pszMasqueTitreJour,'M')===false); do { $rclParametres->F105675ec(); $szJourBrut=''; $bDansMoisCourant = false; switch ($eModeZoom) { case eZoomMois: case eZoomAnnee: $bDansMoisCourant = ($clDate->nGetMois() == $clMoisCourant->nGetMois()); $this->Ffe7732d3( $pclModele , $clDate->nGetJour() , $bDansMoisCourant , $bMoisEtAnneeVisibleDansTitre , $cszJourFormate); break; default: $szJourBrut = $clDate->VersChaine(); $cszJourFormate = ''; if ($bMasqueTitreJourEtMois) $clMasqueTitreJourMMM->F407a3c7c($szJourBrut,$cszJourFormate); else $clMasqueTitreJour->F407a3c7c($szJourBrut,$cszJourFormate); } $this->F1baaf559($clDate, $cszJourFormate); if (0 === Fb742c179($clDate, $clAujourdhui)) $rclParametres->F7373ec8a('m_bAujourdhui', DERNIER_NON, true); $szJourBrut = utf8_substr($szJourBrut,0,LONGUEUR_DATE); if (false != F548dbb0a($szJourBrut)) $rclParametres->F7373ec8a('m_bFerie', DERNIER_NON, true); switch ($eModeZoom) { case eZoomMois: if (false == $bDansMoisCourant) $rclParametres->F7373ec8a('m_bHorsPeriode', DERNIER_NON, true); break; case eZoomAnnee: break; } $rclParametres->F23e52de1('m_sLibelle', DERNIER_OUI, ENCODAGE_CHAINE, $cszJourFormate); $clDate->Fee154cfe(1); $bFini = (1 === $clDate->Ff5b208cb($rclDateFin)); $rclParametres->F1ebdc972($bFini ? DERNIER_OUI : DERNIER_NON); $bMasqueTitreJourEtMois=false; } while (false === $bFini); $rclParametres->Ff1f57391($eDernier); } function F7b48517b($pwzParam, $eDernier, $eElement, &$rclParametres) { $stOptionsCouleur = new stOPTIONSCOULEUR(false, false); $pclStyle =& $this->m_pclModele->vpclGetElementStyleCadreLibelle($eElement, array(&$stOptionsCouleur)); $pclStyleBase =& $this->m_pclModele->vpclGetElementStyleCadreLibelle(ELEMENTSTYLE_CALENDRIER_JOURBASE, array(&$stOptionsCouleur)); $xpclStyleEffectif =& $this->F53d6c6b5($this->m_pclModele, $pclStyleBase, $pclStyle); $this->Fc4aa24e5($pwzParam, $eDernier, $xpclStyleEffectif,false,false, $rclParametres); } function Fd521dde0($pwzParam, $eDernier, $eElement, &$rclParametres) { $stOptionsCouleur = new stOPTIONSCOULEUR(false, false); $pclStyle =& $this->m_pclModele->vpclGetElementStyleCadreLibelle($eElement, array(&$stOptionsCouleur)); $this->Fc4aa24e5($pwzParam, $eDernier, $pclStyle,false,false, $rclParametres); } function F7a3d9884($pwzParam, $eDernier, $eElement,$bFondDegrade,$bVideSiTransparent, &$rclParametres) { $stOptionsCouleur = new stOPTIONSCOULEUR(false, false); $pclStyle =& $this->m_pclModele->vpclGetElementStyleCadreLibelle($eElement, array(&$stOptionsCouleur)); $this->Fc4aa24e5($pwzParam, $eDernier, $pclStyle,$bFondDegrade,$bVideSiTransparent, $rclParametres); } function Fc738e892($pwzParam, $eDernier, $eEtat, $eModeZoom, &$rclDate, &$rclParametres) { $stInfoJour = new stINFOJOUR($eEtat, $rclDate->nGetJour(), null, '' ); switch ($eModeZoom) { case eZoomMois: case eZoomAnnee: { $xpclStyle =& $this->Fc7cf258a($this->m_pclModele,1,$stInfoJour); $this->Fc4aa24e5($pwzParam. 'Pair', $eDernier, $xpclStyle, false, false, $rclParametres); } break; } $xpclStyle =& $this->Fc7cf258a($this->m_pclModele,0,$stInfoJour); $this->Fc4aa24e5($pwzParam, $eDernier, $xpclStyle,false,false, $rclParametres); } function Fc4aa24e5($pwzParam, $eDernier, &$pclStyle,$bFondDegrade,$bVideSiTransparent, &$rclParametres) { $clFond = $clClair = $clFonce = null; $pclStyle->F2e562fe8($clClair, $clFonce, $clFond); $nEpaisseur = $pclStyle->m_nEpaisseur; $rclParametres->F105675ec($pwzParam); $rclParametres->F9d08d63c('m_cFond', DERNIER_NON, false, $bVideSiTransparent, $clFond); if ($bFondDegrade) { $rclParametres->F9d08d63c('m_cFondDegrade', DERNIER_NON, false, false, $this->Fdf03a221($clFond)); } if (false !== $this->m_pclModele->Ffa0a9b1c($clClair)) $clClair = Ffc5d2da8(); if (($nEpaisseur > 0) && (false !== $clClair->F01589132())) { $rclParametres->F4ccc5457('m_nBordureV', DERNIER_NON, $nEpaisseur); $rclParametres->F9d08d63c('m_cBordureV', DERNIER_NON, false, true, $clClair); } $rclParametres->F23e52de1('m_sClasses', DERNIER_OUI, true, $pclStyle->Fecc05ab6()); $rclParametres->F8d12b2f5($eDernier); } function F9bc4c544($ePropriete, $nIndex, $nFlag, $nParam) { if ( (PROP_INVALID_MIN === $ePropriete) && (false === $this->m_bToutModifie)) { if (-1 !== $nIndex) { $pclModele =& $this->m_pclModele; $pclEvenement = $pclModele->Faa22a1bf($nIndex); if (isset($pclEvenement)) { $dwID = $pclEvenement->m_dwIDUnique; if (!isset($this->m_tabIDEvenementsModifies[$dwID])) { $this->m_tabIDEvenementsModifies[$dwID] = true; } } } else { F27efdc07($nFlag, nOMM_DEPUISSOUSELEMENT); } } $this->F941a3dcb(PROP_INVALID_MIN, $nFlag, $nParam); } function Fc1c131ec() { return ((false !== $this->m_bToutModifie) || (false === Feef890d7())); } function F5d67aaa5($eDernier, &$rclParametres) { $bToutModifieEffectif = $this->Fc1c131ec(); $rclParametres->F7373ec8a('m_bToutModifie', DERNIER_NON, $bToutModifieEffectif); $this->F1b96c4c0('m_tabRendezVous', $eDernier, $bToutModifieEffectif, $rclParametres); $null = null; $this->m_pclEditTitreRDVInPlace =& $null; unset($null); return true; } function Fd0d72590($eDernier,&$rclParametres) { $pclModele =& $this->m_pclModele; $eModeZoom = $pclModele->m_eModeZoom; $this->Fa692cba0( 1 , $this->F30407b8e($pclModele) , $this->Fe7708280($pclModele) , $eModeZoom , $rclParametres); switch ($eModeZoom) { case eZoomJournee: case eZoomSemaine: $rclParametres->F4ccc5457('m_nNbJoursSemaine', DERNIER_NON, $pclModele->m_nNbJourModeSemaine); $rclParametres->F7373ec8a('m_bLigneTitreSemaine', DERNIER_NON, $pclModele->Fcb7727d8()); break; case eZoomMois: $this->F914c1476('m_tabNomJoursSemaine', DERNIER_NON, $rclParametres); break; } $rclParametres->F7373ec8a('m_bAccesAuxHeuresNonAffichees', DERNIER_NON, $pclModele->m_bAccesAuxHeuresNonAffichees); $rclParametres->F4ccc5457('m_eModeZoom', $eDernier, $eModeZoom); return true; } function Fa692cba0($nDimensionLateralePxConteneurMin , $nHauteurTitresHorizontal , $nLargeurTitresVertical , $eModeZoom , &$rclParametres) { $pclModele =& $this->m_pclModele; $clDateDebut = new CDateAgenda(); $clDateFin = new CDateAgenda(); $this->F0924d395($clDateDebut, $clDateFin); $rclParametres->F66e5880a('m_oDateDebut', DERNIER_NON, $clDateDebut); $rclParametres->F66e5880a('m_oDateFin', DERNIER_NON, $clDateFin); $clResolution = new FMK_Date_Duree(F04e7ba0d('',10,true),'JHHMMSSLLL'); $pclModele->F76763e0b($clResolution, 3); $rclParametres->F4ccc5457('m_nResolution', DERNIER_NON, $clResolution->F1ba6a9e4()); $pclModele->F76763e0b($clResolution, 2); $rclParametres->F4ccc5457('m_nResolutionGrille', DERNIER_NON, $clResolution->F1ba6a9e4()); $pclModele->F76763e0b($clResolution, 0); $rclParametres->F4ccc5457('m_nResolutionDeplacement', DERNIER_NON, $clResolution->F1ba6a9e4()); $pclModele->F76763e0b($clResolution, 1); $rclParametres->F4ccc5457('m_nResolutionTaille', DERNIER_NON, $clResolution->F1ba6a9e4()); $nRendezVousSelection = $pclModele->m_nElemSelect; if (-1 !== $nRendezVousSelection) { $pclRendezVous =& $pclModele->F30c4a4e3(); if (null !== $pclRendezVous) { $this->F538f01fd('m_sIDSelection', DERNIER_NON, $pclRendezVous, $rclParametres); if (serialize($this->m_pclEditTitreRDVInPlace) === serialize($pclRendezVous)) { $rclParametres->F7373ec8a('m_bEditTitreRDVSelection', DERNIER_NON, true); $null = null; $this->m_pclEditTitreRDVInPlace =& $null; unset($null); } } } $null = null; $this->m_pclEditTitreRDVInPlace =& $null; unset($null); $rclParametres->Ff0b0a50e('m_nHeureOuvrableMin', DERNIER_NON, $pclModele->m_clHeureOuvrableMin); $rclParametres->Ff0b0a50e('m_nHeureOuvrableMax', DERNIER_NON, $pclModele->m_clHeureOuvrableMax); $rclParametres->Ff0b0a50e('m_nHeureAfficheMin', DERNIER_NON, $pclModele->m_clHeureDebutAff); $rclParametres->Ff0b0a50e('m_nHeureAfficheMax', DERNIER_NON, $pclModele->m_clHeureFinAff); $rclParametres->F4ccc5457('m_nPremierJourSemaine', DERNIER_NON, $pclModele->Fca04e360()); $bActif = ($pclModele->Etat == ETAT_CHAMP_ACTIF); $rclParametres->F7373ec8a('m_bDeplacementRendezVous', DERNIER_NON, $bActif && $pclModele->m_bDeplaceEvenementParUser); $rclParametres->F7373ec8a('m_bRedimensionnementRendezVous', DERNIER_NON, $bActif && $pclModele->m_bRedimEvenementParUser); $rclParametres->F7373ec8a('m_bEditionRendezVous', DERNIER_NON, $bActif && (false === $pclModele->m_bEditInPlaceInterdit)); $rclParametres->F7373ec8a('m_bSelectionPeriode', DERNIER_NON, $bActif && $pclModele->m_bSelectPeriodeParUser); $rclParametres->F7373ec8a('m_bSupprimeParUtilisateur', DERNIER_NON, $bActif && $pclModele->Fd359811d()); $rclParametres->F7373ec8a('m_bAfficherTitreRendezVous', DERNIER_NON, $pclModele->m_bAfficherTitreRendezVous); $bZoneJourneeComplete = $pclModele->Fdbe16bf0(); $bAvecBoutonsChangePeriodeEffectif = $this->F4a49c746($pclModele); if (false !== $bAvecBoutonsChangePeriodeEffectif && $pclModele->Etat != ETAT_CHAMP_GRISE) { $clDateDebutSuivante = new CDateAgenda(); $clDateDebutPrecedente = new CDateAgenda(); $pclModele->Fc9d0a157($clDateDebutPrecedente); $pclModele->Fa46249be($clDateDebutSuivante); $rclParametres->F66e5880a('m_oDateDebutPrecedente', DERNIER_NON, $clDateDebutPrecedente); $rclParametres->F66e5880a('m_oDateDebutSuivante', DERNIER_NON, $clDateDebutSuivante); $rclParametres->F23e52de1('m_sImageBtnPeriodePrecedente', DERNIER_NON, true, $this->m_cszImageBtnPrecedent); $rclParametres->F23e52de1('m_sImageBtnPeriodeSuivante', DERNIER_NON, true, $this->m_cszImageBtnSuivant); } $rclParametres->F4ccc5457('m_eModeSuperposition', DERNIER_NON, $pclModele->m_eModesuperposition); $this->Ffc95365e('m_tabFormatHeure', DERNIER_NON, $pclModele->Fb6247526(), $rclParametres); $this->F6057e8a2($pclModele); $this->F0455f0d7('m_tabJours', DERNIER_NON, $this->m_czMasqueTitreJour, $eModeZoom, $clDateDebut, $clDateFin, $rclParametres); $this->Fc738e892('m_oStyleNormal', DERNIER_NON, ETATJOUR_NORMAL, $eModeZoom ,$clDateDebut, $rclParametres); $this->Fc738e892('m_oStyleSelection', DERNIER_NON, ETATJOUR_SELECTION, $eModeZoom, $clDateDebut, $rclParametres); $this->Fc738e892('m_oStyleAujourdhui', DERNIER_NON, ETATJOUR_AUJOURDHUI, $eModeZoom, $clDateDebut, $rclParametres); $this->Fc738e892('m_oStyleSamedi', DERNIER_NON, ETATJOUR_SAMEDI, $eModeZoom, $clDateDebut, $rclParametres); $this->Fc738e892('m_oStyleDimanche', DERNIER_NON, ETATJOUR_DIMANCHE, $eModeZoom, $clDateDebut, $rclParametres); $this->Fc738e892('m_oStyleHorsBornes', DERNIER_NON, ETATJOUR_HORSBORNES, $eModeZoom, $clDateDebut, $rclParametres); $this->Fc738e892('m_oStyleHorsMois', DERNIER_NON, ETATJOUR_HORSMOIS, $eModeZoom, $clDateDebut, $rclParametres); $this->F7b48517b('m_oStyleLibRessource', DERNIER_NON, ELEMENTSTYLE_CALENDRIER_LIBMOIS, $rclParametres); $this->F7b48517b('m_oStyleLibJourSemaine', DERNIER_NON, ELEMENTSTYLE_CALENDRIER_LIBJOURSEMAINE, $rclParametres); $this->F7b48517b('m_oStyleLibNumeroSemaine', DERNIER_NON, ELEMENTSTYLE_AGENDA_LIBNUMEROSEMAINE, $rclParametres); $this->F7b48517b('m_oStyleLibNomMois', DERNIER_NON, ELEMENTSTYLE_AGENDA_LIBNOMMOIS, $rclParametres); $this->F7b48517b("m_oStyleJourneeComplete", DERNIER_NON, ELEMENTSTYLE_AGENDA_JOURNEECOMPLETE, $rclParametres); if (false !== $bAvecBoutonsChangePeriodeEffectif) { $this->F7a3d9884('m_oStyleBtnSuivPrec', DERNIER_NON, ELEMENTSTYLE_CALENDRIER_BTNSUIVPREC, false, false,$rclParametres); } $this->Fc738e892('m_oStyleFerie', DERNIER_NON, ETATJOUR_FERIE, $eModeZoom, $clDateDebut, $rclParametres); $this->F7a3d9884('m_oStyleLibHeure', DERNIER_NON, ELEMENTSTYLE_AGENDA_LIBHEURE, false, false,$rclParametres); $this->F7a3d9884('m_oStyleRendezVous', DERNIER_NON, ELEMENTSTYLE_AGENDA_RENDEZVOUS, true, false,$rclParametres); $this->F7a3d9884('m_oStyleRendezVousSelect', DERNIER_NON, ELEMENTSTYLE_AGENDA_RENDEZVOUSSELECT, true, false,$rclParametres); $this->F7a3d9884('m_oStyleLibContenu', DERNIER_NON, ELEMENTSTYLE_AGENDA_LIBCONTENU, false, true,$rclParametres); $this->F7a3d9884('m_oStyleLibContenuSelect', DERNIER_NON, ELEMENTSTYLE_AGENDA_LIBCONTENUSELECT, false, true,$rclParametres); $rclParametres->F4ccc5457('m_nDimensionLateralePxConteneurMin', DERNIER_NON, $nDimensionLateralePxConteneurMin); if (false !== $bZoneJourneeComplete) $rclParametres->F4ccc5457("m_nHauteurZoneJourneeComplete", DERNIER_NON, $this->F68f10433($pclModele)); $rclParametres->F4ccc5457('m_nHauteurTitresHorizontal', DERNIER_NON, $nHauteurTitresHorizontal); $rclParametres->F4ccc5457('m_nLargeurTitresVertical', DERNIER_NON, $nLargeurTitresVertical); } function F68f10433(&$pclChampAgenda) { $nHauteurEd = $pclChampAgenda->m_nHauteurZoneJourneeCompleteEd; if ($nHauteurEd !== -1) return $nHauteurEd; Fa79fbf41('La hauteur d édition doit toujours être > -1'); return 34; } function F914c1476($pszParam , $eDernier , &$rclParametres) { $tabJoursSemaine = F7d16a969(); $rclParametres->F702c3cec($pszParam); $cszHeureFormate = ''; for ($nJour = 1; $nJour < 8; ++$nJour) { $rclParametres->Fba367465(null, (7 != $nJour) ? DERNIER_NON : DERNIER_OUI, ENCODAGE_CHAINE, $tabJoursSemaine[$nJour-1]); } $rclParametres->Ff1f57391($eDernier); } function F6057e8a2(&$pclChampAgenda) { $pszMasqueForceUser = $pclChampAgenda->Masque; if (F8b98af41($pszMasqueForceUser)) { $this->m_czMasqueTitreJour = $pszMasqueForceUser; } else { $this->F2d44acc1($this->m_czMasqueTitreJour); } } function F1b96c4c0($pszParam, $eDernier, $bToutModifieEffectif, &$rclParametres) { $nFlags = $this->F5c5271a6(); $bCouleurBordureAutomatique = false; $stOptionsCouleur = new stOPTIONSCOULEUR(false, false); $pclStyleRendezVous =& $this->m_pclModele->vpclGetElementStyleCadreLibelle(ELEMENTSTYLE_AGENDA_RENDEZVOUS, array(&$stOptionsCouleur)); $stOptionsCouleurContenu = new stOPTIONSCOULEUR(false, false); $pclStyleContenu =& $this->m_pclModele->vpclGetElementStyleCadreLibelle(ELEMENTSTYLE_AGENDA_LIBCONTENU, array(&$stOptionsCouleurContenu)); if (null !== $pclStyleContenu) { if (false !== $this->m_pclModele->Ffa0a9b1c($pclStyleContenu->m_clBordClair)) $bCouleurBordureAutomatique = true; } $clDateDebut = new CDateAgenda(); $clDateFin = new CDateAgenda(); $this->F0924d395($clDateDebut, $clDateFin); $tabRendezVous = array(); $this->m_pclModele->F2a8e6b09('', $clDateDebut, $clDateFin, $tabRendezVous, $nFlags); F04b3504c($tabRendezVous); $clResolution = new FMK_Date_Duree(F04e7ba0d('',10,true),'JHHMMSSLLL'); $this->m_pclModele->F76763e0b($clResolution, 3); $rclParametres->F702c3cec($pszParam); $bPremierRendezVousEcrit=true; $nNbElements = count($tabRendezVous,COUNT_NORMAL); for ($nRendezVous = 0; $nRendezVous < $nNbElements; ++$nRendezVous) { $pclEvenement =& $tabRendezVous[$nRendezVous]; if ( (false === $bToutModifieEffectif) && (!isset($this->m_tabIDEvenementsModifies[$pclEvenement->m_dwIDUnique])) ) { continue; } if (false === $bPremierRendezVousEcrit) $rclParametres->F63a1c0a8(); else $bPremierRendezVousEcrit = false; $this->Fe8b6b6c8( $pclEvenement , $bCouleurBordureAutomatique , $clResolution , $pclStyleRendezVous->F446c4a79() , $bToutModifieEffectif , $nRendezVous , $rclParametres); } $rclParametres->Ff1f57391($eDernier); $this->m_bToutModifie = false; $this->m_tabIDEvenementsModifies = array(); } function F8daf7f10($rcszRessource, &$rnRessource) { return 1; } function Fe8b6b6c8($pclRendezVous , $bCouleurBordureAutomatique , &$rclResolution , $clCouleurEveDefaut , $bToutModifieEffectif , $nRendezVous , &$rclParametres) { $nRessource = 0; $eResRessourceRendezVous = $this->F8daf7f10($pclRendezVous->m_sRessource, $nRessource); if (3 === $eResRessourceRendezVous) return; $rclParametres->F105675ec(); switch ($eResRessourceRendezVous) { case 0: break; case 1: break; case 2: $rclParametres->F4ccc5457('m_nRessource', DERNIER_NON, $nRessource); break; case 3: default: break; } $rclParametres->F23e52de1('m_sTitre', DERNIER_NON, true, $pclRendezVous->m_sTitre); $clCouleurEve = $this->m_pclModele->Fd625faec($pclRendezVous,false,$pclRendezVous->m_clCouleur); if ($clCouleurEve->m_dwColor !== $clCouleurEveDefaut->m_dwColor) { $rclParametres->F9d08d63c('m_cFondContenu', DERNIER_NON, false, true, $clCouleurEve); $rclParametres->F9d08d63c('m_cFondTitre', DERNIER_NON, false, true, $this->Fd6ff1800($clCouleurEve, 1.0)); } if (false !== $bCouleurBordureAutomatique) { $rclParametres->F9d08d63c('m_cBord', DERNIER_NON, false, true, $this->Fd6ff1800($clCouleurEve, 2.0)); } $clDateDebutReel = new CDateAgenda(); $clDateFinReel = new CDateAgenda(); $pclRendezVous->F9aa2e207($clDateDebutReel, $clDateFinReel, $rclResolution->getMilliseconde()); $rclParametres->F66e5880a('m_oDateDebut', DERNIER_NON, $clDateDebutReel); $rclParametres->F66e5880a('m_oDateFin', DERNIER_NON, $clDateFinReel); $rclParametres->F23e52de1('m_sContenu', DERNIER_NON, true, $pclRendezVous->m_sContenu); $rclParametres->F23e52de1('m_sCategorie', DERNIER_NON, true, $pclRendezVous->m_sCategorie); $rclParametres->F2f67ca8f('m_sIDUtilisateur', DERNIER_NON, true, $pclRendezVous->m_sID); $rclParametres->F4ccc5457('m_nImportance', DERNIER_NON, $pclRendezVous->m_nImportance); $rclParametres->F2f67ca8f('m_sImage', DERNIER_NON, true, $pclRendezVous->m_sImage); $rclParametres->F7373ec8a('m_bRepetee', DERNIER_NON, $pclRendezVous->m_clPeriodicite->m_bAvecRepetition); $rclParametres->F2f67ca8f('m_sBulle', DERNIER_NON, true, $pclRendezVous->m_sBulle); if (false === $bToutModifieEffectif) { $rclParametres->F4ccc5457('m_nIndice', DERNIER_NON, $nRendezVous); } $rclParametres->F7373ec8a('m_bJourneeEntiere', DERNIER_NON, $pclRendezVous->m_bJourneeEntiere); $pclRendezVousBase = null; if ( (false != $pclRendezVous->F29893c95($pclRendezVousBase)) && (null != $pclRendezVousBase)) { Fbd76389c($pclRendezVousBase); $clDateDebutBaseReel = new CDateAgenda(); $clDateFinBaseReel = new CDateAgenda(); $pclRendezVousBase->F9aa2e207($clDateDebutBaseReel, $clDateFinBaseReel, $rclResolution->getMilliseconde()); if (false === $clDateDebutReel->F0ee5647e($clDateDebutBaseReel)) $rclParametres->F7373ec8a('m_bSansRedimDebut', DERNIER_NON, true); if (false === $clDateFinReel->F0ee5647e($clDateFinBaseReel)) $rclParametres->F7373ec8a('m_bSansRedimFin', DERNIER_NON, true); } $this->F538f01fd('m_sID', DERNIER_OUI, $pclRendezVous, $rclParametres); $rclParametres->F1ebdc972(DERNIER_OUI); } function F538f01fd($pwzParam, $eDernier, &$pclRendezVous, &$rclParametres) { $rclParametres->F4ccc5457($pwzParam, $eDernier,$pclRendezVous->m_dwIDUnique); } } function Fc87fa6b6(&$pclChampAgenda,$eModeZoom) { switch ($eModeZoom) { default: case eZoom_Invalide: case eZoomJournee: case eZoomSemaine: break; case eZoomMois: case eZoomAnnee: return 0; } return $pclChampAgenda->F98c69881(); } function F2e6b777b($pclChampAgenda) { return 20; } class CVueChampPlanning_Web extends CVueChampAgenda_Web { function CVueChampPlanning_Web(&$pclModele) { parent::CVueChampAgenda_Web($pclModele); } function F73db2270(&$rtabEvenements) { parent::F73db2270($rtabEvenements); } function F0924d395(&$rclDateMin , &$rclDateMax){ return $this->F1d236653($rclDateMin, $rclDateMax); } function F5c5271a6() { $pclModele =& $this->m_pclModele; if ($pclModele->m_eModeAffichagePlanning === eModeAffPl_RessourceEnColonne) { return 0 | 1 | 2 | 16; } else { return 0 | 1; } } function Fd83eab1c(&$rclDate,$nOptionDV,$nZone) { if (($nOptionDV == 1) && $this->m_pclModele->F302508e9()) { $clDateDuJourMin = new CDateAgenda($rclDate); $clDateDuJourMin->m_dwHeure = $this->m_pclModele->m_clHeureDebutAff->m_dwHeure; $clDateDuJourMax = new CDateAgenda($rclDate); $clDateDuJourMax->m_dwHeure = $this->m_pclModele->m_clHeureFinAff->m_dwHeure; return ( $this->Fd83eab1c($clDateDuJourMin, 0,$nZone) && $this->Fd83eab1c($clDateDuJourMax, 0,$nZone)); } $clDateDebut = new CDateAgenda(); $clDateFin = new CDateAgenda(); $this->F0924d395($clDateDebut, $clDateFin); return ( $rclDate->F071fcbff($clDateDebut, $clDateFin) && (0 < $rclDate->Ff5b208cb($this->m_pclModele->m_clDateHeure1erLigneVisible))); } function Fb9c6a718(&$rclDateAvant, &$rclDateApres) { parent::Fb9c6a718($rclDateAvant, $rclDateApres); } function Fe5801fdf(&$pclNewEvenement, $nNewEvenement, $pszSaisieInitiale) { return parent::Fe5801fdf($pclNewEvenement, $nNewEvenement, $pszSaisieInitiale); } function F2daa5fea(&$pczMasqueTitreJour) { $pczMasqueTitreJour = 'JJJJ J MMMM AAAA'; } function F9bc4c544($ePropriete, $nIndex, $nFlag, $nParam) { switch ($ePropriete) { case RESSOURCE: $this->F941a3dcb(PROP_INVALID_MIN, Ffecd99cc($nFlag, nOMM_DEPUISSOUSELEMENT), $nParam); break; default: parent::F9bc4c544($ePropriete, $nIndex, $nFlag, $nParam); break; } } function Fe7708280(&$pclChampPlanning) { if (!$pclChampPlanning->F302508e9() || $pclChampPlanning->F0c6ce572()) { $nLargeur = 144; return $nLargeur; } return Fc87fa6b6($pclChampPlanning, eZoom_Invalide); } function F2fb423cc(&$pclChampPlanning) { return $pclChampPlanning->m_nLargeurOuHauteurMinRessource; } function F54911454(&$pclChampPlanning) { return $pclChampPlanning->m_nLargeurOuHauteurMinRessource; } function F47d9220c(&$pclChampPlanning, $nHauteur) { $nHauteurMin = $this->F2fb423cc($pclChampPlanning); return max($nHauteur, $nHauteurMin); } function F5d745dfa(&$pclChampPlanning, $nLargeur) { $nLargeurMin = $this->F54911454($pclChampPlanning); return max($nLargeur, $nLargeurMin); } function F31c8a0c9(&$pclChampPlanning, &$rclRectAllEve) { $nNbRessources = $pclChampPlanning->F802c4b0b(); if ($nNbRessources<=0) { $nNbRessources = 1; } $nLargeur1Res = floor($rclRectAllEve->F32954654() / $nNbRessources); $nLargeur1Res = $this->F5d745dfa($pclChampPlanning, $nLargeur1Res); return intval($nLargeur1Res); } function F7f6b7af3(&$pclChampPlanning) { $clRectAllEve = new CRectangle(); $this->F6abd7f4d($clRectAllEve); return $this->F31c8a0c9($pclChampPlanning, $clRectAllEve); } function Fd20dae0e(&$pclChampPlanning) { return F2e6b777b($pclChampPlanning); } function Fc99b650f(&$pclChampPlanning) { return $pclChampPlanning->F919da3cf(); } function Fdb7cfb6f() { return 100; } function Faef31cb5(&$pclChampPlanning) { if ($pclChampPlanning === null) return false; return ($pclChampPlanning !== null) ? $pclChampPlanning->F302508e9() : false; } function F139c439e($pclChampPlanning) { if ($pclChampPlanning->m_eModeAffichagePlanning === eModeAffPl_RessourceEnColonne) { return $this->Fc99b650f($pclChampPlanning); } else { return $this->F57b57b79($pclChampPlanning); } } function F57b57b79(&$pclChampPlanning) { $nNbLigne = $this->Ff5c5b7f0($pclChampPlanning); $nHauteur1Ligne =$pclChampPlanning->F919da3cf(); return $nNbLigne * $nHauteur1Ligne; } function Fb3e23af1($pclChampPlanning) { if ($pclChampPlanning->m_eModeAffichagePlanning === eModeAffPl_RessourceEnColonne) { return $this->F7f6b7af3($pclChampPlanning); } else { return $this->Ffc0a932d($pclChampPlanning); } } function Ffc0a932d($pclChampPlanning) { $clRectAllEve = new CRectangle(); $this->F6abd7f4d($clRectAllEve); return $this->Ffd47b2f4($pclChampPlanning, $clRectAllEve); } function Ffd47b2f4($pclChampPlanning, &$rclRectAllEve) { $nNbRessources = $pclChampPlanning->F802c4b0b(); if ($nNbRessources<=0) return 0; $nHauteur1Res = $rclRectAllEve->Feec6c4bd() / $nNbRessources; $nHauteur1Res = $this->F47d9220c($pclChampPlanning, $nHauteur1Res); return intval($nHauteur1Res); } function Ff5c5b7f0(&$pclChampPlanning) { $nNbLigne = 1; if ($this->Fefdb6d27($pclChampPlanning)) { ++$nNbLigne; } if ($this->F0f7cb2fa($pclChampPlanning)) { ++$nNbLigne; } $bModeDemiJournee= ($pclChampPlanning->F0c6ce572()); if ($this->Faef31cb5($pclChampPlanning) && !$bModeDemiJournee) { ++$nNbLigne; } if ($this->Ffb24b7b5($pclChampPlanning)) { ++$nNbLigne; } return $nNbLigne; } function Ffb24b7b5($pclChampPlanning) { $pszMasqueTitreJour = $pclChampPlanning->Masque; $pszPos1erRC = utf8_strpos($pszMasqueTitreJour,sSEPLIGNEMASKTITREJOURAGD); if ($pszPos1erRC === false) return false; $pszPos2emeRC = utf8_strpos($pszMasqueTitreJour, sSEPLIGNEMASKTITREJOURAGD, $pszPos1erRC+1); if ($pszPos2emeRC === false) return false; return true; } function Fefdb6d27($pclChampPlanning) { if ($pclChampPlanning->m_eModeAffichagePlanning === eModeAffPl_RessourceEnColonne) return false; $pszMasqueTitreJour = $pclChampPlanning->Masque; if ( utf8_strpos($pszMasqueTitreJour,sSEPLIGNEMASKTITREJOURAGD) !== false) return true; return false; } function F0f7cb2fa(&$pclChampPlanning) { if ($pclChampPlanning->F10489c4e()) return false; return $pclChampPlanning->Fcb7727d8(); } function F6abd7f4d(&$pstRectHeure) { $this->Fbfd86bf7($pstRectHeure); $pstRectHeure->top = $pstRectHeure->top + $this->F139c439e($this->m_pclModele); $pstRectHeure->left = $pstRectHeure->left + $this->F0271d090(); if ($this->m_pclModele->m_eModeAffichagePlanning === eModeAffPl_RessourceEnColonne) { $pstRectHeure->right -= 20; } else { $pstRectHeure->bottom -= 20; } } function Fd0d72590($eDernier, &$rclParametres) { $pclModele =& $this->m_pclModele; $this->Fa692cba0( $pclModele->m_nLargeurOuHauteurMinRessource , $this->F139c439e($pclModele) , $this->F0271d090() , eZoom_Invalide , $rclParametres); if ( (false != $pclModele->m_bDateHeure1erLigneVisibleParProgrammation) || (false == Feef890d7())) { $clDateHeure1erVisible =& $pclModele->m_clDateHeure1erLigneVisible; $rclParametres->F66e5880a('m_oDateDateHeure1erLigneVisible', DERNIER_NON, $clDateHeure1erVisible); } if (false != $pclModele->Fc5715ace()) { $rclParametres->F4ccc5457('m_n1erRessourceVisible', DERNIER_NON, $pclModele->Fbdf53127()); } $rclParametres->F4ccc5457('m_nDimensionPxGraduation', DERNIER_NON, $pclModele->m_nGraduationLargeurOuHauteurPixel); if ($pclModele->m_eModeAffichagePlanning === eModeAffPl_RessourceEnColonne) { $rclParametres->F4ccc5457('m_nHauteurLibJour', DERNIER_NON, $this->Fc80e66c7($pclModele)); } else { $bDessineLesHeures = $this->Faef31cb5($pclModele) && (false === ($pclModele->F0c6ce572())); $rclParametres->F7373ec8a('m_bLigneTitreMois', DERNIER_NON, $this->Fefdb6d27($pclModele)); $rclParametres->F7373ec8a('m_bLigneTitreSemaine', DERNIER_NON, $this->F0f7cb2fa($pclModele)); $rclParametres->F7373ec8a('m_bLigneTitreHeure', DERNIER_NON, $bDessineLesHeures); $rclParametres->F7373ec8a('m_bLigneTitreJourDouble', DERNIER_NON, $this->Ffb24b7b5($pclModele)); if ($bDessineLesHeures) { $nLargeur = Fc87fa6b6($pclModele,eZoom_Invalide); $nGraduationLargeur = $pclModele->m_nGraduationLargeurOuHauteurPixel; $nNbGraduationParHeureAffichee = $nLargeur / $nGraduationLargeur; if ($nNbGraduationParHeureAffichee != $nLargeur * $nGraduationLargeur) ++$nNbGraduationParHeureAffichee; $rclParametres->F4ccc5457('m_nNbGraduationParHeureAffichee', DERNIER_NON, floor($nNbGraduationParHeureAffichee)); } } $rclParametres->F4ccc5457('m_eModeAffichage', $eDernier, $pclModele->m_eModeAffichagePlanning); } function F1baaf559(&$rclDate, &$rcszJourFormate) { $pclModele =& $this->m_pclModele; if (false != $this->F0f7cb2fa($pclModele)) { $czNumeroDeSemaineFormatee = ''; $pclModele->F0ceb67f5($rclDate,$czNumeroDeSemaineFormatee); if (false !== $this->Fefdb6d27($pclModele)) { $tabLibelle = explode('|',$rcszJourFormate); if (count($tabLibelle)>1) { $rcszJourFormate = implode('|',array_merge(array($tabLibelle[0],$czNumeroDeSemaineFormatee),array_slice($tabLibelle,1))); } else { $rcszJourFormate.= ('|') . $czNumeroDeSemaineFormatee; } } else { $rcszJourFormate = $czNumeroDeSemaineFormatee . '|' . $rcszJourFormate; } } } function Fc80e66c7(&$pclChampPlanning) { if (!$this->F5bfbe2af($pclChampPlanning)) return 0; $nHauteurRupture = $pclChampPlanning->m_nHauteurRuptureJour; return $nHauteurRupture; } function F5bfbe2af(&$pclChampPlanning) { if ($pclChampPlanning->m_eModeAffichagePlanning !== eModeAffPl_RessourceEnColonne) return false; if (!$this->Faef31cb5($pclChampPlanning)) return false; if ($pclChampPlanning->m_nHauteurRuptureJour === 0) return false; return true; } function F5d67aaa5($eDernier, &$rclParametres) { if (false !== $this->Fc1c131ec()) { $this->Fc12ed48a(array(&$this, 'F77fa0d83'),'m_tabRessources', count($this->m_pclModele->m_tabRessources,COUNT_NORMAL), DERNIER_NON, $rclParametres); } XVERIFY(parent::F5d67aaa5($eDernier, $rclParametres)); } function F77fa0d83($nRessource, &$rclParametres) { $pclRessource =& $this->m_pclModele->Fcb6e6668($nRessource); if (null !== $pclRessource) { $rclParametres->F105675ec(); $rclParametres->F2f67ca8f('m_sNomAffiche', DERNIER_NON, true, $pclRessource->F1e31ec87(1)); $rclParametres->F4ccc5457('m_nRessource', DERNIER_OUI, $nRessource); $rclParametres->F1ebdc972(DERNIER_OUI); } } function F8daf7f10($rcszRessource, &$rnRessource) { $rnRessource = $this->m_pclModele->Fad1d8649($rcszRessource); if (-1 !== $rnRessource) { return 2; } else { return 3; } } function F0271d090() { if ($this->m_pclModele->m_eModeAffichagePlanning === eModeAffPl_RessourceEnColonne) { return $this->Fe7708280($this->m_pclModele); } else { return $this->m_pclModele->m_nLargeurZoneRessourceInitiale; } } } ?>