<?php
//20.0.56.0 WL/HF/FichierHF.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 class CConnexion extends CTypeComparable { var $ConnectID; var $bDynamique = false; var $nAcces; var $DataBase = null; var $sInfosEtendues; var $MotDePasse = null; var $sNom = ""; var $nTypeBase; var $Provider = 'WinDevMySQL'; var $Source = null; var $sSourceDonnees; var $Utilisateur = null; var $m_clAN = null; var $m_bCreeeParProgrammation = false; function CConnexion($sNom=null) { $this->sNom = $sNom; $this->ConnectID = false; $this->m_clAN = null; $this->nTypeBase = (string)TYPE_BASE_MYSQL; } function& F99e91b85() { $pclContexte =& FMK_ContextHF(); return $pclContexte->getConnexion($this->sNom); } function& GetUtilisateur() { return $this->Utilisateur; } function SetUtilisateur($pUtilisateur) { $this->Utilisateur = $pUtilisateur; if ($this->m_bCreeeParProgrammation) { $pclConnexion =& $this->F99e91b85(); $pclConnexion->Utilisateur = $pUtilisateur; } } function& GetSource() { return $this->sSourceDonnees; } function SetSource($pSource) { $this->sSourceDonnees = $pSource; if ($this->m_bCreeeParProgrammation) { $pclConnexion =& $this->F99e91b85(); $pclConnexion->sSourceDonnees = $pSource; } } function& GetServeur() { return $this->Source; } function SetServeur($pServeur) { $this->Source = $pServeur; if ($this->m_bCreeeParProgrammation) { $pclConnexion =& $this->F99e91b85(); $pclConnexion->Source = $pServeur; } } function& GetNom() { return $this->sNom; } function SetNom($pNom) { $this->sNom = $pNom; if ($this->m_bCreeeParProgrammation) { $pclConnexion =& $this->F99e91b85(); $pclConnexion->sNom = $pNom; } } function& GetMotDePasse() { return $this->MotDePasse; } function SetMotDePasse($pMotDePasse) { $this->MotDePasse = $pMotDePasse; if ($this->m_bCreeeParProgrammation) { $pclConnexion =& $this->F99e91b85(); $pclConnexion->MotDePasse = $pMotDePasse; } } function& GetInfosEtendues() { return $this->sInfosEtendues; } function SetInfosEtendues($pInfosEtendues) { $this->sInfosEtendues = $pInfosEtendues; if ($this->m_bCreeeParProgrammation) { $pclConnexion =& $this->F99e91b85(); $pclConnexion->sInfosEtendues = $pInfosEtendues; } } function& GetBaseDeDonnees() { return $this->DataBase; } function SetBaseDeDonnees($pBaseDeDonnées) { $this->DataBase = $pBaseDeDonnées; if ($this->m_bCreeeParProgrammation) { $pclConnexion =& $this->F99e91b85(); $pclConnexion->DataBase = $pBaseDeDonnées; } } function& GetAcces() { return $this->nAcces; } function SetAcces($pAcces) { $this->nAcces = $pAcces; if ($this->m_bCreeeParProgrammation) { $pclConnexion =& $this->F99e91b85(); $pclConnexion->nAcces = $pAcces; } } function& GetProvider() { return $this->Provider; } function SetProvider($sProvider) { if (!isset($sProvider) || ($sProvider=='')) $sProvider = 'WinDevMySQL'; $this->Provider = $sProvider; if ($this->m_bCreeeParProgrammation) { $pclConnexion =& $this->F99e91b85(); $pclConnexion->Provider = $sProvider; } $nTypeBase = null; switch (strtoupper($sProvider)) { case 'WINDEVAS400': $nTypeBase = TYPE_BASE_AS400; break; case "WINDEVMYSQL" : case "WINDEVMARIADB" : $nTypeBase = TYPE_BASE_MYSQL; break; case 'WINDEVPOSTGRESQL': $nTypeBase = TYPE_BASE_PGSQL; break; case 'WINDEVORACLE': $nTypeBase = TYPE_BASE_ORACLE; break; default: Fe81a7f9e('ERR_CONNEXION_PROVIDER_INVALIDE',$sProvider); } $this->nTypeBase = (string)$nTypeBase; if ($this->m_bCreeeParProgrammation) { $pclConnexion->nTypeBase = (string)$nTypeBase; } } function& GetValeur() { return $this->sNom; } function SetValeur($pclConnexion) { if (!is_object($pclConnexion)||(get_class($pclConnexion)!=get_class($this))) { Erreur('ErreurGenerique',FMK_ChaineConstruit(Fc34ec142('TYPE_INCOMPATIBLE'),F3b9ec4ca($this),F3b9ec4ca($pclConnexion))); return; } $this->ConnectID = $pclConnexion->ConnectID; $this->Source = $pclConnexion->Source; $this->Utilisateur = $pclConnexion->Utilisateur; $this->MotDePasse = $pclConnexion->MotDePasse; $this->DataBase = $pclConnexion->DataBase; $this->nTypeBase = $pclConnexion->nTypeBase; $this->nAcces = $pclConnexion->nAcces; $this->sInfosEtendues = $pclConnexion->sInfosEtendues; $this->sSourceDonnees = $pclConnexion->sSourceDonnees; if ($this->m_bCreeeParProgrammation) { $pclConnexion =& $this->F99e91b85(); $pclConnexion->SetValeur($pclConnexion); } } function& Fcc4f5b5d($comparaison) { $this->SetValeur($comparaison); return $this->GetValeur(); } function& F1e21db15() { $t = TYPEWL_CONNEXION; return $t; } function Fbe3f53b3() { return ($this->ConnectID !== false); } function Fb1d3d994($bErreur = true, $sMdp = null) { if ($bErreur && !F31e24e05($this->nTypeBase)) { Fe81a7f9e('ERR_TYPE_BASE_NON_SUPPORTE',$this->sNom,$this->nTypeBase); } $sMotDePasse = $this->MotDePasse; if(isset($sMdp)) { $sMotDePasse = $sMdp; } $sMessageErreur = ''; $bCreationReussie = Fc394fe3e($this->m_clAN,$sMessageErreur,$this->nTypeBase,$this->Source,$this->DataBase,$this->Utilisateur,$sMotDePasse,$this->sInfosEtendues); if (!$bCreationReussie) { if ($bErreur) { global $sLastFunction; Erreur('ErreurEchecConnexion',$sLastFunction, $this->DataBase, $this->Source, $sMessageErreur); } $this->m_clAN = null; return false; } return true; } function Fb640a0ce($bErreur = true, $sMdp = null, $bCreateDatabse = false) { $sMotDePasse = $this->MotDePasse; if(isset($sMdp)) { $sMotDePasse = $sMdp; } $bConnexionImpossible = false; if (!isset($this->m_clAN) ) { if (!$this->Fb1d3d994($bErreur,$sMdp)) { $bConnexionImpossible = true; } } if (!$bConnexionImpossible) { if(!$this->m_clAN->Fb640a0ce($bErreur,$sMotDePasse,$bCreateDatabse) || !$this->m_clAN->F849de7ed()) { $bConnexionImpossible = true; } } if ($bConnexionImpossible) { $pclMessageErreur = F1abae4f0(); if ($bErreur) { global $sLastFunction; Erreur('ErreurEchecConnexion',$sLastFunction, $this->DataBase, $this->Source, $pclMessageErreur); } $this->m_clAN = null; return false; } $this->ConnectID =& $this->m_clAN->m_resConnexionId; return true; } function F9d634e1a() { if (isset($this->m_clAN)) { $this->m_clAN->F9d634e1a(); } else { } } function F218cc1a0() { if (isset($this->m_clAN)) { $tabBaseDonnees = $this->m_clAN->F218cc1a0(); if ($tabBaseDonnees === false) return array(); return $tabBaseDonnees; } else { return null; } } function Fa7865f89($nOptions=null) { if (isset($this->m_clAN)) { $tabTables = $this->m_clAN->Fa7865f89($nOptions); if ($tabTables === false) return array(); return $tabTables; } else { return null; } } function F4b3597dc() { if (isset($this->m_clAN)) { $sInfo = $this->m_clAN->F4b3597dc(); return $sInfo; } else { return ''; } } function F5218fab1() { if (isset($this->m_clAN)) { $sInfo = $this->m_clAN->F5218fab1(); return $sInfo; } else { return ''; } } } class CFichierAnalyse extends CTypeComparable { var $sNom = ""; var $sNomLogique = ""; var $LastRubrique = null; var $BestRub = null; var $EnregCourant; var $EnregUtilisateur; var $bHTrouve = false; var $bHEnDehors = true; var $IdAuto = null; var $TabClePrimaire; var $TabCleUnique; var $TabCleDoublon; var $TabRubriqueNonCle; var $TabRubriques = array(); var $TabNomRubriqueSansAccent = array(); var $nTailleFetch = 100; var $bRealIdAuto = null; var $nIdModifFichier = 0; var $bAffecteParcours = false; var $EnregModif = null; var $sNomConnexion = ""; var $sAbreviation = ""; var $sFiltre = ""; var $bFiltreActif = false; var $sNomRubriqueFiltre = ""; var $bOuvert = false; var $nMode = H_REQUETE_DEFAUT; var $bSourceDonnees = false; var $m_bNouvelEnregistrement = true; var $sNomPhysique = ""; var $nResult = array(); var $tabBorneMin = null; var $tabBorneMax = null; var $sPF =""; var $sLibPF = ""; var $sNomAvecDelimiteurs; function CFichierAnalyse($tabInfosInit = null) { $this->m_nIsXXX |= 2; $this->sNom = isset($tabInfosInit[utf8_strtoupper(ATT_NOM_DANS_BDD)]) ? $tabInfosInit[utf8_strtoupper(ATT_NOM_DANS_BDD)] : $tabInfosInit[ATT_NOM]; $this->sNomLogique = $tabInfosInit[ATT_NOM]; $this->sNomPhysique = isset($tabInfosInit[ATT_NOMPHYSIQUE]) ? $tabInfosInit[ATT_NOMPHYSIQUE] : $this->sNom; if(isset($tabInfosInit[ATT_CONNEXION])) { $this->sNomConnexion = $tabInfosInit[ATT_CONNEXION]; $pclAN =& $this->Fb56717be($this->sNomConnexion,true); if (isset($pclAN)) $pclAN->Fbe71eca8($this,$tabInfosInit); } } function& GetNom() { $sNom = $this->sNom; return $sNom; } function F9047540f() { if (!empty($this->sNomAvecDelimiteurs)) return $this->sNomAvecDelimiteurs; $sNomFichier = $this->sNom; $pclAN = $this->Fb56717be(); if (!isset($pclAN)) return $sNomFichier; $sNomFichier = $pclAN->F98e40c2c($sNomFichier); $this->sNomAvecDelimiteurs = $pclAN->F57e42f93($sNomFichier); return $this->sNomAvecDelimiteurs; } function& F1e21db15() { $Valeur = $this->GetValeur(); $Type = F541bbf6d($Valeur); return $Type; } function Fa38b9988($bEtat) { $this->m_bNouvelEnregistrement = $bEtat; } function& GetNouvelEnregistrement() { return $this->m_bNouvelEnregistrement; } function& GetType() { return getRef(51); } function Fc36b6a50($sNom) { return (isset($this->TabRubriques[utf8_strtolower($sNom)]) && F9ef91cd8($this->TabRubriques[utf8_strtolower($sNom)])); } function F2c5c1106(&$Rubrique) { $this->TabRubriques[utf8_strtolower($Rubrique->sNom)] =& $Rubrique; $this->TabNomRubriqueSansAccent[F03771b65(utf8_strtolower($Rubrique->sNom))] = $Rubrique->sNom; if($Rubrique->Fa2afd757()) { $this->IdAuto = &$this->TabRubriques[utf8_strtolower($Rubrique->sNom)]; } if($Rubrique->Fecba8a60()) { if(!isset($this->TabClePrimaire)) $this->TabClePrimaire = array(); array_push($this->TabClePrimaire, $Rubrique->sNom); } switch($Rubrique->nType_Cle) { case CLE_UNIQUE : if(!isset($this->TabCleUnique)) $this->TabCleUnique = array(); if($Rubrique->Fbe67fb2c()) { array_unshift($this->TabCleUnique, $Rubrique->sNom); } else { $this->TabCleUnique[] = $Rubrique->sNom; } break; case CLE_AVEC_DOUBLON : if(!isset($this->TabCleDoublon)) $this->TabCleDoublon = array(); if($Rubrique->Fbe67fb2c()) { array_unshift($this->TabCleDoublon, $Rubrique->sNom); } else { $this->TabCleDoublon[] = $Rubrique->sNom; } break; default : case NON_CLE : if(!isset($this->TabRubriqueNonCle)) $this->TabRubriqueNonCle = array(); array_push($this->TabRubriqueNonCle, $Rubrique->sNom); break; } $Rubrique->Fichier =& $this; } function Fa15cf330(&$RubriqueParcours) { $TabRubriques = array(); $TabNomRubriques = array(); if(!isset($RubriqueParcours)) return $TabRubriques; $TabRubriques[] = &$RubriqueParcours; $TabNomRubriques[] = $RubriqueParcours->sNom; if($RubriqueParcours->Fa2afd757()) { return $TabRubriques; } if($RubriqueParcours->Fecba8a60()) { return $TabRubriques; } if(isset($this->IdAuto)) { $TabRubriques[] = &$this->IdAuto; return $TabRubriques; } if(isset($this->TabClePrimaire) ) { $ClePrimaire = &$this->TabRubriques[utf8_strtolower($this->TabClePrimaire[0])]; $TabRubriques[] = &$ClePrimaire; return $TabRubriques; } if(isset($this->TabCleUnique)) { foreach($this->TabCleUnique as $valeur) { if($valeur != $RubriqueParcours->sNom) { $Rubrique = &$this->TabRubriques[utf8_strtolower($valeur)]; if($Rubrique->Fbe67fb2c()) { $bOk = true; foreach($Rubrique->TabRubCleComp as $composante => $sens) { if(in_array($composante, $TabNomRubriques)) { $bOk = false; break; } } if($bOk) { $TabRubriques[] = &$Rubrique; foreach($Rubrique->TabRubCleComp as $composante => $sens) { $TabNomRubriques[] = $composante; } } } else { if(!in_array($valeur, $TabNomRubriques)) { $TabRubriques[] = &$Rubrique; $TabNomRubriques[] = $valeur; } } } } } if(isset($this->TabCleDoublon)) { foreach($this->TabCleDoublon as $valeur) { if($valeur != $RubriqueParcours->sNom) { $Rubrique = &$this->TabRubriques[utf8_strtolower($valeur)]; if($Rubrique->Fbe67fb2c()) { $bOk = true; foreach($Rubrique->TabRubCleComp as $composante => $sens) { if(in_array($composante, $TabNomRubriques)) { $bOk = false; break; } } if($bOk) { $TabRubriques[] = &$Rubrique; foreach($Rubrique->TabRubCleComp as $composante => $sens) { $TabNomRubriques[] = $composante; } } } else { if(!in_array($valeur, $TabNomRubriques)) { $TabRubriques[] = &$Rubrique; $TabNomRubriques[] = $valeur; } } } } } if(isset($this->TabRubriqueNonCle)) { foreach($this->TabRubriqueNonCle as $valeur) { if($valeur != $RubriqueParcours->sNom) { if(!in_array($valeur, $TabNomRubriques)) { $TabRubriques[] = &$this->TabRubriques[utf8_strtolower($valeur)]; } } } } return $TabRubriques; } function Fad8a73f6() { if(isset($this->BestRub)) { return; } if(empty($this->TabRubriques)) { Erreur('ErreurGenerique',Fc34ec142("ERR_WLL"),Fc34ec142("ERR_FATAL"), "Erreur interne HF. Le fichier ".$this->sNomLogique." n'a pas de rubriques." ); } else if(isset($this->IdAuto)) { $this->BestRub = &$this->IdAuto; } else if(!empty($this->TabClePrimaire)) { $sNomClePrimaire = $this->TabClePrimaire[0]; $this->BestRub = &$this->TabRubriques[utf8_strtolower($sNomClePrimaire)]; } else if(!empty($this->TabCleUnique)) { $sNomCle = $this->TabCleUnique[0]; $this->BestRub = &$this->TabRubriques[utf8_strtolower($sNomCle)]; } else if(!empty($this->TabCleDoublon)) { $sNomCle = $this->TabCleDoublon[0]; $this->BestRub = &$this->TabRubriques[utf8_strtolower($sNomCle)]; } else { foreach($this->TabRubriqueNonCle as $nom) { $rubrique = &$this->TabRubriques[utf8_strtolower($nom)]; if(!$rubrique->F5c7b90f9()) { $this->BestRub = &$rubrique; return; } } $rubrique = &$this->TabRubriques[utf8_strtolower($this->TabRubriqueNonCle[0])]; $this->BestRub = &$rubrique; } } function& getRubrique($sNomRubriqueParcours="", $bErreurSiInexistant = true) { $RetourParDefaut = null; if($sNomRubriqueParcours != "") { if ($this->nMode != H_REQUETE_SANS_CORRECTION) { if(!array_key_exists(utf8_strtolower(F03771b65($sNomRubriqueParcours)), $this->TabNomRubriqueSansAccent)) { $this->bHTrouve = false; global $sLastFunction; if ($bErreurSiInexistant) Erreur('ErreurRubriqueHFInconnue',$sLastFunction, $this->sNomLogique, $sNomRubriqueParcours); return $RetourParDefaut; } } else { $tmpRub = new CRubriqueAnalyse($sNomRubriqueParcours); return $tmpRub; } $sNom = $this->TabNomRubriqueSansAccent[utf8_strtolower(F03771b65($sNomRubriqueParcours))]; return $this->TabRubriques[utf8_strtolower($sNom)]; } else { if(isset($this->LastRubrique)) { return $this->LastRubrique; } else { $this->Fad8a73f6(); return $this->BestRub; } } } function& F133178d5($sNomRubrique) { $RetourParDefaut = null; if(array_key_exists(utf8_strtolower($sNomRubrique), $this->TabRubriques)) { $Rubrique = &$this->TabRubriques[utf8_strtolower($sNomRubrique)]; $Rubrique->Fichier = &$this; return $Rubrique; } Erreur('ErreurRubriqueHFInconnue','',$this->sNomLogique, $sNomRubrique); return $RetourParDefaut; } function Fd90f4b71(&$RubriqueParcours) { if(!isset($RubriqueParcours)) { return false; } $Buffer = &$RubriqueParcours->BufferParcours; if(isset($Buffer)) { $Buffer->sValeurRecherche = ""; $Buffer->raz($this->nIdModifFichier); } return true; } function Fd172163b(&$Rubrique) { $gclContextHF =& FMK_ContextHF(); $nIdPosition = -1; $Position = new FMK_Position($this, $this->bHTrouve, $this->bHEnDehors, $this->EnregCourant); $Position->bFiltreActif = $this->bFiltreActif; $Position->sFiltre = $this->sFiltre; $Position->sNomRubriqueFiltre = $this->sNomRubriqueFiltre; if(!isset($gclContextHF->TabPositions)) { $gclContextHF->TabPositions = array(); $gclContextHF->TabPositions[1] = &$Position; } else { $gclContextHF->TabPositions[] = &$Position; } $nIdPosition = count($gclContextHF->TabPositions); if(isset($Rubrique)) { if (!isset($Rubrique->Fichier)) { $Rubrique->Fichier =& $this; } $Rubrique->Fcc1f14ff($nIdPosition, $Position); } else { $TabNomRubrique = array_keys($this->TabRubriques); foreach($TabNomRubrique as $sNom) { $rub = &$this->TabRubriques[$sNom]; if(isset($rub)) { if (!isset($rub->Fichier)) { $rub->Fichier =& $this; } $rub->Fcc1f14ff($nIdPosition, $Position); } } } return $nIdPosition; } function Fe2cc55e7() { $pclAN =& $this->Fb56717be(); if (!isset($pclAN)) return true; return $pclAN->Fe2cc55e7($this); } function Fa7eacd58(&$Rubrique, $bAll = false) { if(!isset($this->EnregUtilisateur)) { $this->EnregUtilisateur = $this->F06b47f2e(); } else if($bAll) { $this->EnregUtilisateur = $this->F06b47f2e(); } else { $this->EnregUtilisateur[$Rubrique->sNom] = $Rubrique->F9b258a4a(); } $this->sNomAvecDelimiteurs = null; return true; } function F52830b80($sNomConnexion) { $gclContextHF =& FMK_ContextHF(); if(!array_key_exists(utf8_strtolower($sNomConnexion), $gclContextHF->TabConnexions)) { Erreur('ErreurConnexionInconnue',Fc34ec142("FCT_HCHANGE_CONNEXION"), $sNomConnexion); return false; } if($this->bOuvert && !$this->Fe2cc55e7()) { return false; } $this->sNomConnexion = $sNomConnexion; $tmp=null; $this->Fa7eacd58($tmp, true); return true; } function F020cb2dc($TabRub, $bUnique) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F020cb2dc($this,$TabRub,$bUnique); } function F08a30ecf($nFlags) { $bResultat = false; $bForceIdAuto = (($nFlags & H_FIXE_ID_AUTO) == H_FIXE_ID_AUTO) || (($nFlags & H_FORCE_ID_AUTO) == H_FORCE_ID_AUTO); $bAffecteParcours = (($nFlags & H_AFFECTE_PARCOURS) == H_AFFECTE_PARCOURS); if(!isset($this->EnregUtilisateur)) { $Enreg = $this->F06b47f2e(); $bResultat = $this->Fdaf2984b($Enreg, $bForceIdAuto); if($bResultat) { $this->F96c9cbe1($Enreg); } } else { $bResultat = $this->Fdaf2984b($this->EnregUtilisateur, $bForceIdAuto); if($bResultat) { $this->F96c9cbe1($this->EnregUtilisateur); } } if($bResultat) { $this->Fb908a8b7($bAffecteParcours); } return $bResultat; } function F3f143f5b($nFlags) { $bResultat = false; $bForceIdAuto = (($nFlags & H_FIXE_ID_AUTO) == H_FIXE_ID_AUTO) || (($nFlags & H_FORCE_ID_AUTO) == H_FORCE_ID_AUTO); $bAffecteParcours = (($nFlags & H_AFFECTE_PARCOURS) == H_AFFECTE_PARCOURS); if(!isset($this->EnregCourant)) { global $sLastFunction; Erreur('ErreurAucunEnregCourant',$sLastFunction, $this->sNomLogique); } else { $bResultat = $this->Fa159cbaa($bForceIdAuto); if($bResultat) { $this->F96c9cbe1($this->EnregUtilisateur); $this->Fb908a8b7($bAffecteParcours); } } return $bResultat; } function F8ca9a29d($nFlags) { $bResultat = false; if(!isset($this->EnregCourant)) { global $sLastFunction; Erreur('ErreurAucunEnregCourant',$sLastFunction, $this->sNomLogique); } else { $bResultat = $this->F90efb612(); if($bResultat) { if(isset($this->LastRubrique)) { $Buffer = &$this->LastRubrique->BufferParcours; if (isset($Buffer)) $Buffer->Ffc557a55(); } } } return $bResultat; } function F138cb69f(&$RubriqueParcours) { if(!isset($RubriqueParcours)) { return -1; } if(!isset($RubriqueParcours->BufferParcours)) { global $sLastFunction; Erreur('ErreurAucunParcours',$sLastFunction, $RubriqueParcours->sNom, $this->sNomLogique); } if(!isset($this->EnregCourant)) { global $sLastFunction; Erreur('ErreurAucunEnregCourant',$sLastFunction, $this->sNomLogique); } $nNbEnregTotal = $this->F7f79f122(0); if($nNbEnregTotal == 0) { return -1; } $nPosition = $this->F7ce1a2b2($RubriqueParcours, $this->EnregCourant); if($nPosition == -1) { return -1; } return round(($nPosition * 1000) / $nNbEnregTotal); } function F06b47f2e() { $Enreg = array(); $TabNomRubrique = array_keys($this->TabRubriques); foreach($TabNomRubrique as $sNom) { $Rubrique = &$this->TabRubriques[$sNom]; if(!$Rubrique->Fbe67fb2c()) { $Enreg[$Rubrique->sNom] = $Rubrique->F9b258a4a(); } } return $Enreg; } function Fb908a8b7($bAffecteParcours) { $this->nIdModifFichier++; $this->bAffecteParcours = $bAffecteParcours; $this->EnregModif = $this->EnregCourant; } function F41e5bf49($RubriqueParcours = null, $nSensParcours = PARCOURS_PREMIER_SUIVANT) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F41e5bf49($this,$RubriqueParcours,$nSensParcours); } function F06c56363() { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F06c56363($this); } function Fe8d9985a() { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->Fe8d9985a($this); } function F7653b31e() { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F7653b31e($this); } function Fd5be2853($TabRub, $nTypeParcours) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->Fd5be2853($this,$TabRub,$nTypeParcours); } function F5237a205($TabRub, $nTypeParcours, &$DernierEnregLu) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F5237a205($this,$TabRub,$nTypeParcours,$DernierEnregLu); } function F0fa6e24e(&$Rubrique, $sValeur, $nTypeCompare, $nTypeParcours = PARCOURS_PREMIER_SUIVANT, $bNull = true, $bNomRubriqueBase = false) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F0fa6e24e($this,$Rubrique,$sValeur,$nTypeCompare,$nTypeParcours,$bNull,$bNomRubriqueBase); } function F25514b5d($sValCleComp, $nTypeCompare, $nTypeParcours = PARCOURS_PREMIER_SUIVANT, $bNull, &$FirstComp) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F25514b5d($this,$sValCleComp,$nTypeCompare,$nTypeParcours,$bNull,$FirstComp); } function F96c9cbe1($Enreg) { $this->EnregCourant = $Enreg; $this->EnregUtilisateur = $Enreg; } function F475159c6($sMdp = null) { $gclContextHF =& FMK_ContextHF(); if ( (isset($this->sNomConnexion)) && (!empty($this->sNomConnexion)) && (array_key_exists(utf8_strtolower($this->sNomConnexion), $gclContextHF->TabConnexions))) { $Connexion = &$gclContextHF->TabConnexions[utf8_strtolower($this->sNomConnexion)]; if(!empty($sMdp)) { if($Connexion->m_clAN->F849de7ed($sMdp) || $Connexion->Fb640a0ce(true,$sMdp)) { $IdConnexion = $Connexion->m_clAN->m_resConnexionId; return $IdConnexion; } return false; } $IdConnexion = $Connexion->m_clAN->m_resConnexionId; if($IdConnexion != 0) { return $IdConnexion; } if($Connexion->m_clAN->F849de7ed() || $Connexion->Fb640a0ce(true)) { $IdConnexion = $Connexion->m_clAN->m_resConnexionId; return $IdConnexion; } return false; } global $sLastFunction; Erreur('ErreurConnexionInconnue',$sLastFunction, $this->sNomConnexion); return 0; } function F5095ecf4() { if(empty($this->sFiltre) || $this->bFiltreActif) { return true; } $this->bFiltreActif = true; $this->F167474d7(); return true; } function F018e8e04() { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F018e8e04($this); } function Fd3fe8fb0(&$pTableau) { $pTableau = array( $this->sFiltre, $this->bFiltreActif, $this->sNomRubriqueFiltre, ); } function F4fcf411f($Tableau) { $this->sFiltre = $Tableau[0]; $this->bFiltreActif = $Tableau[1]; $this->sNomRubriqueFiltre = $Tableau[2]; } function F167474d7() { $TabNomRubriques = array_keys($this->TabRubriques); foreach($TabNomRubriques as $sNomRubrique) { $Rubrique = &$this->TabRubriques[$sNomRubrique]; if($Rubrique->bRubriqueFiltre) { $Buffer = &$Rubrique->BufferParcours; if(isset($Buffer)) { $Buffer->raz($this->nIdModifFichier); $Buffer->bInitBuffer = true; } } } } function Fd7f91600(&$RubriqueParcours, $TabVal) { $pclAN =& $this->Fb56717be(); if (!isset($pclAN)) return false; $sFiltre = $pclAN->F38eab526($RubriqueParcours,$TabVal); if ($sFiltre===false) { return false; } $RubriqueParcours->bRubriqueFiltre = true; $this->sFiltre = $sFiltre; $this->sNomRubriqueFiltre = $RubriqueParcours->sNom; $this->bFiltreActif = true; return $RubriqueParcours->sNom; } function F402c595e(&$RubriqueParcours, $TabVal) { $pclAN =& $this->Fb56717be(); if (!isset($pclAN)) return false; $sFiltre = $pclAN->Fc64a4d72($RubriqueParcours,$TabVal); if ($sFiltre===false) { return false; } $RubriqueParcours->bRubriqueFiltre = true; $this->sFiltre = $sFiltre; $this->sNomRubriqueFiltre = $RubriqueParcours->sNom; $this->bFiltreActif = true; return $RubriqueParcours->sNom; } function Fcae1f5c6(&$RubriqueParcours, $TabVal) { $pclAN =& $this->Fb56717be(); if (!isset($pclAN)) return false; $sFiltre = $pclAN->F08fec282($this,$RubriqueParcours,$TabVal); if ($sFiltre===false) { return false; } $RubriqueParcours->bRubriqueFiltre = true; $this->sFiltre = $sFiltre; $this->sNomRubriqueFiltre = $RubriqueParcours->sNom; $this->bFiltreActif = true; return $RubriqueParcours->sNom; } function Fc7d0d5f9(&$CleComposee, $TabVal) { if(!isset($CleComposee)) { return ""; } $sValCle = ID_CLE_COMP; $nMin = min(count($TabVal), count($CleComposee->TabRubCleComp)); $TabComposantes = array_keys($CleComposee->TabRubCleComp); for($i=0;$i<$nMin;$i++) { if($i > 0) { $sValCle .= SEPARATEUR_COMPOSANTE; } $Composante = &$this->TabRubriques[utf8_strtolower($TabComposantes[$i])]; $TabVal[$i] = utf8_str_replace(H_VAL_MIN, $Composante->Fa73f5cc0(), $TabVal[$i]); $TabVal[$i] = utf8_str_replace(H_VAL_MAX, $Composante->F59cfd421(), $TabVal[$i]); $sValCle .= $Composante->sNom.SEPARATEUR_VALEUR.$TabVal[$i]; } return $sValCle; } function Fdf7ae7ff(&$Rubrique, $sFichier) { global $sLastFunction; if(!isset($Rubrique)) { return false; } if(!isset($this->EnregUtilisateur)) { $Enreg = $this->F06b47f2e(); $this->Fichier->EnregUtilisateur = $Enreg; } if ($Rubrique->nType != TYPE_MEMO_BINAIRE) { Erreur('ErreurHF_2_Param',"ErreurRubriqueMemoBinaire", $Rubrique->sNom, $this->sNomLogique, $sLastFunction); } if(!isset($sFichier)) { $this->EnregUtilisateur[$Rubrique->sNom] = $Rubrique->F9b258a4a(); return true; } DebutErreurAttendue(); $Content = file_get_contents(F9486bf1a($sFichier)); FinErreurAttendue(); if(!$Content) { Erreur('ErreurHF_1_Param',"ErreurAccesFichierExterne", $sFichier, $sLastFunction); return false; } $this->EnregUtilisateur[$Rubrique->sNom] = $Content; return true; } function F026989b4(&$Rubrique, $sFichier) { global $sLastFunction; if(!isset($Rubrique)) { return false; } if(!isset($this->EnregUtilisateur)) { return true; } if ($Rubrique->nType != TYPE_MEMO_BINAIRE) { Erreur('ErreurHF_2_Param',"ErreurRubriqueMemoBinaire", $Rubrique->sNom, $this->sNomLogique, $sLastFunction); } DebutErreurAttendue(); $id = fopen(F9486bf1a($sFichier),'w+'); FinErreurAttendue(); if(!$id) { Erreur('ErreurHF_1_Param',"ErreurAccesFichierExterne", $sFichier, $sLastFunction); return false; } DebutErreurAttendue(); $bEcritureReussie = fwrite($id,$this->EnregUtilisateur[$Rubrique->sNom]); FinErreurAttendue(); if(!$bEcritureReussie) { Erreur('ErreurHF_1_Param',"ErreurAccesFichierExterne", $sFichier, $sLastFunction); return false; } fclose($id); return true; } function& GetValeur() { $sNom = $this->sNomLogique ; return $sNom; } function& Fb56717be($sNomConnexion = null, $bSansErreur=false) { $ret = null; $pclContexteHF =& FMK_ContextHF(); $pclConnexion =& $pclContexteHF->getConnexion( (isset($sNomConnexion) ? $sNomConnexion : $this->sNomConnexion) ); if (isset($pclConnexion)) { if (!isset($pclConnexion->m_clAN)) { $pclConnexion->Fb1d3d994(!$bSansErreur,$pclConnexion->MotDePasse); } return $pclConnexion->m_clAN; } if ($bSansErreur) return $ret; Fe81a7f9e('ERR_CONNEXION_INDEFINIE',$this->sNomLogique); return $ret; } function& GetConnexion() { $pclConnexion = null; $pclContexteHF =& FMK_ContextHF(); $pclConnexion =& $pclContexteHF->getConnexion( $this->sNomConnexion ); return $pclConnexion; } function SetConnexion($pConnexion) { $this->sNomConnexion = $pConnexion; } function Ff83132b7(&$RubriqueParcours, $BorneMin = null, $BorneMax = null, $sConditionSelection= "") { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->Ff83132b7($this,$RubriqueParcours, $BorneMin, $BorneMax, $sConditionSelection); } function Fa84e48aa(&$RubriqueParcours, $bPremier = true, $nFlags = 0) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->Fa84e48aa($this,$RubriqueParcours, $bPremier, $nFlags); } function Fec3a1557(&$RubriqueParcours, $bSuivant = true, $nPas = 1) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->Fec3a1557($this,$RubriqueParcours, $bSuivant, $nPas); } function F218e30b2(&$RubriqueParcours, $sValeur, $bPremier = true, $nFlags = 0) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F218e30b2($this,$RubriqueParcours, $sValeur, $bPremier, $nFlags); } function F33a5022b($sMotDepasse) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F33a5022b($this,$sMotDepasse); } function Fffae753d($sMotDepasse, $bSiInexistant = false) { $pclAN =& $this->Fb56717be(); if (!isset($pclAN)) return false; return $pclAN->Fffae753d($this,$sMotDepasse,$bSiInexistant); } function Fba409abd($nIdConnexion, $sNomRequete= "") { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) $pclAN->Fba409abd($nIdConnexion, $this->sNomLogique , $sNomRequete); } function F0df7c3d7($nCodeErreur, $IdConnexion) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F0df7c3d7($nCodeErreur, $IdConnexion); } function F7ce1a2b2(&$Rubrique, $Enreg, $nSens = 0, $sValeurRecherche= "") { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F7ce1a2b2($this,$Rubrique, $Enreg, $nSens, $sValeurRecherche); } function F7f79f122($nFlags, $sValeurRecherche= "", $RubriqueParcours = null, $bFiltre = false) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F7f79f122($this,$nFlags, $sValeurRecherche, $RubriqueParcours, $bFiltre); } function F27cfe4f5() { $nIdAuto = 0; $nIdConnexion = $this->F475159c6(); $pclAN =& $this->Fb56717be(); $nIdAuto = (!isset($pclAN)) ? false : $pclAN->F27cfe4f5($this); if ($nIdAuto === false) { $this->Fba409abd($nIdConnexion); } return $nIdAuto; } function Fdaf2984b(&$Enreg, $bForceIdAuto = false) { $pclAN =& $this->Fb56717be(); $nIdConnexion = $this->F475159c6(); $nIdAuto = false; $sNomRubIdAuto = null; $clQueryStatement = (!isset($pclAN)) ? false : $pclAN->F7aeb10e1($this,$Enreg,$nIdAuto,$sNomRubIdAuto,$bForceIdAuto,true); if($clQueryStatement===false) { $this->Fba409abd($nIdConnexion); return false; } if ($nIdAuto!==false) { $this->EnregUtilisateur[$sNomRubIdAuto] = $nIdAuto; } return true; } function Fa159cbaa($bForceIdAuto = false) { $pclAN =& $this->Fb56717be(); if (!isset($pclAN)) return false; $nIdConnexion = $this->F475159c6(); if (!$this->bOuvert) { if(!F33a5022b($this)) { return false; } } XVERIFY( ($nResultQuery = $pclAN->Fbac1b32d($this,$bForceIdAuto)) <= 1); if($nResultQuery===false) { $this->Fba409abd($nIdConnexion); return false; } return true; } function F90efb612() { $pclAN =& $this->Fb56717be(); if (!isset($pclAN)) return false; $nIdConnexion = $this->F475159c6(); if (!$this->bOuvert) { if(!F33a5022b($this)) { return false; } } XVERIFY( ($nResultQuery = $pclAN->F100650c1($this)) === 1 ); if($nResultQuery===false) { $this->Fba409abd($nIdConnexion); return false; } return true; } function Fdc8698c9(&$Rubrique,$sValeur) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->Fdc8698c9($Rubrique,$sValeur); } function F137bdb94(&$Rubrique,$sValeur) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F137bdb94($Rubrique,$sValeur); } function Fc513efef($sRequeteSQL,$tabOptions=null) { $nIdConnexion = $this->F475159c6(); if (isset($tabOptions)&&!isset($tabOptions['SOURCE'])) $tabOptions['SOURCE'] = $this->Fa66a2d9c() ? 4 : 2; $pclSqlStatement = $this->F52651677($sRequeteSQL, $nIdConnexion, true, $tabOptions) ; if($pclSqlStatement===false) { $this->Fba409abd($nIdConnexion,$this->sNomLogique); } if($pclSqlStatement===false || $pclSqlStatement->F2262f69c() == 0) { $this->bHTrouve = false; $this->bHEnDehors = true; $gclContextHF =& FMK_ContextHF(); $gclContextHF->nNumErreur = 0; return false; } return $pclSqlStatement; } function Fa66a2d9c() { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->Fa66a2d9c($this); return ($this->m_nIsXXX == 4); } function F52651677($sRequeteSQL, $nIdConnexion, $bTestOuverture = false, $tabOptions = null) { if($bTestOuverture && !$this->bOuvert) { if(!F33a5022b($this)) { return false; } } $pclAN =& $this->Fb56717be(); if (isset($pclAN)) $resRequete = $pclAN->query($sRequeteSQL, $tabOptions, $this); return $resRequete; } function F1b8fc945(&$pclChamp) { $pclAN =& $this->Fb56717be(); if (isset($pclAN)) return $pclAN->F1b8fc945($pclChamp, $this); } function F91276a4c(&$pclStatement) { return $pclStatement->F5374034a(); } function& Faa097ba5($sNom) { $pclAN =& $this->Fb56717be(null,true); if (!isset($pclAN)) { $rub = new CRubriqueAnalyse($sNom); } else { $tabArgs = func_get_args(); $rub = call_user_func_array(array(&$pclAN,__FUNCTION__),$tabArgs); } return $rub; } } ?>