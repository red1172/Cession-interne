<?php
//20.0.56.0 WL/AJAX/Ajax.php GF 
//VersionVI: 30F200066p
//(c) 2005-2012 PC SOFT  - Release
 if (!defined('__INC__FMK/Dessin/Couleur.php')) { define('__INC__FMK/Dessin/Couleur.php',true); include_once(WB_INCLUDE_PATH.'WD2521e084cbaf10ef8d5f4ede4dc6baa2.php'); } if (!defined('__INC__FMK/Chaine.php')) { define('__INC__FMK/Chaine.php',true); include_once(WB_INCLUDE_PATH.'WD55acb2e708e26f23cb8956cd93e98123.php'); } if (!defined('__INC__FMK/Chaine/Conversion.php')) { define('__INC__FMK/Chaine/Conversion.php',true); include_once(WB_INCLUDE_PATH.'WD2763954cb0d71a3b844e3c73c65bc4a3.php'); } define('ACTION_AJAX_EXECUTE' , 'AJAXEXECUTE' ); define('ACTION_AJAX_CHAMP' , 'AJAXCHAMP' ); define('ACTION_AJAX_PAGE' , 'AJAXPAGE' ); define('ACTION_MENU_SUBMIT' , 'MENU_SUBMIT' ); define('CMD_EXECUTE_PROC' , 'EXECUTEPROC' ); define('CMD_EXECUTE_PROC_CHP' , 'EXECUTEPROCCHAMPS' ); define('CMD_EXECUTE' , 'EXECUTE' ); define('CMD_LIGNES_TABLE' , 'LIGNESTABLE' ); define('CMD_LIGNES_TRIABLE' , 'LIGNESTRITABLE' ); define('CMD_RECHERCHE_TABLE' , 'RECHERCHETABLE' ); define('CMD_MODIF_TABLE' , 'MODIFTABLE' ); define('CMD_SCROLLTABLE' , 'SCROLLTABLE' ); define('CMD_CLIC_TABLE' , 'CLICTABLE' ); define('CMD_CLIC_CALENDRIER_OLD' , 'CLICCALENDRIER' ); define('CMD_ACTIONCHAMP' , 'ACTIONCHAMP' ); define('szAJAXCOMMANDE_FILTRETABLE' , 'FILTRETABLE' ); define('szAJAXCOMMANDE_ANNULEFILTRETABLE' , 'ANNULEFILTRETABLE' ); define('szAJAXCOMMANDE_DEPLACECOLONNE' , 'DEPLACECOLONNE' ); define('szAJAXCOMMANDE_SAISIEASSISTEE' , 'SAISIEASSISTEE' ); define('PARAM_COL_TRI' , 'WD_TABLE_COL_TRI_' ); define('PARAM_TABLE_DEBUT' , 'WD_TABLE_DEBUT_' ); define('PARAM_TABLE_NOMBRE' , 'WD_TABLE_NOMBRE_' ); define('PARAM_TABLE_LIEN' , 'WD_TABLE_COL_LIEN_' ); define('PARAM_RECHERCHE_MARGE' , 'WD_TABLE_RECHERCHE_MARGE_' ); define('PARAM_RECHERCHE_NOMBRE' , 'WD_TABLE_RECHERCHE_NOMBRE_' ); define('PARAM_RECHERCHE_COLONNE' , 'WD_TABLE_RECHERCHE_COL_' ); define('PARAM_RECHERCHE_VALEUR' , 'WD_TABLE_RECHERCHE_VAL_' ); define('szFILTRE_FILTRE' , 'WD_TABLE_FILTRE_FILTRE_' ); define('szDEPLACE_COLONNE' , 'WD_TABLE_DEPLACE_COLONNE_' ); define('szDEPLACE_POSITION' , 'WD_TABLE_DEPLACE_POSITION_' ); define('CONTEXTE_AJAX' , 'WD_CONTEXTE_' ); define('ID_PCODE_CLIC' , 16); define('ID_PCODE_SELECTION_COMBO' , 47); define('TYPE_AJAX_UNDEF' ,0); define('TYPE_AJAX_BOOL' ,1); define('TYPE_AJAX_ENTIER' ,2); define('TYPE_AJAX_REEL' ,3); define('TYPE_AJAX_NUMERIQUE' ,4); define('TYPE_AJAX_CHAINE' ,5); define('TYPE_AJAX_DINO' ,6); define('XML_CHAMP_PROP_NUM_VALEUR' ,1); define('XML_CHAMP_PROP_NUM_LIBELLE' ,3); define('XML_CHAMP_PROP_NUM_HAUTEUR' ,5); define('XML_CHAMP_PROP_NUM_LARGEUR' ,6); define('XML_CHAMP_PROP_NUM_COULEUR' ,10); define('XML_CHAMP_PROP_NUM_COULEURFOND' ,11); define('XML_CHAMP_PROP_NUM_VISIBLE' ,18); define('XML_CHAMP_PROP_NUM_VALEURAFFICHEE' ,21); define('XML_CHAMP_PROP_NUM_IMAGE' ,34); define('XML_CHAMP_PROP_NUM_URL' ,38); define('XML_CHAMP_PROP_NUM_X' ,41); define('XML_CHAMP_PROP_NUM_Y' ,42); define('XML_CHAMP_PROP_NUM_OPACITE' ,52); define('XML_CHAMP_PROP_NUM_BULLE' ,39); define('XML_CHAMP_PROP_NUM_INDICATION' ,58); define('XML_CHAMP_PROP_NUM_POLICEGRAS' ,47); define('XML_CHAMP_PROP_NUM_POLICEITALIQUE' ,48); define('XML_CHAMP_PROP_NUM_POLICESOULIGNEE' ,50); define('XML_CHAMP_PROP_NUM_POLICETAILLE' ,51); define('XML_CHAMP_PROP_NUM_POLICENOM' ,49); define('XML_CHAMP_PROP_NUM_ETAT' ,12); define('XML_CHAMP_PROP_NUM_CURSEUR' ,43); define('XML_CHAMP_PROP_NUM_ENROULE' ,72); define('XML_CHAMP_PROP_NUM_SELECTIONNEE' ,55); define('XML_CHAMP_PROP_NUM_LIBELLEHTML' ,96); define('XML_CHAMP_PROP_NUM_CLASSE' ,113); define('HEADER_XML', 'WebDevXMLDoc'); function Faf10ef27(&$pclPage, $sNomAction, $SCRIPT_PARAM) { global $WB_ContexteAjax; switch($sNomAction) { case ACTION_MENU_SUBMIT: { F61288fff($pclPage, $SCRIPT_PARAM); } break; case ACTION_AJAX_PAGE : $WB_ContexteAjax = new FMK_ContexteAjax(); if(isset($SCRIPT_PARAM[CMD_EXECUTE])) { F61288fff($pclPage, $SCRIPT_PARAM); F3ecf4149(true); $WB_ContexteAjax->Fabaaa509($pclPage, CMD_EXECUTE, $SCRIPT_PARAM[CMD_EXECUTE], $SCRIPT_PARAM[CONTEXTE_AJAX]); return false; } else if(isset($SCRIPT_PARAM[CMD_SCROLLTABLE])) { F61288fff($pclPage, $SCRIPT_PARAM); $Reglette = &$pclPage->TabChamp[$SCRIPT_PARAM[CMD_SCROLLTABLE]]; if(isset($Reglette)) { F3ecf4149(true); $sNomPCode = $Reglette->F960e3ffe() . TRT_clic_Page; if(!function_exists($sNomPCode)) $sNomPCode = $Reglette->F960e3ffe()."CLICSER"; if(function_exists($sNomPCode)) { call_user_func_array($sNomPCode, array()); } $Reglette->F47301c2e($SCRIPT_PARAM[$Reglette->GetAlias()]); } return true; } break; case ACTION_AJAX_CHAMP : $WB_ContexteAjax = new FMK_ContexteAjax(); if(isset($SCRIPT_PARAM[CMD_EXECUTE])) { F61288fff($pclPage, $SCRIPT_PARAM); F3ecf4149(true); $WB_ContexteAjax->Fabaaa509($pclPage, CMD_EXECUTE, $SCRIPT_PARAM[CMD_EXECUTE], $SCRIPT_PARAM[CONTEXTE_AJAX]); return false; } elseif(isset($SCRIPT_PARAM[CMD_CLIC_TABLE])) { $sAlias = $SCRIPT_PARAM[CMD_CLIC_TABLE]; F61288fff($pclPage, $SCRIPT_PARAM); F3ecf4149(true); $WB_ContexteAjax->Fe655cfde(); $WB_ContexteAjax->F3b0ed96b(CMD_CLIC_TABLE, $sAlias, Fda3fb40b($SCRIPT_PARAM, 3)); return true; } elseif ((isset($SCRIPT_PARAM[CMD_CLIC_CALENDRIER_OLD]))||(isset($SCRIPT_PARAM[CMD_ACTIONCHAMP]))) { $sAlias = $SCRIPT_PARAM[CONTEXTE_AJAX]; if (isset($pclPage->TabChamp[$sAlias]) && ($pclPage->TabChamp[$sAlias]->GetType() === ID_CALENDRIER)) { F3ecf4149(true); if ($WB_ContexteAjax->F02e6fa4b(isset($SCRIPT_PARAM[CMD_CLIC_CALENDRIER_OLD]) ? CMD_CLIC_CALENDRIER : CMD_ACTIONCHAMP, $sAlias, $SCRIPT_PARAM)) return true; } } else if(isset($SCRIPT_PARAM[szAJAXCOMMANDE_SAISIEASSISTEE])) { $sAlias = $SCRIPT_PARAM[szAJAXCOMMANDE_SAISIEASSISTEE]; $WB_ContexteAjax->Fe655cfde(); global $MaPage; $Champ = &$MaPage->TabChamp[$sAlias]; if (isset($Champ)) { F3ecf4149(true); $Champ->F05bc6f05($SCRIPT_PARAM[$sAlias]); return true; } } if (isset($SCRIPT_PARAM[CMD_ACTIONCHAMP])) { return Fbc7be080($pclPage, $pclPage->TabChamp[$SCRIPT_PARAM[CONTEXTE_AJAX]], $SCRIPT_PARAM[CMD_ACTIONCHAMP], true, $SCRIPT_PARAM); } break; case ACTION_AJAX_EXECUTE : F3ecf4149(true); $WB_ContexteAjax = new FMK_ContexteAjax(); if(isset($SCRIPT_PARAM[CMD_EXECUTE_PROC])||isset($SCRIPT_PARAM[CMD_EXECUTE_PROC_CHP])) { $sNomProcedure = isset($SCRIPT_PARAM[CMD_EXECUTE_PROC_CHP]) ? $SCRIPT_PARAM[CMD_EXECUTE_PROC_CHP] : $SCRIPT_PARAM[CMD_EXECUTE_PROC]; $TabParametre = array(); $nIndiceParam = 1; while( isset($SCRIPT_PARAM["PA".$nIndiceParam]) || isset($SCRIPT_PARAM["PO".$nIndiceParam])) { if (isset($SCRIPT_PARAM["PA".$nIndiceParam])) $TabParametre[] =& $SCRIPT_PARAM["PA".$nIndiceParam]; else $TabParametre[] =& $SCRIPT_PARAM["PO".$nIndiceParam]; ++$nIndiceParam; } $resultat = F5126425e($sNomProcedure, $TabParametre); if (isset($SCRIPT_PARAM[CMD_EXECUTE_PROC_CHP])) { $WB_ContexteAjax->F855d8a27($resultat); return false; } F24d2b9db($resultat); return true; } elseif (isset($SCRIPT_PARAM[CMD_EXECUTE]) && ( ($SCRIPT_PARAM[CMD_EXECUTE]==TRT_clic_Page)||($SCRIPT_PARAM[CMD_EXECUTE]==TRT_optionmenu_Page) )) { $WB_ContexteAjax->Fabaaa509($pclPage, CMD_EXECUTE, $SCRIPT_PARAM[CMD_EXECUTE], $SCRIPT_PARAM[CONTEXTE_AJAX]); return false; } else if(isset($SCRIPT_PARAM[CMD_LIGNES_TABLE])) { $sAlias = $SCRIPT_PARAM[CMD_LIGNES_TABLE]; $WB_ContexteAjax->Fe655cfde(); $WB_ContexteAjax->F3b0ed96b(CMD_LIGNES_TABLE, $sAlias, Fda3fb40b($SCRIPT_PARAM, 3)); return true; } else if(isset($SCRIPT_PARAM[CMD_LIGNES_TRIABLE])) { $sAlias = $SCRIPT_PARAM[CMD_LIGNES_TRIABLE]; $WB_ContexteAjax->Fe655cfde(); $WB_ContexteAjax->F3b0ed96b(CMD_LIGNES_TRIABLE, $sAlias, Fda3fb40b($SCRIPT_PARAM, 3)); return true; } else if(isset($SCRIPT_PARAM[CMD_RECHERCHE_TABLE])) { $sAlias = $SCRIPT_PARAM[CMD_RECHERCHE_TABLE]; $WB_ContexteAjax->Fe655cfde(); $WB_ContexteAjax->F3b0ed96b(CMD_RECHERCHE_TABLE, $sAlias, Fda3fb40b($SCRIPT_PARAM, 3)); return true; } else if(isset($SCRIPT_PARAM[szAJAXCOMMANDE_DEPLACECOLONNE])) { $sAlias = $SCRIPT_PARAM[szAJAXCOMMANDE_DEPLACECOLONNE]; $WB_ContexteAjax->Fe655cfde(); $WB_ContexteAjax->F3b0ed96b(szAJAXCOMMANDE_DEPLACECOLONNE, $sAlias, Fda3fb40b($SCRIPT_PARAM, 3)); return true; } else if(isset($SCRIPT_PARAM[szAJAXCOMMANDE_FILTRETABLE])) { $sAlias = $SCRIPT_PARAM[szAJAXCOMMANDE_FILTRETABLE]; $WB_ContexteAjax->Fe655cfde(); $WB_ContexteAjax->F3b0ed96b(szAJAXCOMMANDE_FILTRETABLE, $sAlias, Fda3fb40b($SCRIPT_PARAM, 3)); return true; } else if(isset($SCRIPT_PARAM[szAJAXCOMMANDE_ANNULEFILTRETABLE])) { $sAlias = $SCRIPT_PARAM[szAJAXCOMMANDE_ANNULEFILTRETABLE]; $WB_ContexteAjax->Fe655cfde(); $WB_ContexteAjax->F3b0ed96b(szAJAXCOMMANDE_ANNULEFILTRETABLE, $sAlias, Fda3fb40b($SCRIPT_PARAM, 3)); return true; } else if(isset($SCRIPT_PARAM[CMD_SCROLLTABLE])) { $Reglette = &$pclPage->TabChamp[$SCRIPT_PARAM[CMD_SCROLLTABLE]]; if(isset($Reglette)) { $Reglette->bClicSurRegletteEnCours = true; $WB_ContexteAjax->Fe655cfde(); $Reglette->F47301c2e($SCRIPT_PARAM[$Reglette->GetAlias()]); } return true; } else if(isset($SCRIPT_PARAM[CMD_MODIF_TABLE])) { $sAlias = $SCRIPT_PARAM[CMD_MODIF_TABLE]; $WB_ContexteAjax->Fe655cfde(); $WB_ContexteAjax->F3b0ed96b(CMD_MODIF_TABLE, $sAlias, Fda3fb40b($SCRIPT_PARAM, 3)); return true; } break; } return false; } function Fda3fb40b($TabParametres, $nPremierParametre) { $params = array(); $nIndex = 1; $sSessionName = ini_get('session.name'); if (isset($TabParametres[$sSessionName])) { unset($TabParametres[$sSessionName]); } foreach ($TabParametres as $cle => $valeur) { if($nIndex >= $nPremierParametre) { $params[$cle] = $valeur; } ++$nIndex; } return $params; } function F85d8e16d($sNomProcedure) { global $WB_TabFnAjax; if ((!isset($WB_TabFnAjax)) || (!is_array($WB_TabFnAjax))) return false; $nLongueurNomProcedure = utf8_strlen($sNomProcedure); $WB_TabFnAjax_Keys = array_keys($WB_TabFnAjax); foreach ($WB_TabFnAjax_Keys as $key) { if (Fd1fcabe5($key,$sNomProcedure) == $nLongueurNomProcedure) return true; } return false; } function F5126425e($sNomProcedure, $TabValeurParametre, $bDepuisNomPHP=false) { global $WB_TabFnAjax; $TabTypeParametre = null; $clVM =& obtenirVM(); if(isset($WB_TabFnAjax)) { foreach($WB_TabFnAjax as $fonction) { if(!is_array($fonction)) continue; $sNom = key($fonction); if ($bDepuisNomPHP) { $sNomPHP = $clVM->Ff06e3e53($sNom); if (isset($sNomPHP)) $sNom = $sNomPHP; } if(utf8_strcasecmp($sNom, $sNomProcedure) === 0) { $TabTypeParametre = current($fonction); break; } } } $bFonctionExiste = function_exists($sNomProcedurePHP = ($bDepuisNomPHP ? $sNomProcedure : $clVM->Ff06e3e53($sNomProcedure))); if(( !isset($TabTypeParametre)&&isset($TabValeurParametre)&&is_array($TabValeurParametre)&&count($TabValeurParametre,COUNT_NORMAL)>0)) { if ($bFonctionExiste) { return F5126425e($sNomProcedurePHP,$TabValeurParametre, true); } Erreur('ErreurWL_1_Param',"ErreurProcedureInconnueAjax", $sNomProcedure); return null; } else { $nIndex = 0; if (isset($TabTypeParametre)) foreach ($TabTypeParametre as $nType) { switch ($nType) { case TYPE_AJAX_BOOL : $TabValeurParametre[$nIndex] = (bool)$TabValeurParametre[$nIndex]; break; case TYPE_AJAX_CHAINE : $TabValeurParametre[$nIndex] = (string)$TabValeurParametre[$nIndex]; break; case TYPE_AJAX_ENTIER : $TabValeurParametre[$nIndex] = (int)$TabValeurParametre[$nIndex]; break; case TYPE_AJAX_NUMERIQUE : case TYPE_AJAX_REEL : $TabValeurParametre[$nIndex] = (double)$TabValeurParametre[$nIndex]; break; case TYPE_AJAX_DINO : $TabValeurParametre[$nIndex] =& F7b3eb9c8($TabValeurParametre[$nIndex]); break; case TYPE_AJAX_UNDEF : default : break; } ++$nIndex; } DebutErreurAttendue(); if (PHPVERSION_5_3) foreach (array_keys($TabValeurParametre) as $tabindex) $TabValeurParametre[$tabindex] =& $TabValeurParametre[$tabindex]; $return =& VersPrimitif(call_user_func_array($sNomProcedurePHP, $TabValeurParametre) ); FinErreurAttendue(); return $return; } return null; } function F24d2b9db($retour) { global $WB_ContexteAjax; FMK_Charge('WL/XML/XML.php',false); if(!isset($WB_ContexteAjax)) { $WB_ContexteAjax = new FMK_ContexteAjax(); } if(!isset($retour)) { echo ""; } else { $docXML = Fb9098312($retour, false); if(isset($docXML)) { header(HEADER_XML.": ".$retour); $bUTF8 = false; global $MaPage; if(isset($MaPage) && $MaPage->bUTF8 = true) { $bUTF8 = true; } if($bUTF8) { header("Content-Type: text/xml; charset=utf-8"); $retour = (UNICODE_PAGE_UTF8 ? $retour : _cp1252_to_utf8($retour)); } else { header("Content-Type: text/xml; charset=iso-8859-1"); } echo Ff4eeaced($retour); } else { header("Content-Type: text/plain; charset=iso-8859-1"); echo $retour; } } $WB_ContexteAjax->m_bReponseConstruite = true; } function F742091de() { global $WB_ContexteAjax; return $WB_ContexteAjax->Ff980317d(); } function F4c16799e($sNomChamp, $nIdPropriete) { global $WB_ContexteAjax; $WB_ContexteAjax->Ff6cbbfff($sNomChamp, $nIdPropriete); } function F8ab7cd18($sNomChamp, $nEtat) { global $WB_ContexteAjax; $WB_ContexteAjax->F4be2ec67($sNomChamp, $nEtat); } function F2afdeace($sNomChamp) { global $WB_ContexteAjax; $WB_ContexteAjax->F8a7bd543($sNomChamp); } function Ffbcbe502($Url, $MoreHeader) { global $WB_ContexteAjax; $WB_ContexteAjax->m_TabModifChamp[] = new FMK_RedirectionAjax($Url, $MoreHeader); } function F9402f437($sNomChamp, &$ChampTable) { if ($ChampTable->F4a917fa4() == 11) { F055fb2fe($sNomChamp, $ChampTable); return ; } global $WB_ContexteAjax; $bChampAvecOperationsAjaxEncours = array_key_exists($ChampTable->m_sNomPHP, $WB_ContexteAjax->m_TabModifChamp); if ($bChampAvecOperationsAjaxEncours && isset($WB_ContexteAjax->m_TabModifChamp[$ChampTable->m_sNomPHP]->sAction) && $WB_ContexteAjax->m_TabModifChamp[$ChampTable->m_sNomPHP]->sAction == CMD_LIGNES_TABLE) { return; } if(!$bChampAvecOperationsAjaxEncours || (!isset($WB_ContexteAjax->m_TabModifChamp[$ChampTable->m_sNomPHP]->m_bModifContenu)||!$WB_ContexteAjax->m_TabModifChamp[$ChampTable->m_sNomPHP]->m_bModifContenu)) { $ChampTable->F76aaaac4(); $Reglette = &$ChampTable->Reglette; if(isset($Reglette)) { $WB_ContexteAjax->Ff6cbbfff($Reglette->m_sNomPHP, XML_CHAMP_PROP_NUM_VALEUR); } } $WB_ContexteAjax->F8a7bd543($ChampTable->m_sNomPHP); } function F055fb2fe($sNomChamp, &$ChampZR) { if ($ChampZR->F4a917fa4() != 11) { F9402f437($sNomChamp, $ChampZR); return ; } global $WB_ContexteAjax; if(!array_key_exists($ChampZR->m_sNomPHP, $WB_ContexteAjax->m_TabModifChamp) || (!isset($WB_ContexteAjax->m_TabModifChamp[$ChampZR->m_sNomPHP]->m_bModifContenu))|| (!$WB_ContexteAjax->m_TabModifChamp[$ChampZR->m_sNomPHP]->m_bModifContenu)) { $ChampZR->F76aaaac4(); $Reglette = &$ChampZR->Reglette; if(isset($Reglette)) { $WB_ContexteAjax->Ff6cbbfff($Reglette->m_sNomPHP, XML_CHAMP_PROP_NUM_VALEUR); } } $WB_ContexteAjax->F8a7bd543($ChampZR->m_sNomPHP); } function F694db118($sNomChamp) { global $WB_ContexteAjax; $WB_ContexteAjax->Fdf205e4c($sNomChamp); } function F2930536a($sCodeJS) { global $WB_ContexteAjax; $WB_ContexteAjax->F9ba8d8eb($sCodeJS); } function Fea4f23e5($sTrace) { global $WB_ContexteAjax; if (isset($WB_ContexteAjax)) $WB_ContexteAjax->F32278025($sTrace); } function F71e92e30() { global $WB_ContexteAjax; $WB_ContexteAjax->Fe655cfde(); } function F5e65e3cf($sTexte) { return F5192ea98(utf8_htmlspecialchars($sTexte, ENT_QUOTES)); } function F5192ea98($s) { return $s; } function Fd02cc4ce($bUTF8) { return $bUTF8 ? '<?xml version="1.0" encoding="utf-8" ?>' : '<?xml version="1.0" encoding="iso-8859-1" ?>'; } class FMK_ContexteAjax { var $m_TabModifChamp = array(); var $m_TabCodeJSFoncWL = null; var $m_ChampPCode = ''; var $m_sTrace = ''; var $m_sAliasActionTable = null; var $m_sActionTable = null; var $m_bReponseConstruite = false; var $m_pclModifAjaxCourante = null; var $m_sResultat = null; function FMK_ContexteAjax() { $clContexte =& F4a1887ce(); $this->m_sTrace = ''; $sMessage = utf8_strip_tags( $clContexte->F239ddeda('TraceMessage') ); $this->m_sTrace = (!isset($sMessage)) ? '' : F5e65e3cf($clContexte->F239ddeda('TraceMessage')); } function getTrace() { return $this->m_sTrace; } function F855d8a27($Valeur) { $this->m_sResultat = $Valeur; } function Ff6cbbfff($sNomChamp, $nIdPropriete) { $modif = null; if(array_key_exists($sNomChamp, $this->m_TabModifChamp)) { $modif = &$this->m_TabModifChamp[$sNomChamp]; } else { $modif = new FMK_ModifAjaxChamp($sNomChamp); $this->m_TabModifChamp[$sNomChamp] = &$modif; } $modif->Fa2e62e39($nIdPropriete); } function F4be2ec67($sNomChamp, $nEtat) { $modif = null; if(array_key_exists($sNomChamp, $this->m_TabModifChamp)) { $modif = &$this->m_TabModifChamp[$sNomChamp]; } else { $modif = new FMK_ModifAjaxChamp($sNomChamp); $this->m_TabModifChamp[$sNomChamp] = &$modif; } $modif->Fa2e62e39(XML_CHAMP_PROP_NUM_ETAT); } function F8a7bd543($sNomChamp) { $modif = null; if(array_key_exists($sNomChamp, $this->m_TabModifChamp)) { $modif = &$this->m_TabModifChamp[$sNomChamp]; } else { $modif = new FMK_ModifAjaxChamp($sNomChamp); $this->m_TabModifChamp[$sNomChamp] = &$modif; } $modif->F3f4b73b8(true); } function Fdf205e4c($sNomChamp) { $modif = null; if(array_key_exists($sNomChamp, $this->m_TabModifChamp)) { $modif = &$this->m_TabModifChamp[$sNomChamp]; } else { $modif = new FMK_ModifAjaxChamp($sNomChamp); $this->m_TabModifChamp[$sNomChamp] = &$modif; } $modif->Fa3440b27(true); } function F9ba8d8eb($sCodeJS) { if(!isset($this->m_TabCodeJSFoncWL)) { $this->m_TabCodeJSFoncWL = array(); } $this->m_TabCodeJSFoncWL[] = new FMK_FoncWLAjax($sCodeJS); } function F32278025($sTrace) { if(!empty($this->m_sTrace)) { $this->m_sTrace .= "\r\n"; } $this->m_sTrace .= F5e65e3cf($sTrace); } function Fe655cfde() { $this->m_sTrace = ''; } function F99c63beb($bUTF8) { if($this->m_bReponseConstruite) { return; } $sReponse = ''; $this->m_pclModifAjaxCourante = null; $modifAjax = reset($this->m_TabModifChamp); while(isset($modifAjax) && $modifAjax !== false) { $this->m_pclModifAjaxCourante =& $modifAjax; $sResponseCourante = $modifAjax->F6f99da24(); $sReponse = $sResponseCourante . $sReponse; $modifAjax = next($this->m_TabModifChamp); } $this->m_pclModifAjaxCourante = null; if(isset($this->m_TabCodeJSFoncWL)) { foreach ($this->m_TabCodeJSFoncWL as $CodeJS) { $sReponse .= $CodeJS->F6f99da24(); } } if (isset($this->m_sResultat)) { $sReponse .= "<RESULTAT><![CDATA[" . $this->m_sResultat . "]]></RESULTAT>"; } $sReponse .= "</WAJAX>"; $sDebutReponse = Fd02cc4ce($bUTF8); $sDebutReponse .= "<WAJAX>"; $sTrace=$this->getTrace(); if ($sTrace!='') $sDebutReponse .= "<TRACE>".$sTrace."</TRACE>"; $sReponse = $sDebutReponse . $sReponse; header("Content-Type: text/xml"); if($bUTF8) { $sReponse = (UNICODE_PAGE_UTF8 ? $sReponse : _cp1252_to_utf8($sReponse)); header("charset: utf-8"); } else { header("charset: iso-8859-1"); } echo $sReponse; } function Fabaaa509(&$pclPage, $sNomCommande, $ValeurCommande, $sContexte) { if(!isset($sNomCommande) ||empty($sNomCommande)) { return; } switch($sNomCommande) { case CMD_EXECUTE : $this->m_ChampPCode = $sContexte; } } function F3b0ed96b($sAction, $sAlias, $param) { $modif = new FMK_ModifActionTable($sAlias, $sAction); $modif->Fc9b0732b($param); global $MaPage; if (isset($MaPage)) { $pclChamp =& $MaPage->TabChamp[$sAlias]; if (isset($pclChamp)) { $this->m_TabModifChamp[$pclChamp->m_sNomPHP] = &$modif; } } if (!isset($pclChamp)) { $this->m_TabModifChamp[$sAlias] = &$modif; } } function F02e6fa4b($sAction, $sAliasChamp, $tabParam) { global $MaPage; $Champ =& $MaPage->TabChamp[$sAliasChamp]; if(isset($Champ)) { switch($sAction) { case CMD_CLIC_CALENDRIER_OLD : case CMD_ACTIONCHAMP : if(isset($tabParam)) { return F94839a76($Champ,$tabParam[$sAction]); } break; default: return false; } return true; } return false; } function Ff980317d() { return $this->m_ChampPCode; } } class FMK_ModifAjax { function F6f99da24() { } function F4032a799($nIdPropriete, &$Champ) { $sAttributs = ''; $bBesoinDeConvert2XML = true; switch($nIdPropriete) { case XML_CHAMP_PROP_NUM_COULEUR : $nCouleur = $Champ->GetCouleur(); if($nCouleur == -1) { $return = ""; } else $return = '#'.F5bfcd185($nCouleur); break; case XML_CHAMP_PROP_NUM_COULEURFOND : $nCouleurFond = $Champ->GetCouleurFond(); if($nCouleurFond == -1) { $return = ""; } else $return = '#'.F5bfcd185($nCouleurFond); break; case XML_CHAMP_PROP_NUM_LIBELLEHTML : $return = $Champ->GetLibelleRiche(); break; case XML_CHAMP_PROP_NUM_LIBELLE : $return = $Champ->GetLibelle(); break; case XML_CHAMP_PROP_NUM_URL : $return = $Champ->GetURL(); break; case XML_CHAMP_PROP_NUM_VALEUR : if ($Champ->F4a917fa4() == 21) { $return = "<![CDATA["; $return .= $Champ->F16d5955d(); $return .= "]]>"; $bBesoinDeConvert2XML = false; } else $return = $Champ->F16d5955d(); break; case XML_CHAMP_PROP_NUM_VISIBLE : if ($Champ->m_bParentRelatif===true) { $sAttributs = 'PARENTRELATIF="1"'; } $return = ($Champ->GetVisible()?'1':'0'); break; case XML_CHAMP_PROP_NUM_LARGEUR: $return = $Champ->GetLargeur(); break; case XML_CHAMP_PROP_NUM_HAUTEUR : $return = $Champ->GetHauteur(); break; case XML_CHAMP_PROP_NUM_VALEURAFFICHEE : $bBesoinDeConvert2XML = false; $return = $Champ->GetValeurAffichee(); break; case XML_CHAMP_PROP_NUM_OPACITE : $return = $Champ->GetOpacite(); break; case XML_CHAMP_PROP_NUM_BULLE : $return = $Champ->GetBulle(); break; case XML_CHAMP_PROP_NUM_INDICATION: $return = $Champ->GetIndication(); break; case XML_CHAMP_PROP_NUM_POLICEGRAS : $return = $Champ->F96efd01f(); break; case XML_CHAMP_PROP_NUM_POLICEITALIQUE : $return = ($Champ->GetPoliceItalique()?'1':'0'); break; case XML_CHAMP_PROP_NUM_POLICESOULIGNEE : $return = ($Champ->GetPoliceSoulignee()?'1':'0'); break; case XML_CHAMP_PROP_NUM_POLICETAILLE : $return = $Champ->GetPoliceTaille(); break; case XML_CHAMP_PROP_NUM_POLICENOM : $return = $Champ->GetPoliceNom(); break; case XML_CHAMP_PROP_NUM_ETAT : $return = $Champ->GetEtat(); break; case XML_CHAMP_PROP_NUM_X: $return = $Champ->GetX(); break; case XML_CHAMP_PROP_NUM_Y: $return = $Champ->GetY(); break; case XML_CHAMP_PROP_NUM_CLASSE: $return = $Champ->GetClasseSupp(); break; case CONTENU_WEB: return $Champ->F6107e7bd(true, false); break; case PROP_INVALID_MIN: $sContenuHTML = $Champ->pszGetContenuHTML(); if (isset($Champ->m_pclListeFaaSauveSaisie)) return $sContenuHTML; $return = "<![CDATA[" . $sContenuHTML . "]]>"; $bBesoinDeConvert2XML = false; break; default : return ""; break; } if (!empty($sAttributs)) $sAttributs = ' '.$sAttributs; return "<PROP NUM=\"".$nIdPropriete."\"".$sAttributs.">" . ($bBesoinDeConvert2XML ? F5e65e3cf($return) : $return) . "</PROP>"; } } class FMK_FoncWLAjax extends FMK_ModifAjax { var $m_sCodeJS = ''; function FMK_FoncWLAjax($sCodeJS) { $this->m_sCodeJS = $sCodeJS; } function F6f99da24() { return "<JS>".$this->m_sCodeJS."</JS>"; } } class FMK_RedirectionAjax extends FMK_ModifAjax { var $m_sPage = ''; var $m_sHeaders = ''; function FMK_RedirectionAjax($sPage,$sHeaders) { $this->m_sHeaders = $sHeaders; $this->m_sPage = $sPage; } function F6f99da24() { $Url = $this->m_sPage; if ($this->m_sHeaders !== '') { $Url .= '?'.$this->m_sHeaders; } return '<REDIR>'.$Url.'</REDIR>'; } } class FMK_ModifAjaxChamp extends FMK_ModifAjax { var $m_sNomChamp; var $m_TabIdPropriete = null; var $m_bModifContenu = false; var $m_bModifSelection = false; var $m_TabCodeJS = null; function FMK_ModifAjaxChamp($sNomChamp) { $this->m_sNomChamp = $sNomChamp; } function F3f4b73b8($bModif) { $this->m_bModifContenu = $bModif; } function Fa3440b27($bModif) { $this->m_bModifSelection = $bModif; } function Fa2e62e39($nIdPropriete) { if(!isset($this->m_TabIdPropriete)) { $this->m_TabIdPropriete = array(); } if(!in_array($nIdPropriete, $this->m_TabIdPropriete)) { $this->m_TabIdPropriete[] = $nIdPropriete; } } function Fbf6de367($sCode) { if(!isset($this->m_TabCodeJS)) { $this->m_TabCodeJS = array(); } $this->m_TabCodeJS[] = $sCode; } function F6f99da24() { $sCodeXML = ""; $sCodeXML_Additionnel = ""; $Champ =& F9abbf335($this->m_sNomChamp,IND_CHAMP); if(isset($Champ) && (!isset($Champ->m_bInterne) || $Champ->m_bInterne!==true)) { $sCodeXML .= "<CHAMP ALIAS=\"".$Champ->F048cc3de()."\" TYPE=\"".$Champ->F4a917fa4()."\">"; if(isset($this->m_TabIdPropriete)) { foreach ($this->m_TabIdPropriete as $nIdPropriete) { if ( isset($Champ->Table) && ($Champ->F70cea20e()) && ($Champ->GetType()>=20001) && ($Champ->GetType()<=20006) ) { $Table =& $GLOBALS[$Champ->Table]; if(isset($Table)) $sCodeXML_Additionnel .= '<CHAMP ALIAS="'.$Table->GetAlias().'" TYPE="'.$Table->F4a917fa4().'"><REFRESH RESETTABLE="1"/></CHAMP>'; } $sCodeXML .= $this->F4032a799($nIdPropriete,$Champ); } } if(isset($this->m_TabCodeJS)) { foreach ($this->m_TabCodeJS as $sCodeJS) { $sCodeXML .= "<JS>".F5e65e3cf($sCodeJS)."</JS>"; } } if($this->m_bModifContenu) { $sCodeXML .= $Champ->F236bb7fa(); } else if($this->m_bModifSelection) { $sCodeXML .= $Champ->F7b5c0e7a(); } $sCodeXML .= "</CHAMP>"; } return $sCodeXML.$sCodeXML_Additionnel; } function F4032a799($nIdPropriete, &$Champ) { $sXML=''; switch($nIdPropriete) { case XML_CHAMP_PROP_NUM_ETAT: { $clAjax = new FMK_ModifChampEtat($Champ); return $clAjax->F6f99da24(); } break; case XML_CHAMP_PROP_NUM_VALEUR: { if ($Champ->F70cea20e() && isset($Champ->eTypeImage) && $Champ->eTypeImage==2) $sXML = '<RECHARGE />'; } break; default: ; } return parent::F4032a799($nIdPropriete, $Champ) . $sXML; } } class FMK_ModifChampEtat extends FMK_ModifAjax { var $m_sXML; var $m_pclChamp; function FMK_ModifChampEtat(&$Champ) { $this->m_sXML = ''; $this->m_pclChamp = $Champ; } function F6f99da24() { $Champ =& $this->m_pclChamp; $eEtat = $Champ->Etat; switch ($Champ->F4a917fa4()) { case 4: case 22: case 79: { $this->F13df93d0($Champ, $eEtat); $this->F0d6f3b9c('READONLY', $eEtat == ETAT_CHAMP_INACTIF); $this->F0d6f3b9c('DISABLED', $eEtat == ETAT_CHAMP_GRISE); $this->F46efa6fa('.disabled', ETAT_CHAMP_GRISE == $eEtat); } break; case 2: if ($Champ->Fd2c2cc01()) { $this->Fc2922831('<PROP NUM="'); $this->Fc2922831(XML_CHAMP_PROP_NUM_ETAT); $this->Fc2922831('" />'); } else { $this->F13df93d0($Champ, $eEtat); $this->F930eab0b($Champ); } break; default: } return $this->m_sXML; } function F930eab0b(&$pclChamp) { switch($this->m_pclChamp->Etat) { case ETAT_CHAMP_INACTIF : $this->Fab8b5732('.readOnly=true'); $this->Fab8b5732('.disabled=false'); break; case ETAT_CHAMP_GRISE : $this->Fab8b5732('.readOnly=true'); $this->Fab8b5732('.disabled=true'); break; default : $this->Fab8b5732('.readOnly=false'); $this->Fab8b5732('.disabled=false'); break; } } function F13df93d0(&$pclObjet, $eEtatObjet) { $this->Fc2922831('<PROP NUM="'); $this->Fc2922831(XML_CHAMP_PROP_NUM_ETAT); $this->Fc2922831('" ETAT="'); $this->Fc2922831($eEtatObjet); $this->Fc2922831('">'); if (!empty($pclObjet->m_sDynHref)) { $this->Fc2922831('<DYN_HREF '); $this->Fc2922831($pclObjet->m_sDynHref); $this->Fc2922831('/>'); } $this->Fc2922831('</PROP>'); } function F0d6f3b9c($pszAttribut, $bPresent) { $this->Fc2922831('<JS>'); if ($bPresent) $this->Fc2922831('.setAttributeNode(document.createAttribute("'); else $this->Fc2922831('.removeAttribute("'); $this->Fc2922831($pszAttribut); if ($bPresent) $this->Fc2922831('"))'); else $this->Fc2922831('")'); $this->Fc2922831('</JS>'); } function F46efa6fa($pszProp, $bValeur) {$this->F29df975c($pszProp, $bValeur ? 'true' : 'false', false); } function F29df975c($pszProp, $pszValeur, $bQuote) { $bQuote = $bQuote ? '"' : ''; $this->Fab8b5732($pszProp . '=' . $bQuote . $pszValeur . $bQuote); } function Fab8b5732($sCodeJS){ $this->m_sXML.= '<JS>' . F5e65e3cf($sCodeJS) . '</JS>'; } function F429249f1($sCode) { $this->m_sXML.= F5e65e3cf($sCode); } function Fc2922831($sCode) { $this->m_sXML.= $sCode; } } class FMK_ModifActionTable extends FMK_ModifAjax { var $sAliasChamp = ''; var $sAction = ''; var $tabParam = null; var $m_bModificationDuContenuPendantClicTable=false; function FMK_ModifActionTable($sAlias, $sAction) { $this->sAliasChamp = $sAlias; $this->sAction = $sAction; } function F3f4b73b8($bModif) { $this->m_bModificationDuContenuPendantClicTable=true; } function Fa3440b27($bModif) { } function Fc9b0732b($param) { $this->tabParam = $param; } function F6f99da24() { $sCodeXML = ""; global $MaPage; $Champ = &$MaPage->TabChamp[$this->sAliasChamp]; if(isset($Champ)) { reset($this->tabParam); switch($this->sAction) { case CMD_LIGNES_TABLE : if(isset($this->tabParam)) { $nIndiceDebut = key($this->tabParam); $nNbLignes = current($this->tabParam); $sCodeXML = $Champ->Fd937dfb3($nIndiceDebut, $nNbLignes); } break; case CMD_LIGNES_TRIABLE : if(isset($this->tabParam)) { $nIndiceDebut = key($this->tabParam); $nNbLignes = current($this->tabParam); next($this->tabParam); $nIndiceColonneTri = 0; $bSens = true; if(key($this->tabParam) == PARAM_COL_TRI) { $nIndiceColonneTri = current($this->tabParam); if(utf8_strpos($nIndiceColonneTri, '-') === 0) { $nIndiceColonneTri = utf8_substr($nIndiceColonneTri,1); $bSens = false; } } $Champ->Fe67060d9($nIndiceColonneTri + 1, $bSens); $sCodeXML = $Champ->Fd937dfb3($nIndiceDebut, $nNbLignes); } break; case CMD_CLIC_TABLE : if(isset($this->tabParam)) { $nIndiceDebut = $this->tabParam[PARAM_TABLE_DEBUT]; $nNbLignes = $this->tabParam[PARAM_TABLE_NOMBRE]; $sSelectionLignes = $this->tabParam[$this->sAliasChamp]; $selection = utf8_explode(';',$sSelectionLignes); $Champ->F3fee29dd($selection); if(isset($selection) && count($selection) > 0) { $bCodeSelectionTraite = false; $nIndiceColLien = $this->tabParam[PARAM_TABLE_LIEN]; empileVM($MaPage->Nom,$Champ->m_sNomPHP); $Champ->F03b82a62($selection[0] + 1); if (isset($nIndiceColLien) && $nIndiceColLien>0 && isset($Champ->TabColonnes[$nIndiceColLien])) { $bCodeSelectionTraite = $Champ->Ff8a71d2b($Champ->TabColonnes[$nIndiceColLien],true); } Ff094e78e(); } if ($this->m_bModificationDuContenuPendantClicTable) { $nIndiceDebut=0; $nNbLignes=$Champ->F1ac18ca4(); } if($Champ->F48dce54a()) { if(isset($Champ->TabPosition[$Champ->Valeur])) { Fe4e65a90($Champ->TabPosition[$Champ->Valeur], H_RP_CONSERVE); } } $sCodeXML = $Champ->Fd937dfb3($nIndiceDebut, $nNbLignes); } break; case szAJAXCOMMANDE_DEPLACECOLONNE: if(isset($this->tabParam)) { $nColonne = intval($this->tabParam[szDEPLACE_COLONNE]); $nPosition = intval($this->tabParam[szDEPLACE_POSITION]); if (!is_array($Champ->TabColonneAff)) { $Champ->TabColonneAff=array(); $i=0; while(isset($Champ->TabColonnes[$i+1])) $Champ->TabColonneAff[] = $i++; } $nIndiceAff = array_search($nColonne,$Champ->TabColonneAff); unset($Champ->TabColonneAff[$nIndiceAff]); $Champ->TabColonneAff[(string)($nPosition-0.5)] = $nColonne; ksort($Champ->TabColonneAff); $Champ->TabColonneAff = array_values($Champ->TabColonneAff); $sCodeXML = $Champ->Fd937dfb3(0, count($Champ->TabLigne,COUNT_NORMAL)); } break; case szAJAXCOMMANDE_ANNULEFILTRETABLE: if(isset($this->tabParam)) { $nMarge = $this->tabParam[PARAM_RECHERCHE_MARGE]; $nNombre = $this->tabParam[PARAM_RECHERCHE_NOMBRE]; if ( ($nNombre < 0) || ( (0 == $nNombre) && (0 != $nMarge)) || ( (0 < $nNombre) && ($nMarge <= 0))) return; $nColonneFiltre = intval($this->tabParam[PARAM_RECHERCHE_COLONNE])+1; $Champ->F87f3f9f2($nColonneFiltre); if ($Champ->F48dce54a()) { $Champ->Feb0bfada(TA_DEBUT); } $Colonne =& $Champ->GetColonne($nColonneFiltre); $Colonne->m_nFiltreEncours=0; $sCodeXML = $Champ->Fd937dfb3(0, ( $nNombre + 2 * $nMarge),0); } break; case szAJAXCOMMANDE_FILTRETABLE: if(isset($this->tabParam)) { $nMarge = $this->tabParam[PARAM_RECHERCHE_MARGE]; $nNombre = $this->tabParam[PARAM_RECHERCHE_NOMBRE]; if ( ($nNombre < 0) || ( (0 == $nNombre) && (0 != $nMarge)) || ( (0 < $nNombre) && ($nMarge <= 0))) return; $nColonneFiltre = intval($this->tabParam[PARAM_RECHERCHE_COLONNE])+1; $eFiltre = $this->tabParam[szFILTRE_FILTRE]; $pszValeur = $this->tabParam[PARAM_RECHERCHE_VALEUR]; if ($pszValeur=='') return; $Champ->F87f3f9f2($nColonneFiltre); $Champ->Fac671d6a($nColonneFiltre, $eFiltre, $pszValeur); if ($Champ->F48dce54a()) { $Champ->Feb0bfada(TA_DEBUT); } $Colonne =& $Champ->GetColonne($nColonneFiltre); $Colonne->m_nFiltreEncours=$eFiltre; $sCodeXML = $Champ->Fd937dfb3(0, ( $nNombre + 2 * $nMarge),0); } break; case CMD_RECHERCHE_TABLE : if(isset($this->tabParam)) { $nMarge = $this->tabParam[PARAM_RECHERCHE_MARGE]; $nNbLignes = $this->tabParam[PARAM_RECHERCHE_NOMBRE]; $nIndiceColonneRecherche = $this->tabParam[PARAM_RECHERCHE_COLONNE]; $sValeurRecherche = $this->tabParam[PARAM_RECHERCHE_VALEUR]; $Champ->Fe67060d9($nIndiceColonneRecherche + 1, true); $Colonne = $Champ->GetColonne($nIndiceColonneRecherche+1); if ( ($nRecherche = $Colonne->TableCherche($sValeurRecherche, false)) == -1) $nRecherche = $Colonne->TableCherche(Fd9124f10($sValeurRecherche), false); $nIndiceDebut = ($Champ->GetType()===ID_TABLEHIERARCHIQUE) ? 0 : max(0, $nRecherche - $nMarge); $nNbLignes = $nNbLignes + 2 * $nMarge; $sCodeXML = $Champ->Fd937dfb3($nIndiceDebut, $nNbLignes, max(0,$nRecherche)); } break; case CMD_MODIF_TABLE : if(isset($this->tabParam)) { $sCodeXML = $Champ->Fc4748612($this->tabParam); } break; } } return $sCodeXML; } } ?>